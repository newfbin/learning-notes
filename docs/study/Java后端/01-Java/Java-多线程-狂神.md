###  1.çº¿ç¨‹ è¿›ç¨‹ å¤šçº¿ç¨‹

å¤šçº¿ç¨‹ï¼šå¤šæ¡æ‰§è¡Œè·¯å¾„ï¼Œ**ä¸»çº¿ç¨‹ä¸å­çº¿ç¨‹å¹¶è¡Œäº¤æ›¿æ‰§è¡Œ**ï¼ˆæ™®é€šæ–¹æ³•åªæœ‰ä¸»çº¿ç¨‹ä¸€æ¡è·¯å¾„ï¼‰ã€‚

ç¨‹åºï¼šæŒ‡ä»¤å’Œæ•°æ®çš„æœ‰åºé›†åˆï¼Œæœ¬èº«æ²¡æœ‰ä»»ä½•è¿è¡Œçš„å«ä¹‰ï¼Œæ˜¯ä¸€ä¸ªé™æ€çš„æ¦‚å¿µã€‚

è¿›ç¨‹ï¼š**åœ¨æ“ä½œç³»ç»Ÿä¸­è¿è¡Œçš„ç¨‹åº**å°±æ˜¯è¿›ç¨‹ï¼Œå³æ‰§è¡Œç¨‹åºçš„ä¸€æ¬¡æ‰§è¡Œè¿‡ç¨‹ï¼Œæ˜¯ä¸€ä¸ªåŠ¨æ€çš„æ¦‚å¿µã€‚

**ä¸€ä¸ªè¿›ç¨‹å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹**ï¼Œæ¯”å¦‚è§†é¢‘ä¸­åŒæ—¶å¬å£°éŸ³ï¼Œçœ‹å›¾åƒï¼Œçœ‹å¼¹å¹•ç­‰ã€‚

**çº¿ç¨‹æ˜¯CPUè°ƒåº¦å’Œæ‰§è¡Œçš„åŸºæœ¬å•ä½ã€‚**

```
æ³¨æ„ï¼š
 å¾ˆå¤šå¤šçº¿ç¨‹æ˜¯æ¨¡æ‹Ÿå‡ºæ¥çš„ï¼ŒçœŸæ­£çš„å¤šçº¿ç¨‹æ˜¯æŒ‡æœ‰å¤šä¸ªcpuï¼Œå³å¤šæ ¸ï¼Œå¦‚æœåŠ¡å™¨ã€‚å¦‚æœæ˜¯æ¨¡æ‹Ÿå‡ºæ¥çš„å¤šçº¿ç¨‹ï¼Œå³åœ¨ä¸€ä¸ªcpuçš„æƒ…å†µä¸‹ï¼Œåœ¨åŒä¸€ä¸ªæ—¶é—´ç‚¹ï¼Œ
cpuåªèƒ½æ‰§è¡Œä¸€ä¸ªä»£ç ï¼Œå› ä¸ºåˆ‡æ¢çš„å¾ˆå¿«ï¼Œæ‰€ä»¥å°±æœ‰åŒæ—¶æ‰§è¡Œçš„é”™è§‰ã€‚
```

#### æ ¸å¿ƒæ¦‚å¿µ

- çº¿ç¨‹å°±æ˜¯ç‹¬ç«‹çš„æ‰§è¡Œè·¯å¾„
- åœ¨ç¨‹åºè¿è¡Œæ—¶,å³ä½¿è‡ªå·±æ²¡æœ‰åˆ›å»ºçº¿ç¨‹,åå°ä¹Ÿä¼šæœ‰å¤šä¸ªçº¿ç¨‹,æ¯”å¦‚ä¸»çº¿ç¨‹,GCçº¿ç¨‹(Javaç¨‹åºé»˜è®¤æœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼Œmainçº¿ç¨‹å’ŒGCçº¿ç¨‹)
- main()ç§°ä¹‹ä¸ºä¸»çº¿ç¨‹,ä¸ºç³»ç»Ÿçš„å…¥å£,ç”¨äºæ‰§è¡Œæ•´ä¸ªç¨‹åº
- åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­,å¦‚æœå¼€è¾Ÿäº†å¤šä¸ªçº¿ç¨‹,**çº¿ç¨‹çš„è¿è¡Œæ˜¯ç”±è°ƒåº¦å™¨ï¼ˆcpuï¼‰å®‰æ’è°ƒåº¦çš„**,è°ƒåº¦å™¨æ˜¯ä¸æ“ä½œç³»ç»Ÿç´§å¯†ç›¸å…³çš„,å…ˆåé¡ºåºæ˜¯ä¸èƒ½äººä¸ºå¹²é¢„çš„
- å¯¹åŒä¸€ä»½èµ„æºæ“ä½œæ—¶ ä¼š**å­˜åœ¨èµ„æºæŠ¢å¤ºçš„é—®é¢˜,éœ€è¦åŠ å…¥å¹¶å‘æ§åˆ¶**
- çº¿ç¨‹ä¼šå¸¦æ¥é¢å¤–çš„å¼€é”€,å¦‚CPUè°ƒåº¦æ—¶é—´,å¹¶å‘æ§åˆ¶å¼€é”€
- æ¯ä¸ªçº¿ç¨‹åœ¨è‡ªå·±çš„å·¥ä½œå†…å­˜äº¤äº’,å†…å­˜æ§åˆ¶ä¸å½“ä¼šé€ æˆæ•°æ®ä¸ä¸€è‡´

### 2.çº¿ç¨‹åˆ›å»º

ä¸‰ç§æ–¹å¼ï¼š

1. ç»§æ‰¿Threadç±»ï¼ˆé‡ç‚¹ï¼‰
2. å®ç°Runnableæ¥å£ï¼ˆé‡ç‚¹ï¼‰
3. å®ç°Callableæ¥å£ï¼ˆäº†è§£ï¼‰

#### æ–¹æ³•1ï¼šThreadç±»

1. è‡ªå®šä¹‰çº¿ç¨‹ç±» ç»§æ‰¿`Thread`ç±»
2. é‡å†™`run()`æ–¹æ³•ï¼Œç¼–å†™çº¿ç¨‹æ‰§è¡Œä½“
3. åˆ›å»ºçº¿ç¨‹å¯¹è±¡ï¼Œè°ƒç”¨`start()`æ–¹æ³•å¯åŠ¨çº¿ç¨‹

```java
package com.mine.demo01;
//çº¿ç¨‹ä¸ä¸€å®šç«‹å³æ‰§è¡Œï¼Œç”±CPUå®‰æ’è°ƒåº¦
public class TestThread1 extends Thread{
    @Override
    public void run() {
        //runæ–¹æ³•çº¿ç¨‹ä½“
        for (int i = 0; i < 20; i++) {
            System.out.println("runæ–¹æ³•çº¿ç¨‹--"+i);
        }
    }

    public static void main(String[] args) {
        //åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å¯¹è±¡
        TestThread1 thread1 = new TestThread1();
        //start()å¼€å¯çº¿ç¨‹
        thread1.start();

        //mainä¸»çº¿ç¨‹
        for (int i = 0; i < 1000; i++) {
            System.out.println("ä¸»çº¿ç¨‹--"+i);
        }
    }
//è¿è¡Œç»“æœå¹¶å‘æ‰§è¡Œ,ç©¿æ’æ‰“å°
}
```

##### ä¾‹å­ï¼šä¸‹è½½å›¾ç‰‡

```java
package com.mine.demo01;

import org.apache.commons.io.FileUtils;

import java.io.File;
import java.io.IOException;
import java.net.URL;

/*
ç»ƒä¹ Threadï¼Œå®ç°å¤šçº¿ç¨‹åŒæ­¥ä¸‹è½½å›¾ç‰‡
 */
public class TestThread2 extends Thread{

    private String url; //ç½‘ç»œå›¾ç‰‡åœ°å€
    private String name; //ä¿å­˜çš„æ–‡ä»¶å

    public TestThread2(String url,String name){
        this.url=url;
        this.name=name;
    }

    @Override
    public void run() {
        WebDownloader webDownloader = new WebDownloader();
        webDownloader.downloader(url,name);
        System.out.println("ä¸‹è½½äº†æ–‡ä»¶åä¸ºï¼š"+name);
    }

    public static void main(String[] args) {
        TestThread2 thread1 = new TestThread2("https://img-blog.csdnimg.cn/20210427081055529.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10," + "text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZsbG93X3dpbmQ=,size_16,color_FFFFFF,t_70","1.jpg");
        TestThread2 thread2 = new TestThread2("https://img-blog.csdnimg.cn/20210427081055529.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10," +    "text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZsbG93X3dpbmQ=,size_16,color_FFFFFF,t_70","2.jpg");
        TestThread2 thread3 = new TestThread2("https://img-blog.csdnimg.cn/20210427081055529.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10," +                "text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZsbG93X3dpbmQ=,size_16,color_FFFFFF,t_70","3.jpg");

        thread1.start();
        thread2.start();
        thread3.start();
        /*
        ç»“æœå¹¶æ²¡æœ‰æŒ‰é¡ºåºæ‰§è¡Œï¼Œä¸”æ¯æ¬¡è¿è¡Œç»“æœä¸ä¸€æ ·
         */
    }
}

//ä¸‹è½½å™¨
class WebDownloader{
    //ä¸‹è½½æ–¹æ³•
    public void downloader(String url,String name){
        try {
            FileUtils.copyURLToFile(new URL(url),new File(name));
        } catch (IOException e) {
            e.printStackTrace();
            System.out.println("ioå¼‚å¸¸ï¼Œdownloaderæ–¹æ³•å‡ºç°é—®é¢˜");
        }
    }
}
```

#### æ–¹æ³•2ï¼šRunnableæ¥å£

1. è‡ªå®šä¹‰çº¿ç¨‹ç±»å®ç°`Runnable`æ¥å£
2. å®ç°`run()`æ–¹æ³•,ç¼–å†™çº¿ç¨‹æ‰§è¡Œä½“
3. åˆ›å»ºçº¿ç¨‹å¯¹è±¡,è°ƒç”¨`start()`æ–¹æ³•å¯åŠ¨å¯¹è±¡

**æ¨èä½¿ç”¨Runnableå¯¹è±¡,å› ä¸ºJavaå•ç»§æ‰¿çš„å±€é™æ€§**

```java
package com.mine.demo01;
/*
æ–¹å¼2ï¼šimplements Runnable ä¸ç»§æ‰¿Threadå¾ˆåƒ
 */
public class TestThread3 implements Runnable{
    @Override
    public void run() {
        //runæ–¹æ³•çº¿ç¨‹ä½“
        for (int i = 0; i < 20; i++) {
            System.out.println("runæ–¹æ³•çº¿ç¨‹--"+i);
        }
    }

    public static void main(String[] args) {
        //åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å¯¹è±¡
        TestThread3 thread3 = new TestThread3();

        //å¼€å¯çº¿ç¨‹å¯¹è±¡æ¥start()å¼€å¯çº¿ç¨‹ï¼Œä»£ç†
        new Thread(thread3).start();  //ä¸æ–¹æ³•1çš„åŒºåˆ«

        //mainä¸»çº¿ç¨‹
        for (int i = 0; i < 1000; i++) {
            System.out.println("ä¸»çº¿ç¨‹--"+i);
        }
    }
}
```

##### ä¾‹å­ï¼šä¹°ç«è½¦ç¥¨

```java
package com.mine.demo01;
/*ä¾‹å­ï¼šä¹°ç«è½¦ç¥¨ */
public class TestThread4 implements Runnable{
    //ç¥¨æ•°
    private int ticketNums = 10;

    @Override
    public void run() {
        while (true){
            if(ticketNums<=0) break;

            try { //æ¨¡æ‹Ÿå»¶æ—¶
                Thread.sleep(200);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }

            System.out.println(Thread.currentThread().getName()+"æ‹¿åˆ°äº†ç¬¬"+ticketNums--+"å¼ ç¥¨");
        }
    }
    public static void main(String[] args) {
        TestThread4 ticket = new TestThread4();
        new Thread(ticket,"å°æ˜").start();
        new Thread(ticket,"è€å¸ˆ").start();
        new Thread(ticket,"é»„ç‰›å…š").start();
    }
    //é—®é¢˜ï¼šå¤šä¸ªçº¿ç¨‹æ“ä½œåŒä¸€ä¸ªèµ„æºçš„æƒ…å†µä¸‹ï¼Œçº¿ç¨‹ä¸å®‰å…¨ï¼Œæ•°æ®ç´Šä¹±
}
```

ä¾‹å­2ï¼šé¾Ÿå…”èµ›è·‘

```java
package com.mine.demo01;
//é¾Ÿå…”èµ›è·‘
public class Race implements Runnable{
    //èƒœåˆ©è€…
    private static String winner;

    @Override
    public void run() {
        for (int i = 1; i <= 100; i++) {

            boolean flag=gameOver(i);//åˆ¤æ–­æ¯”èµ›æ˜¯å¦ç»“æŸ
            if(flag) break;

            System.out.println(Thread.currentThread().getName()+"-->è·‘äº†"+i+"æ­¥");

            //æ¨¡æ‹Ÿå…”å­ä¼‘æ¯
            if(Thread.currentThread().getName().equals("å…”å­")&& i%10==0){
                try {
                    Thread.sleep(100);
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
            }
        }
    }

    //åˆ¤æ–­æ˜¯å¦å®Œæˆæ¯”èµ›
    private boolean gameOver(int steps){
        if(winner!=null){
            return true;
        }{
            if (steps==100){
                winner=Thread.currentThread().getName();
                System.out.println("winner is"+winner);
                return true;
            }
        }
        return false;
    }

    public static void main(String[] args) {
        Race race = new Race();
        new Thread(race,"å…”å­").start();
        new Thread(race,"ä¹Œé¾Ÿ").start();
    }
}
```

#### æ–¹æ³•3ï¼šCallableæ¥å£ (JUCåŒ…ä¸‹)

å®ç°Callableæ¥å£ï¼Œéœ€è¦è¿”å›å€¼ç±»å‹

é‡å†™callæ–¹æ³•ï¼Œéœ€è¦æŠ›å‡ºå¼‚å¸¸

åˆ›å»ºç›®æ ‡å¯¹è±¡

åˆ›å»ºæ‰§è¡ŒæœåŠ¡ï¼šExecutorService ser = Executors.newFixedThreadPool(1);

æäº¤æ‰§è¡Œï¼šFuture result1 = ser.submit(11);

è·å–ç»“æœï¼šboolean r1 = result1.get()

å…³é—­æœåŠ¡ï¼šser.shutdownNow();

**æ”¹å†™ä¾‹å­ï¼šä¸‹è½½å›¾ç‰‡**

```java
package com.mine.demo01;

import java.util.concurrent.*;
/**
 * æ–¹å¼ä¸‰ï¼šå®ç°Callableæ¥å£
 * 1.å¯ä»¥è¿”å›å€¼
 * 2.å¯ä»¥æŠ›å‡ºå¼‚å¸¸
 */
public class TestCallable implements Callable<Boolean> {

    private String url;//ç½‘ç»œå›¾ç‰‡åœ°å€
    private String name;//æŠ¥é”™æ‰¥æ–‡ä»¶å

    //æœ‰å‚æ„é€ 
    public TestCallable(String url, String name) {
        this.url = url;
        this.name = name;
    }

    //ä¸‹è½½å›¾ç‰‡çº¿ç¨‹çš„æ‰§è¡Œä½“
    public Boolean call() throws Exception {
        WebDownloader webDownloader = new WebDownloader();
        webDownloader.downloader(url, name);
        System.out.println("ä¸‹è½½äº†æ–‡ä»¶åä¸º:" + name);
        return true;
    }

    public static void main(String[] args) throws ExecutionException, InterruptedException {
        TestCallable c = new TestCallable("https://img-home.csdnimg.cn/images/20201124032511.png", "1.png");
        TestCallable c1 = new TestCallable("https://img-home.csdnimg.cn/images/20201124032511.png", "2.png");
        TestCallable c2 = new TestCallable("https://img-home.csdnimg.cn/images/20201124032511.png", "3.png");
        //åˆ›å»ºæ‰§è¡ŒæœåŠ¡
        ExecutorService ser = Executors.newFixedThreadPool(3);
        //æäº¤æ‰§è¡Œ
        Future<Boolean> r = ser.submit(c);
        Future<Boolean> r1 = ser.submit(c1);
        Future<Boolean> r2 = ser.submit(c2);
        //è·å–ç»“æœ
        boolean res = r.get();
        boolean res1 = r1.get();
        boolean res2 = r2.get();
        System.out.println(res);
        System.out.println(res1);
        System.out.println(res2);
        //å…³é—­æœåŠ¡
        ser.shutdownNow();
    }
}
//class WebDownloaderåœ¨å‰é¢ä¸‹è½½å›¾ç‰‡å·²ç»å®šä¹‰äº†ï¼Œè¿™é‡Œå°±ä¸ç”¨å†æ¬¡å†™ï¼Œç›´æ¥ä½¿ç”¨å°±å¥½
```

#### é™æ€ä»£ç†

```java
package com.mine.demo02;
/*
é™æ€ä»£ç†ï¼š
1.çœŸå®å¯¹è±¡ä¸ä»£ç†å¯¹è±¡è¦å®ç°åŒä¸€æ¥å£
2.ä»£ç†å¯¹è±¡åˆ›å»ºä»£ç†çœŸå®è§’è‰²
å¥½å¤„ï¼š
1.ä»£ç†å¯¹è±¡å¯ä»¥åšå¾ˆå¤šçœŸå®å¯¹è±¡åšä¸äº†çš„äº‹æƒ…ï¼Œæ¯”å¦‚å¸ƒç½®ç»“å©šåœºæ™¯
2.çœŸå®å¯¹è±¡ä¸“æ³¨åšè‡ªå·±çš„äº‹æƒ…ï¼Œç»“å©š
 */
public class StaticProxy {
    public static void main(String[] args) {
        /*You you = new You();
        you.HappyMarry();*/ //åŸæœ¬æ–¹å¼ï¼Œä¸‹é¢äº¤ç»™ä»£ç†

        //çº¿ç¨‹ç±»ä»£ç†ï¼Œå®é™…è°ƒç”¨äº†Runnableæ¥å£ä¸­çš„runæ–¹æ³•
        new Thread(()-> System.out.println("æˆ‘çˆ±ä½ ")).start();

        WeddingCompany company = new WeddingCompany(new You());
        company.HappyMarry();
    }
}

interface Marry{
    void HappyMarry();
}

class You implements Marry{ //çœŸå®è§’è‰²
    @Override
    public void HappyMarry() {
        System.out.println("æˆ‘ä»Šå¤©è¦ç»“å©šäº†ï¼");
    }
}

class WeddingCompany implements Marry{ //ä»£ç†è§’è‰²

    private Marry target; //ç›®æ ‡ï¼šçœŸå®å¯¹è±¡

    public WeddingCompany(Marry target) {
        this.target = target;
    }

    @Override
    public void HappyMarry() { //å®ç°ä»£ç†
        before();
        this.target.HappyMarry(); //è°ƒç”¨çœŸå®å¯¹è±¡çš„æ–¹æ³•
        after();
    }

    private void after() {
        System.out.println("å–„åå·¥ä½œï¼");
    }
    private void before() {
        System.out.println("å©šå‰å¸ƒç½®ï¼");
    }
    
}
```

#### Lambda è¡¨è¾¾å¼â€”â€”ç‹‚ç¥

- Î» å¸Œè…Šå­—æ¯è¡¨ä¸­æ’åºç¬¬åä¸€ä½çš„å­—æ¯ï¼Œè‹±è¯­åç§°ä¸º Lamda
- é¿å…åŒ¿åå†…éƒ¨ç±»å®šä¹‰è¿‡å¤š
- å…¶å®è´¨å±äºå‡½æ•°å¼ç¼–ç¨‹çš„æ¦‚å¿µ
- å»æ‰äº†ä¸€å †æ²¡æœ‰æ„ä¹‰çš„ä»£ç ,åªç•™ä¸‹æ ¸å¿ƒé€»è¾‘

```java
new Thread (()->System.out.println(â€œå¤šçº¿ç¨‹å­¦ä¹ ã€‚ã€‚ã€‚ã€‚â€)).start();
```

**å‡½æ•°å¼æ¥å£çš„å®šä¹‰:**
ä»»ä½•æ¥å£,å¦‚æœåªåŒ…å«å”¯ä¸€ä¸€ä¸ªæŠ½è±¡æ–¹æ³•,é‚£ä¹ˆå®ƒå°±æ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥å£.

```java
public interface Runnable{
    public abstract void run();
}
```

å¯¹äºå‡½æ•°å¼æ¥å£,æˆ‘ä»¬å¯ä»¥é€šè¿‡Lamdaè¡¨è¾¾å¼æ¥åˆ›å»ºè¯¥æ¥å£çš„å¯¹è±¡.

```java
//1.å®šä¹‰ä¸€ä¸ªå‡½æ•°å¼æ¥å£
interface ILike{
    void like();
}
//6.ç”¨lambdaç®€åŒ–ï¼Œ-->å‡½æ•°å¼æ¥å£
like = ()->{
System.out.println("i like lambda5");
};
```

**Lamdaè¡¨è¾¾å¼ç®€åŒ–ä¹‹è·¯ï¼š**

```java
package com.mine.demo04;
/* Lambdaè¡¨è¾¾å¼ åªæœ‰ä¸€è¡Œä»£ç çš„æƒ…å†µä¸‹å¯ä»¥ç©¶æç®€åŒ–3
* å‰æï¼šå‡½æ•°å¼æ¥å£ï¼Œä¸”åªèƒ½æœ‰ä¸€ä¸ªæ–¹æ³•
* */
public class TestLambda2 {
    public static void main(String[] args) {
        ILove love = null;

        //Lambdaè¡¨è¾¾å¼ï¼ŒåŸç”Ÿç®€åŒ–
        love=(int a)->{
            System.out.println("I love you"+a);
        };

        //è¿›é˜¶ç®€åŒ–1ï¼šå»æ‰å‚æ•°ç±»å‹ï¼Œå¤šä¸ªå‚æ•°ä¹Ÿå¯ä»¥å»æ‰ï¼Œè¦å»æ‰éƒ½å»æ‰
        love=(a)->{
            System.out.println("I love her"+a);
        };

        //è¿›é˜¶ç®€åŒ–2ï¼šå»æ‰æ‹¬å·ï¼Œåªèƒ½æ”¯æŒä¸€ä¸ªå‚æ•°
        love = a->{
            System.out.println("I love me"+a);
        };

        //è¿›é˜¶ç®€åŒ–3ï¼šå»æ‰å¤§æ‹¬å·ï¼Œåªèƒ½å•è¡Œå‡½æ•°ä½“
        love = a-> System.out.println("I love me"+a);

        love.love(2); //æµ‹è¯•
    }
}

interface ILove{
    void love(int a);
}
```

#### Lambda è¡¨è¾¾å¼â€”â€”åšå®¢

> åŸæ–‡åœ°å€ ï¼š https://objcoding.com/2019/03/04/lambda/

æœ¬èŠ‚å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨Lambdaè¡¨è¾¾å¼ç®€åŒ–åŒ¿åå†…éƒ¨ç±»çš„ä¹¦å†™ï¼Œä½†Lambdaè¡¨è¾¾å¼å¹¶ä¸èƒ½å–ä»£æ‰€æœ‰çš„åŒ¿åå†…éƒ¨ç±»ï¼Œåªèƒ½ç”¨æ¥å–ä»£**å‡½æ•°æ¥å£ï¼ˆFunctional Interfaceï¼‰**çš„ç®€å†™ã€‚å…ˆåˆ«åœ¨ä¹ç»†èŠ‚ï¼Œçœ‹å‡ ä¸ªä¾‹å­å†è¯´ã€‚

##### ä¾‹å­1ï¼šæ— å‚å‡½æ•°çš„ç®€å†™

å¦‚æœéœ€è¦æ–°å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œä¸€ç§å¸¸è§çš„å†™æ³•æ˜¯è¿™æ ·ï¼š

```java
// JDK7 åŒ¿åå†…éƒ¨ç±»å†™æ³•
new Thread(new Runnable(){// æ¥å£å
	@Override
	public void run(){// æ–¹æ³•å
		System.out.println("Thread run()");
	}
}).start();
```

ä¸Šè¿°ä»£ç ç»™`Tread`ç±»ä¼ é€’äº†ä¸€ä¸ªåŒ¿åçš„`Runnable`å¯¹è±¡ï¼Œé‡è½½`Runnable`æ¥å£çš„`run()`æ–¹æ³•æ¥å®ç°ç›¸åº”é€»è¾‘ã€‚è¿™æ˜¯ `JDK7` ä»¥åŠä¹‹å‰çš„å¸¸è§å†™æ³•ã€‚åŒ¿åå†…éƒ¨ç±»çœå»äº†ä¸ºç±»èµ·åå­—çš„çƒ¦æ¼ï¼Œä½†è¿˜æ˜¯ä¸å¤Ÿç®€åŒ–ï¼Œåœ¨Java 8ä¸­å¯ä»¥ç®€åŒ–ä¸ºå¦‚ä¸‹å½¢å¼ï¼š

```java
// JDK8 Lambdaè¡¨è¾¾å¼å†™æ³•
new Thread(
		() -> System.out.println("Thread run()")// çœç•¥æ¥å£åå’Œæ–¹æ³•å
).start();
```

ä¸Šè¿°ä»£ç è·ŸåŒ¿åå†…éƒ¨ç±»çš„ä½œç”¨æ˜¯ä¸€æ ·çš„ï¼Œä½†æ¯”åŒ¿åå†…éƒ¨ç±»æ›´è¿›ä¸€æ­¥ã€‚è¿™é‡Œè¿**æ¥å£åå’Œå‡½æ•°åéƒ½ä¸€åŒçœæ‰**äº†ï¼Œå†™èµ·æ¥æ›´åŠ ç¥æ¸…æ°”çˆ½ã€‚å¦‚æœå‡½æ•°ä½“æœ‰å¤šè¡Œï¼Œå¯ä»¥ç”¨å¤§æ‹¬å·æ‹¬èµ·æ¥ï¼Œå°±åƒè¿™æ ·ï¼š

```java
// JDK8 Lambdaè¡¨è¾¾å¼ä»£ç å—å†™æ³•
new Thread(
        () -> {
            System.out.print("Hello");
            System.out.println(" Hoolee");
        }
).start();
```

##### ä¾‹å­2ï¼šå¸¦å‚å‡½æ•°çš„ç®€å†™

å¦‚æœè¦ç»™ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨é€šè¿‡è‡ªå®šä¹‰æ¯”è¾ƒå™¨ï¼ŒæŒ‰ç…§å­—ç¬¦ä¸²é•¿åº¦è¿›è¡Œæ’åºï¼ŒJava 7çš„ä¹¦å†™å½¢å¼å¦‚ä¸‹ï¼š

```java
// JDK7 åŒ¿åå†…éƒ¨ç±»å†™æ³•
List<String> list = Arrays.asList("I", "love", "you", "too");
Collections.sort(list, new Comparator<String>(){// æ¥å£å
    @Override
    public int compare(String s1, String s2){// æ–¹æ³•å
        if(s1 == null)
            return -1;
        if(s2 == null)
            return 1;
        return s1.length()-s2.length();
    }
});
```

ä¸Šè¿°ä»£ç é€šè¿‡å†…éƒ¨ç±»é‡è½½äº†`Comparator`æ¥å£çš„`compare()`æ–¹æ³•ï¼Œå®ç°æ¯”è¾ƒé€»è¾‘ã€‚é‡‡ç”¨Lambdaè¡¨è¾¾å¼å¯ç®€å†™å¦‚ä¸‹ï¼š

```java
// JDK8 Lambdaè¡¨è¾¾å¼å†™æ³•
List<String> list = Arrays.asList("I", "love", "you", "too");
Collections.sort(list, (s1, s2) ->{// çœç•¥å‚æ•°è¡¨çš„ç±»å‹
    if(s1 == null)
        return -1;
    if(s2 == null)
        return 1;
    return s1.length()-s2.length();
});
```

ä¸Šè¿°ä»£ç è·ŸåŒ¿åå†…éƒ¨ç±»çš„ä½œç”¨æ˜¯ä¸€æ ·çš„ã€‚é™¤äº†çœç•¥äº†æ¥å£åå’Œæ–¹æ³•åï¼Œä»£ç ä¸­æŠŠå‚æ•°è¡¨çš„ç±»å‹ä¹Ÿçœç•¥äº†ã€‚è¿™å¾—ç›Šäº`javac`çš„**ç±»å‹æ¨æ–­**æœºåˆ¶ï¼Œç¼–è¯‘å™¨èƒ½å¤Ÿæ ¹æ®ä¸Šä¸‹æ–‡ä¿¡æ¯æ¨æ–­å‡ºå‚æ•°çš„ç±»å‹ï¼Œå½“ç„¶ä¹Ÿæœ‰æ¨æ–­å¤±è´¥çš„æ—¶å€™ï¼Œè¿™æ—¶å°±éœ€è¦æ‰‹åŠ¨æŒ‡æ˜å‚æ•°ç±»å‹äº†ã€‚æ³¨æ„ï¼ŒJavaæ˜¯å¼ºç±»å‹è¯­è¨€ï¼Œæ¯ä¸ªå˜é‡å’Œå¯¹è±¡éƒ½å¿…éœ€æœ‰æ˜ç¡®çš„ç±»å‹ã€‚

##### ç®€å†™çš„ä¾æ®

ä¹Ÿè®¸ä½ å·²ç»æƒ³åˆ°äº†ï¼Œ**èƒ½å¤Ÿä½¿ç”¨Lambdaçš„ä¾æ®æ˜¯å¿…é¡»æœ‰ç›¸åº”çš„å‡½æ•°æ¥å£**ï¼ˆå‡½æ•°æ¥å£ï¼Œæ˜¯æŒ‡å†…éƒ¨åªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•çš„æ¥å£ï¼‰ã€‚è¿™ä¸€ç‚¹è·ŸJavaæ˜¯å¼ºç±»å‹è¯­è¨€å»åˆï¼Œä¹Ÿå°±æ˜¯è¯´ä½ å¹¶ä¸èƒ½åœ¨ä»£ç çš„ä»»ä½•åœ°æ–¹ä»»æ€§çš„å†™Lambdaè¡¨è¾¾å¼ã€‚å®é™…ä¸Š*Lambdaçš„ç±»å‹å°±æ˜¯å¯¹åº”å‡½æ•°æ¥å£çš„ç±»å‹*ã€‚**Lambdaè¡¨è¾¾å¼å¦ä¸€ä¸ªä¾æ®æ˜¯ç±»å‹æ¨æ–­æœºåˆ¶**ï¼Œåœ¨ä¸Šä¸‹æ–‡ä¿¡æ¯è¶³å¤Ÿçš„æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨å¯ä»¥æ¨æ–­å‡ºå‚æ•°è¡¨çš„ç±»å‹ï¼Œè€Œä¸éœ€è¦æ˜¾å¼æŒ‡åã€‚Lambdaè¡¨è¾¾æ›´å¤šåˆæ³•çš„ä¹¦å†™å½¢å¼å¦‚ä¸‹ï¼š

```java
// Lambdaè¡¨è¾¾å¼çš„ä¹¦å†™å½¢å¼
Runnable run = () -> System.out.println("Hello World");// 1
ActionListener listener = event -> System.out.println("button clicked");// 2
Runnable multiLine = () -> {// 3 ä»£ç å—
    System.out.print("Hello");
    System.out.println(" Hoolee");
};
BinaryOperator<Long> add = (Long x, Long y) -> x + y;// 4
BinaryOperator<Long> addImplicit = (x, y) -> x + y;// 5 ç±»å‹æ¨æ–­
```

ä¸Šè¿°ä»£ç ä¸­ï¼Œ1å±•ç¤ºäº†æ— å‚å‡½æ•°çš„ç®€å†™ï¼›2å¤„å±•ç¤ºäº†æœ‰å‚å‡½æ•°çš„ç®€å†™ï¼Œä»¥åŠç±»å‹æ¨æ–­æœºåˆ¶ï¼›3æ˜¯ä»£ç å—çš„å†™æ³•ï¼›4å’Œ5å†æ¬¡å±•ç¤ºäº†ç±»å‹æ¨æ–­æœºåˆ¶ã€‚

##### è‡ªå®šä¹‰å‡½æ•°æ¥å£

è‡ªå®šä¹‰å‡½æ•°æ¥å£å¾ˆå®¹æ˜“ï¼Œåªéœ€è¦ç¼–å†™ä¸€ä¸ªåªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•çš„æ¥å£å³å¯ã€‚

```java
// è‡ªå®šä¹‰å‡½æ•°æ¥å£
@FunctionalInterface
public interface ConsumerInterface<T>{
	void accept(T t);
}
```

ä¸Šé¢ä»£ç ä¸­çš„@FunctionalInterfaceæ˜¯å¯é€‰çš„ï¼Œä½†åŠ ä¸Šè¯¥æ ‡æ³¨ç¼–è¯‘å™¨ä¼šå¸®ä½ æ£€æŸ¥æ¥å£æ˜¯å¦ç¬¦åˆå‡½æ•°æ¥å£è§„èŒƒã€‚å°±åƒåŠ å…¥@Overrideæ ‡æ³¨ä¼šæ£€æŸ¥æ˜¯å¦é‡è½½äº†å‡½æ•°ä¸€æ ·ã€‚

æœ‰äº†ä¸Šè¿°æ¥å£å®šä¹‰ï¼Œå°±å¯ä»¥å†™å‡ºç±»ä¼¼å¦‚ä¸‹çš„ä»£ç ï¼š

```java
ConsumerInterface<String> consumer = str -> System.out.println(str);
```

è¿›ä¸€æ­¥çš„ï¼Œè¿˜å¯ä»¥è¿™æ ·ä½¿ç”¨ï¼š

```java
class MyStream<T>{
	private List<T> list;
    ...
	public void myForEach(ConsumerInterface<T> consumer){// 1
		for(T t : list){
			consumer.accept(t);
		}
	}
}
MyStream<String> stream = new MyStream<String>();
stream.myForEach(str -> System.out.println(str));// ä½¿ç”¨è‡ªå®šä¹‰å‡½æ•°æ¥å£ä¹¦å†™Lambdaè¡¨è¾¾å¼
```

### 3.çº¿ç¨‹çŠ¶æ€åŠæ–¹æ³•

#### äº”å¤§çŠ¶æ€

**çº¿ç¨‹äº”å¤§çŠ¶æ€ï¼š**

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](./assets/Java-å¤šçº¿ç¨‹-ç‹‚ç¥/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZsbG93X3dpbmQ=,size_16,color_FFFFFF,t_70.png)
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](./assets/Java-å¤šçº¿ç¨‹-ç‹‚ç¥/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZsbG93X3dpbmQ=,size_16,color_FFFFFF,t_70-1719645825094-1.png)

**çº¿ç¨‹æ–¹æ³•ï¼š**

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](./assets/Java-å¤šçº¿ç¨‹-ç‹‚ç¥/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZsbG93X3dpbmQ=,size_16,color_FFFFFF,t_70-1719645825094-2.png)

#### çº¿ç¨‹åœæ­¢

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](./assets/Java-å¤šçº¿ç¨‹-ç‹‚ç¥/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZsbG93X3dpbmQ=,size_16,color_FFFFFF,t_70-1719645825094-3.png)

```java
package com.mine.demo05;

    /*    æµ‹è¯•stop */
    public class TestStop implements Runnable {    //1.è®¾ç½®ä¸€ä¸ªæ ‡è¯†ä½    
        private boolean flag = true;

        @Override
        public void run() {
            int i = 0;
            while (flag) {
                System.out.println("run..Thread--" + i++);
            }
        }    //2.è®¾ç½®å…¬å¼€çš„æ–¹æ³•ï¼Œè½¬æ¢æ ‡è¯†ä½ï¼Œè®©çº¿ç¨‹åœæ­¢    

        public void stop() {
            this.flag = false;
        }

        public static void main(String[] args) {
            TestStop thread = new TestStop();
            new Thread(thread).start();
            for (int i = 0; i < 1000; i++) {
                System.out.println("main--" + i);
                //3.è°ƒç”¨æ–¹æ³•åœæ­¢çº¿ç¨‹            
                if (i == 900) {
                    thread.stop();
                    System.out.println("çº¿ç¨‹è¯¥åœæ­¢äº†ã€‚ã€‚");
                }
            }
        }
    }
```

#### çº¿ç¨‹ä¼‘çœ 

- sleep(æ—¶é—´)æŒ‡å®šå½“å‰çº¿ç¨‹é˜»å¡çš„æ¯«ç§’æ•°ï¼›
- sleepæ—¶é—´åˆ°è¾¾åçº¿ç¨‹å°±è¿›å…¥å°±ç»ªçŠ¶æ€ï¼›
- sleepå­˜åœ¨å¼‚å¸¸InterruptedExceptionï¼›
- sleepå¯ä»¥æ¨¡æ‹Ÿç½‘ç»œå»¶æ—¶ï¼Œå€’è®¡æ—¶ç­‰ã€‚ï¼ˆæ•…æ„è®¾ç½®å»¶æ—¶æ”¶ä¼˜åŒ–é’±ğŸ’´ï¼Œä¸é“å¾·ï¼Œæ¯”å¦‚æŸç›˜ï¼‰
- æ¯ä¸€ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªé”ğŸ”’ï¼Œsleepä¸ä¼šé‡Šæ”¾é”ã€‚

```java
package com.mine.demo05;

import java.text.SimpleDateFormat;
import java.util.Date;
//æ¨¡æ‹Ÿå€’è®¡æ—¶ï¼Œæ¨¡æ‹Ÿæ—¶é’Ÿï¼Œæ¨¡æ‹Ÿç½‘ç»œå»¶æ—¶(ä¹°ç«è½¦ç¥¨ä¾‹å­)
public class TestSleep2 {

    public static void main(String[] args){

        try { //1.æ¨¡æ‹Ÿå€’è®¡æ—¶
            tenDown(); //10så€’è®¡æ—¶
        } catch (InterruptedException e) {
            e.printStackTrace();
        }

        //2.æ‰“å°å½“å‰ç³»ç»Ÿæ—¶é—´
        Date startTime = new Date(System.currentTimeMillis()); //è·å–å½“å‰æ—¶é—´

        while (true){ //æ¨¡æ‹Ÿæ—¶é’Ÿ
            try {
                Thread.sleep(1000); //æ¯éš”1s
                System.out.println(new SimpleDateFormat("HH:mm:ss").format(startTime));
                startTime = new Date(System.currentTimeMillis()); //æ›´æ–°å½“å‰æ—¶é—´
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }

    }

    public static void tenDown() throws InterruptedException {
        int num = 10;
        while (true){
            Thread.sleep(1000); //æ¯éš”1s
            System.out.println(num--);
            if(num<=0) break;
        }
    }
}
```

#### çº¿ç¨‹ç¤¼è®©

- ç¤¼è®©çº¿ç¨‹ï¼Œè®©å½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹æš‚åœï¼Œä½†ä¸é˜»å¡
- å°†çº¿ç¨‹ä»è¿è¡ŒçŠ¶æ€è½¬åŒ–ä¸ºå°±ç»ªçŠ¶æ€
- è®©CPUé‡æ–°è°ƒåº¦ï¼Œä½†ç¤¼è®©ä¸ä¸€å®šæˆåŠŸï¼Œçœ‹CPUå¿ƒæƒ…

```java
package com.mine.demo05;

public class TestYield {
    public static void main(String[] args) {
        MyYield myYield = new MyYield(); //ä¸€ä¸ªå¯¹è±¡ä¸¤ä¸ªçº¿ç¨‹
        //ç¤¼è®©ä¸ä¸€å®šæˆåŠŸ
        new Thread(myYield,"a").start();
        new Thread(myYield,"b").start();
    }
}

class MyYield implements Runnable{

    @Override
    public void run() {
        System.out.println(Thread.currentThread().getName()+"çº¿ç¨‹å¼€å§‹æ‰§è¡Œ");
        Thread.yield(); //ç¤¼è®©
        System.out.println(Thread.currentThread().getName()+"çº¿ç¨‹åœæ­¢æ‰§è¡Œ");
    }
}
```

#### çº¿ç¨‹æ’é˜Ÿ

- Joinåˆå¹¶çº¿ç¨‹ï¼Œå¾…çº¿ç¨‹æ‰§è¡Œå®Œæˆåï¼Œå†æ‰§è¡Œå…¶ä»–çº¿ç¨‹ï¼Œå…¶ä»–çº¿ç¨‹å µå¡

```java
package com.mine.demo05;
/*
æµ‹è¯•joinæ–¹æ³•ï¼Œçº¿ç¨‹æ’é˜Ÿï¼Œå¼ºåˆ¶æ‰§è¡Œï¼Œé˜»å¡å…¶ä»–çº¿ç¨‹ï¼Œå°½é‡å°‘ç”¨
 */
public class TestJoin implements Runnable{
    @Override
    public void run() {
        for (int i = 0; i <= 1000; i++) {
            System.out.println("çº¿ç¨‹vipæ¥äº†"+i);
        }
    }

    public static void main(String[] args) throws InterruptedException {
        TestJoin testJoin = new TestJoin();
        Thread thread = new Thread(testJoin);
        thread.start(); //å¯åŠ¨æˆ‘ä»¬çš„çº¿ç¨‹

        //ä¸»çº¿ç¨‹
        for (int i = 0; i <= 500; i++) {
            if(i==200){
                thread.join();//æ’é˜Ÿï¼Œç­‰çº¿ç¨‹æ‰§è¡Œå®Œ
            }
            System.out.println("main"+i);
        }
    }
}
```

#### è§‚æµ‹çº¿ç¨‹çŠ¶æ€

- Thread.State

çº¿ç¨‹çŠ¶æ€ã€‚ çº¿ç¨‹å¯ä»¥å¤„äºä»¥ä¸‹çŠ¶æ€ä¹‹ä¸€ï¼š

```java
public enum State {

    	//æ–°å»º
    	//å¤„äº NEW çŠ¶æ€çš„çº¿ç¨‹æ­¤æ—¶å°šæœªå¯åŠ¨ã€‚è¿™é‡Œçš„å°šæœªå¯åŠ¨æŒ‡çš„æ˜¯è¿˜æ²¡è°ƒç”¨ Thread å®ä¾‹çš„start()æ–¹æ³•ã€‚
        NEW,

    	//è¿è¡Œ
    	//è¡¨ç¤ºå½“å‰çº¿ç¨‹æ­£åœ¨è¿è¡Œä¸­ã€‚å¤„äº RUNNABLE çŠ¶æ€çš„çº¿ç¨‹åœ¨ Java è™šæ‹Ÿæœºä¸­è¿è¡Œï¼Œä¹Ÿæœ‰å¯èƒ½åœ¨ç­‰å¾… CPU åˆ†é…èµ„æºã€‚
        RUNNABLE,

    	//é˜»å¡
  	    //é˜»å¡çŠ¶æ€ã€‚å¤„äº BLOCKED çŠ¶æ€çš„çº¿ç¨‹æ­£ç­‰å¾…é”ï¼ˆé”ä¼šåœ¨åé¢ç»†è®²ï¼‰çš„é‡Šæ”¾ä»¥è¿›å…¥åŒæ­¥åŒºã€‚
        BLOCKED,

    	//ç­‰å¾…
   	    //ç­‰å¾…çŠ¶æ€ã€‚å¤„äºç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹å˜æˆ RUNNABLE çŠ¶æ€éœ€è¦å…¶ä»–çº¿ç¨‹å”¤é†’ã€‚
        WAITING,

        //è¶…æ—¶ç­‰å¾…
        //è¶…æ—¶ç­‰å¾…çŠ¶æ€ã€‚çº¿ç¨‹ç­‰å¾…ä¸€ä¸ªå…·ä½“çš„æ—¶é—´ï¼Œæ—¶é—´åˆ°åä¼šè¢«è‡ªåŠ¨å”¤é†’ã€‚
        TIMED_WAITING,

        //ç»ˆæ­¢
        //ç»ˆæ­¢çŠ¶æ€ã€‚æ­¤æ—¶çº¿ç¨‹å·²æ‰§è¡Œå®Œæ¯•ã€‚
        TERMINATED;
    }
```

ä¸€ä¸ªçº¿ç¨‹å¯ä»¥åœ¨ç»™å®šæ—¶é—´ç‚¹å¤„äºä¸€ä¸ªçŠ¶æ€ã€‚ è¿™äº›çŠ¶æ€æ˜¯ä¸åæ˜ ä»»ä½•æ“ä½œç³»ç»Ÿçº¿ç¨‹çŠ¶æ€çš„è™šæ‹ŸæœºçŠ¶æ€ã€‚

```java
package com.mine.demo05;

//è§‚å¯Ÿæµ‹è¯•çº¿ç¨‹çŠ¶æ€
public class TestState {
    public static void main(String[] args) throws InterruptedException {
        Thread thread = new Thread(()->{
            for (int i = 0; i < 5; i++) {
                try {
                    Thread.sleep(1000);
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
            }
            System.out.println("///");
        });

        //è§‚å¯ŸçŠ¶æ€
        Thread.State state = thread.getState();
        System.out.println(state); //NEW

        thread.start(); //å¯åŠ¨ Run()æ–¹æ³•
        state = thread.getState();
        System.out.println(state); //RUNNABLE

        //åªè¦çº¿ç¨‹ä¸ç»ˆæ­¢
        while (state != Thread.State.TERMINATED){
            Thread.sleep(1000);
            state = thread.getState(); //æ¯éš”1s,æ‰“å°ä¸€æ¬¡çº¿ç¨‹çŠ¶æ€
            System.out.println(state);
        }

        //thread.start();æ­»äº¡ä¹‹åçš„çº¿ç¨‹ä¸èƒ½å†æ¬¡å¯åŠ¨ï¼ŒæŠ¥é”™
    }

}
```

#### ä¼˜å…ˆçº§

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](./assets/Java-å¤šçº¿ç¨‹-ç‹‚ç¥/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZsbG93X3dpbmQ=,size_16,color_FFFFFF,t_70-1719645825094-4.png)

```java
package com.mine.demo05;
// ä¼˜å…ˆçº§
public class TestPriority{
    
    public static void main(String[] args) {
        //main é»˜è®¤ä¼˜å…ˆçº§ 5
        System.out.println(Thread.currentThread().getName()+"-->"+Thread.currentThread().getPriority());
        
        MyPriority myPriority = new MyPriority();

        Thread t1 = new Thread(myPriority);
        Thread t2 = new Thread(myPriority);
        Thread t3 = new Thread(myPriority);
        Thread t4 = new Thread(myPriority);
        Thread t5 = new Thread(myPriority);

        //å…ˆè®¾ç½®ä¼˜å…ˆçº§ï¼Œå†å¯åŠ¨
        t1.start();  //Thread-0 é»˜è®¤ä¼˜å…ˆçº§ 5

        t2.setPriority(1);
        t2.start();

        t3.setPriority(4);
        t3.start();

        t4.setPriority(Thread.MAX_PRIORITY); //æœ€å¤§ä¼˜å…ˆçº§
        t4.start();

        t5.setPriority(3);
        t5.start();
    }
}

class MyPriority implements Runnable{
    @Override
    public void run() {
        System.out.println(Thread.currentThread().getName()+"-->"+Thread.currentThread().getPriority());
    }
}
```

#### å®ˆæŠ¤çº¿ç¨‹

- çº¿ç¨‹åˆ†ä¸º**ç”¨æˆ·çº¿ç¨‹**å’Œ**å®ˆæŠ¤çº¿ç¨‹(daemon)**
- è™šæ‹Ÿæœºå¿…é¡»ç¡®ä¿ç”¨æˆ·çº¿ç¨‹æ‰§è¡Œå®Œæ¯•
- è™šæ‹Ÿæœºä¸ç”¨ç­‰å¾…å®ˆæŠ¤çº¿ç¨‹æ‰§è¡Œå®Œæ¯•
- å¦‚ï¼Œåå°è®°å½•æ“ä½œæ—¥å¿—ï¼Œç›‘æ§å†…å­˜ï¼Œåƒåœ¾å›æ”¶ç­‰å¾…â€¦

```java
package com.mine.demo05;

//æµ‹è¯•å®ˆæŠ¤çº¿ç¨‹ daemon
public class TestDaemon {

    public static void main(String[] args) {
        God god = new God();
        You you = new You();

        //ä¸Šå¸æ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼Œç”¨æˆ·çº¿ç¨‹ç»“æŸè‡ªå·±ä¹Ÿç»“æŸ
        Thread thread = new Thread(god); 
        thread.setDaemon(true); //è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹ é»˜è®¤æ˜¯false(è¡¨ç¤ºç”¨æˆ·çº¿ç¨‹)
        
        thread.start(); //å®ˆæŠ¤çº¿ç¨‹å¯åŠ¨

        new Thread(you).start(); //ç”¨æˆ·çº¿ç¨‹å¯åŠ¨
    }

}

class God implements Runnable{
    @Override
    public void run() {
        while (true){
            System.out.println("ä¸Šå¸ä¿ä½‘ç€ä½ ");
        }
    }
}

class You implements Runnable{
    @Override
    public void run() {
        for (int i = 0; i < 36500; i++) {
            System.out.println("ä½ åº¦è¿‡äº†å¼€å¿ƒçš„ç¬¬"+i+"å¤©");
        }
        System.out.println("-==goodbye,world!==-");
    }
}
```

### 4.çº¿ç¨‹åŒæ­¥

- å¹¶å‘ï¼š**åŒä¸€å¯¹è±¡è¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œ**ï¼ˆæŠ¢ç¥¨ï¼‰
- çº¿ç¨‹åŒæ­¥æ˜¯ä¸€ä¸ªç­‰å¾…æœºåˆ¶ï¼Œå¤šä¸ªéœ€è¦åŒæ—¶è®¿é—®æ­¤å¯¹è±¡çš„çº¿ç¨‹è¿›å…¥è¿™ä¸ª**å¯¹è±¡çš„ç­‰å¾…æ± **å½¢æˆé˜Ÿåˆ—ï¼Œç­‰å¾…å‰ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨å®Œæ¯•ï¼Œä¸‹ä¸€ä¸ªçº¿ç¨‹æ‰èƒ½ä½¿ç”¨ã€‚

å½¢æˆæ¡ä»¶ï¼š**é˜Ÿåˆ—+é”**

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](./assets/Java-å¤šçº¿ç¨‹-ç‹‚ç¥/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZsbG93X3dpbmQ=,size_16,color_FFFFFF,t_70-1719645825095-5.png)

------

#### Synchronizedæ–¹æ³•

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](./assets/Java-å¤šçº¿ç¨‹-ç‹‚ç¥/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZsbG93X3dpbmQ=,size_16,color_FFFFFF,t_70-1719645825095-6.png)

------

- **å¼Šç«¯ï¼š**
- **1. æ–¹æ³•é‡Œéœ€è¦ä¿®æ”¹çš„å†…å®¹æ‰éœ€è¦é”ï¼Œåªè¯»å¯ä»¥ä¸ç”¨é”ï¼Œé”å¤ªå¤šä¼šæµªè´¹èµ„æºã€‚**
- **2. Açº¿ç¨‹è°ƒç”¨åŒæ­¥çš„æ–¹æ³•æ‰§è¡Œä¸€ä¸ªé•¿æ—¶é—´çš„ä»»åŠ¡ï¼Œé‚£ä¹ˆBçº¿ç¨‹å°±å¿…é¡»ç­‰å¾…æ¯”è¾ƒé•¿çš„æ—¶é—´æ‰èƒ½æ‰§è¡Œ**

```java
package com.mine.demo06;
//ä¸€ã€ä¹°ç¥¨ä¸å®‰å…¨
public class UnsafeBuyTicket {

    public static void main(String[] args) {

        BuyTicket station = new BuyTicket();

        new Thread(station,"å°æ˜").start();
        new Thread(station,"å¼ ä¸‰").start();
        new Thread(station,"é»„ç‰›").start();
    }
}

class BuyTicket implements Runnable{
    private int ticketNums =10;
    boolean flag = true;

    @Override
    public void run() {
        while (flag){
            try {
                buy();
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }
    }
    
    //åŒæ­¥æ–¹æ³•ï¼šsynchronizedï¼Œé”çš„æ˜¯this
    private synchronized void buy() throws InterruptedException {
        //åˆ¤æ–­æ˜¯å¦æœ‰ç¥¨
        if(ticketNums <= 0){
            this.flag = false;
            return;
        }
        Thread.sleep(500); //æ¨¡æ‹Ÿå»¶æ—¶
        //ä¹°ç¥¨
        System.out.println(Thread.currentThread().getName()+"æ‹¿åˆ°"+ticketNums--);
    }
}
```

#### Synchronizedä»£ç å—


å…ˆç»™å¤§å®¶ä»‹ç»ä¸€ä¸‹åŒæ­¥ä»£ç å—æ€ä¹ˆå†™ï¼Œå¤§ä½“çš„ä»£ç æ¡†æ¶æ˜¯è¿™æ ·ï¼š

```java
synchronized(xxx) {
    
}
```

xxx å¯ä»¥æ˜¯ this æˆ–è€… Object æˆ–è€… xxx.classï¼Œä¸‹é¢æˆ‘ä»¬å°±æ ¹æ®è¿™ 3 ç§ä¸åŒåŠ é”æ–¹å¼è¿›è¡Œå±•å¼€è®¨è®ºã€‚

##### this

è¡¨ç¤ºçš„æ˜¯é”ä½å½“å‰å¯¹è±¡ï¼Œå’ŒåŸæ¥ä½¿ç”¨åŒæ­¥å®ä¾‹æ–¹å¼ä¸€æ ·ï¼Œé”ä½äº†å½“å‰çš„å¯¹è±¡ã€‚

```java
package syn.block;

public class SynchronizedCodeTest {

    public static void main(String[] args) {
        SynchronizedCodeTest synchronizedCodeTest = new SynchronizedCodeTest();
        for (int i = 0; i < 5; i ++) {
            Thread thread = new Thread(() -> {
                synchronizedCodeTest.testSynchronizedCode();
            });
            thread.start();
        }
    }

    int count = 0;
    public void testSynchronizedCode() {
        System.out.printf("%s-start-count=%s\n", Thread.currentThread().getName(), count);
        synchronized (this) {
            System.out.printf("%s-synchronized-start-count=%s\n", Thread.currentThread().getName(), count);
            count ++;
            System.out.printf("%s-synchronized-end-count=%s\n", Thread.currentThread().getName(), count);
        }
        System.out.printf("%s-end-count=%s\n", Thread.currentThread().getName(), count);
    }

}

```

è¿è¡Œç»“æœï¼š

![image-20241028112913183](./assets/Java-å¤šçº¿ç¨‹-ç‹‚ç¥/image-20241028112913183.png)

æˆ‘ä»¬ä¸»è¦å…³æ³¨çº¢è‰²æ¡†å’Œè“è‰²æ¡†çš„è¿™éƒ¨åˆ†ç»“æœï¼Œçº¢è‰²æ¡†é‡Œé¢æ˜¯åŒæ­¥å—çš„ä»£ç ï¼Œçº¿ç¨‹ä¹‹é—´æ˜¯äº’æ–¥çš„ï¼Œä½†æ˜¯è“è‰²æ¡†ä¸­**Thread-0**åœ¨æ‰§è¡ŒåŒæ­¥å—çš„è¿‡ç¨‹ä¸­ï¼Œå…¶ä»–çº¿ç¨‹éåŒæ­¥å—ä¹Ÿåœ¨æ‰§è¡Œï¼Œè¿™é‡Œè¯´æ˜äº†é”çš„ç²’åº¦ç¡®å®å˜å°äº†ï¼Œå˜æˆäº†æ–¹æ³•é‡Œé¢çš„åŒæ­¥å—ä»£ç ä¹‹é—´äº’æ–¥ï¼ŒéåŒæ­¥å—ä»£ç ä¸äº’æ–¥ï¼Œcount çš„å€¼æœ€ç»ˆæ˜¯ 5ï¼Œè¯´æ˜åˆ°æ‰§è¡Œåˆ°åŒæ­¥å—æ—¶ï¼ŒåŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œã€‚

æˆ‘ä»¬å†å†™ä¸ªæµ‹è¯•ä»£ç ï¼Œçœ‹ä¸€çœ‹ `synchronized(this)` æ˜¯é”ä½ä»€ä¹ˆï¼Ÿ

```java
public class SynchronizedCodeTest {

    public static void main(String[] args) {
        for (int i = 0; i < 5; i ++) {
            SynchronizedCodeTest synchronizedCodeTest = new SynchronizedCodeTest();
            Thread thread = new Thread(() -> {
                synchronizedCodeTest.testSynchronizedCode();
            });
            thread.start();
        }
    }
```

è¿è¡Œç»“æœï¼š

![image-20241028113454251](./assets/Java-å¤šçº¿ç¨‹-ç‹‚ç¥/image-20241028113454251.png)

è§‚å¯Ÿåˆ°çº¢è‰²æ¡†é‡Œé¢å°±å¯ä»¥å‘ç°ï¼Œè¿™æ—¶å€™åŒæ­¥å—ä¸èµ·æ•ˆæœäº†ï¼Œå¹¶ä¸” count æœ€ç»ˆéƒ½æ˜¯ 1ï¼Œè¯æ˜ `synchronized(this)` é”ä½çš„æ˜¯å½“å‰çš„å¯¹è±¡ï¼Œå’Œ `public synchronized void testSynchronizedMethod()` ä¸€æ ·ã€‚

##### Object

åŒæ­¥ä»£ç å—å¸¦æ¥äº†çµæ´»æ€§ï¼Œå®ƒä¸å†åªæ˜¯é”ä½å½“å‰å¯¹è±¡äº†ï¼Œå¯ä»¥é”ä½ä»»ä½•æˆ‘ä»¬åˆ›å»ºçš„å¯¹è±¡ï¼Œä¸‹é¢å°±æ¥çœ‹çœ‹ã€‚

```java
public class SynchronizedCodeTest {

    public static void main(String[] args) {
        Object lock = new Object();
        SynchronizedCodeTest synchronizedCodeTest = new SynchronizedCodeTest(lock);
        for (int i = 0; i < 5; i ++) {
            Thread thread = new Thread(() -> {
                synchronizedCodeTest.testSynchroniedLock();
            });
            thread.start();
        }
    }

    int count = 0;

    Object lock = null;
    public SynchronizedCodeTest(Object lock) {
        this.lock = lock;
    }

    public void testSynchroniedLock() {
        System.out.printf("%s-start-count=%s\n", Thread.currentThread().getName(), count);
        synchronized (lock) {
            System.out.printf("%s-synchronized-start-count=%s\n", Thread.currentThread().getName(), count);
            count ++;
            System.out.printf("%s-synchronized-end-count=%s\n", Thread.currentThread().getName(), count);
        }
        System.out.printf("%s-end-count=%s\n", Thread.currentThread().getName(), count);
    }

}
```

è¿è¡Œç»“æœï¼š

![image-20241028151551337](./assets/Java-å¤šçº¿ç¨‹-ç‹‚ç¥/image-20241028151551337.png)

è¿™æ®µä»£ç ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª lock å¯¹è±¡ï¼Œä½œä¸ºå‚æ•°ä¼ å…¥åˆ° synchronizedCodeTest å¯¹è±¡é‡Œï¼Œæˆ‘ä»¬çœ‹åˆ°ç»“æœé‡Œé¢ï¼Œ5 ä¸ªçº¿ç¨‹åœ¨åŒæ­¥å—ä»£ç é‡Œæ˜¯ä¸²è¡Œæ‰§è¡Œçš„ï¼Œcount æœ€ç»ˆä¹Ÿå¾—åˆ°ç»“æœæ˜¯ 5ã€‚è¿™æ®µä»£ç æ²¡æœ‰çœ‹å‡ºé”å¯¹è±¡å¸¦æ¥çš„çµæ´»æ€§ï¼Œä¸‹é¢å†çœ‹ä¸€ä¸ªä¾‹å­ï¼ŒæŠŠæµ‹è¯•ä»£ç ç¨å¾®æ”¹ä¸€ä¸‹ï¼Œè®©æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ synchronizedCodeTest å¯¹è±¡ã€‚

```java
public static void main(String[] args) {
	Object lock = new Object();
	for (int i = 0; i < 5; i ++) {
	SynchronizedCodeTest synchronizedCodeTest = new SynchronizedCodeTest(lock);
		Thread thread = new Thread(() -> {
			synchronizedCodeTest.testSynchroniedLock();
		});
		thread.start();
	}
}
```

è¿è¡Œç»“æœï¼š

![image-20241028151726153](./assets/Java-å¤šçº¿ç¨‹-ç‹‚ç¥/image-20241028151726153.png)

ç»“æœæˆ‘ä»¬å‘ç°ï¼Œè™½ç„¶æˆ‘ä»¬ä¸ºæ¯ä¸ªçº¿ç¨‹åˆ›å»ºä¸€ä¸ª synchronizedCodeTest å¯¹è±¡ï¼Œä½†æ˜¯ä¸ç®¡æ€ä¹ˆè¿è¡Œï¼Œ5 ä¸ªçº¿ç¨‹çš„åŒæ­¥ä»£ç å—éƒ½æ˜¯ä¸²è¡Œæ‰§è¡Œçš„ï¼ŒåŸå› åœ¨äºï¼Œæˆ‘ä»¬åªåˆ›å»ºäº†ä¸€ä¸ª lock å¯¹è±¡ï¼Œè¿™ 5 ä¸ª synchronizedCodeTest çš„ lock å¯¹è±¡éƒ½æ˜¯åŒä¸€ä¸ªï¼Œå› æ­¤ç«äº‰èµ„æºæ˜¯åŒä¸€ä¸ªï¼Œæ‰å‡ºç°è¿™ç§æƒ…å†µã€‚çœ‹æ˜¯ä¸æ˜¯æ¯”åŒæ­¥æ–¹æ³•çµæ´»å¤šäº†ï¼Œä¸Šä¸€ç¯‡ä¸­ï¼Œæˆ‘ä»¬è¦è®©å¤šä¸ªå®ä¾‹åŒæ­¥æ‰§è¡Œï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨**é™æ€åŒæ­¥æ–¹æ³•**ï¼Œç°åœ¨ä¸ç”¨äº†ï¼Œä½¿ç”¨åŒæ­¥ä»£ç å—å°±å¯ä»¥ï¼Œåªéœ€è¦æ»¡è¶³é”ä½åŒä¸€ä¸ªå®ä¾‹å¯¹è±¡å°±è¡Œã€‚

å¦å¤–ï¼Œè¿™ä¸ªä¾‹å­çš„ç»“æœæ˜¯æ¯ä¸ªå®ä¾‹çš„ count æœ€ç»ˆéƒ½ä¸º 1ï¼Œè¿™æ˜¯å› ä¸ºæ¯ä¸ª synchronizedCodeTest å¯¹è±¡éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„å˜é‡ countï¼Œæ‰€ä»¥çº¿ç¨‹ä¹‹é—´äº’ä¸å½±å“ã€‚

##### xxx.class

å†æ¥çœ‹çœ‹æœ€åä¸€ç§ä»£ç å—é” Class ç±»ï¼Œè¿™å’Œ `public static synchronized testSynchronizedStatic()` çš„ä½œç”¨æ˜¯ä¸€æ ·çš„ï¼ŒåŒºåˆ«å°±åªæ˜¯ä»£ç å—çš„é”èŒƒå›´å¯å˜ã€‚æˆ‘ä»¬ç›´æ¥çœ‹çœ‹ä»£ç ä¾‹å­ã€‚

```java
public class SynchronizedCodeTest {

    public static void main(String[] args) {
        for (int i = 0; i < 5; i ++) {
            SynchronizedCodeTest synchronizedCodeTest = new SynchronizedCodeTest();
            Thread thread = new Thread(() -> {
                synchronizedCodeTest.testSynchronizedCodeClass();
            });
            thread.start();
        }
    }

    int count = 0;
    public void testSynchronizedCodeClass() {
        System.out.printf("%s-start-count=%s\n", Thread.currentThread().getName(), count);
        synchronized (SynchronizedCodeTest.class) {
            System.out.printf("%s-synchronized-start-count=%s\n", Thread.currentThread().getName(), count);
            count ++;
            System.out.printf("%s-synchronized-end-count=%s\n", Thread.currentThread().getName(), count);
        }
        System.out.printf("%s-end-count=%s\n", Thread.currentThread().getName(), count);
    }

}
```

è¿è¡Œç»“æœï¼š

![image-20241028152140279](./assets/Java-å¤šçº¿ç¨‹-ç‹‚ç¥/image-20241028152140279.png)

æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å®ä¾‹ï¼Œä½†æ˜¯é”ä½ Class ä¼šä½¿æ¯ä¸ªçº¿ç¨‹å®ä¾‹å¯¹è±¡çš„åŒæ­¥å—éƒ½æ˜¯ä¸²è¡Œæ‰§è¡Œï¼Œè¿™ä¸ªç»“æœå’Œä¸Šé¢çš„å¤šä¸ªå®ä¾‹é”ä½åŒä¸€ä¸ª Object å¯¹è±¡çš„ç»“æœæ˜¯ä¸€æ ·çš„ã€‚æˆ‘ä¸ªäººæ›´å€¾å‘äºä½¿ç”¨é”åŒä¸€ä¸ª Object å¯¹è±¡ï¼Œè€Œä¸æ˜¯é” Class ç±»å¯¹è±¡ã€‚

##### æ€»ç»“

è¿™ç¯‡ä»‹ç»äº†**synchronizd ä»£ç å—**çš„ 3 ç§ä½¿ç”¨æ–¹å¼ï¼Œå¹¶è¯¦ç»†ä»‹ç»äº†å„è‡ªçš„ä½¿ç”¨æ–¹å¼å’ŒåŒºåˆ«ã€‚ç®€å•çš„åˆ—ä¸ªè¡¨ã€‚

|   ç±»å‹    |         ä½¿ç”¨æ–¹å¼          |         é”ä½œç”¨èŒƒå›´         |
| :-------: | :-----------------------: | :------------------------: |
|   this    |   synchronized(this){}    |     é”ä½å½“å‰çš„å®ä¾‹å¯¹è±¡     |
|  object   |   synchronized(lock){}    | é”ä½å…¶ä»–å®ä¾‹å¯¹è±¡ï¼Œæ¯”è¾ƒçµæ´» |
| xxx.class | synchronized(xxx.class){} |      é”ä½ Class å¯¹è±¡       |



#### æ­»é”

- å¤šä¸ªçº¿ç¨‹å„è‡ªå ç”¨ä¸€äº›å…±äº«èµ„æºï¼Œå¹¶ä¸”äº’ç›¸ç­‰å¾…å…¶ä»–çº¿ç¨‹å æœ‰çš„èµ„æºæ‰èƒ½è¿è¡Œï¼Œè€Œå¯¼è‡´ä¸¤ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹éƒ½åœ¨ç­‰å¾…å¯¹æ–¹èµ„æºé‡Šæ”¾ï¼Œéƒ½åœæ­¢çš„æƒ…å½¢ã€‚æŸä¸€ä¸ªåŒæ­¥å—åŒæ—¶æ‹¥æœ‰**ä¸¤ä¸ªä»¥ä¸Šå¯¹è±¡çš„é”**æ—¶ï¼Œå°±å¯èƒ½ä¼šæ­»é”ã€‚

```java
package com.mine.deadlock;
//æ­»é”ï¼šå¤šçº¿ç¨‹äº’ç›¸æŠ±ç€å¯¹æ–¹éœ€è¦çš„èµ„æºï¼Œç„¶åå½¢æˆåƒµæŒ
public class DeadLock {
    public static void main(String[] args) {
        Makeup g1 = new Makeup(0, "ç°å§‘å¨˜");
        Makeup g2 = new Makeup(1, "ç™½é›ªå…¬ä¸»");

        g1.start();
        g2.start();
    }
}

//å£çº¢
class Lipstick{
}

//é•œå­
class Mirror{
}

class Makeup extends Thread{
    static Lipstick lipstick = new Lipstick();
    static Mirror mirror = new Mirror();

    int choice;//å‡ ç§é€‰æ‹©
    String girlName; //ä½¿ç”¨è€…

    public Makeup(int choice, String girlName) {
        this.choice = choice;
        this.girlName = girlName;
    }

    @Override
    public void run() {
        //åŒ–å¦†
        try {
            makeup();
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    }
    //äº’ç›¸æŒæœ‰å¯¹æ–¹çš„é”ï¼Œå°±æ˜¯éœ€è¦æ‹¿åˆ°å¯¹æ–¹çš„èµ„æº
    private void makeup() throws InterruptedException {
        //é€‰æ‹©1
        if(choice==0){
            synchronized (lipstick){ //è·å¾—å£çº¢çš„é”
                System.out.println(this.girlName+"è·å¾—å£çº¢çš„é”");
                Thread.sleep(1000);
                synchronized (mirror){ //ä¸€åˆ†é’Ÿåæƒ³æ‹¿é•œå­
                    System.out.println(this.girlName+"è·å¾—é•œå­çš„é”");
                }
            }
        }   //é€‰æ‹©2
        else {
            synchronized (mirror){ //è·å¾—é•œå­çš„é”
                System.out.println(this.girlName+"è·å¾—é•œå­çš„é”");
                Thread.sleep(2000);
                synchronized (lipstick){ //ä¸€åˆ†é’Ÿåæƒ³æ‹¿å£çº¢
                    System.out.println(this.girlName+"è·å¾—å£çº¢çš„é”");
                }
            }

        }
    }
}
```

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](./assets/Java-å¤šçº¿ç¨‹-ç‹‚ç¥/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZsbG93X3dpbmQ=,size_16,color_FFFFFF,t_70-1719645825095-7.png)

#### Lock(é”)

- ä»JDK5.0å¼€å§‹ï¼ŒJavaæä¾›äº†æ›´å¼ºå¤§çš„åŒæ­¥çº¿ç¨‹æœºåˆ¶â€”â€”é€šè¿‡æ˜¾å¼å®šä¹‰åŒæ­¥é”å¯¹è±¡æ¥å®ç°åŒæ­¥ï¼ŒåŒæ­¥é”ä½¿ç”¨Lockå¯¹è±¡å……å½“ã€‚
- Lockæ¥å£æ˜¯æ§åˆ¶èº²ä¸ªçº¿ç¨‹å¯¹å…±äº«èµ„æºè¿›è¡Œè®¿é—®çš„å·¥å…·ã€‚é”æä¾›äº†å¯¹å…±äº«èµ„æºçš„ç‹¬å è®¿é—®ï¼Œæ¯æ¬¡åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å¯¹LockåŠ é”ï¼Œçº¿ç¨‹å¼€å§‹è®¿é—®èµ„æºå‰å¿…é¡»å…ˆè·å¾—Lockå¯¹è±¡ã€‚
- ReentrantLock(å¯é‡å…¥é”)ç±»å®ç°äº†Lockï¼Œå®ƒæ‹¥æœ‰ä¸synchronizedç›¸åŒçš„å¹¶å‘æ€§å’Œå†…å­˜è¯­ä¹‰ï¼Œåœ¨å®ç°çº¿ç¨‹å®‰å…¨çš„æ§åˆ¶ä¸­ï¼Œæ¯”è¾ƒå¸¸ç”¨çš„æ˜¯ReentrantLockï¼Œå¯ä»¥æ˜¾å¼åŠ é”ï¼Œé‡Šæ”¾é”ã€‚

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](./assets/Java-å¤šçº¿ç¨‹-ç‹‚ç¥/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZsbG93X3dpbmQ=,size_16,color_FFFFFF,t_70-1719645825096-8.png)

```java
package com.mine.gaoji;
import java.util.concurrent.locks.ReentrantLock;
//ä¹°ç¥¨
public class TestLock {
    public static void main(String[] args) {
        TestLock2 testLock2 = new TestLock2();

        new Thread(testLock2).start();
        new Thread(testLock2).start();
        new Thread(testLock2).start();
    }
}

class TestLock2 implements Runnable{
    int ticketNums = 10;
    //å®šä¹‰Locké”
    private final ReentrantLock lock = new ReentrantLock();
    
    @Override
    public void run() {
        while (true){
            try { //åŠ é”
                lock.lock();
                if(ticketNums>0){
                    try {
                        Thread.sleep(1000);
                    } catch (InterruptedException e) {
                        e.printStackTrace();
                    }
                    System.out.println(ticketNums--);
                }else {
                    break;
                }
            }finally { //è§£é”
                lock.unlock();
            }
        }
    }

}
```

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](./assets/Java-å¤šçº¿ç¨‹-ç‹‚ç¥/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZsbG93X3dpbmQ=,size_16,color_FFFFFF,t_70-1719645825096-9.png)

------

------

### 5.çº¿ç¨‹é€šä¿¡

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](./assets/Java-å¤šçº¿ç¨‹-ç‹‚ç¥/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZsbG93X3dpbmQ=,size_16,color_FFFFFF,t_70-1719645825096-10.png)

**è¿™æ˜¯ä¸€ä¸ªçº¿ç¨‹åŒæ­¥é—®é¢˜ï¼Œç”Ÿäº§è¿™ä¸æ¶ˆè´¹è€…å…±äº«åŒä¸€ä¸ªèµ„æºï¼Œä»–ä»¬ä¹‹é—´ç›¸äº’ä¾èµ–ï¼Œäº’ä¸ºæ¡ä»¶ã€‚**

- å¯¹äºç”Ÿäº§è€…ï¼Œæ²¡æœ‰ç”Ÿäº§äº§å“ä¹‹å‰ï¼Œè¦é€šçŸ¥æ¶ˆè´¹è€…ç­‰å¾…ï¼Œè€Œç”Ÿäº§äº†äº§å“ä¹‹åï¼Œåˆè¦é©¬ä¸Šé€šçŸ¥æ¶ˆè´¹è€…æ¶ˆè´¹ã€‚
- å¯¹äºæ¶ˆè´¹è€…ï¼Œæ¶ˆè´¹ä¹‹åï¼Œè¦é€šçŸ¥ç”Ÿäº§è€…ç”Ÿäº§æ–°çš„äº§å“ã€‚
- **synchronized**å¯é˜»æ­¢å¹¶å‘æ›´æ–°åŒä¸€ä¸ªå…±äº«èµ„æºï¼Œè€Œ**ä¸èƒ½å®ç°ä¸åŒè¿›ç¨‹ä¹‹é—´æ¶ˆæ¯çš„ä¼ é€’ã€‚**

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](./assets/Java-å¤šçº¿ç¨‹-ç‹‚ç¥/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZsbG93X3dpbmQ=,size_16,color_FFFFFF,t_70-1719645825096-11.png)

#### ç®¡ç¨‹æ³•

```java
package com.mine.gaoji;
//ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜ï¼š1.ç®¡ç¨‹æ³•
//ç”Ÿäº§è€…ï¼Œæ¶ˆè´¹è€…ï¼Œäº§å“ï¼Œç¼“å†²åŒº
public class TestPC {
    public static void main(String[] args) {
        SynContainter containter = new SynContainter();

        new Productor(containter).start();
        new Consumer(containter).start();
    }
}
//ç”Ÿäº§è€…
class Productor extends Thread{
    SynContainter containter;

    public Productor(SynContainter containter){
        this.containter =containter;
    }
    //ç”Ÿäº§
    @Override
    public void run() {
        for (int i = 1; i < 100; i++) {
            containter.push(new Chicken(i));
            System.out.println("ç”Ÿäº§äº†"+i+"åªé¸¡");
        }
    }
}
//æ¶ˆè´¹è€…
class Consumer extends Thread{
    SynContainter containter;

    public Consumer(SynContainter containter){
        this.containter =containter;
    }
    //æ¶ˆè´¹
    @Override
    public void run() {
        for (int i = 1; i < 100; i++) {
            System.out.println("æ¶ˆè´¹äº†"+containter.pop().id+"åªé¸¡");
        }
    }
}

class Chicken{
    int id; //äº§å“ç¼–å·

    public Chicken(int id){
        this.id=id;
    }
}

//ç¼“å†²åŒº
class SynContainter{
    //å®¹å™¨å®¹é‡
    Chicken[] chickens =new Chicken[10];
    int count = 0;

    //ç”Ÿäº§è€…æ”¾å…¥äº§å“
    public synchronized void push(Chicken chicken){
        if(count==chickens.length){
            //ç”Ÿäº§ç­‰å¾…
            try {
                this.wait();
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }
        chickens[count]=chicken;
        count++;

        //å¯ä»¥é€šçŸ¥æ¶ˆè´¹è€…æ¶ˆè´¹äº†
        this.notifyAll();
    }

    //æ¶ˆè´¹è€…æ¶ˆè´¹äº§å“
    public synchronized Chicken pop(){
        //åˆ¤æ–­èƒ½å¦æ¶ˆè´¹
        if(count==0){
            //ç­‰å¾…ç”Ÿäº§è€…ç”Ÿäº§
            try {
                this.wait();
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }
        count--;
        Chicken chicken = chickens[count];

        //é€šçŸ¥ç”Ÿäº§è€…ç”Ÿäº§
        this.notifyAll();
        return chicken;
    }

}
```

#### ä¿¡å·ç¯æ³•

```java
package com.mine.gaoji;

//ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜ï¼š2.ä¿¡å·ç¯æ³•ï¼Œä¸€ä¸ªæ ‡å¿—ä½è§£å†³(flag)
public class TestPC2 {
    public static void main(String[] args) {
        TV tv = new TV();

        new Player(tv).start();
        new Watcher(tv).start();
    }
}

//ç”Ÿäº§è€…-->æ¼”å‘˜
class Player extends Thread{
    TV tv;
    public Player(TV tv) {
        this.tv = tv;
    }

    @Override
    public void run() {
        for (int i = 0; i < 20; i++) {
            if(i%2==0){
                this.tv.play("å¿«ä¹å¤§æœ¬è¥");
            }else {
                this.tv.play("ä¸­å›½å¥½å£°éŸ³");
            }
        }
    }
}

//æ¶ˆè´¹è€…-->è§‚ä¼—
class Watcher extends Thread{
    TV tv;
    public Watcher(TV tv) {
        this.tv = tv;
    }

    @Override
    public void run() {
        for (int i = 0; i < 20; i++) {
            tv.watch();
        }
    }
}

//äº§å“-->èŠ‚ç›®
class TV{
    //æ¼”å‘˜è¡¨æ¼”ï¼Œè§‚ä¼—ç­‰å¾…
    //è§‚ä¼—è§‚çœ‹ï¼Œæ¼”å‘˜ç­‰å¾…
    String voice; //è¡¨æ¼”çš„èŠ‚ç›®
    boolean flag = true;  //æ ‡å¿—ä½

    //è¡¨æ¼”
    public synchronized void play(String voice){
        if(!flag){
            try {
                this.wait();
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }
        System.out.println("æ¼”å‘˜è¡¨æ¼”äº†ï¼š"+voice);
        //é€šçŸ¥è§‚ä¼—è§‚çœ‹
        this.notifyAll();
        this.voice = voice;
        this.flag = !this.flag;
    }
    //è§‚çœ‹
    public synchronized void watch(){
        if(flag){
            try {
                this.wait();
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }
        System.out.println("è§‚çœ‹äº†"+voice);
        //é€šçŸ¥æ¼”å‘˜è¡¨æ¼”
        this.notifyAll();
        this.flag = !this.flag;
    }
}
```

#### çº¿ç¨‹æ± 

- èƒŒæ™¯ï¼šç»å¸¸é”€æ¯ã€ä½¿ç”¨é‡ç‰¹åˆ«å¤§çš„èµ„æºï¼Œæ¯”å¦‚å¹¶å‘æƒ…å†µä¸‹çš„çº¿ç¨‹ï¼Œå¯¹æ€§èƒ½å½±å“å¾ˆå¤§ã€‚
- æ€è·¯ï¼šæå‰åˆ›å»ºå¥½å¤šä¸ªçº¿ç¨‹ï¼Œæ”¾å…¥çº¿ç¨‹æ± ä¸­ï¼Œä½¿ç”¨æ—¶ç›´æ¥è·å–ï¼Œä½¿ç”¨å®Œæ”¾å›æ± ä¸­ã€‚å¯ä»¥é¿å…é¢‘ç¹åˆ›å»ºé”€æ¯ã€å®ç°é‡å¤åˆ©ç”¨ã€‚ç±»ä¼¼ç”Ÿæ´»ä¸­çš„å…¬å…±äº¤é€šå·¥å…·ã€‚
- å¥½å¤„ï¼š
  - æé«˜å“åº”é€Ÿåº¦ï¼ˆå‡å°‘äº†åˆ›å»ºæ–°çº¿ç¨‹çš„æ—¶é—´ï¼‰
  - é™ä½èµ„æºæ¶ˆè€—ï¼ˆé‡å¤åˆ©ç”¨çº¿ç¨‹æ± ä¸­çº¿ç¨‹ï¼Œä¸ç”¨æ¯æ¬¡éƒ½åˆ›å»ºï¼‰
  - ä¾¿äºçº¿ç¨‹ç®¡ç†
    - **corePoolSize** (æ ¸å¿ƒæ± å¤§å°)
    - **maximumPoolSize** (æœ€å¤§çº¿ç¨‹æ•°)
    - **keepAliveTime** (å½“çº¿ç¨‹æ²¡æœ‰ä»»åŠ¡ï¼Œä¿æŒå¤šé•¿æ—¶é—´ç»ˆæ­¢)

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](./assets/Java-å¤šçº¿ç¨‹-ç‹‚ç¥/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZsbG93X3dpbmQ=,size_16,color_FFFFFF,t_70-1719645825096-12.png)

```java
package com.mine.gaoji;

import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;
//çº¿ç¨‹æ± 
public class TestPool {
    public static void main(String[] args) {
        //1.åˆ›å»ºæœåŠ¡ï¼Œåˆ›å»ºçº¿ç¨‹æ± 
        //newFixedThreadPool å‚æ•°ï¼šçº¿ç¨‹æ± å¤§å°
        ExecutorService service = Executors.newFixedThreadPool(10);

        //æ‰§è¡Œ
        service.execute(new MyThread());
        service.execute(new MyThread());
        service.execute(new MyThread());
        service.execute(new MyThread());
        //2.å…³é—­è¿æ¥
        service.shutdown();
    }
}

class MyThread implements Runnable{
    @Override
    public void run() {
        System.out.println(Thread.currentThread().getName());
    }
}
```