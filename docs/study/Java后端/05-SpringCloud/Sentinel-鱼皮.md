### Sentinel å…¥é—¨

https://sentinelguard.io/zh-cn/index.html

#### 1ã€æ ¸å¿ƒæ¦‚å¿µ

1ï¼‰èµ„æºï¼šè¡¨ç¤ºè¦ä¿æŠ¤çš„ä¸šåŠ¡é€»è¾‘æˆ–ä»£ç å—ã€‚æˆ‘ä»¬è¯´çš„èµ„æºï¼Œå¯ä»¥æ˜¯ä»»ä½•ä¸œè¥¿ï¼ŒæœåŠ¡ã€æœåŠ¡é‡Œçš„æ–¹æ³•ã€ç”šè‡³æ˜¯ä¸€æ®µä»£ç ã€‚

ä½¿ç”¨ Sentinel æ¥è¿›è¡Œèµ„æºä¿æŠ¤ï¼Œä¸»è¦åˆ†ä¸ºå‡ ä¸ªæ­¥éª¤:

1. å®šä¹‰èµ„æº
2. å®šä¹‰è§„åˆ™
3. æ£€éªŒè§„åˆ™æ˜¯å¦ç”Ÿæ•ˆ

**å…ˆæŠŠå¯èƒ½éœ€è¦ä¿æŠ¤çš„èµ„æºå®šä¹‰å¥½ï¼Œä¹‹åå†é…ç½®è§„åˆ™ã€‚**ä¹Ÿå¯ä»¥ç†è§£ä¸ºï¼Œåªè¦æœ‰äº†èµ„æºï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ä»»ä½•æ—¶å€™çµæ´»åœ°å®šä¹‰å„ç§æµé‡æ§åˆ¶è§„åˆ™ã€‚åœ¨ç¼–ç çš„æ—¶å€™ï¼Œåªéœ€è¦è€ƒè™‘è¿™ä¸ªä»£ç æ˜¯å¦éœ€è¦ä¿æŠ¤ï¼Œå¦‚æœéœ€è¦ä¿æŠ¤ï¼Œå°±å°†ä¹‹å®šä¹‰ä¸ºä¸€ä¸ªèµ„æºã€‚

æœ‰å¤šç§å®šä¹‰èµ„æºçš„æ–¹æ³•ï¼Œæ¯”å¦‚ç¼–ç¨‹å¼å’Œæ³¨è§£å¼ï¼Œ[å‚è€ƒå®˜æ–¹æ–‡æ¡£](https://sentinelguard.io/zh-cn/docs/basic-api-resource-rule.html) ã€‚

2ï¼‰è§„åˆ™ï¼šSentinel ä½¿ç”¨è§„åˆ™æ¥å®šä¹‰å¯¹èµ„æºçš„ä¿æŠ¤ç­–ç•¥ã€‚

å¯ä»¥ [å‚è€ƒå®˜æ–¹æ–‡æ¡£](https://sentinelguard.io/zh-cn/docs/basic-api-resource-rule.html) æ¥äº†è§£è§„åˆ™ï¼Œæ¯”å¦‚ï¼š

- é™æµè§„åˆ™ï¼šç”¨äºæ§åˆ¶æµé‡çš„è§„åˆ™ï¼Œè®¾ç½® QPSï¼ˆæ¯ç§’æŸ¥è¯¢é‡ï¼‰ç­‰å‚æ•°ï¼Œé˜²æ­¢ç³»ç»Ÿè¿‡è½½ã€‚
- ç†”æ–­è§„åˆ™ï¼šç”¨äºå®ç°ç†”æ–­é™çº§çš„è§„åˆ™ï¼Œå½“æŸä¸ªèµ„æºçš„å¼‚å¸¸æ¯”ä¾‹æˆ–å“åº”æ—¶é—´è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œè§¦å‘ç†”æ–­ï¼ŒçŸ­æ—¶é—´å†…ä¸å†è®¿é—®è¯¥èµ„æºã€‚
- ç³»ç»Ÿè§„åˆ™ï¼šæ ¹æ®ç³»ç»Ÿçš„æ•´ä½“è´Ÿè½½ï¼ˆå¦‚ CPU ä½¿ç”¨ç‡ã€å†…å­˜ä½¿ç”¨ç‡ç­‰ï¼‰è¿›è¡Œä¿æŠ¤ï¼Œé€‚åˆåœ¨ç³»ç»Ÿçº§åˆ«è¿›è¡Œæµé‡æ§åˆ¶ã€‚
- çƒ­ç‚¹å‚æ•°è§„åˆ™ï¼šç”¨äºé™åˆ¶æŸä¸ªæ–¹æ³•çš„æŸäº›çƒ­ç‚¹å‚æ•°çš„è®¿é—®é¢‘ç‡ï¼Œé¿å…æŸäº›å‚æ•°å¯¼è‡´æµé‡è¿‡å¤§ã€‚
- æˆæƒè§„åˆ™ï¼šç”¨äºå®šä¹‰é»‘ç™½åå•çš„æˆæƒè§„åˆ™ï¼Œæ§åˆ¶èµ„æºè®¿é—®çš„æƒé™ã€‚

3ï¼‰æ§åˆ¶å°ï¼š Sentinel æ§åˆ¶å°æ˜¯ä¸€ä¸ªå¯è§†åŒ–çš„ç®¡ç†å·¥å…·ï¼Œä¸»è¦ç”¨äºç›‘æ§ã€ç®¡ç†å’Œé…ç½® Sentinel çš„æµæ§è§„åˆ™ã€ç†”æ–­è§„åˆ™ç­‰ã€‚å®ƒæä¾›äº†ä¸€ä¸ªå‹å¥½çš„ç•Œé¢ï¼Œè®©ç”¨æˆ·å¯ä»¥è½»æ¾åœ°æ“ä½œã€‚è¿™æ˜¯ Sentinel çš„æ ¸å¿ƒä¼˜åŠ¿ï¼Œå¯ä»¥æå‡å¯è§‚æµ‹æ€§ï¼Œæ²¡æœ‰ Sentinel æ§åˆ¶å°ï¼Œæ„Ÿè§‰å°±å¤±å»äº†ä½¿ç”¨å®ƒçš„çµé­‚ã€‚

4ï¼‰å®¢æˆ·ç«¯ï¼šæ˜¯æŒ‡é›†æˆäº† Sentinel çš„åº”ç”¨ç¨‹åºï¼Œé€šå¸¸æ˜¯é€šè¿‡å¼•å…¥ Sentinel çš„ä¾èµ–æ¥æ¥å…¥ã€‚å®¢æˆ·ç«¯è´Ÿè´£åœ¨æœ¬åœ°å¯¹èµ„æºè¿›è¡Œç›‘æ§ã€é™æµã€ç†”æ–­ï¼Œå¹¶å°† **æ•°æ®ä¸ŠæŠ¥** ç»™æ§åˆ¶å°ã€‚

#### 2ã€æ¶æ„è®¾è®¡

[å‚è€ƒå®˜æ–¹æ–‡æ¡£çš„åŸºæœ¬åŸç†](https://sentinelguard.io/zh-cn/docs/basic-implementation.html)ï¼Œæ€»ä½“æ¶æ„è®¾è®¡å¦‚ä¸‹ï¼š

![img](./assets/Sentinel-é±¼çš®/cJesgoNNkkEzj98w.webp)

Sentinel å°† `ProcessorSlot` ä½œä¸º SPI æ¥å£è¿›è¡Œæ‰©å±•ï¼Œä½¿å¾— Slot Chain å…·å¤‡äº†æ‰©å±•çš„èƒ½åŠ›ã€‚æ‚¨å¯ä»¥è‡ªè¡ŒåŠ å…¥è‡ªå®šä¹‰çš„ slot å¹¶ç¼–æ’ slot é—´çš„é¡ºåºï¼Œä»è€Œå¯ä»¥ç»™ Sentinel æ·»åŠ è‡ªå®šä¹‰çš„åŠŸèƒ½ã€‚

![img](./assets/Sentinel-é±¼çš®/vCuXJwtZ7gPzikeS.webp)

å¯¹äºé™æµç³»ç»Ÿï¼ŒæŒ‡æ ‡çš„ç»Ÿè®¡ä¾ç„¶æ˜¯å®ç°å…³é”®ï¼ŒSentinel ä¸­ä½¿ç”¨é«˜æ€§èƒ½çš„ç¯å½¢è®¡æ•°å™¨ï¼ˆæ»‘åŠ¨çª—å£ï¼‰æ¥å®ç°ï¼š

![img](./assets/Sentinel-é±¼çš®/MdonS7mokcJvUqGm.webp)

ä¸‹é¢æˆ‘ä»¬æ¥å®‰è£…å’Œä½¿ç”¨ Sentinelã€‚

#### 3ã€Sentinel å…¥é—¨ Demo

å¯ä»¥ [å‚è€ƒå®˜ç½‘ç¼–å†™å…¥é—¨ Demo](https://sentinelguard.io/zh-cn/docs/quick-start.html)ï¼Œåœ¨æœ¬åœ°é€šè¿‡ Main æ–¹æ³•è¿è¡Œä¸€ä¸ª Sentinel å®¢æˆ·ç«¯ç¨‹åºã€‚

è¿è¡ŒæˆåŠŸåï¼Œå¯ä»¥åœ¨å½“å‰ç”¨æˆ·æ ¹ç›®å½•ä¸‹ï¼ˆ~/logs/csp/${appName}-metrics.log.xxxï¼‰çœ‹åˆ°è¾“å‡ºï¼š

![img](./assets/Sentinel-é±¼çš®/mGi4iVBzqyk3Bppz.webp)

#### 4ã€ä¸‹è½½å¹¶å¯åŠ¨ Sentinel æ§åˆ¶å°

å¯ä»¥ [å‚è€ƒå®˜æ–¹æ–‡æ¡£](https://sentinelguard.io/zh-cn/docs/dashboard.html) è¿›è¡Œå®‰è£…ã€‚

1ï¼‰ä¸‹è½½æ§åˆ¶å° jar åŒ…å¹¶åœ¨æœ¬åœ°å¯åŠ¨ï¼Œå¯ä»¥è®¿é—®ä» [github](https://github.com/alibaba/Sentinel/releases) ä¸Šä¸‹è½½ releaseçš„ jar åŒ…ã€‚

æœ¬æ•™ç¨‹ä¸ºå¤§å®¶æä¾›äº†è½¯ä»¶åŒ…ï¼šhttps://pan.baidu.com/s/1u73-Nlolrs8Rzb1_b6X6HA ï¼Œæå–ç ï¼šc2sd

2ï¼‰ç›´æ¥åœ¨å‘½ä»¤è¡Œçª—å£å¯åŠ¨ Sentinel æ§åˆ¶å°ï¼š

æ³¨æ„ï¼šå¯åŠ¨ Sentinel æ§åˆ¶å°éœ€è¦ JDK ç‰ˆæœ¬ä¸º 1.8 åŠä»¥ä¸Šç‰ˆæœ¬ã€‚

å‘½ä»¤ï¼š

```java
java -Dserver.port=8131 -jar sentinel-dashboard-1.8.6.jar	
```

å¯åŠ¨æˆåŠŸï¼š

![img](./assets/Sentinel-é±¼çš®/O9RjoEE8eA331lQA.webp)

æœ¬åœ°è®¿é—® http://localhost:8131/ï¼ˆä½ å¡«çš„ç«¯å£ï¼‰ï¼Œå³å¯è®¿é—®æ§åˆ¶å°ï¼Œ**é»˜è®¤è´¦å·å’Œå¯†ç éƒ½æ˜¯ sentinel**

![img](./assets/Sentinel-é±¼çš®/quEUDJ42WSQGJoP9.webp)

4ï¼‰å®¢æˆ·ç«¯æ¥å…¥æ§åˆ¶å°

å¼•å…¥ Maven ä¾èµ–ï¼Œç”¨äºå’Œ Sentinel æ§åˆ¶å°é€šè®¯ï¼š

```xml
<dependency>
  <groupId>com.alibaba.csp</groupId>
  <artifactId>sentinel-transport-simple-http</artifactId>
  <version>1.8.6</version>
</dependency>
```

ç¨‹åºå¯åŠ¨æ—¶éœ€è¦åŠ å…¥ JVM å‚æ•° `-Dcsp.sentinel.dashboard.server=consoleIp:port` æŒ‡å®šæ§åˆ¶å°åœ°å€å’Œç«¯å£ã€‚è‹¥å¯åŠ¨å¤šä¸ªåº”ç”¨ï¼Œåˆ™éœ€è¦é€šè¿‡ `-Dcsp.sentinel.api.port=xxxx` æŒ‡å®šå®¢æˆ·ç«¯ç›‘æ§ API çš„ç«¯å£ï¼ˆé»˜è®¤æ˜¯ 8719ï¼‰ã€‚

Sentinel éå¸¸è´´å¿ƒï¼Œæä¾›äº†å¾ˆå¤šæ¡†æ¶æ•´åˆçš„ä¾èµ–ï¼Œä¾¿äºå¼€å‘ï¼Œæ¯”å¦‚ Spring Web é¡¹ç›®æ”¯æŒå°†æ‰€æœ‰çš„æ¥å£è‡ªåŠ¨è¯†åˆ«ä¸ºèµ„æºï¼š

![img](./assets/Sentinel-é±¼çš®/lJqF9NCxNkICeOGt.webp)

å¯ä»¥æ ¹æ®ä½¿ç”¨çš„æ¡†æ¶å¼•å…¥é€‚é…ä¾èµ–ï¼Œ[å‚è€ƒå®˜æ–¹æ–‡æ¡£](https://sentinelguard.io/zh-cn/docs/open-source-framework-integrations.html)ã€‚

æ­¤å¤„ç›´æ¥è¿è¡Œ Main æ–¹æ³•æ¥æ¼”ç¤ºæ•ˆæœï¼ŒJVM å‚æ•°ä¸ºï¼š`-Dcsp.sentinel.dashboard.server=localhost:8131`

![img](./assets/Sentinel-é±¼çš®/TlkE2He3jihoi9ov.webp)

è¿˜æœ‰æ›´å¤šçš„é…ç½®ï¼Œæ¯”å¦‚æ›´æ”¹æ—¥å¿—ç›®å½•ç­‰ï¼Œå¯ä»¥çœ‹ [å®˜æ–¹æ–‡æ¡£](https://sentinelguard.io/zh-cn/docs/startup-configuration.html) äº†è§£ã€‚

**ç¡®ä¿å®¢æˆ·ç«¯æœ‰è®¿é—®é‡**ï¼ŒSentinel ä¼šåœ¨ **å®¢æˆ·ç«¯é¦–æ¬¡è°ƒç”¨çš„æ—¶å€™** è¿›è¡Œåˆå§‹åŒ–ï¼Œå¼€å§‹å‘æ§åˆ¶å°å‘é€å¿ƒè·³åŒ…ã€‚é€šè¿‡æ§åˆ¶å°å¯ä»¥æŸ¥çœ‹åˆ°å®æ—¶è®¿é—®æƒ…å†µï¼š

![img](./assets/Sentinel-é±¼çš®/NAwAxcOiQxQ1bPwQ.webp)

æŸ¥çœ‹æœºå™¨åˆ—è¡¨å’Œå¥åº·æƒ…å†µï¼š

![img](./assets/Sentinel-é±¼çš®/0I1LuX29pXXCO5Pm.webp)

ç°‡ç‚¹é“¾è·¯ï¼ˆå•æœºè°ƒç”¨é“¾è·¯ï¼‰é¡µé¢å®æ—¶çš„å»æ‹‰å–æŒ‡å®šå®¢æˆ·ç«¯èµ„æºçš„è¿è¡Œæƒ…å†µã€‚å®ƒä¸€å…±æä¾›ä¸¤ç§å±•ç¤ºæ¨¡å¼ï¼šä¸€ç§ç”¨æ ‘çŠ¶ç»“æ„å±•ç¤ºèµ„æºçš„è°ƒç”¨é“¾è·¯ï¼Œå¦å¤–ä¸€ç§åˆ™ä¸åŒºåˆ†è°ƒç”¨é“¾è·¯å±•ç¤ºèµ„æºçš„è¿è¡Œæƒ…å†µã€‚å¦‚å›¾ï¼š

![img](./assets/Sentinel-é±¼çš®/wVBKDJsinGWtXlZ7.webp)

#### 5ã€è§„åˆ™ç®¡ç†å’Œæ¨é€

é—®é¢˜ï¼šSentinel çš„è§„åˆ™å­˜å‚¨åœ¨å“ªé‡Œå‘¢ï¼Ÿåˆæ˜¯å¦‚ä½•é€šè¿‡æ§åˆ¶å°ä¿®æ”¹è§„åˆ™ä¹‹åï¼Œå°†è§„åˆ™åŒæ­¥ç»™å®¢æˆ·ç«¯è¿›è¡Œé™æµç†”æ–­çš„å‘¢ï¼Ÿ

[å®˜æ–¹æ–‡æ¡£](https://sentinelguard.io/zh-cn/docs/dashboard.html) æœ‰è¯¦ç»†åœ°ä»‹ç»ï¼šSentinel æ§åˆ¶å°åŒæ—¶æä¾›ç®€å•çš„è§„åˆ™ç®¡ç†ä»¥åŠæ¨é€çš„åŠŸèƒ½ã€‚è§„åˆ™æ¨é€åˆ†ä¸º 3 ç§æ¨¡å¼ï¼ŒåŒ…æ‹¬ "åŸå§‹æ¨¡å¼"ã€"Pull æ¨¡å¼" å’Œ "Push æ¨¡å¼"ã€‚

![img](./assets/Sentinel-é±¼çš®/r4UBlzLz9fSor7Mq.webp)

ç›®å‰æ§åˆ¶å°çš„è§„åˆ™æ¨é€ä¹Ÿæ˜¯é€šè¿‡ [è§„åˆ™æŸ¥è¯¢æ›´æ”¹ HTTP API](https://github.com/alibaba/Sentinel/wiki/å¦‚ä½•ä½¿ç”¨#æŸ¥è¯¢æ›´æ”¹è§„åˆ™) æ¥æ›´æ”¹è§„åˆ™ã€‚**è¿™ä¹Ÿæ„å‘³ç€è¿™äº›è§„åˆ™ä»…åœ¨å†…å­˜æ€ç”Ÿæ•ˆï¼Œåº”ç”¨é‡å¯ä¹‹åï¼Œè¯¥è§„åˆ™ä¼šä¸¢å¤±ã€‚**

ä»¥ä¸Šæ˜¯åŸå§‹æ¨¡å¼ã€‚å½“äº†è§£äº†åŸå§‹æ¨¡å¼ä¹‹åï¼Œå®˜æ–¹å»ºè®®é€šè¿‡ [åŠ¨æ€è§„åˆ™](https://sentinelguard.io/zh-cn/docs/dynamic-rule-configuration.html) å¹¶ç»“åˆå„ç§å¤–éƒ¨å­˜å‚¨æ¥å®šåˆ¶è‡ªå·±çš„è§„åˆ™æºã€‚æˆ‘ä»¬æ¨èé€šè¿‡åŠ¨æ€é…ç½®æºçš„æ§åˆ¶å°æ¥è¿›è¡Œè§„åˆ™å†™å…¥å’Œæ¨é€ï¼Œè€Œä¸æ˜¯é€šè¿‡ Sentinel å®¢æˆ·ç«¯ç›´æ¥å†™å…¥åˆ°åŠ¨æ€é…ç½®æºä¸­ã€‚

åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå®˜æ–¹æ¨è push æ¨¡å¼ï¼Œæ”¯æŒè‡ªå®šä¹‰å­˜å‚¨è§„åˆ™çš„é…ç½®ä¸­å¿ƒï¼Œæ§åˆ¶å°æ”¹å˜è§„åˆ™åï¼Œä¼š push åˆ°é…ç½®ä¸­å¿ƒã€‚

![img](./assets/Sentinel-é±¼çš®/9aKc3ZqRK2SHHOTY.webp)

æ›´å¤šè§„åˆ™ç®¡ç†å’Œæ¨é€è§„åˆ™å¯ä»¥é˜…è¯»ï¼š[åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ Sentinel](https://github.com/alibaba/Sentinel/wiki/åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨-Sentinel)ã€‚

![img](./assets/Sentinel-é±¼çš®/Vs0gWqfyY6l0tQsv.webp)

#### 6ã€æ•´åˆ Spring Boot

åŸºäº Spring Boot Starter + æ³¨è§£æ¨¡å¼å¼€å‘ + åŸå§‹è§„åˆ™æ¨é€æ¨¡å¼å¼€å‘

Spring Boot é¡¹ç›®å¯ä»¥è½»æ¾å’Œ Sentinel é›†æˆï¼Œç›´æ¥å¼•å…¥ä¸€ä¸ª starterï¼Œä½¿ç”¨ [Spring Cloud Alibaba Sentinel](https://github.com/alibaba/spring-cloud-alibaba/wiki/Sentinel) å³å¯ã€‚

**åœ¨å¼•å…¥æ•´åˆä¾èµ–æ—¶ï¼Œä¸€å®šè¦æ³¨æ„ç‰ˆæœ¬å·ï¼**

å»ºè®® [å‚è€ƒå®˜æ–¹æ–‡æ¡£é€‰æ‹©ç‰ˆæœ¬](https://github.com/alibaba/spring-cloud-alibaba/wiki/ç‰ˆæœ¬è¯´æ˜)ã€‚ç”±äº Spring Boot 3.0ï¼ŒSpring Boot 2.7~2.4 å’Œ 2.4 ä»¥ä¸‹ç‰ˆæœ¬ä¹‹é—´å˜åŒ–è¾ƒå¤§ï¼Œç›®å‰ä¼ä¸šçº§å®¢æˆ·è€é¡¹ç›®ç›¸å…³ Spring Boot ç‰ˆæœ¬ä»åœç•™åœ¨ Spring Boot 2.4 ä»¥ä¸‹ï¼Œä¸ºäº†åŒæ—¶æ»¡è¶³å­˜é‡ç”¨æˆ·å’Œæ–°ç”¨æˆ·ä¸åŒéœ€æ±‚ï¼Œç¤¾åŒºä»¥ Spring Boot 3.0 å’Œ 2.4 åˆ†åˆ«ä¸ºåˆ†ç•Œçº¿ï¼ŒåŒæ—¶ç»´æŠ¤ 2022.xã€2021.xã€2.2.x ä¸‰ä¸ªåˆ†æ”¯è¿­ä»£ã€‚

![img](./assets/Sentinel-é±¼çš®/Xggn6dT88LlQk5ek.webp)

æœ¬é¡¹ç›® Spring Boot ç”¨çš„æ˜¯ 2.7ï¼Œå› æ­¤ä½¿ç”¨ Sentinel Starter çš„ç‰ˆæœ¬ 2021.0.5.0ã€‚åœ¨é¡¹ç›®ä¸­å¼•å…¥ä¾èµ–ï¼š

```xml
<!-- https://mvnrepository.com/artifact/com.alibaba.cloud/spring-cloud-starter-alibaba-sentinel -->
<dependency>
    <groupId>com.alibaba.cloud</groupId>
    <artifactId>spring-cloud-starter-alibaba-sentinel</artifactId>
    <version>2021.0.5.0</version>
</dependency>
```

å¯ä»¥çœ‹åˆ°ï¼Œè¯¥ä¾èµ–è‡ªåŠ¨æ•´åˆäº† Sentinel çš„ core åŒ…ã€å®¢æˆ·ç«¯é€šè®¯åŒ…ã€æ³¨è§£å¼€å‘åŒ…ã€webmvc é€‚é…åŒ…ã€çƒ­ç‚¹å‚æ•°é™æµåŒ…ç­‰ï¼š

![img](./assets/Sentinel-é±¼çš®/kvj73edhVkUxxvbA.webp)

æ•´åˆåŒ…æ”¯æŒè‡ªåŠ¨å°†æ‰€æœ‰çš„æ¥å£æ ¹æ® url è·¯å¾„è¯†åˆ«ä¸ºèµ„æºã€‚å¯åŠ¨é¡¹ç›®åï¼Œé€šè¿‡æ¥å£æ–‡æ¡£æµ‹è¯•å°±èƒ½çœ‹åˆ°ç›‘æ§æ•ˆæœï¼š

![img](./assets/Sentinel-é±¼çš®/u4Pzn9enw8suoGpV.webp)

![img](./assets/Sentinel-é±¼çš®/hqKSYEWN4tiTBIwY.webp)

#### 7ã€å¼€å‘æ¨¡å¼

Sentinel çš„å¼€å‘ä¸»è¦åŒ…æ‹¬å®šä¹‰èµ„æºå’Œå®šä¹‰è§„åˆ™ã€‚

**1ï¼‰å®šä¹‰èµ„æº**ï¼šæ”¯æŒé€šè¿‡ä»£ç ã€å¼•å…¥æ¡†æ¶é€‚é…ã€[æ³¨è§£æ–¹å¼](https://sentinelguard.io/zh-cn/docs/annotation-support.html) å®šä¹‰èµ„æºã€‚

é€šè¿‡ä»£ç å®šä¹‰èµ„æºï¼Œæ›´çµæ´»ï¼š

```java
Entry entry = null;
// åŠ¡å¿…ä¿è¯finallyä¼šè¢«æ‰§è¡Œ
try {
  // èµ„æºåå¯ä½¿ç”¨ä»»æ„æœ‰ä¸šåŠ¡è¯­ä¹‰çš„å­—ç¬¦ä¸²
  entry = SphU.entry("è‡ªå®šä¹‰èµ„æºå");
  // è¢«ä¿æŠ¤çš„ä¸šåŠ¡é€»è¾‘
  // do something...
} catch (BlockException e1) {
  // èµ„æºè®¿é—®é˜»æ­¢ï¼Œè¢«é™æµæˆ–è¢«é™çº§
  // è¿›è¡Œç›¸åº”çš„å¤„ç†æ“ä½œ
} finally {
  if (entry != null) {
    entry.exit();
  }
}
```

é€šè¿‡æ³¨è§£å®šä¹‰èµ„æºï¼Œæ›´å¿«æ·å¯è¯»ï¼š

```java
public class TestService {

    // å¯¹åº”çš„ `handleException` å‡½æ•°éœ€è¦ä½äº `ExceptionUtil` ç±»ä¸­ï¼Œå¹¶ä¸”å¿…é¡»ä¸º static å‡½æ•°.
    @SentinelResource(value = "test", blockHandler = "handleException", blockHandlerClass = {ExceptionUtil.class})
    public void test() {
        System.out.println("Test");
    }

    // åŸå‡½æ•°
    @SentinelResource(value = "hello", blockHandler = "exceptionHandler", fallback = "helloFallback")
    public String hello(long s) {
        return String.format("Hello at %d", s);
    }
    
    // Fallback å‡½æ•°ï¼Œå‡½æ•°ç­¾åä¸åŸå‡½æ•°ä¸€è‡´æˆ–åŠ ä¸€ä¸ª Throwable ç±»å‹çš„å‚æ•°.
    public String helloFallback(long s) {
        return String.format("Halooooo %d", s);
    }

    // Block å¼‚å¸¸å¤„ç†å‡½æ•°ï¼Œå‚æ•°æœ€åå¤šä¸€ä¸ª BlockExceptionï¼Œå…¶ä½™ä¸åŸå‡½æ•°ä¸€è‡´.
    public String exceptionHandler(long s, BlockException ex) {
        // Do some log here.
        ex.printStackTrace();
        return "Oops, error occurred at " + s;
    }
}
```

`@SentinelResource` æ³¨è§£çš„é…ç½®ä¼˜å…ˆäºè‡ªåŠ¨è¯†åˆ«çš„é…ç½®ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœæ³¨è§£ä¸­å®šä¹‰äº†ç‰¹å®šçš„é™æµæˆ–ç†”æ–­ç­–ç•¥ï¼Œè¿™äº›ç­–ç•¥å°†è¦†ç›–é»˜è®¤çš„æˆ–è‡ªåŠ¨è¯†åˆ«çš„é…ç½®ã€‚

æ¨èå¼€å‘æ¨¡å¼ï¼šä¼˜å…ˆä½¿ç”¨é€‚é…åŒ…æ¥è‡ªåŠ¨è¯†åˆ«èµ„æºï¼Œç„¶åèƒ½è¿ç”¨æ³¨è§£å°½é‡è¿ç”¨æ³¨è§£ï¼Œæœ€åå†é€‰æ‹©ä¸»åŠ¨ç¼–ç å®šä¹‰èµ„æºã€‚

**2ï¼‰å®šä¹‰è§„åˆ™ï¼š**æ”¯æŒé€šè¿‡ä»£ç ã€æ§åˆ¶å°ï¼ˆæ¨èï¼‰ã€é…ç½®æ–‡ä»¶æ¥å®šä¹‰è§„åˆ™ã€‚

æ¯”å¦‚é€šè¿‡ä»£ç å®šä¹‰ä¸€ä¸ªé™æµè§„åˆ™ï¼Œæ›´çµæ´»ï¼š

```java
private static void initFlowQpsRule() {
    List<FlowRule> rules = new ArrayList<>();
    FlowRule rule1 = new FlowRule();
    rule1.setResource(resource);
    // Set max qps to 20
    rule1.setCount(20);
    rule1.setGrade(RuleConstant.FLOW_GRADE_QPS);
    rule1.setLimitApp("default");
    rules.add(rule1);
    FlowRuleManager.loadRules(rules);
}
```

é€šè¿‡æ§åˆ¶å°é…ç½®ï¼Œæ›´é«˜æ•ˆï¼š

![img](./assets/Sentinel-é±¼çš®/cB0SWortho6g4MVe.webp)

ä¸€èˆ¬æ¨èä½¿ç”¨æ§åˆ¶å°æ¥é…ç½®è§„åˆ™ï¼Œä½†å¦‚æœå¸Œæœ›å¼€å‘è€…æ›´å¿«å¯åŠ¨å’Œå­¦ä¹ é¡¹ç›®ï¼Œå¯ä»¥é€šè¿‡ç¼–ç å®šä¹‰è§„åˆ™ï¼Œè¿™æ ·ä¸ç”¨æ­å»ºæ§åˆ¶å°ã€è€Œä¸”æ¯æ¬¡å¯åŠ¨é¡¹ç›®éƒ½ä¼šç¡®ä¿è§„åˆ™è¢«åˆ›å»ºã€‚

#### 8ã€å…¶ä»–ç‰¹æ€§

é™¤äº†é™æµå¤–ï¼ŒSentinel è¿˜æä¾›äº†å¤šç§è§„åˆ™ï¼Œéƒ½å¯ä»¥é€šè¿‡å®˜æ–¹æ–‡æ¡£æ¥äº†è§£ã€‚

1. [ç†”æ–­é™çº§](https://sentinelguard.io/zh-cn/docs/circuit-breaking.html)ï¼šç”¨äºå®ç°ç†”æ–­é™çº§çš„è§„åˆ™ï¼Œå½“æŸä¸ªèµ„æºçš„å¼‚å¸¸æ¯”ä¾‹æˆ–å“åº”æ—¶é—´è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œè§¦å‘ç†”æ–­ï¼ŒçŸ­æ—¶é—´å†…ä¸å†è®¿é—®è¯¥èµ„æºã€‚
2. [ç³»ç»Ÿè‡ªé€‚åº”ä¿æŠ¤](https://sentinelguard.io/zh-cn/docs/system-adaptive-protection.html)ï¼šæ ¹æ®ç³»ç»Ÿçš„æ•´ä½“è´Ÿè½½ï¼ˆå¦‚ CPU ä½¿ç”¨ç‡ã€å†…å­˜ä½¿ç”¨ç‡ç­‰ï¼‰è¿›è¡Œä¿æŠ¤ï¼Œé€‚åˆåœ¨ç³»ç»Ÿçº§åˆ«è¿›è¡Œæµé‡æ§åˆ¶ã€‚
3. [çƒ­ç‚¹å‚æ•°é™æµ](https://sentinelguard.io/zh-cn/docs/parameter-flow-control.html)ï¼šç”¨äºé™åˆ¶æŸä¸ªæ–¹æ³•çš„æŸäº›çƒ­ç‚¹å‚æ•°çš„è®¿é—®é¢‘ç‡ï¼Œé¿å…æŸäº›å‚æ•°å¯¼è‡´æµé‡è¿‡å¤§ã€‚
4. [æ¥æºè®¿é—®æ§åˆ¶](https://sentinelguard.io/zh-cn/docs/origin-authority-control.html)ï¼šç”¨äºå®šä¹‰é»‘ç™½åå•çš„æˆæƒè§„åˆ™ï¼Œæ§åˆ¶èµ„æºè®¿é—®çš„æƒé™ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€šè¿‡æœ¬é¡¹ç›®çš„éœ€æ±‚å®ç°ï¼Œå¸¦å¤§å®¶å®æˆ˜ Sentinel å¼€å‘ã€‚

### åç«¯å¼€å‘ï¼ˆSentinel å®æˆ˜ï¼‰

#### 1ã€æŸ¥çœ‹é¢˜åº“åˆ—è¡¨æ¥å£é™æµç†”æ–­

èµ„æºï¼šlistQuestionBankVOByPage æ¥å£

ç›®çš„ï¼šæ§åˆ¶å¯¹è€—æ—¶è¾ƒé•¿çš„ã€ç»å¸¸è®¿é—®çš„æ¥å£çš„è¯·æ±‚é¢‘ç‡ï¼Œé˜²æ­¢è¿‡å¤šè¯·æ±‚å¯¼è‡´ç³»ç»Ÿè¿‡è½½ã€‚

é™æµè§„åˆ™ï¼š

- ç­–ç•¥ï¼šæ•´ä¸ªæ¥å£æ¯ç§’é’Ÿä¸è¶…è¿‡ 10 æ¬¡è¯·æ±‚
- é˜»å¡æ“ä½œï¼šæç¤ºâ€œç³»ç»Ÿå‹åŠ›è¿‡å¤§ï¼Œè¯·è€å¿ƒç­‰å¾…â€

ç†”æ–­è§„åˆ™ï¼š

- ç†”æ–­æ¡ä»¶ï¼šå¦‚æœæ¥å£å¼‚å¸¸ç‡è¶…è¿‡ 10%ï¼Œæˆ–è€…æ…¢è°ƒç”¨ï¼ˆå“åº”æ—¶é•¿ > 3 ç§’ï¼‰çš„æ¯”ä¾‹å¤§äº 20%ï¼Œè§¦å‘ 60 ç§’ç†”æ–­ã€‚
- ç†”æ–­æ“ä½œï¼šç›´æ¥è¿”å›æœ¬åœ°æ•°æ®ï¼ˆç¼“å­˜æˆ–ç©ºæ•°æ®ï¼‰

**å¼€å‘æ¨¡å¼ï¼šç”¨æ³¨è§£å®šä¹‰èµ„æº + åŸºäºæ§åˆ¶å°å®šä¹‰è§„åˆ™**

1ï¼‰å®šä¹‰èµ„æºã€‚ç»™éœ€è¦é™æµçš„æ¥å£æ·»åŠ  @SentinelResource æ³¨è§£ï¼š

```java
@PostMapping("/list/page/vo")
@SentinelResource(value = "listQuestionBankVOByPage",
        blockHandler = "handleBlockException",
        fallback = "handleFallback")
public BaseResponse<Page<QuestionBankVO>> listQuestionBankVOByPage(
    @RequestBody QuestionBankQueryRequest questionBankQueryRequest,
    HttpServletRequest request) {
}
```

ä¸Šè¿°ä»£ç ä¸­ï¼Œå‚è€ƒ [æ³¨è§£ä½¿ç”¨å®˜æ–¹æ–‡æ¡£](https://sentinelguard.io/zh-cn/docs/annotation-support.html) æŒ‡å®šäº†èµ„æºåç§°ã€é˜»å¡å¤„ç†å™¨å’Œé™çº§å¤„ç†å™¨ã€‚

å¯åŠ¨é¡¹ç›®ï¼Œæ³¨æ„éœ€åŠ å…¥ JVM å‚æ•° `-Dcsp.sentinel.dashboard.server=consoleIp:port` æŒ‡å®šæ§åˆ¶å°åœ°å€å’Œç«¯å£ã€‚

![img](./assets/Sentinel-é±¼çš®/FSt8uJpxK2TQP2HZ.webp)

å¯åŠ¨é¡¹ç›®æˆåŠŸå¹¶ä¸”è®¿é—®æ¥å£åï¼Œå¯ä»¥åœ¨æ§åˆ¶å°çœ‹åˆ°åˆšå®šä¹‰çš„èµ„æºï¼š

![img](./assets/Sentinel-é±¼çš®/igm1dO6wGtRr4f20.webp)

2ï¼‰å®ç°é™æµé˜»å¡å’Œç†”æ–­é™çº§æ–¹æ³•ã€‚æ³¨æ„éµå¾ª [å®˜æ–¹æ–‡æ¡£çš„æ–¹æ³•å®šä¹‰è§„åˆ™](https://sentinelguard.io/zh-cn/docs/annotation-support.html)ï¼š

![img](./assets/Sentinel-é±¼çš®/jVa23HsnqNl6X6sv.webp)

ä¸ºäº†å®ç°æ–¹ä¾¿ï¼Œå°½å¿«éªŒè¯æ•ˆæœï¼Œæˆ‘ä»¬å…ˆåœ¨æ¥å£ç›¸åŒçš„ Controller ä¸­ç¼–å†™é™æµé˜»å¡å’Œé™çº§æ–¹æ³•ï¼š

```java
/**
 * listQuestionBankVOByPage é™çº§æ“ä½œï¼šç›´æ¥è¿”å›æœ¬åœ°æ•°æ®
 */
public BaseResponse<Page<QuestionBankVO>> handleFallback(@RequestBody QuestionBankQueryRequest questionBankQueryRequest,
                                                         HttpServletRequest request, Throwable ex) {
    // å¯ä»¥è¿”å›æœ¬åœ°æ•°æ®æˆ–ç©ºæ•°æ®
    return ResultUtils.success(null);
}

/**
 * listQuestionBankVOByPage æµæ§æ“ä½œ
 * é™æµï¼šæç¤ºâ€œç³»ç»Ÿå‹åŠ›è¿‡å¤§ï¼Œè¯·è€å¿ƒç­‰å¾…â€
 */
public BaseResponse<Page<QuestionBankVO>> handleBlockException(@RequestBody QuestionBankQueryRequest questionBankQueryRequest,
                                                               HttpServletRequest request, BlockException ex) {
    // é™æµæ“ä½œ
    return ResultUtils.error(ErrorCode.SYSTEM_ERROR, "ç³»ç»Ÿå‹åŠ›è¿‡å¤§ï¼Œè¯·è€å¿ƒç­‰å¾…");
}
```

3ï¼‰é€šè¿‡æ§åˆ¶å°å®šä¹‰è§„åˆ™

é™æµè§„åˆ™ï¼šæ ¹æ®éœ€æ±‚é…ç½®å³å¯

![img](./assets/Sentinel-é±¼çš®/8XVvI4rabV99RYh5.webp)

![img](./assets/Sentinel-é±¼çš®/X2aOE40rX1nhwV1Z.webp)

ç†”æ–­è§„åˆ™ï¼šæ–°å¢ä¸¤æ¡ç†”æ–­è§„åˆ™ï¼Œæ³¨æ„è®¾ç½®æœ€å°è¯·æ±‚æ•°ã€ç»Ÿè®¡æ—¶é•¿

![img](./assets/Sentinel-é±¼çš®/mLKbGY1FkBaQEV8s.webp)

![img](./assets/Sentinel-é±¼çš®/RTU9YP5sizazpMJI.webp)

4ï¼‰æµ‹è¯•

ä¸ºä¾¿äºæµ‹è¯•ï¼Œå¯ä»¥å…ˆå°†é™æµç†”æ–­è§„åˆ™è°ƒæ•´åˆ°å®¹æ˜“è§¦å‘çš„å€¼ï¼Œç„¶åé€šè¿‡æ¥å£æ–‡æ¡£æµ‹è¯•è°ƒç”¨ï¼ŒæŸ¥çœ‹æ•ˆæœã€‚

è¿ç»­å¿«é€Ÿå‘é€å¤šæ¬¡è¯·æ±‚ï¼Œè§¦å‘é™æµï¼Œæ‰§è¡Œäº† `blockHandler` å¤„ç†å™¨çš„é€»è¾‘ï¼š

![img](./assets/Sentinel-é±¼çš®/YWcfQyuFYoYBk8FP.webp)

æ³¨æ„ï¼Œåªæœ‰ä¸šåŠ¡å¼‚å¸¸ï¼ˆæ¯”å¦‚è¯·æ±‚å‚æ•°é”™è¯¯ã€æˆ–è€…æ•°æ®åº“æ“ä½œå¤±è´¥ç­‰é—®é¢˜ï¼‰ï¼Œæ‰ä¼šç®—åˆ°ç†”æ–­æ¡ä»¶ä¸­ï¼Œé™æµç†”æ–­æœ¬èº«çš„å¼‚å¸¸ BlockException æ˜¯ä¸è®¡ç®—çš„ã€‚

æµ‹è¯•ç†”æ–­çš„æ—¶å€™ï¼Œå¯ä»¥æ•…æ„ç»™ sortField è¯·æ±‚å‚æ•°ä¼ ä¸€ä¸ªä¸å­˜åœ¨çš„å­—æ®µï¼Œè§¦å‘ä¸šåŠ¡å¼‚å¸¸ã€‚å¯ä»¥å°è¯•ä¸‹ç†”æ–­çš„è§¦å‘å’Œæ¢å¤ï¼š

1. å…ˆé€šè¿‡ä¼ é”™ä¸šåŠ¡å‚æ•°è§¦å‘å¼‚å¸¸ï¼Œå¯¼è‡´ç†”æ–­
2. ç­‰å¾…ç†”æ–­ç»“æŸåï¼Œå†è§¦å‘ä¸€æ¬¡å¼‚å¸¸ï¼Œè¿˜ä¼šç»§ç»­ç†”æ–­
3. è¿‡ä¸€æ®µæ—¶é—´ï¼Œå†è§¦å‘ä¸€æ¬¡æ­£å¸¸è¯·æ±‚ï¼Œåˆ™ç†”æ–­è§£é™¤

æµ‹è¯•å‘ç°ï¼Œä»»ä½•ä¸šåŠ¡å¼‚å¸¸ï¼ˆä¸ä»…ä»…æ˜¯è¢«ç†”æ–­äº†ï¼‰ï¼Œéƒ½ä¼šè§¦å‘ `fallbackHandler`ï¼Œè¯¥æ–¹æ³•å¯ä½œä¸ºä¸€ä¸ªé€šç”¨çš„é™çº§é€»è¾‘å¤„ç†å™¨ã€‚

æµ‹è¯•å‘ç°ï¼Œå¦‚æœ `blockHandler` å’Œ `fallbackHandler` åŒæ—¶é…ç½®ï¼Œå½“ç†”æ–­å™¨æ‰“å¼€åï¼Œä»ç„¶ä¼šè¿›å…¥ `blockHandler` è¿›è¡Œå¤„ç†ï¼Œå› æ­¤éœ€è¦åœ¨è¯¥æ–¹æ³•ä¸­å¤„ç†å› ä¸ºç†”æ–­è§¦å‘çš„é™çº§é€»è¾‘ï¼š

```java
/**
 * listQuestionBankVOByPage æµæ§æ“ä½œ
 * é™æµï¼šæç¤ºâ€œç³»ç»Ÿå‹åŠ›è¿‡å¤§ï¼Œè¯·è€å¿ƒç­‰å¾…â€
 * ç†”æ–­ï¼šæ‰§è¡Œé™çº§æ“ä½œ
 */
public BaseResponse<Page<QuestionBankVO>> handleBlockException(@RequestBody QuestionBankQueryRequest questionBankQueryRequest,
                                                               HttpServletRequest request, BlockException ex) {
    // é™çº§æ“ä½œ
    if (ex instanceof DegradeException) {
        return handleFallback(questionBankQueryRequest, request, ex);
    }
    // é™æµæ“ä½œ
    return ResultUtils.error(ErrorCode.SYSTEM_ERROR, "ç³»ç»Ÿå‹åŠ›è¿‡å¤§ï¼Œè¯·è€å¿ƒç­‰å¾…");
}
```

Sentinel çš„ `blockHandler` å¤„ç†çš„æ˜¯`BlockException`ï¼Œè¯¥å¼‚å¸¸è¡¨ç¤ºç³»ç»Ÿå—åˆ°æµé‡æ§åˆ¶é™åˆ¶ï¼ˆå¦‚é™æµæˆ–ç†”æ–­ï¼‰ï¼Œè¿™äº›ä¸æ˜¯ä¸šåŠ¡é€»è¾‘ä¸­çš„å¼‚å¸¸ï¼Œå› æ­¤ `fallback` ä¸ä¼šå¤„ç†è¿™äº›å¼‚å¸¸ã€‚å¦‚æœä¸é…ç½® `blockHandler`ï¼Œæ‰ä¼šåœ¨ç†”æ–­æ—¶ï¼Œè¿›å…¥åˆ° `fallbackHandler` ä¸­è¿›è¡Œå…œåº•ã€‚

![img](./assets/Sentinel-é±¼çš®/XVsXb02kRDMUlAzw.webp)

æ€»ç»“ä¸€ä¸‹ï¼š

- `blockHandler` å¤„ç† Sentinel æµé‡æ§åˆ¶å¼‚å¸¸ï¼Œå¦‚ `BlockException`ã€‚
- `fallback` å¤„ç†ä¸šåŠ¡é€»è¾‘ä¸­çš„å¼‚å¸¸ï¼Œæ¯”å¦‚æˆ‘ä»¬è‡ªå·±çš„ `BusinessException`ã€‚

å¯ä»¥æ ¹æ®è‡ªå·±çš„å®é™…æƒ…å†µé…ç½®ã€‚

#### **2ã€å• IP æŸ¥çœ‹é¢˜ç›®åˆ—è¡¨é™æµç†”æ–­**

èµ„æºï¼šlistQuestionVoByPage æ¥å£

é™æµè§„åˆ™ï¼š

- ç­–ç•¥ï¼šæ¯ä¸ª IP åœ°å€æ¯åˆ†é’Ÿå…è®¸æŸ¥çœ‹é¢˜ç›®åˆ—è¡¨çš„æ¬¡æ•°ä¸èƒ½è¶…è¿‡ 60 æ¬¡ã€‚
- é˜»å¡æ“ä½œï¼šæç¤ºâ€œè®¿é—®è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•â€

ç†”æ–­è§„åˆ™ï¼š

- ç†”æ–­æ¡ä»¶ï¼šå¦‚æœæ¥å£å¼‚å¸¸ç‡è¶…è¿‡ 10%ï¼Œæˆ–è€…æ…¢è°ƒç”¨ï¼ˆå“åº”æ—¶é•¿ > 3 ç§’ï¼‰çš„æ¯”ä¾‹å¤§äº 20%ï¼Œè§¦å‘ 60 ç§’ç†”æ–­ã€‚
- ç†”æ–­æ“ä½œï¼šç›´æ¥è¿”å›æœ¬åœ°æ•°æ®ï¼ˆç¼“å­˜æˆ–ç©ºæ•°æ®ï¼‰

ç”±äºéœ€è¦é’ˆå¯¹æ¯ä¸ªç”¨æˆ·è¿›ä¸€æ­¥ç²¾ç»†åŒ–é™æµï¼Œè€Œä¸æ˜¯æ•´ä½“æ¥å£é™æµï¼Œå¯ä»¥é‡‡ç”¨ [çƒ­ç‚¹å‚æ•°é™æµæœºåˆ¶](https://sentinelguard.io/zh-cn/docs/parameter-flow-control.html)ï¼Œå…è®¸æ ¹æ®å‚æ•°æ§åˆ¶é™æµè§¦å‘æ¡ä»¶ã€‚

![img](./assets/Sentinel-é±¼çš®/5uHbtdBNScXIBtW8.webp)

å¯¹äºæˆ‘ä»¬çš„éœ€æ±‚ï¼Œå¯ä»¥å°† IP åœ°å€ä½œä¸ºçƒ­ç‚¹å‚æ•°ã€‚

1ï¼‰å®šä¹‰èµ„æº

å¯¹äº `@SentinelResource` æ³¨è§£æ–¹å¼å®šä¹‰çš„èµ„æºï¼Œè‹¥æ³¨è§£ä½œç”¨çš„æ–¹æ³•ä¸Šæœ‰å‚æ•°ï¼ŒSentinel ä¼šå°†å®ƒä»¬ä½œä¸ºå‚æ•°ä¼ å…¥ `SphU.entry(res, args)`ã€‚æ¯”å¦‚ä»¥ä¸‹çš„æ–¹æ³•é‡Œé¢ `uid` å’Œ `type` ä¼šåˆ†åˆ«ä½œä¸ºç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥ Sentinel APIï¼Œä»è€Œå¯ä»¥ç”¨äºçƒ­ç‚¹è§„åˆ™åˆ¤æ–­ï¼š

```java
@SentinelResource("myMethod")
public Result doSomething(String uid, int type) {
  // some logic here...
}
```

ç”±äº Controller æ¥å£å‚æ•°è¾ƒæ‚ä¹±ï¼Œä½¿ç”¨ç¼–ç¨‹å¼å®šä¹‰èµ„æºçš„æ–¹æ³•ã€‚

ğŸ’¡ è¿™é‡Œå»ºè®®æ–°å†™ä¸€ä¸ªæ¥å£ï¼Œä¸è¦æ±¡æŸ“åŸæœ‰æ¥å£ï¼Œç­‰æµ‹è¯•ç¨³å®šåï¼Œå†è¿›è¡Œåˆ‡æ¢ã€‚

ä»£ç å¦‚ä¸‹ï¼š

```java
// åŸºäº IP é™æµ
String remoteAddr = request.getRemoteAddr();
Entry entry = null;
try  {
    entry = SphU.entry("listQuestionVOByPage", EntryType.IN, 1, remoteAddr);
    // è¢«ä¿æŠ¤çš„ä¸šåŠ¡é€»è¾‘
    // æŸ¥è¯¢æ•°æ®åº“
    Page<Question> questionPage = questionService.listQuestionByPage(questionQueryRequest);
    // è·å–å°è£…ç±»
    return ResultUtils.success(questionService.getQuestionVOPage(questionPage, request));
} catch (BlockException ex) {
    // èµ„æºè®¿é—®é˜»æ­¢ï¼Œè¢«é™æµæˆ–è¢«é™çº§
    if (ex instanceof DegradeException) {
        return handleFallback(questionQueryRequest, request, ex);
    }
    // é™æµæ“ä½œ
    return ResultUtils.error(ErrorCode.SYSTEM_ERROR, "è®¿é—®è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•");
} finally {
    if (entry != null) {
        entry.exit(1, remoteAddr);
    }
}
```

ğŸ’¡éœ€è¦ç‰¹åˆ«æ³¨æ„ï¼

1. è‹¥ entry çš„æ—¶å€™ä¼ å…¥äº†çƒ­ç‚¹å‚æ•°ï¼Œé‚£ä¹ˆ exit çš„æ—¶å€™ä¹Ÿä¸€å®šè¦å¸¦ä¸Šå¯¹åº”çš„å‚æ•°ï¼ˆ`exit(count, args)`ï¼‰ï¼Œå¦åˆ™å¯èƒ½ä¼šæœ‰ç»Ÿè®¡é”™è¯¯ã€‚**è¿™ä¸ªæ—¶å€™ä¸èƒ½ä½¿ç”¨ try-with-resources çš„æ–¹å¼ã€‚**
2. `SphU.entry(xxx)` éœ€è¦ä¸ `entry.exit()` æ–¹æ³•æˆå¯¹å‡ºç°ï¼ŒåŒ¹é…è°ƒç”¨ï¼Œå¦åˆ™ä¼šå¯¼è‡´è°ƒç”¨é“¾è®°å½•å¼‚å¸¸ï¼ŒæŠ›å‡º `ErrorEntryFreeException` å¼‚å¸¸ã€‚

æ³¨æ„ Sentinel çš„é™çº§ä»…é’ˆå¯¹ä¸šåŠ¡å¼‚å¸¸ï¼Œå¯¹ Sentinel é™æµé™çº§æœ¬èº«çš„å¼‚å¸¸ `BlockException` ä¸ç”Ÿæ•ˆã€‚ä¸ºäº†ç»Ÿè®¡å¼‚å¸¸æ¯”ä¾‹æˆ–å¼‚å¸¸æ•°ï¼Œéœ€è¦æ‰‹åŠ¨é€šè¿‡ `Tracer.trace(ex)` è®°å½•ä¸šåŠ¡å¼‚å¸¸ã€‚ç¤ºä¾‹ï¼š

```java
Entry entry = null;
try {
  entry = SphU.entry(resource);

  // Write your biz code here.
  // <<BIZ CODE>>
} catch (Throwable t) {
  if (!BlockException.isBlockException(t)) {
    Tracer.trace(t);
  }
} finally {
  if (entry != null) {
    entry.exit();
  }
}
```

æ³¨æ„ï¼Œé€šè¿‡ `Tracer.trace(ex)` æ¥ç»Ÿè®¡å¼‚å¸¸ä¿¡æ¯æ—¶ï¼Œç”±äº try-with-resources è¯­æ³•ä¸­ catch è°ƒç”¨é¡ºåºçš„é—®é¢˜ï¼Œä¼šå¯¼è‡´æ— æ³•æ­£ç¡®ç»Ÿè®¡å¼‚å¸¸æ•°ï¼Œå› æ­¤ç»Ÿè®¡å¼‚å¸¸ä¿¡æ¯æ—¶ä¹Ÿä¸èƒ½åœ¨ try-with-resources çš„ catch å—ä¸­è°ƒç”¨ `Tracer.trace(ex)`ã€‚

ğŸ’¡ ä¸ºä»€ä¹ˆä¸Šä¸€ä¸ªéœ€æ±‚ä¸­ï¼Œæˆ‘ä»¬ä¸ç”¨æ‰‹åŠ¨è°ƒç”¨ Tracer ä¸ŠæŠ¥å¼‚å¸¸å‘¢ï¼Ÿå› ä¸ºä½¿ç”¨ Sentinel çš„å¼€æºæ•´åˆæ¨¡å—ï¼Œå¦‚ Sentinel Dubbo Adapter, Sentinel Web Servlet Filter æˆ– `@SentinelResource` æ³¨è§£ä¼šè‡ªåŠ¨ç»Ÿè®¡ä¸šåŠ¡å¼‚å¸¸ï¼Œæ— éœ€æ‰‹åŠ¨è°ƒç”¨ã€‚

éœ€è¦ç»™æˆ‘ä»¬çš„èµ„æºå®šä¹‰å¢åŠ å¼‚å¸¸ç»Ÿè®¡ä»£ç ï¼š

```java
catch (Throwable ex) {
    // ä¸šåŠ¡å¼‚å¸¸
    if (!BlockException.isBlockException(ex)) {
        Tracer.trace(ex);
        return ResultUtils.error(ErrorCode.SYSTEM_ERROR, "ç³»ç»Ÿé”™è¯¯");
    }
    // é™çº§æ“ä½œ
    if (ex instanceof DegradeException) {
        return handleFallback(questionQueryRequest, request, ex);
    }
    // é™æµæ“ä½œ
    return ResultUtils.error(ErrorCode.SYSTEM_ERROR, "è®¿é—®è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•");
}
```

2ï¼‰ç¼–å†™é˜»å¡å’Œé™çº§æ“ä½œä»£ç 

```java
try {
    entry = SphU.entry("listQuestionVOByPage", EntryType.IN, 1, remoteAddr);
    // è¢«ä¿æŠ¤çš„ä¸šåŠ¡é€»è¾‘
    // æŸ¥è¯¢æ•°æ®åº“
    Page<Question> questionPage = questionService.listQuestionByPage(questionQueryRequest);
    // è·å–å°è£…ç±»
    return ResultUtils.success(questionService.getQuestionVOPage(questionPage, request));
} catch (Throwable ex) {
    // ä¸šåŠ¡å¼‚å¸¸
    if (!BlockException.isBlockException(ex)) {
        Tracer.trace(ex);
        return ResultUtils.error(ErrorCode.SYSTEM_ERROR, "ç³»ç»Ÿé”™è¯¯");
    }
    // é™çº§æ“ä½œ
    if (ex instanceof DegradeException) {
        return handleFallback(questionQueryRequest, request, ex);
    }
    // é™æµæ“ä½œ
    return ResultUtils.error(ErrorCode.SYSTEM_ERROR, "è®¿é—®è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•");
} finally {
    if (entry != null) {
        entry.exit(1, remoteAddr);
    }
}

/**
 * listQuestionVOByPage é™çº§æ“ä½œï¼šç›´æ¥è¿”å›æœ¬åœ°æ•°æ®
 */
public BaseResponse<Page<QuestionVO>> handleFallback(QuestionQueryRequest questionQueryRequest,
                                                         HttpServletRequest request, Throwable ex) {
    // å¯ä»¥è¿”å›æœ¬åœ°æ•°æ®æˆ–ç©ºæ•°æ®
    return ResultUtils.success(null);
}
```

3ï¼‰é€šè¿‡ç¼–ç æ–¹å¼å®šä¹‰è§„åˆ™ã€‚å¯ä»¥æ–°å»º `sentinel` åŒ…å¹¶å®šä¹‰ä¸€ä¸ªå•ç‹¬çš„ Manager ä½œä¸º Beanï¼Œåˆ©ç”¨ @PostConstruct æ³¨è§£ï¼Œåœ¨ Bean åŠ è½½ååˆ›å»ºè§„åˆ™ã€‚ä»£ç å¦‚ä¸‹ï¼š

```java
@Component
public class SentinelRulesManager {

    @PostConstruct
    public void initRules() {
        initFlowRules();
        initDegradeRules();
    }

    // é™æµè§„åˆ™
    public void initFlowRules() {
        // å• IP æŸ¥çœ‹é¢˜ç›®åˆ—è¡¨é™æµè§„åˆ™
        ParamFlowRule rule = new ParamFlowRule("listQuestionVOByPage")
                .setParamIdx(0) // å¯¹ç¬¬ 0 ä¸ªå‚æ•°é™æµï¼Œå³ IP åœ°å€
                .setCount(60) // æ¯åˆ†é’Ÿæœ€å¤š 60 æ¬¡
                .setDurationInSec(60); // è§„åˆ™çš„ç»Ÿè®¡å‘¨æœŸä¸º 60 ç§’
        ParamFlowRuleManager.loadRules(Collections.singletonList(rule));
    }

    // é™çº§è§„åˆ™
    public void initDegradeRules() {
        // å• IP æŸ¥çœ‹é¢˜ç›®åˆ—è¡¨ç†”æ–­è§„åˆ™
        DegradeRule slowCallRule = new DegradeRule("listQuestionVOByPage")
                .setGrade(CircuitBreakerStrategy.SLOW_REQUEST_RATIO.getType())
                .setCount(0.2) // æ…¢è°ƒç”¨æ¯”ä¾‹å¤§äº 20%
                .setTimeWindow(60) // ç†”æ–­æŒç»­æ—¶é—´ 60 ç§’
                .setStatIntervalMs(30 * 1000) // ç»Ÿè®¡æ—¶é•¿ 30 ç§’
                .setMinRequestAmount(10) // æœ€å°è¯·æ±‚æ•°
                .setSlowRatioThreshold(3); // å“åº”æ—¶é—´è¶…è¿‡ 3 ç§’

        DegradeRule errorRateRule = new DegradeRule("listQuestionVOByPage")
                .setGrade(CircuitBreakerStrategy.ERROR_RATIO.getType())
                .setCount(0.1) // å¼‚å¸¸ç‡å¤§äº 10%
                .setTimeWindow(60) // ç†”æ–­æŒç»­æ—¶é—´ 60 ç§’
                .setStatIntervalMs(30 * 1000) // ç»Ÿè®¡æ—¶é•¿ 30 ç§’
                .setMinRequestAmount(10); // æœ€å°è¯·æ±‚æ•°

        // åŠ è½½è§„åˆ™
        DegradeRuleManager.loadRules(Arrays.asList(slowCallRule, errorRateRule));
    }
}
```

4ï¼‰æµ‹è¯•

å¯åŠ¨é¡¹ç›®å°±èƒ½çœ‹åˆ°è§„åˆ™ï¼š

![img](./assets/Sentinel-é±¼çš®/h7RcI0M3GyfrEHjG.webp)

ä¸ºäº†æµ‹è¯•æ–¹ä¾¿ï¼Œå¯ä»¥å…ˆå°†è§„åˆ™çš„é˜ˆå€¼è°ƒæ•´å°ä¸€ç‚¹ï¼Œç„¶åé€šè¿‡æ¥å£æ–‡æ¡£éªŒè¯æ•ˆæœã€‚

é™æµæ•ˆæœï¼š

![img](./assets/Sentinel-é±¼çš®/fpzesO4uBuDgFCT2.webp)

æµ‹è¯•é™çº§æ•ˆæœçš„æ—¶å€™ï¼Œå¯ä»¥æ•…æ„å°† sortField ä¼ ä¸€ä¸ªä¸å­˜åœ¨çš„å­—æ®µã€‚æ•ˆæœå¦‚å›¾ï¼Œè§¦å‘äº† DegradeExceptionï¼š

![img](./assets/Sentinel-é±¼çš®/XM9oxMNhMfMjtXN3.webp)

### æ‰©å±•çŸ¥è¯†

#### 1ã€ä»…å¯¹éƒ¨åˆ† URL è¿›è¡Œç»Ÿè®¡ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰

å‚è€ƒï¼š[https://github.com/alibaba/spring-cloud-alibaba/wiki/Sentinel#%E9%85%8D%E7%BD%AE](https://github.com/alibaba/spring-cloud-alibaba/wiki/Sentinel#é…ç½®)â€˜

å¯ä»¥ä¿®æ”¹ç›‘å¬çš„ URL è§„åˆ™é…ç½®ï¼š

```xml
spring.cloud.sentinel.filter.url-patterns=/*
```

#### 2ã€è§„åˆ™é…ç½®æœ¬åœ°æŒä¹…åŒ–

å‚è€ƒå®˜æ–¹æ–‡æ¡£çš„é…ç½®ï¼šhttps://sentinelguard.io/zh-cn/docs/dynamic-rule-configuration.html

å®˜æ–¹æä¾›äº† Demoï¼Œå¯ä»¥ç”¨æ–‡ä»¶æ¥æœ¬åœ°æŒä¹…åŒ–é…ç½®ï¼Œè¿™æ ·é‡å¯é¡¹ç›®åé…ç½®å°±ä¸ä¼šä¸¢å¤±äº†ã€‚

- [è¯»å†™æœ¬åœ°æ–‡ä»¶ Demo](https://github.com/alibaba/Sentinel/blob/master/sentinel-demo/sentinel-demo-dynamic-file-rule/src/main/java/com/alibaba/csp/sentinel/demo/file/rule/FileDataSourceInit.java)ï¼ˆå…ˆçœ‹è¿™ä¸ªï¼‰
- [è¯»æœ¬åœ°æ–‡ä»¶ Demo](https://github.com/alibaba/Sentinel/blob/master/sentinel-demo/sentinel-demo-dynamic-file-rule/src/main/java/com/alibaba/csp/sentinel/demo/file/rule/FileDataSourceDemo.java)

![img](./assets/Sentinel-é±¼çš®/xcINe23tQitIGB75.webp)

ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼Œå¯ä»¥åœ¨ SentinelManager çš„åˆå§‹åŒ–é€»è¾‘ä¸­è°ƒç”¨ï¼š

```java
/**
 * æŒä¹…åŒ–é…ç½®ä¸ºæœ¬åœ°æ–‡ä»¶
 */
public void listenRules() throws Exception {
    // è·å–é¡¹ç›®æ ¹ç›®å½•
    String rootPath = System.getProperty("user.dir");
    // sentinel ç›®å½•è·¯å¾„
    File sentinelDir = new File(rootPath, "sentinel");
    // ç›®å½•ä¸å­˜åœ¨åˆ™åˆ›å»º
    if (!FileUtil.exist(sentinelDir)) {
        FileUtil.mkdir(sentinelDir);
    }
    // è§„åˆ™æ–‡ä»¶è·¯å¾„
    String flowRulePath = new File(sentinelDir, "FlowRule.json").getAbsolutePath();
    String degradeRulePath = new File(sentinelDir, "DegradeRule.json").getAbsolutePath();

    // Data source for FlowRule
    ReadableDataSource<String, List<FlowRule>> flowRuleDataSource = new FileRefreshableDataSource<>(flowRulePath, flowRuleListParser);
    // Register to flow rule manager.
    FlowRuleManager.register2Property(flowRuleDataSource.getProperty());
    WritableDataSource<List<FlowRule>> flowWds = new FileWritableDataSource<>(flowRulePath, this::encodeJson);
    // Register to writable data source registry so that rules can be updated to file
    WritableDataSourceRegistry.registerFlowDataSource(flowWds);

    // Data source for DegradeRule
    FileRefreshableDataSource<List<DegradeRule>> degradeRuleDataSource
            = new FileRefreshableDataSource<>(
            degradeRulePath, degradeRuleListParser);
    DegradeRuleManager.register2Property(degradeRuleDataSource.getProperty());
    WritableDataSource<List<DegradeRule>> degradeWds = new FileWritableDataSource<>(degradeRulePath, this::encodeJson);
    // Register to writable data source registry so that rules can be updated to file
    WritableDataSourceRegistry.registerDegradeDataSource(degradeWds);
}

private Converter<String, List<FlowRule>> flowRuleListParser = source -> JSON.parseObject(source,
        new TypeReference<List<FlowRule>>() {
        });
private Converter<String, List<DegradeRule>> degradeRuleListParser = source -> JSON.parseObject(source,
        new TypeReference<List<DegradeRule>>() {
        });

private <T> String encodeJson(T t) {
    return JSON.toJSONString(t);
}
```

ç„¶åå¯ä»¥æµ‹è¯•è¯»å†™æ•ˆæœã€‚

#### 3ã€ä»£ç ç»„ç»‡ç»“æ„ä¼˜åŒ–

é™æµé˜»å¡å’Œé™çº§æ–¹æ³•å¯ä»¥å•ç‹¬æŠ½æˆç‹¬ç«‹çš„ç±»ï¼ŒSentinel çš„èµ„æºåç§°ä¹Ÿå¯ä»¥å•ç‹¬å®šä¹‰ä¸ºå¸¸é‡ï¼Œç»Ÿä¸€æ”¾åˆ° sentinel åŒ…ä¸­ï¼Œæ›´æ¨¡å—åŒ–ã€‚

å¸¸é‡ç±»ï¼š

```java
/**
 * Sentinel é™æµç†”æ–­å¸¸é‡
 */
public interface SentinelConstant {

    /**
     * åˆ†é¡µè·å–é¢˜åº“åˆ—è¡¨æ¥å£é™æµ
     */
    String listQuestionBankVOByPage = "listQuestionBankVOByPage";

    /**
     * åˆ†é¡µè·å–é¢˜ç›®åˆ—è¡¨æ¥å£é™æµ
     */
    String listQuestionVOByPage = "listQuestionVOByPage";
}
```

#### 4ã€å°è£…é™æµç»„ä»¶ä¸º Spring Boot Starter

ä¸ºäº†ç®€åŒ–é¡¹ç›®çš„é…ç½®å’Œä¾èµ–ç®¡ç†ï¼Œå‡å°‘é™æµç»„ä»¶çš„æ¥å…¥æˆæœ¬ï¼Œæˆ‘ä»¬é€šè¿‡ Starter å°è£…é™æµç»„ä»¶ï¼Œå°†å¤šä¸ªç›¸å…³çš„ä¾èµ–æ‰“åŒ…æˆä¸€ä¸ª Maven ä¾èµ–ï¼Œç”¨æˆ·åªéœ€å¼•å…¥ä¸€ä¸ªä¾èµ–å³å¯å®Œæˆé…ç½®ï¼Œè€Œä¸éœ€è¦æ‰‹åŠ¨å¼•å…¥æ¯ä¸ªæ¨¡å—çš„ä¾èµ–ã€‚

1ï¼‰åˆ›å»ºä¸€ä¸ª spring boot é¡¹ç›®

å°†æ— ç”¨çš„é»˜è®¤ä¾èµ–éƒ½ç§»é™¤ï¼Œä¾‹å¦‚é»˜è®¤çš„é…ç½®æ–‡ä»¶ã€å¯åŠ¨æ–‡ä»¶ã€test ç›¸å…³ç­‰ã€‚

2ï¼‰å¼•å…¥éœ€è¦çš„ä¾èµ–ã€‚å®Œæ•´ pom æ–‡ä»¶å¦‚ä¸‹ï¼š

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>2.7.2</version>
        <relativePath/> <!-- lookup parent from repository -->
    </parent>
    <groupId>com.yupi</groupId>
    <artifactId>limit-spring-boot-starter</artifactId>
    <version>0.0.1-SNAPSHOT</version>
    <name>limit-spring-boot-starter</name>
    <description>limit-spring-boot-starter</description>
    <properties>
        <java.version>1.8</java.version>
    </properties>
    <dependencies>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter</artifactId>
        </dependency>

        <dependency>
            <groupId>com.alibaba.csp</groupId>
            <artifactId>sentinel-core</artifactId>
            <version>1.8.6</version>
        </dependency>
        <dependency>
            <groupId>com.alibaba.csp</groupId>
            <artifactId>sentinel-transport-simple-http</artifactId>
            <version>1.8.6</version>
        </dependency>
        <dependency>
            <groupId>com.alibaba.csp</groupId>
            <artifactId>sentinel-annotation-aspectj</artifactId>
            <version>1.8.6</version>
        </dependency>
        <dependency>
            <groupId>com.alibaba.csp</groupId>
            <artifactId>sentinel-parameter-flow-control</artifactId>
            <version>1.8.6</version>
        </dependency>
    </dependencies>


</project>
```

3ï¼‰åˆ›å»ºé…ç½®æ–‡ä»¶

```java
@ConfigurationProperties(prefix = "spring")
public class LimitProperties {
    private String sentinelDashboard;
    private List<LimitRule> limitRules;

    public List<LimitRule> getLimitRules() {
        return limitRules;
    }

    public void setLimitRules(List<LimitRule> limitRules) {
        this.limitRules = limitRules;
    }

    public String getSentinelDashboard() {
        return sentinelDashboard;
    }

    public void setSentinelDashboard(String sentinelDashboard) {
        this.sentinelDashboard = sentinelDashboard;
    }

    public static class LimitRule {
        private String resource;
        private int grade;
        private int count;

        public String getResource() {
            return resource;
        }

        public void setResource(String resource) {
            this.resource = resource;
        }

        public int getGrade() {
            return grade;
        }

        public void setGrade(int grade) {
            this.grade = grade;
        }

        public int getCount() {
            return count;
        }

        public void setCount(int count) {
            this.count = count;
        }
    }

}
```

4ï¼‰åˆ›å»ºè‡ªåŠ¨é…ç½®ç±»

```java
@Configuration
@EnableConfigurationProperties(LimitProperties.class)
public class LimitAutoConfiguration {

    @Resource
    private LimitProperties properties;

    @Bean
    @ConditionalOnMissingBean
    public SentinelResourceAspect sentinelResourceAspect() {
        return new SentinelResourceAspect();
    }

    @PostConstruct
    public void initLimit() {
        initDefaultRule();
        initDashboard();
    }


    private void initDefaultRule() {
        List<LimitProperties.LimitRule> limitRules = properties.getLimitRules();
        if (CollectionUtils.isEmpty(limitRules)) {
            return;
        }

        List<FlowRule> rules = new ArrayList<>();
        for (LimitProperties.LimitRule limitRule : limitRules) {
            FlowRule rule = new FlowRule();
            rule.setResource(limitRule.getResource());
            rule.setGrade(limitRule.getGrade());
            rule.setCount(limitRule.getCount());
            rules.add(rule);
        }
        FlowRuleManager.loadRules(rules);
    }

    private void initDashboard() {
        SentinelConfig.setConfig("csp.sentinel.dashboard.server", properties.getSentinelDashboard());
    }
}
```

5ï¼‰åˆ›å»º spring.factories æ–‡ä»¶ã€‚

åœ¨ src/main/resources/META-INF ç›®å½•ä¸‹åˆ›å»º spring.factories æ–‡ä»¶ï¼Œå¹¶åœ¨å…¶ä¸­å®šä¹‰è‡ªåŠ¨é…ç½®ç±»ã€‚

![img](./assets/Sentinel-é±¼çš®/EWwFulpgl9NAgNrO.webp)

æ–‡ä»¶å†…å®¹ï¼š

```plain
org.springframework.boot.autoconfigure.EnableAutoConfiguration=\
  com.yupi.limitspringbootstarter.LimitAutoConfiguration
```

6ï¼‰æœ¬åœ° install

![img](./assets/Sentinel-é±¼çš®/X1DOrcZk8dQsaovc.webp)

è¿™æ ·æœ¬åœ°ä»“åº“å°±æœ‰äº†å½“å‰çš„ starterã€‚

7ï¼‰ä½¿ç”¨ã€‚åç«¯é¡¹ç›®å¼•å…¥æ­¤ starterï¼š

```xml
  <dependency>
      <artifactId>limit-spring-boot-starter</artifactId>
      <groupId>com.yupi</groupId>
      <version>0.0.1-SNAPSHOT</version>
  </dependency>
```

application.yml æ–‡ä»¶ä¸­å¡«å†™å¯¹åº”é™æµé…ç½®ï¼š

```yaml
spring:
  # sentinel æ§åˆ¶å°åœ°å€
  sentinelDashboard: localhost:7878 
  # é™æµè§„åˆ™
  limitRules:
    - resource: "QuestionBank"
      count: 5
      grade: 1
```

é¡¹ç›®ä¸­åŒæ ·è¿˜æ˜¯ä½¿ç”¨ `@SentinelResource`æ³¨è§£ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ§åˆ¶å°åŠ¨æ€é…ç½®é™æµã€‚