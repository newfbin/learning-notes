# 13  åŠ å…¥é˜Ÿä¼æƒé™æ ¡éªŒ

<font style="color:rgb(51, 51, 51);">åœ¨çº¿å›æ”¾ï¼š</font>[https://meeting.tencent.com/v2/cloud-record/share?...](https://meeting.tencent.com/v2/cloud-record/share?id=bd47843d-fb08-43ca-8549-a3f32c7da65b&from=3)<font style="color:rgb(51, 51, 51);"> (è®¿é—®å¯†ç ï¼šK4a7) </font>

## ä¸€ã€ä¸»é¡µåˆ‡æ¢åŠŸèƒ½
åœ¨vantç»„ä»¶åº“é‡Œå¯»æ‰¾switchå¼€å…³ï¼Œå¤åˆ¶åˆ°ä¸»é¡µindexé‡Œé¢  
![1669459751988-9702b7c0-1747-4f3e-b791-26465ccff0af.png](./img/-mE-D-fHXRPwR49r/1669459751988-9702b7c0-1747-4f3e-b791-26465ccff0af-200390.png)  
![1669463503627-e2ada385-1c03-4741-a7b7-b8d4cac3dd7f.png](./img/-mE-D-fHXRPwR49r/1669463503627-e2ada385-1c03-4741-a7b7-b8d4cac3dd7f-103116.png)  
å®šä¹‰ä¸€ä¸ªå¼€å…³åˆ‡æ¢å¸¸é‡ï¼Œé»˜è®¤ä¸ºå…³é—­



![1669472239069-93a19495-d95b-4c1c-8730-6d990a8ca99b.png](./img/-mE-D-fHXRPwR49r/1669472239069-93a19495-d95b-4c1c-8730-6d990a8ca99b-179143.png)



æˆ‘ä»¬ç°åœ¨ä¸éœ€è¦ä¸€æ¬¡æ€§æŒ‚è½½ï¼Œå†™ä¸€ä¸ªåŠ è½½çš„æ–¹æ³•ï¼Œå¹¶ä¸”å†™ä¸€ä¸ªç›‘å¬å™¨ï¼ˆå½“å¼€å…³åˆ‡æ¢æ—¶ï¼Œâ€œæ›´æ¢é¡µé¢â€)



```javascript
/**
* åŠ è½½æ•°æ®
*/
  const loadData = async () => {
    let userListData;
    // å¿ƒåŠ¨æ¨¡å¼ï¼Œæ ¹æ®æ ‡ç­¾åŒ¹é…ç”¨æˆ·
    if (isMatchMode.value) {
      const num = 10;
      userListData = await myAxios.get('/user/match', {
        params: {
          num,
        },
      })
        .then(function (response) {
          console.log('/user/match succeed', response);
          return response?.data;
        })
        .catch(function (error) {
          console.error('/user/match error', error);
          Toast.fail('è¯·æ±‚å¤±è´¥');
        })
    } else {
      // æ™®é€šæ¨¡å¼ï¼Œç›´æ¥åˆ†é¡µæŸ¥è¯¢ç”¨æˆ·
      userListData = await myAxios.get('/user/recommend', {
        params: {
          pageSize: 8,
          pageNum: 1,
        },
      })
        .then(function (response) {
          console.log('/user/recommend succeed', response);
          return response?.data?.records;
        })
        .catch(function (error) {
          console.error('/user/recommend error', error);
          Toast.fail('è¯·æ±‚å¤±è´¥');
        })
    }
    if (userListData) {
      userListData.forEach((user: UserType) => {
        if (user.tags) {
          user.tags = JSON.parse(user.tags);
        }
      })
      userList.value = userListData;
    }
  }

  watchEffect(() => {
    loadData();
  })
```



PSï¼šåˆ«å¿˜äº†![1669464197956-5602801f-5d21-4755-a541-45bedff6245f.png](./img/-mE-D-fHXRPwR49r/1669464197956-5602801f-5d21-4755-a541-45bedff6245f-815303.png)ï¼Œå¦åˆ™è¿è¡ŒæŠ¥é”™  
ä½†æ˜¯æ·»åŠ ä¹‹åuser.tageä¼šçˆ†çº¢,å¯ä»¥å°†UserTypeé‡Œçš„tagsç±»å‹ä»æ•°ç»„æ”¹ä¸ºå­—ç¬¦ä¸²å½¢å¼ï¼ˆè¿™é‡Œçˆ†çº¢ä¹Ÿèƒ½è¿è¡Œï¼Œæ‰€ä»¥å°±ä¸æ›´æ”¹äº†ï¼‰  
![1669464237152-d7a197a3-9a26-4642-8ef1-30156a9673b0.png](./img/-mE-D-fHXRPwR49r/1669464237152-d7a197a3-9a26-4642-8ef1-30156a9673b0-242524.png)  
è¿è¡Œï¼Œé¡µé¢æ˜¾ç¤ºå¦‚ä¸‹ Â ç‚¹å‡»å¼€å…³  
![1669469800163-02a83eea-4973-477c-996c-4958d47a514f.png](./img/-mE-D-fHXRPwR49r/1669469800163-02a83eea-4973-477c-996c-4958d47a514f-047347.png)![1669469832724-d0fdb096-3543-46e4-95c7-72187cdc4ca7.png](./img/-mE-D-fHXRPwR49r/1669469832724-d0fdb096-3543-46e4-95c7-72187cdc4ca7-077463.png)  
ä¸­é—´åŠ è½½çš„æ—¶é—´è¾ƒé•¿ï¼Œè¿™æ˜¯æ­£å¸¸ç°è±¡



## äºŒã€todo


![1669470337874-46b5a929-9e88-4806-8560-db16dfdc5d93.png](./img/-mE-D-fHXRPwR49r/1669470337874-46b5a929-9e88-4806-8560-db16dfdc5d93-170089.png)



### 1.åŠ è½½loadingç‰¹æ•ˆ


æˆ‘ä»¬ä½¿ç”¨éª¨æ¶å±ç‰¹æ•ˆ  
![1669473451394-cb996f55-dc5f-487d-a77a-03bac3da5211.png](./img/-mE-D-fHXRPwR49r/1669473451394-cb996f55-dc5f-487d-a77a-03bac3da5211-919072.png)



æŠŠå®ƒæ”¾åœ¨UserListCardé‡Œé¢ï¼ˆåŒ…è£¹å†…å®¹ï¼‰



![1669475265245-332d9ef5-4cc2-4ca7-a41e-d7dd23d3ad1c.png](./img/-mE-D-fHXRPwR49r/1669475265245-332d9ef5-4cc2-4ca7-a41e-d7dd23d3ad1c-757518.png)



åˆ«å¿˜äº†åœ¨jsé‡Œæ·»åŠ è¿™ä¸¤ä¸ªå‚æ•°  
![1669475290923-d35890ac-2168-45bb-bd9e-7a5e4cd2893f.png](./img/-mE-D-fHXRPwR49r/1669475290923-d35890ac-2168-45bb-bd9e-7a5e4cd2893f-449163.png)  
åˆ°indexçš„user-card-listé‡Œå¼•ç”¨  
![1669475384175-3d15a91c-ce8c-484f-a51e-ccc53fc484b6.png](./img/-mE-D-fHXRPwR49r/1669475384175-3d15a91c-ce8c-484f-a51e-ccc53fc484b6-300529.png)  
åŒæ—¶åˆ«å¿˜äº†å¼•å…¥loadingå¸¸é‡ï¼Œå¹¶åœ¨loadDataæ–¹æ³•é‡Œï¼Œåœ¨å¼€å§‹å’Œç»“å°¾å¤„åˆ†åˆ«ä½¿loadingè®¾ç½®ä¸ºtrueå’Œfalse



### 2.ä»…åŠ å…¥é˜Ÿä¼å’Œåˆ›å»ºé˜Ÿä¼çš„äººèƒ½çœ‹åˆ°é˜Ÿä¼æ“ä½œæŒ‰é’®


**é˜Ÿä¼æ“ä½œæƒé™æ§åˆ¶**  
åŠ å…¥é˜Ÿä¼ï¼š ä»…éé˜Ÿä¼åˆ›å»ºäººã€ä¸”æœªåŠ å…¥é˜Ÿä¼çš„äººå¯è§  
æ›´æ–°é˜Ÿä¼ï¼šä»…åˆ›å»ºäººå¯è§  
è§£æ•£é˜Ÿä¼ï¼šä»…åˆ›å»ºäººå¯è§  
é€€å‡ºé˜Ÿä¼ï¼šåˆ›å»ºäººä¸å¯è§ï¼Œä»…å·²åŠ å…¥é˜Ÿä¼çš„äººå¯è§



ä»…åŠ å…¥é˜Ÿä¼å’Œåˆ›å»ºé˜Ÿä¼çš„äººèƒ½çœ‹åˆ°é˜Ÿä¼æ“ä½œæŒ‰é’®ï¼ˆlistTeam æ¥å£è¦èƒ½è·å–æˆ‘åŠ å…¥çš„é˜Ÿä¼çŠ¶æ€ï¼‰  
æ–¹æ¡ˆ 1ï¼šå‰ç«¯æŸ¥è¯¢æˆ‘åŠ å…¥äº†å“ªäº›é˜Ÿä¼åˆ—è¡¨ï¼Œç„¶ååˆ¤æ–­æ¯ä¸ªé˜Ÿä¼ id æ˜¯å¦åœ¨åˆ—è¡¨ä¸­ï¼ˆå‰ç«¯è¦å¤šå‘ä¸€æ¬¡è¯·æ±‚ï¼‰  
æ–¹æ¡ˆ 2ï¼šåœ¨åç«¯å»åšä¸Šè¿°äº‹æƒ…ï¼ˆæ¨èï¼‰  
è¿™é‡Œæˆ‘ä»¬é€‰æ‹©æ–¹æ¡ˆ2



#### 1.é¦–å…ˆä¸ºTeamUserVOå¤ªé‚£å‡ æ˜¯å¦å·²åŠ å…¥é˜Ÿä¼çš„å­—æ®µ


![1669477352376-5178f5d3-c672-4a58-b09a-a816bc950d71.png](./img/-mE-D-fHXRPwR49r/1669477352376-5178f5d3-c672-4a58-b09a-a816bc950d71-367778.png)



#### 2.ä¿®æ”¹listTeamçš„æ¥å£ï¼ŒåŠ å…¥æ˜¯å¦å·²ç»åŠ å…¥é˜Ÿä¼çš„åˆ¤æ–­


```java
    @GetMapping("/list")
    public BaseResponse<List<TeamUserVO>> listTeams(TeamQuery teamQuery, HttpServletRequest request) {
        if (teamQuery == null) {
            throw new BusinessException(ErrorCode.PARAMS_ERROR);
        }
        boolean isAdmin = userService.isAdmin(request);
        // 1ã€æŸ¥è¯¢é˜Ÿä¼åˆ—è¡¨
        List<TeamUserVO> teamList = teamService.listTeams(teamQuery, isAdmin);
        final List<Long> teamIdList = teamList.stream().map(TeamUserVO::getId).collect(Collectors.toList());
        // 2ã€åˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦å·²åŠ å…¥é˜Ÿä¼
        QueryWrapper<UserTeam> userTeamQueryWrapper = new QueryWrapper<>();
        try {
            User loginUser = userService.getLoginUser(request);
            userTeamQueryWrapper.eq("userId", loginUser.getId());
            userTeamQueryWrapper.in("teamId", teamIdList);
            List<UserTeam> userTeamList = userTeamService.list(userTeamQueryWrapper);
            // å·²åŠ å…¥çš„é˜Ÿä¼ id é›†åˆ
            Set<Long> hasJoinTeamIdSet = userTeamList.stream().map(UserTeam::getTeamId).collect(Collectors.toSet());
            teamList.forEach(team -> {
                boolean hasJoin = hasJoinTeamIdSet.contains(team.getId());
                team.setHasJoin(hasJoin);
            });
        } catch (Exception e) {}
        return ResultUtils.success(teamList);
    }
```



#### 3.ä¿®æ”¹å‰ç«¯é¡µé¢çš„user-card-listé‡Œ4ä¸ªæŒ‰é’®å‡ºç°çš„åˆ¤æ–­æ¡ä»¶


```vue
        <van-button size="small" type="primary" v-if="team.userId !== currentUser?.id && !team.hasJoin" plain
                    @click="preJoinTeam(team)">
          åŠ å…¥é˜Ÿä¼
        </van-button>
        <van-button v-if="team.userId === currentUser?.id" size="small" plain
                    @click="doUpdateTeam(team.id)">æ›´æ–°é˜Ÿä¼
        </van-button>
        <!-- ä»…åŠ å…¥é˜Ÿä¼å¯è§ -->
        <van-button v-if="team.userId !== currentUser?.id && team.hasJoin" size="small" plain
                    @click="doQuitTeam(team.id)">é€€å‡ºé˜Ÿä¼
        </van-button>
        <van-button v-if="team.userId === currentUser?.id" size="small" type="danger" plain
                    @click="doDeleteTeam(team.id)">è§£æ•£é˜Ÿä¼
        </van-button>
```



#### 4.æµ‹è¯•


æˆ‘çš„æ•°æ®åº“é‡Œæœ‰14é˜Ÿä¼å’Œ24é˜Ÿä¼ï¼Œå…¶ä¸­4æ˜¯24çš„åˆ›å»ºè€…ï¼Œ550007æ˜¯14çš„åˆ›å»ºè€…ï¼ŒåŒæ—¶4ä¹Ÿæ˜¯14çš„é˜Ÿå‘˜  
psï¼šï¼ˆå†™å®Œåç«¯åƒä¸‡åˆ«å¿˜äº†é‡å¯ï¼‰  
![1669478479069-cb249ff7-66f6-4222-b702-bcce57184dcf.png](./img/-mE-D-fHXRPwR49r/1669478479069-cb249ff7-66f6-4222-b702-bcce57184dcf-028868.png)



å¯¹ç…§è¦æ±‚ï¼Œçœ‹çœ‹æ˜¯å¦ç¬¦åˆ Â  ï¼ˆâˆšï¼‰  
![1669478499693-a0203770-4ef1-4c5e-b419-6f486d3fd92f.png](./img/-mE-D-fHXRPwR49r/1669478499693-a0203770-4ef1-4c5e-b419-6f486d3fd92f-135933.png)



### 3.å‰ç«¯å¯¼èˆªæ æ­»ã€æ ‡é¢˜ã€‘é—®é¢˜


è§£å†³ï¼šä½¿ç”¨ router.beforeEachï¼Œæ ¹æ®è¦è·³è½¬é¡µé¢çš„ url è·¯å¾„ åŒ¹é… config/routes é…ç½®çš„ title å­—æ®µ  
1.é…ç½®è·¯ç”±é‡Œçš„titleå­—æ®µ  
![1669480155236-598629df-68d8-41b1-8832-8f50480879de.png](./img/-mE-D-fHXRPwR49r/1669480155236-598629df-68d8-41b1-8832-8f50480879de-234189.png)  
åœ¨BasicLayouté‡Œå¢åŠ æ ¹æ®è·¯ç”±åˆ‡æ¢æ ‡é¢˜  
![1669511865184-867b192e-5015-40e9-9ec9-30f14c878068.png](./img/-mE-D-fHXRPwR49r/1669511865184-867b192e-5015-40e9-9ec9-30f14c878068-840576.png)  
åŒæ—¶æŠŠåŸæ¥ç”¨äºæµ‹è¯•çš„Toastå“åº”ï¼ˆè¯·æ±‚æˆåŠŸï¼‰åˆ é™¤ï¼Œå…¨å±€æœç´¢åˆ é™¤



![](https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2767/image-20230208012500879.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_14%2Ctext_U2hpZXI%3D%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10)



åˆ«å¿˜äº†ï¼ŒæŠŠè¿™å¥ä¹Ÿåˆ é™¤  
![1669511941589-0c4eea23-a444-48bc-97e9-b4425551f646.png](./img/-mE-D-fHXRPwR49r/1669511941589-0c4eea23-a444-48bc-97e9-b4425551f646-170944.png)  
åˆ·æ–°ï¼Œåˆ‡æ¢åˆ°ä¸åŒé¡µé¢ï¼Œæµ‹è¯•æ ‡ç­¾æ æ˜¯å¦æ›´æ¢ï¼Œä»¥åŠè¯·æ±‚æˆåŠŸæ˜¯å¦ä¸å†å‡ºç°



## ç¬¬åä¸‰æœŸå®Œç»“ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰


> æ›´æ–°: 2023-02-10 10:07:37  
> åŸæ–‡: <https://www.yuque.com/shierkcs/catstudy/hlehrls6ykwzgd8b>