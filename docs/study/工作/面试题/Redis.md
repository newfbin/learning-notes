## 为什么Redis这么快

- 使用C语言实现，效率高
- 数据存储在内存中，相比于传统的，访问速度快
- 使用单线程事件驱动模型结合IO多路复用，避免了线程间上下文切换产生不必要的开销
- Redis提供了一些高效的数据结构，如字符串、哈希、ZSet等，这些数据结构大多数操作的时间复杂度都为O(1)，并且经过优化之后，能够快速完成各种操作

## 为什么Redis要把数据放到内存中

- 放到内存中能够快速读写数据
- Redis提供了数据持久化机制，不用担心数据丢失

## 什么是Pipline

Pipline允许客户端在一次网络请求中发送多条命令到服务端

## Pipline和事务的区别

事务保证原子性

Pipline不保证原子性，如果一条命令执行失败，会继续执行其余的命令

## Pipline的好处

节省了网络传输时间

减少了服务端上下文切换的开销

## Redis持久化机制

Redis持久化机制主要有两种：RDB和AOF

### RDB

- RDB通过生成某一时刻的数据快照实现持久化，每隔一段时间生成一次
- 能够生成紧凑的二进制数据，适合数据备份和恢复，但可能会在崩溃时，丢失最后一次备份之后的数据

**优点**：

写入和恢复数据的速度都很快

**缺点**:

容易丢失数据，会丢失最后一次备份之后的数据

### AOF

- 通过将写操作追加到日志文件中实现持久化
- 文件大，恢复成本高

**优点**：

数据恢复更加精确，不会丢失数据

**缺点**:

数据恢复的时间更长

### 混合恢复机制

由于RDB和AOF各有优缺点，在Redis4.0的时候出现了混合恢复机制

该机制结合了RDB和AOF的优点

流程如下：

- 每次AOF更新时，都会将RDB复制到新的AOF文件头部，在向AOF文件头部复制RDB数据期间，执行的命令都会存到命令缓冲区
- 在RDB数据完全复制到AOF文件之后，命令缓冲区的命令会被追加到新的AOF文件的结尾
- 之后使用AOF文件进行恢复时，会先将RDB的数据恢复，再执行AOF文件剩余的命令
- 即利用了RDB快速恢复数据的优点，又利用了AOF文件准确恢复数据的优点

## RDB回写时机

可以设置

always实时写入

senc每秒写入

不写入，由操作系统决定合适写入



## AOF更新机制

AOF可以通过手动执行命令或开启配置开启该机制

AOF文件中的字段命令会更新为最新的等效的命令