(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[111],{110:function(s,e,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/chapter7",function(){return r(9483)}])},3780:function(s,e){"use strict";e.Z={src:"../../media/coding-may.73ece283.jpg"/*tpa=https://qufei1993.github.io/nextjs-learn-cn//_next/static/media/coding-may.73ece283.jpg*/,height:826,width:838,blurDataURL:"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAoKCgoKCgsMDAsPEA4QDxYUExMUFiIYGhgaGCIzICUgICUgMy03LCksNy1RQDg4QFFeT0pPXnFlZXGPiI+7u/sBCgoKCgoKCwwMCw8QDhAPFhQTExQWIhgaGBoYIjMgJSAgJSAzLTcsKSw3LVFAODhAUV5PSk9ecWVlcY+Ij7u7+//CABEIAAgACAMBIgACEQEDEQH/xAAnAAEBAAAAAAAAAAAAAAAAAAAABwEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAAoIP/xAAaEAEAAgMBAAAAAAAAAAAAAAABAhEAA0Fx/9oACAEBAAE/ACLKgp1c9XP/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oACAECAQE/AH//xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oACAEDAQE/AH//2Q==",blurWidth:8,blurHeight:8}},4826:function(s,e){"use strict";e.Z={src:"../../media/qrcode_for_coding_world.36d9f0b1.avif.jpg"/*tpa=https://qufei1993.github.io/nextjs-learn-cn//_next/static/media/qrcode_for_coding_world.36d9f0b1.avif*/,height:344,width:344,blurDataURL:"data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAACcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAgAAAAIAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAC9tZGF0EgAKCBgIv2iBAQNCMhkXwAAASAAAa/vsKDzFa4j9jHQvv0Aal3Zo",blurWidth:8,blurHeight:8}},1669:function(s,e,r){"use strict";r.r(e),r.d(e,{default:function(){return a}});var n=r(5893),l=r(5675),i=r.n(l),o=r(3780),t=r(4826);function a(){return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("h2",{class:"text-2xl font-semibold mt-6 mb-4",children:"声明"}),(0,n.jsx)("p",{children:"之前，有网友表示，这个项目挺好的，对他有帮助，来表示感谢！"}),(0,n.jsx)("p",{class:"mt-5",children:"在此声明下，本项目只是一个中文翻译版本，纯粹的 “为爱发电了”，原版权仍归 Next.js 官方教程所有，本翻译项目无任何商业行为，也不接受任何金钱上的捐赠哈。 如果真的感觉有帮助，就点个 Star 吧，关注下 “编程界” 公众号，上面平常也在分享 Next.js 相关内容。"}),(0,n.jsxs)("div",{class:"flex mt-5",children:[(0,n.jsxs)("div",{class:"w-1/2 items-center flex flex-col pr-2",children:[(0,n.jsx)(i(),{src:o.Z,className:"mb-4 rounded-md shadow-lg mb-5 rounded-md shadow-lg",alt:"扫码备注 “nextjs” 加入 Next.js 中文技术交流群",width:200,height:200}),(0,n.jsxs)("p",{class:"nx-text-xs font-bold text-center",children:["扫码备注「",(0,n.jsx)("b",{children:"nextjs"}),"」",(0,n.jsx)("br",{}),"加入 Next.js 中文技术交流群"]})]}),(0,n.jsxs)("div",{class:"w-1/2 items-center flex flex-col pl-2",children:[(0,n.jsx)(i(),{src:t.Z,className:"mb-5 rounded-md shadow-lg",alt:"关注公众号编程界获取最新 Next.js 开发资讯",width:200,height:200}),(0,n.jsxs)("p",{class:"nx-text-xs font-bold text-center",children:["关注公众号「",(0,n.jsx)("b",{children:"编程界"}),"」",(0,n.jsx)("br",{}),"获取最新 Next.js 开发资讯"]})]})]})]})}},1472:function(s,e,r){"use strict";r.r(e);var n=r(5893),l=r(2474),i=r.n(l),o=r(7294),t=r(2489),a=r(9417);let c={0:"A",1:"B",2:"C",3:"D",4:"E",5:"F"};function h(s){return i().createHash("md5").update(s).digest("hex")}e.default=s=>{let{name:e,answers:r=[],correctAnswer:l}=s,[i,d]=(0,o.useState)(""),[x,A]=(0,o.useState)(-1),[p,k]=(0,o.useState)(""),j=(s,e)=>{k(""),d(s.target.value),A(e)};return(0,n.jsxs)("div",{className:"max-w-md mx-auto p-5 m-12 border rounded-md shadow-md",children:[(0,n.jsxs)("h2",{className:"py-2 text-2xl font-bold mb-4 flex items-center justify-center",children:[(0,n.jsx)("span",{role:"img","aria-label":"question mark",className:"mr-2",children:(0,n.jsx)(t.G,{icon:a.Fuz,className:"text-blue-500 h-7 w-7"})}),(0,n.jsx)("span",{children:"是时候做个测验了！"})]}),(0,n.jsx)("legend",{class:"text-base font-semibold leading-6",children:e}),(0,n.jsx)("div",{class:"mt-6 space-y-4",children:r.map((s,r)=>(0,n.jsxs)("div",{class:"flex items-center gap-x-3",children:[(0,n.jsx)("input",{value:s,checked:i===s,onChange:s=>j(s,r),id:"".concat(h(e),"-").concat(r),name:e,type:"radio",class:"h-4 w-4 border-gray-300 text-indigo-600 focus:ring-indigo-600"}),(0,n.jsxs)("label",{htmlFor:"".concat(h(e),"-").concat(r),class:"block text-sm font-medium leading-6",children:[c[r],"：",s]})]},r))}),(0,n.jsx)("div",{className:"mt-4 text-right",children:(0,n.jsx)("button",{onClick:()=>{i===l?k("回答正确！\uD83C\uDF89"):k("回答错误，请再试一次。")},className:"px-3 py-1.5 bg-blue-500 text-white rounded-md",children:"检查答案"})}),p&&(0,n.jsxs)("div",{className:"mt-4 text-lg font-semibold ".concat(p.includes("正确")?"text-green-500":"text-red-500"),children:["当前答案 ",c[x]||"未选择","，",p]})]})}},979:function(s,e,r){"use strict";var n=r(5893),l=r(1163),i=r(5675),o=r.n(i),t=r(3780),a=r(4826);let c=(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("link",{rel:"icon",type:"image/x-icon",href:"../../../../../favicon.ico.css"/*tpa=https://qufei1993.github.io/favicon.ico*/}),(0,n.jsx)("meta",{name:"description",content:"基于 App Router 架构的免费学习教程，通过构建全栈 Web 应用程序，让您更好的了解 Next.js 主要功能"}),(0,n.jsx)("meta",{name:"keywords",content:"Next.js, Next.js 教程, 如何学习 Next.js, React Server Component, React Server Actions"}),(0,n.jsx)("meta",{property:"og:title",content:"Learn Next.js 中文教程"}),(0,n.jsx)("meta",{property:"og:description",content:"基于 App Router 架构的免费学习教程，通过构建全栈 Web 应用程序，让您更好的了解 Next.js 主要功能"}),(0,n.jsx)("meta",{property:"og:image",content:"https://qufei1993.github.io/chapter0-dashboard.avif"})]}),h={head:c,logo:(0,n.jsx)("span",{children:"Learn Next.js 中文教程"}),project:{link:"https://github.com/qufei1993/nextjs-learn-cn"},docsRepositoryBase:"https://github.com/qufei1993/nextjs-learn-cn/blob/main",search:{placeholder:"Search"},sidebar:{toggleButton:!0},toc:{backToTop:!0,extraContent:(0,n.jsx)(()=>(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{class:"flex flex-col items-center",children:[(0,n.jsx)(o(),{src:t.Z,className:"mb-4 rounded-md shadow-lg",alt:"扫码备注 “nextjs” 加入 Next.js 中文技术交流群",width:200,height:200}),(0,n.jsxs)("p",{class:"nx-text-xs font-bold text-center",children:["扫码备注 “nextjs”",(0,n.jsx)("br",{}),"加入 Next.js 中文技术交流群"]}),(0,n.jsx)("div",{class:"h-5"}),(0,n.jsx)(o(),{src:a.Z,className:"mb-4 rounded-md shadow-lg",alt:"扫码备注 “nextjs” 加入 Next.js 中文技术交流群",width:200,height:200}),(0,n.jsxs)("p",{class:"nx-text-xs font-bold text-center",children:["关注公众号 “编程界”",(0,n.jsx)("br",{}),"接收 Next.js 最新资讯"]})]})}),{})},feedback:{content:null},useNextSeoProps(){let{asPath:s}=(0,l.useRouter)();return"/"===s?{titleTemplate:"Learn Next.js 中文教程"}:{titleTemplate:"%s - Learn Next.js 中文教程"}},gitTimestamp:null,footer:{text:(0,n.jsx)("span",{children:(0,n.jsx)("a",{href:"https://github.com/qufei1993/nextjs-learn-cn/blob/main/LICENSE",target:"_blank",children:"MIT License - Copyright (c) 2023"})})}};e.Z=h},9483:function(s,e,r){"use strict";r.r(e),r.d(e,{__toc:function(){return p},default:function(){return v}});var n=r(5893),l=r(2673),i=r(9298),o=r(979);r(9966);var t=r(2643),a={src:"https://qufei1993.github.io/nextjs-learn-cn//_next/static/media/chapter7-recent-revenue.1c075c34.avif",height:1170,width:1920,blurDataURL:"data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAAGhbWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAsaWxvYwAAAABEAAACAAEAAAABAAAB5wAAACEAAgAAAAEAAAHJAAAAHgAAAEJpaW5mAAAAAAACAAAAGmluZmUCAAAAAAEAAGF2MDFDb2xvcgAAAAAaaW5mZQIAAAAAAgAAYXYwMUFscGhhAAAAABppcmVmAAAAAAAAAA5hdXhsAAIAAQABAAAA12lwcnAAAACxaXBjbwAAABRpc3BlAAAAAAAAAAgAAAAFAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAUaXNwZQAAAAAAAAAIAAAABQAAAA5waXhpAAAAAAEIAAAADGF2MUOBABwAAAAAOGF1eEMAAAAAdXJuOm1wZWc6bXBlZ0I6Y2ljcDpzeXN0ZW1zOmF1eGlsaWFyeTphbHBoYQAAAAAeaXBtYQAAAAAAAAACAAEEAQKDBAACBAUGhwgAAABHbWRhdBIACgUYCLxpUDITF8AAASBABieIGuzko0AlggoL3BIACggYCLxogQEDQjITF8AAAElgAEBTa+mRyhx/kINv8A==",blurWidth:8,blurHeight:5},c={src:"https://qufei1993.github.io/nextjs-learn-cn//_next/static/media/chapter7-latest-invoices.fe9376ac.avif",height:1170,width:1920,blurDataURL:"data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAAGhbWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAsaWxvYwAAAABEAAACAAEAAAABAAAB5wAAACEAAgAAAAEAAAHJAAAAHgAAAEJpaW5mAAAAAAACAAAAGmluZmUCAAAAAAEAAGF2MDFDb2xvcgAAAAAaaW5mZQIAAAAAAgAAYXYwMUFscGhhAAAAABppcmVmAAAAAAAAAA5hdXhsAAIAAQABAAAA12lwcnAAAACxaXBjbwAAABRpc3BlAAAAAAAAAAgAAAAFAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAUaXNwZQAAAAAAAAAIAAAABQAAAA5waXhpAAAAAAEIAAAADGF2MUOBABwAAAAAOGF1eEMAAAAAdXJuOm1wZWc6bXBlZ0I6Y2ljcDpzeXN0ZW1zOmF1eGlsaWFyeTphbHBoYQAAAAAeaXBtYQAAAAAAAAACAAEEAQKDBAACBAUGhwgAAABHbWRhdBIACgUYCLxpUDITF8AAASBABieIGuzko0AlggoL3BIACggYCLxogQEDQjITF8AAAElgAEBTbC9+YjUbiKNv9A==",blurWidth:8,blurHeight:5},h={src:"https://qufei1993.github.io/nextjs-learn-cn//_next/static/media/chapter7-complete-dashboard.433aebc0.avif",height:1170,width:1920,blurDataURL:"data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAAGhbWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAsaWxvYwAAAABEAAACAAEAAAABAAAB5wAAACIAAgAAAAEAAAHJAAAAHgAAAEJpaW5mAAAAAAACAAAAGmluZmUCAAAAAAEAAGF2MDFDb2xvcgAAAAAaaW5mZQIAAAAAAgAAYXYwMUFscGhhAAAAABppcmVmAAAAAAAAAA5hdXhsAAIAAQABAAAA12lwcnAAAACxaXBjbwAAABRpc3BlAAAAAAAAAAgAAAAFAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAUaXNwZQAAAAAAAAAIAAAABQAAAA5waXhpAAAAAAEIAAAADGF2MUOBABwAAAAAOGF1eEMAAAAAdXJuOm1wZWc6bXBlZ0I6Y2ljcDpzeXN0ZW1zOmF1eGlsaWFyeTphbHBoYQAAAAAeaXBtYQAAAAAAAAACAAEEAQKDBAACBAUGhwgAAABIbWRhdBIACgUYCLxpUDITF8AAASBABieIGuzko0AlggoL3BIACggYCLxogQEDQjIUF8AAAElwAHtbD2wYxcJ3eWHxb+g=",blurWidth:8,blurHeight:5},d={src:"https://qufei1993.github.io/nextjs-learn-cn//_next/static/media/chapter7-sequential-parallel-data-fetching.9bb1c5c1.avif",height:1050,width:3200,blurDataURL:"data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABoAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAgAAAADAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACJtZGF0EgAKCBgIfNECAgaEMgwXwAAASXAAAR6f//M=",blurWidth:8,blurHeight:3},x=r(1669),A=r(1472);let p=[{depth:2,value:"选择如何获取数据",id:"选择如何获取数据"},{depth:3,value:"API 层",id:"api-层"},{depth:3,value:"数据库查询",id:"数据库查询"},{depth:3,value:"使用 Server Components 获取数据",id:"使用-server-components-获取数据"},{depth:3,value:"使用 SQL",id:"使用-sql"},{depth:2,value:"获取 Dashboard 概览页面的数据",id:"获取-dashboard-概览页面的数据"},{depth:2,value:"获取 <RevenueChart/> 组件的数据",id:"获取-revenuechart-组件的数据"},{depth:2,value:"获取 <LatestInvoices /> 组件的数据",id:"获取-latestinvoices--组件的数据"},{depth:2,value:"练习：为 <Card> 组件获取数据",id:"练习为-card-组件获取数据"},{depth:2,value:"请求瀑布是什么？",id:"请求瀑布是什么"},{depth:2,value:"并行数据获取",id:"并行数据获取"}];function k(s){let e=Object.assign({h1:"h1",p:"p",ul:"ul",li:"li",h2:"h2",h3:"h3",a:"a",code:"code",pre:"pre",span:"span",blockquote:"blockquote",strong:"strong",img:"img",details:"details",summary:"summary"},(0,t.a)(),s.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e.h1,{children:"获取数据"}),"\n",(0,n.jsx)(e.p,{children:"既然你已经创建并填充了你的数据库，让我们讨论一下获取应用程序数据的不同方式，以及构建 Dashboard 概览页面。"}),"\n",(0,n.jsx)(e.p,{children:"以下是本章中将涵盖的主题："}),"\n",(0,n.jsxs)(e.ul,{children:["\n",(0,n.jsx)(e.li,{children:"了解一些获取数据的方法：API、ORM、SQL 等。"}),"\n",(0,n.jsx)(e.li,{children:"如何使用 Server Components 更安全地访问后端资源。"}),"\n",(0,n.jsx)(e.li,{children:"什么是网络瀑布。"}),"\n",(0,n.jsx)(e.li,{children:"如何使用 JavaScript 模式实现并行数据获取。"}),"\n"]}),"\n",(0,n.jsx)(e.h2,{id:"选择如何获取数据",children:"选择如何获取数据"}),"\n",(0,n.jsx)(e.h3,{id:"api-层",children:"API 层"}),"\n",(0,n.jsx)(e.p,{children:"API 是你的应用程序代码和数据库之间的中间层。有几种情况下你可能会使用 API："}),"\n",(0,n.jsxs)(e.ul,{children:["\n",(0,n.jsx)(e.li,{children:"如果你使用提供 API 的第三方服务。"}),"\n",(0,n.jsx)(e.li,{children:"如果你从客户端获取数据，你希望有一个在服务器上运行的 API 层，以避免将数据库秘密暴露给客户端。"}),"\n"]}),"\n",(0,n.jsxs)(e.p,{children:["在 Next.js 中，你可以使用",(0,n.jsx)(e.a,{href:"https://nextjs.org/docs/app/building-your-application/routing/route-handlers",children:"路由处理程序"}),"创建 API 端点。"]}),"\n",(0,n.jsx)(e.h3,{id:"数据库查询",children:"数据库查询"}),"\n",(0,n.jsxs)(e.p,{children:["当你创建一个全栈应用程序时，你还需要编写与数据库交互的逻辑。对于像 Postgres 这样的",(0,n.jsx)(e.a,{href:"https://aws.amazon.com/cn/relational-database/",children:"关系数据库"}),"，你可以使用 SQL 或像 ",(0,n.jsx)(e.a,{href:"https://vercel.com/docs/storage/vercel-postgres/using-an-orm#",children:"Prisma"})," 这样的 ",(0,n.jsx)(e.a,{href:"https://vercel.com/docs/storage/vercel-postgres/using-an-orm#",children:"ORM"})," 来实现。"]}),"\n",(0,n.jsx)(e.p,{children:"有几种情况下你需要编写数据库查询："}),"\n",(0,n.jsxs)(e.ul,{children:["\n",(0,n.jsx)(e.li,{children:"当创建 API 端点时，你需要编写与数据库交互的逻辑。"}),"\n",(0,n.jsx)(e.li,{children:"如果你正在使用 React Server Components（在服务器上获取数据），你可以跳过 API 层，直接查询数据库，而不会有暴露数据库秘密给客户端的风险。"}),"\n"]}),"\n",(0,n.jsx)(A.default,{name:"在以下哪种情况下，你不应该直接查询你的数据库？",answers:["当在客户端获取数据时","当在服务器上获取数据时","当创建自己的 API 层与数据库交互时"],correctAnswer:"当在客户端获取数据时"}),"\n",(0,n.jsx)(e.p,{children:"让我们更深入地了解 React Server Components。"}),"\n",(0,n.jsx)(e.h3,{id:"使用-server-components-获取数据",children:"使用 Server Components 获取数据"}),"\n",(0,n.jsx)(e.p,{children:"默认情况下，Next.js 应用程序使用 React Server Components。使用 Server Components 获取数据是一种相对较新的方法，使用它们有一些好处："}),"\n",(0,n.jsxs)(e.ul,{children:["\n",(0,n.jsx)(e.li,{children:"Server Components 支持 promises，为异步任务（如数据获取）提供了更简单的解决方案。你可以使用 async/await 语法，而无需使用 useEffect、useState 或数据获取库。"}),"\n",(0,n.jsx)(e.li,{children:"Server Components 在服务器上执行，因此你可以将昂贵的数据获取和逻辑保留在服务器上，并仅将结果发送到客户端。"}),"\n"]}),"\n",(0,n.jsx)(e.p,{children:"如前所述，由于 Server Components 在服务器上执行，你可以直接查询数据库，而无需额外的 API 层。"}),"\n",(0,n.jsx)(A.default,{name:"使用 React Server Components 获取数据的一个优势是什么？",answers:["它们会自动保护你免受 SQL 注入。","它们允许你直接从服务器查询数据库，而无需额外的 API 层。","它们要求你使用 API 层并创建端点。"],correctAnswer:"它们允许你直接从服务器查询数据库，而无需额外的 API 层。"}),"\n",(0,n.jsx)(e.h3,{id:"使用-sql",children:"使用 SQL"}),"\n",(0,n.jsxs)(e.p,{children:["在你的仪表板项目中，你将使用 ",(0,n.jsx)(e.a,{href:"https://vercel.com/docs/storage/vercel-postgres/sdk",children:"Vercel Postgres SDK"})," 和 SQL 编写数据库查询。我们使用 SQL 的原因有几点："]}),"\n",(0,n.jsxs)(e.ul,{children:["\n",(0,n.jsx)(e.li,{children:"在关系查询数据库中 SQL 是行业标准（例如，ORM 在底层生成 SQL）。"}),"\n",(0,n.jsx)(e.li,{children:"对 SQL 的基本理解可以帮助你理解关系数据库的基础知识，使你能够将你的知识应用于其他工具。"}),"\n",(0,n.jsx)(e.li,{children:"SQL 是多才多艺的，允许你获取和操作特定的数据。"}),"\n",(0,n.jsxs)(e.li,{children:["Vercel Postgres SDK 提供了对",(0,n.jsx)(e.a,{href:"https://vercel.com/docs/storage/vercel-postgres/sdk#preventing-sql-injections",children:" SQL 注入"}),"的保护。"]}),"\n"]}),"\n",(0,n.jsx)(e.p,{children:"如果你以前没有使用过 SQL，不用担心 - 我们已经为你提供了查询。"}),"\n",(0,n.jsxs)(e.p,{children:["打开 ",(0,n.jsx)(e.code,{children:"https://qufei1993.github.io/app/lib/data.ts"}),"，这里你会看到我们正在从 @vercel/postgres 导入 ",(0,n.jsx)(e.a,{href:"https://vercel.com/docs/storage/vercel-postgres/sdk#sql",children:"sql"})," 函数。这个函数允许你查询你的数据库："]}),"\n",(0,n.jsx)(e.pre,{"data-language":"js","data-theme":"default",filename:"https://qufei1993.github.io/app/lib/data.ts",hasCopyCode:!0,children:(0,n.jsx)(e.code,{"data-line-numbers":"","data-language":"js","data-theme":"default","data-line-numbers-max-digits":"1",children:(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" { sql } "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"from"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'@vercel/postgres'"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:";"})]})})}),"\n",(0,n.jsx)(e.p,{children:"你可以在任何 Server Component 中调用 sql。但为了让你更轻松地浏览组件，我们将所有数据查询都保留在 data.ts 文件中，你可以将它们导入到组件中。"}),"\n",(0,n.jsx)(A.default,{name:"SQL 在获取数据方面允许你做什么？",answers:["无差别地获取所有数据","获取和操作特定的数据","自动缓存数据以提高性能","动态更改数据库架构"],correctAnswer:"获取和操作特定的数据"}),"\n",(0,n.jsxs)(e.blockquote,{children:["\n",(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.strong,{children:"注意"}),"：如果在第 6 章中使用了自己的数据库提供程序，你需要更新数据库查询以适应你的提供程序。你可以在 ",(0,n.jsx)(e.code,{children:"https://qufei1993.github.io/app/lib/data.ts"})," 中找到这些查询。"]}),"\n"]}),"\n",(0,n.jsx)(e.h2,{id:"获取-dashboard-概览页面的数据",children:"获取 Dashboard 概览页面的数据"}),"\n",(0,n.jsxs)(e.p,{children:["既然你了解了不同的获取数据方式，让我们获取 Dashboard 概览页面的数据。导航到 ",(0,n.jsx)(e.code,{children:"https://qufei1993.github.io/app/dashboard/page.tsx"}),"，粘贴以下代码，并花些时间来探索它："]}),"\n",(0,n.jsx)(e.pre,{"data-language":"js","data-theme":"default",filename:"https://qufei1993.github.io/app/dashboard/page.tsx",hasCopyCode:!0,children:(0,n.jsxs)(e.code,{"data-line-numbers":"","data-language":"js","data-theme":"default","data-line-numbers-max-digits":"2",children:[(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" { Card } "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"from"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'@/app/ui/dashboard/cards'"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" RevenueChart "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"from"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'@/app/ui/dashboard/revenue-chart'"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" LatestInvoices "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"from"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'@/app/ui/dashboard/latest-invoices'"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" { lusitana } "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"from"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'@/app/ui/fonts'"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,n.jsx)(e.span,{className:"line",children:(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "})}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"export"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"default"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"async"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Page"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"() {"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" ("})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    <"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"main"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:">"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"      <"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"h1"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"className"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"{"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"`"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"${"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"lusitana"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:".className"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"}"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:" mb-4 text-xl md:text-2xl`"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}>"})]}),"\n",(0,n.jsx)(e.span,{className:"line",children:(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        仪表板"})}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"      </"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"h1"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:">"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"      <"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"div"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"className"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"grid gap-6 sm:grid-cols-2 lg:grid-cols-4"'}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:">"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        {"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:'/* <Card title="已收款" value={totalPaidInvoices} type="collected" /> */'}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        {"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:'/* <Card title="待处理" value={totalPendingInvoices} type="pending" /> */'}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        {"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:'/* <Card title="总发票数" value={numberOfInvoices} type="invoices" /> */'}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        {"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"/* <Card"})]}),"\n",(0,n.jsx)(e.span,{className:"line",children:(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:'          title="总客户数"'})}),"\n",(0,n.jsx)(e.span,{className:"line",children:(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"          value={numberOfCustomers}"})}),"\n",(0,n.jsx)(e.span,{className:"line",children:(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:'          type="customers"'})}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"        /> */"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"      </"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"div"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:">"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"      <"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"div"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"className"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"mt-6 grid grid-cols-1 gap-6 md:grid-cols-4 lg:grid-cols-8"'}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:">"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        {"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"/* <RevenueChart revenue={revenue}  /> */"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        {"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"/* <LatestInvoices latestInvoices={latestInvoices} /> */"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"      </"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"div"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:">"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    </"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"main"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:">"})]}),"\n",(0,n.jsx)(e.span,{className:"line",children:(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"  );"})}),"\n",(0,n.jsx)(e.span,{className:"line",children:(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})}),"\n",(0,n.jsx)(e.p,{children:"在上面的代码中："}),"\n",(0,n.jsxs)(e.ul,{children:["\n",(0,n.jsx)(e.li,{children:"Page 是一个异步组件。这允许你使用 await 来获取数据。"}),"\n",(0,n.jsxs)(e.li,{children:["还有 3 个组件接收数据：",(0,n.jsx)(e.code,{children:"<Card>"}),"、",(0,n.jsx)(e.code,{children:"<RevenueChart>"})," 和 ",(0,n.jsx)(e.code,{children:"<LatestInvoices>"}),"。它们当前被注释掉，以防止应用程序出错。"]}),"\n"]}),"\n",(0,n.jsxs)(e.h2,{id:"获取-revenuechart-组件的数据",children:["获取 ",(0,n.jsx)(e.code,{children:"<RevenueChart/>"})," 组件的数据"]}),"\n",(0,n.jsxs)(e.p,{children:["要获取 ",(0,n.jsx)(e.code,{children:"<RevenueChart/>"})," 组件的数据，从 ",(0,n.jsx)(e.code,{children:"https://qufei1993.github.io/nextjs-learn-cn/_next/static/chunks/pages/data.ts"})," 中导入 ",(0,n.jsx)(e.code,{children:"fetchRevenue"})," 函数，并在你的组件内调用它："]}),"\n",(0,n.jsx)(e.pre,{"data-language":"js","data-theme":"default",filename:"https://qufei1993.github.io/app/dashboard/page.tsx",hasCopyCode:!0,children:(0,n.jsxs)(e.code,{"data-line-numbers":"","data-language":"js","data-theme":"default","data-line-numbers-max-digits":"2",children:[(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" { Card } "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"from"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'@/app/ui/dashboard/cards'"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" RevenueChart "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"from"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'@/app/ui/dashboard/revenue-chart'"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" LatestInvoices "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"from"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'@/app/ui/dashboard/latest-invoices'"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" { lusitana } "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"from"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'@/app/ui/fonts'"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,n.jsxs)(e.span,{className:"line highlighted",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" { fetchRevenue } "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"from"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'@/app/lib/data'"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,n.jsx)(e.span,{className:"line",children:(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "})}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"export"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"default"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"async"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Page"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"() {"})]}),"\n",(0,n.jsxs)(e.span,{className:"line highlighted",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"revenue"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"await"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"fetchRevenue"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"();"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// ..."})]}),"\n",(0,n.jsx)(e.span,{className:"line",children:(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})}),"\n",(0,n.jsxs)(e.p,{children:["然后，取消注释 ",(0,n.jsx)(e.code,{children:"<RevenueChart/>"})," 组件，导航到组件文件（/",(0,n.jsx)(e.code,{children:"https://qufei1993.github.io/nextjs-learn-cn/_next/static/chunks/pages/app/ui/dashboard/revenue-chart.tsx"}),"）并取消注释其中的代码。检查你的 localhost，你应该能够看到一个使用收入数据的图表。"]}),"\n",(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{alt:"收入图表显示过去 12 个月的总收入",placeholder:"blur",src:a})}),"\n",(0,n.jsx)(e.p,{children:"让我们继续导入更多的数据查询！"}),"\n",(0,n.jsxs)(e.h2,{id:"获取-latestinvoices--组件的数据",children:["获取 ",(0,n.jsx)(e.code,{children:"<LatestInvoices />"})," 组件的数据"]}),"\n",(0,n.jsxs)(e.p,{children:["对于 ",(0,n.jsx)(e.code,{children:"<LatestInvoices />"})," 组件，我们需要获取最新的 5 张发票，并按日期排序。"]}),"\n",(0,n.jsx)(e.p,{children:"你可以获取所有的发票，然后使用 JavaScript 进行排序。这对于我们的小型数据来说不是问题，但随着应用程序的增长，它可能会显著增加每个请求传输的数据量和用于排序的 JavaScript。"}),"\n",(0,n.jsxs)(e.p,{children:["与在内存中对最新发票进行排序不同，你可以使用 SQL 查询仅获取最近的 5 张发票。例如，这是你的 ",(0,n.jsx)(e.code,{children:"https://qufei1993.github.io/nextjs-learn-cn/_next/static/chunks/pages/data.ts"})," 文件中的 SQL 查询："]}),"\n",(0,n.jsx)(e.pre,{"data-language":"js","data-theme":"default",filename:"https://qufei1993.github.io/app/lib/data.ts",hasCopyCode:!0,children:(0,n.jsxs)(e.code,{"data-line-numbers":"","data-language":"js","data-theme":"default","data-line-numbers-max-digits":"1",children:[(0,n.jsx)(e.span,{className:"line",children:(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// 获取最近的 5 张发票，按日期排序"})}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"data"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"await"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"sql"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"<"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"LatestInvoiceRaw"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:">"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"`"})]}),"\n",(0,n.jsx)(e.span,{className:"line",children:(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"  SELECT invoices.amount, customers.name, customers.image_url, customers.email"})}),"\n",(0,n.jsx)(e.span,{className:"line",children:(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"  FROM invoices"})}),"\n",(0,n.jsx)(e.span,{className:"line",children:(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"  https://qufei1993.github.io/nextjs-learn-cn/_next/static/chunks/pages/JOIN customers ON invoices.customer_id = customers.id"})}),"\n",(0,n.jsx)(e.span,{className:"line",children:(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"  ORDER BY invoices.date DESC"})}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"  LIMIT 5`"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:";"})]})]})}),"\n",(0,n.jsxs)(e.p,{children:["在你的页面中，导入 ",(0,n.jsx)(e.code,{children:"fetchLatestInvoices"})," 函数："]}),"\n",(0,n.jsx)(e.pre,{"data-language":"jsx","data-theme":"default",filename:"https://qufei1993.github.io/app/dashboard/page.tsx",hasCopyCode:!0,children:(0,n.jsxs)(e.code,{"data-line-numbers":"","data-language":"jsx","data-theme":"default","data-line-numbers-max-digits":"2",children:[(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" { Card } "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"from"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'@/app/ui/dashboard/cards'"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" RevenueChart "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"from"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'@/app/ui/dashboard/revenue-chart'"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" LatestInvoices "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"from"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'@/app/ui/dashboard/latest-invoices'"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" { lusitana } "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"from"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'@/app/ui/fonts'"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,n.jsxs)(e.span,{className:"line highlighted",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" { fetchRevenue"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" fetchLatestInvoices } "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"from"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'@/app/lib/data'"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,n.jsx)(e.span,{className:"line",children:(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "})}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"export"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"default"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"async"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Page"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"() {"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"revenue"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"await"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"fetchRevenue"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"();"})]}),"\n",(0,n.jsxs)(e.span,{className:"line highlighted",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"latestInvoices"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"await"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"fetchLatestInvoices"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"();"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// ..."})]}),"\n",(0,n.jsx)(e.span,{className:"line",children:(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})}),"\n",(0,n.jsxs)(e.p,{children:["然后，取消注释 ",(0,n.jsx)(e.code,{children:"<LatestInvoices />"})," 组件。你还需要在 ",(0,n.jsx)(e.code,{children:"<LatestInvoices />"})," 组件本身（位于 ",(0,n.jsx)(e.code,{children:"/app/ui/dashboard/latest-invoices"}),"）中取消注释相关代码。"]}),"\n",(0,n.jsx)(e.p,{children:"如果你访问 localhost，你应该会看到只有最近的 5 张发票从数据库返回。希望你开始看到直接查询数据库的优势了！"}),"\n",(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{alt:"最新发票组件和收入图表一起显示",placeholder:"blur",src:c})}),"\n",(0,n.jsxs)(e.h2,{id:"练习为-card-组件获取数据",children:["练习：为 ",(0,n.jsx)(e.code,{children:"<Card>"})," 组件获取数据"]}),"\n",(0,n.jsxs)(e.p,{children:["现在轮到你为 ",(0,n.jsx)(e.code,{children:"<Card>"})," 组件获取数据了。卡片将显示以下数据："]}),"\n",(0,n.jsxs)(e.ul,{children:["\n",(0,n.jsx)(e.li,{children:"已收款的发票总额。"}),"\n",(0,n.jsx)(e.li,{children:"待处理的发票总额。"}),"\n",(0,n.jsx)(e.li,{children:"发票的总数。"}),"\n",(0,n.jsx)(e.li,{children:"客户的总数。"}),"\n"]}),"\n",(0,n.jsxs)(e.p,{children:["再次，你可能会诱惑地获取所有发票和客户，并使用 JavaScript 操纵数据。例如，你可以使用 ",(0,n.jsx)(e.code,{children:"Array.length"})," 来获取发票和客户的总数："]}),"\n",(0,n.jsx)(e.pre,{"data-language":"js","data-theme":"default",hasCopyCode:!0,children:(0,n.jsxs)(e.code,{"data-line-numbers":"","data-language":"js","data-theme":"default","data-line-numbers-max-digits":"1",children:[(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"totalInvoices"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"allInvoices"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"."}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"length"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"totalCustomers"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"allCustomers"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"."}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"length"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:";"})]})]})}),"\n",(0,n.jsx)(e.p,{children:"但是使用 SQL，你可以仅获取需要的数据。虽然使用 Array.length 要短一些，但这意味着在请求期间需要传输的数据较少。这是 SQL 的替代方法："}),"\n",(0,n.jsx)(e.pre,{"data-language":"js","data-theme":"default",filename:"https://qufei1993.github.io/app/lib/data.ts",hasCopyCode:!0,children:(0,n.jsxs)(e.code,{"data-line-numbers":"","data-language":"js","data-theme":"default","data-line-numbers-max-digits":"1",children:[(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"invoiceCountPromise"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"sql"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"`SELECT COUNT(*) FROM invoices`"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"customerCountPromise"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"sql"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"`SELECT COUNT(*) FROM customers`"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:";"})]})]})}),"\n",(0,n.jsxs)(e.p,{children:["你需要导入的函数叫做 ",(0,n.jsx)(e.code,{children:"fetchCardData"}),"。你需要解构函数返回的值。"]}),"\n",(0,n.jsx)(e.p,{children:"提示："}),"\n",(0,n.jsxs)(e.ul,{children:["\n",(0,n.jsx)(e.li,{children:"检查卡片组件，看看它们需要什么数据。"}),"\n",(0,n.jsx)(e.li,{children:"检查 data.ts 文件，看看该函数返回什么。"}),"\n"]}),"\n",(0,n.jsx)(e.p,{children:"当你准备好后，展开下面的切换以查看最终代码："}),"\n",(0,n.jsxs)(e.details,{children:[(0,n.jsx)(e.summary,{children:"点击展开/折叠"}),(0,n.jsx)(e.pre,{"data-language":"jsx","data-theme":"default",filename:"https://qufei1993.github.io/app/dashboard/page.tsx",hasCopyCode:!0,children:(0,n.jsxs)(e.code,{"data-line-numbers":"","data-language":"jsx","data-theme":"default","data-line-numbers-max-digits":"2",children:[(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" { Card } "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"from"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'@/app/ui/dashboard/cards'"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" RevenueChart "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"from"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'@/app/ui/dashboard/revenue-chart'"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" LatestInvoices "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"from"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'@/app/ui/dashboard/latest-invoices'"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" { lusitana } "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"from"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'@/app/ui/fonts'"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    fetchRevenue"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    fetchLatestInvoices"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,n.jsxs)(e.span,{className:"line highlighted",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    fetchCardData"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"  } "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"from"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'@/app/lib/data'"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,n.jsx)(e.span,{className:"line",children:(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"  "})}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"export"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"default"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"async"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Page"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"() {"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"revenue"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"await"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"fetchRevenue"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"();"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"latestInvoices"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"await"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"fetchLatestInvoices"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"();"})]}),"\n",(0,n.jsxs)(e.span,{className:"line highlighted",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,n.jsxs)(e.span,{className:"line highlighted",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"      "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"numberOfInvoices"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,n.jsxs)(e.span,{className:"line highlighted",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"      "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"numberOfCustomers"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,n.jsxs)(e.span,{className:"line highlighted",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"      "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"totalPaidInvoices"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,n.jsxs)(e.span,{className:"line highlighted",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"      "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"totalPendingInvoices"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,n.jsxs)(e.span,{className:"line highlighted",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    } "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"await"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"fetchCardData"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"();"})]}),"\n",(0,n.jsx)(e.span,{className:"line",children:(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"  "})}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" ("})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"      <"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"main"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:">"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        <"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"h1"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"className"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"{"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"`"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"${"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"lusitana"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:".className"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"}"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:" mb-4 text-xl md:text-2xl`"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}>"})]}),"\n",(0,n.jsx)(e.span,{className:"line",children:(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"          Dashboard"})}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        </"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"h1"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:">"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        <"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"div"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"className"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"grid gap-6 sm:grid-cols-2 lg:grid-cols-4"'}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:">"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"          <"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"Card"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"title"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"Collected"'}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"value"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"{totalPaidInvoices} "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"type"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"collected"'}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" />"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"          <"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"Card"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"title"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"Pending"'}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"value"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"{totalPendingInvoices} "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"type"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"pending"'}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" />"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"          <"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"Card"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"title"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"Total Invoices"'}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"value"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"{numberOfInvoices} "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"type"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"invoices"'}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" />"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"          <"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"Card"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"            "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"title"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"Total Customers"'})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"            "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"value"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"{numberOfCustomers}"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"            "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"type"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"customers"'})]}),"\n",(0,n.jsx)(e.span,{className:"line",children:(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"          />"})}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        </"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"div"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:">"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        <"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"div"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"className"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"mt-6 grid grid-cols-1 gap-6 md:grid-cols-4 lg:grid-cols-8"'}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:">"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"          <"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"RevenueChart"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"revenue"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"{revenue} />"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"          <"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"LatestInvoices"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"latestInvoices"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"{latestInvoices} />"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        </"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"div"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:">"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"      </"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"main"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:">"})]}),"\n",(0,n.jsx)(e.span,{className:"line",children:(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    );"})}),"\n",(0,n.jsx)(e.span,{className:"line",children:(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"  }"})})]})})]}),"\n",(0,n.jsx)(e.p,{children:"太好了！你现在已经为仪表板概览页面获取了所有数据。你的页面应该看起来像这样："}),"\n",(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{alt:"仪表板页面，已获取所有数据",placeholder:"blur",src:h})}),"\n",(0,n.jsx)(e.p,{children:"然而...有两件事情需要注意："}),"\n",(0,n.jsxs)(e.ul,{children:["\n",(0,n.jsx)(e.li,{children:"数据请求无意中相互阻塞，形成请求瀑布。"}),"\n",(0,n.jsx)(e.li,{children:"默认情况下，Next.js 对路由进行预渲染以提高性能，这称为静态渲染。因此，如果你的数据发生变化，它不会反映在你的 Dashboard 中。"}),"\n"]}),"\n",(0,n.jsx)(e.p,{children:"让我们在本章中讨论第一点，然后在下一章详细了解第二点。"}),"\n",(0,n.jsx)(e.h2,{id:"请求瀑布是什么",children:"请求瀑布是什么？"}),"\n",(0,n.jsx)(e.p,{children:'"瀑布" 指的是一系列的网络请求序列，这些请求依赖于前面请求的完成。在数据获取的情况下，每个请求只能在前一个请求返回数据后才能开始。'}),"\n",(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{alt:"示意图显示按时间顺序进行顺序数据获取和并行数据获取",placeholder:"blur",src:d})}),"\n",(0,n.jsxs)(e.p,{children:["例如，我们需要等待 ",(0,n.jsx)(e.code,{children:"fetchRevenue()"})," 执行完毕，然后 ",(0,n.jsx)(e.code,{children:"fetchLatestInvoices()"})," 才能开始运行，以此类推。"]}),"\n",(0,n.jsx)(e.pre,{"data-language":"jsx","data-theme":"default",filename:"https://qufei1993.github.io/app/dashboard/page.tsx",hasCopyCode:!0,children:(0,n.jsxs)(e.code,{"data-line-numbers":"","data-language":"jsx","data-theme":"default","data-line-numbers-max-digits":"1",children:[(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"revenue"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"await"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"fetchRevenue"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"();"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"latestInvoices"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"await"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"fetchLatestInvoices"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(); "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// 等待 fetchRevenue() 完成"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"numberOfInvoices"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"numberOfCustomers"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"totalPaidInvoices"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"totalPendingInvoices"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"} "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"await"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"fetchCardData"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(); "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// 等待 fetchLatestInvoices() 完成"})]})]})}),"\n",(0,n.jsx)(e.p,{children:"这种模式不一定是不好的。有些情况下，你可能希望有瀑布，因为你希望在进行下一个请求之前满足某个条件。例如，你可能希望先获取用户的 ID 和个人资料信息。一旦有了 ID，你可能会继续获取他们的朋友列表。在这种情况下，每个请求都依赖于前一个请求返回的数据。"}),"\n",(0,n.jsx)(e.p,{children:"然而，这种行为也可能是无意的，并且会影响性能。"}),"\n",(0,n.jsx)(A.default,{name:"何时可能想要使用瀑布模式？",answers:["在进行下一个请求之前满足条件时。","同时进行所有请求","通过一次只进行一次获取来减轻服务器负载"],correctAnswer:"在进行下一个请求之前满足条件时。"}),"\n",(0,n.jsx)(e.h2,{id:"并行数据获取",children:"并行数据获取"}),"\n",(0,n.jsx)(e.p,{children:"避免瀑布的一种常见方式是同时启动所有数据请求 - 进行并行处理。"}),"\n",(0,n.jsxs)(e.p,{children:["在 JavaScript 中，您可以使用 ",(0,n.jsx)(e.code,{children:"Promise.all()"})," 或 ",(0,n.jsx)(e.code,{children:"Promise.allSettled()"})," 函数同时启动所有 Promise。例如，在 ",(0,n.jsx)(e.code,{children:"https://qufei1993.github.io/nextjs-learn-cn/_next/static/chunks/pages/data.ts"})," 中，我们在 ",(0,n.jsx)(e.code,{children:"fetchCardData()"})," 函数中使用了 ",(0,n.jsx)(e.code,{children:"Promise.all()"}),"："]}),"\n",(0,n.jsx)(e.pre,{"data-language":"js","data-theme":"default",filename:"../../../../../app/lib/data.js"/*tpa=https://qufei1993.github.io/app/lib/data.js*/,hasCopyCode:!0,children:(0,n.jsxs)(e.code,{"data-line-numbers":"","data-language":"js","data-theme":"default","data-line-numbers-max-digits":"2",children:[(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"export"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"async"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"fetchCardData"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"() {"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"try"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"invoiceCountPromise"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"sql"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"`SELECT COUNT(*) FROM invoices`"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"customerCountPromise"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"sql"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"`SELECT COUNT(*) FROM customers`"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"invoiceStatusPromise"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"sql"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"`SELECT"})]}),"\n",(0,n.jsx)(e.span,{className:"line",children:(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"         SUM(CASE WHEN status = 'paid' THEN amount ELSE 0 END) AS \"paid\","})}),"\n",(0,n.jsx)(e.span,{className:"line",children:(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"         SUM(CASE WHEN status = 'pending' THEN amount ELSE 0 END) AS \"pending\""})}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"         FROM invoices`"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,n.jsx)(e.span,{className:"line",children:(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "})}),"\n",(0,n.jsxs)(e.span,{className:"line highlighted",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"data"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"await"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"Promise"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:".all"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(["})]}),"\n",(0,n.jsxs)(e.span,{className:"line highlighted",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"      invoiceCountPromise"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,n.jsxs)(e.span,{className:"line highlighted",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"      customerCountPromise"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,n.jsxs)(e.span,{className:"line highlighted",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"      invoiceStatusPromise"}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,n.jsx)(e.span,{className:"line highlighted",children:(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    ]);"})}),"\n",(0,n.jsxs)(e.span,{className:"line",children:[(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,n.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// ..."})]}),"\n",(0,n.jsx)(e.span,{className:"line",children:(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"  }"})}),"\n",(0,n.jsx)(e.span,{className:"line",children:(0,n.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})}),"\n",(0,n.jsx)(e.p,{children:"通过使用这种模式，您可以："}),"\n",(0,n.jsxs)(e.ul,{children:["\n",(0,n.jsx)(e.li,{children:"同时开始执行所有数据获取，这可能会带来性能提升。"}),"\n",(0,n.jsx)(e.li,{children:"使用可应用于任何库或框架的本机 JavaScript 模式。"}),"\n"]}),"\n",(0,n.jsx)(e.p,{children:"然而，仅依赖此 JavaScript 模式有一个缺点：如果一个数据请求比其他所有请求慢，会发生什么？"}),"\n",(0,n.jsx)(x.default,{})]})}let j={MDXContent:function(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}=Object.assign({},(0,t.a)(),s.components);return e?(0,n.jsx)(e,{...s,children:(0,n.jsx)(k,{...s})}):k(s)},pageOpts:{filePath:"https://qufei1993.github.io/nextjs-learn-cn/_next/static/chunks/pages/src/pages/chapter7.mdx",route:"/chapter7",pageMap:[{kind:"Meta",data:{index:{title:"介绍",theme:{breadcrumb:!1}},chapter1:"Chapter 1：入门",chapter2:"Chapter 2：CSS 样式",chapter3:"Chapter 3：优化字体和图片",chapter4:"Chapter 4：创建 Layouts 和 Pages",chapter5:"Chapter 5：页面之间导航",chapter6:"Chapter 6：建立你的数据库",chapter7:"Chapter 7：获取数据",chapter8:"Chapter 8：静态和动态渲染",chapter9:"Chapter 9：流式传输",chapter10:"Chapter 10：部分预渲染",chapter11:"Chapter 11：添加搜索和分页",chapter12:"Chapter 12：Mutating 数据",chapter13:"Chapter 13：错误处理",chapter14:"Chapter 14：提高可访问性",chapter15:"Chapter 15：添加身份验证",chapter16:"Chapter 16：添加元数据",chapter17:"扩展篇 1：Vercel Postgres 搭配本地数据库",chapter18:"扩展篇 2：Next.js 学习资源汇总"}},{kind:"MdxPage",name:"chapter1",route:"/chapter1"},{kind:"MdxPage",name:"chapter10",route:"/chapter10"},{kind:"MdxPage",name:"chapter11",route:"/chapter11"},{kind:"MdxPage",name:"chapter12",route:"/chapter12"},{kind:"MdxPage",name:"chapter13",route:"/chapter13"},{kind:"MdxPage",name:"chapter14",route:"/chapter14"},{kind:"MdxPage",name:"chapter15",route:"/chapter15"},{kind:"MdxPage",name:"chapter16",route:"/chapter16"},{kind:"MdxPage",name:"chapter17",route:"/chapter17"},{kind:"MdxPage",name:"chapter18",route:"/chapter18"},{kind:"MdxPage",name:"chapter2",route:"/chapter2"},{kind:"MdxPage",name:"chapter3",route:"/chapter3"},{kind:"MdxPage",name:"chapter4",route:"/chapter4"},{kind:"MdxPage",name:"chapter5",route:"/chapter5"},{kind:"MdxPage",name:"chapter6",route:"/chapter6"},{kind:"MdxPage",name:"chapter7",route:"/chapter7"},{kind:"MdxPage",name:"chapter8",route:"/chapter8"},{kind:"MdxPage",name:"chapter9",route:"/chapter9"},{kind:"MdxPage",name:"index",route:"/"}],flexsearch:{codeblocks:!0},title:"获取数据",headings:p},pageNextRoute:"/chapter7",nextraLayout:i.ZP,themeConfig:o.Z};var v=(0,l.j)(j)}},function(s){s.O(0,[976,714,675,53,638,774,888,179],function(){return s(s.s=110)}),_N_E=s.O()}]);