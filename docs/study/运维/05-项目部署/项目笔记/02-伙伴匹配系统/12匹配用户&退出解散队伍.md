# 12 åŒ¹é…ç”¨æˆ·+é€€å‡ºã€è§£æ•£é˜Ÿä¼

åœ¨çº¿å›æ”¾ï¼š[https://meeting.tencent.com/v2/cloud-record/share?...](https://meeting.tencent.com/v2/cloud-record/share?id=91e7942d-ab8e-489f-ad39-c0ac22072099&from=3) Â (è®¿é—®å¯†ç ï¼šHfrN)

## é±¼çš®ç¬”è®°

### å‰ç«¯å¼€å‘


1. å¼€å‘å‰ç«¯çš„åŠŸèƒ½ 
   1. æœç´¢é˜Ÿä¼ âˆš
   2. æ›´æ–°é˜Ÿä¼ï¼ˆä»…é˜Ÿä¼çš„åˆ›å§‹äººå¯è§ï¼‰ âˆš
   3. æŸ¥çœ‹ä¸ªäººå·²åŠ å…¥é˜Ÿä¼ âˆš
   4. æŸ¥çœ‹ä¸ªäººåˆ›å»ºçš„é˜Ÿä¼ âˆš
   5. è§£æ•£é˜Ÿä¼ âˆš
   6. é€€å‡ºé˜Ÿä¼ âˆš
2. éšæœºåŒ¹é… 30 - 40 min
3. å®Œæˆä¹‹å‰çš„é—ç•™é—®é¢˜ todo



### å‰ç«¯ä¸åŒé¡µé¢æ€ä¹ˆä¼ é€’æ•°æ®ï¼Ÿ


1. **url querystringï¼ˆxxx?id=1ï¼‰** æ¯”è¾ƒé€‚ç”¨äºé¡µé¢è·³è½¬
2. **urlï¼ˆ/team/:idï¼Œxxx/1ï¼‰**
3. hash (/team#1)
4. localStorage
5. **contextï¼ˆå…¨å±€å˜é‡ï¼ŒåŒé¡µé¢æˆ–æ•´ä¸ªé¡¹ç›®è¦è®¿é—®å…¬å…±å˜é‡ï¼‰**



### éšæœºåŒ¹é…


ä¸ºäº†å¸®å¤§å®¶æ›´å¿«åœ°å‘ç°å’Œè‡ªå·±å…´è¶£ç›¸åŒçš„æœ‹å‹  
åŒ¹é… 1 ä¸ªè¿˜æ˜¯åŒ¹é…å¤šä¸ªï¼Ÿ  
ç­”ï¼šåŒ¹é…å¤šä¸ªï¼Œå¹¶ä¸”æŒ‰ç…§åŒ¹é…çš„ç›¸ä¼¼åº¦ä»é«˜åˆ°ä½æ’åº  
æ€ä¹ˆåŒ¹é…ï¼Ÿï¼ˆæ ¹æ®ä»€ä¹ˆåŒ¹é…ï¼‰  
ç­”ï¼šæ ‡ç­¾ tags  
è¿˜å¯ä»¥æ ¹æ® user_team åŒ¹é…åŠ å…¥ç›¸åŒé˜Ÿä¼çš„ç”¨æˆ·  
æœ¬è´¨ï¼šæ‰¾åˆ°æœ‰ç›¸ä¼¼æ ‡ç­¾çš„ç”¨æˆ·  
ä¸¾ä¾‹ï¼š  
ç”¨æˆ· Aï¼š[Java, å¤§ä¸€, ç”·]  
ç”¨æˆ· Bï¼š[Java, å¤§äºŒ, ç”·]  
ç”¨æˆ· Cï¼š[Python, å¤§äºŒ, å¥³]  
ç”¨æˆ· Dï¼š[Java, å¤§ä¸€, å¥³]



#### 1. æ€ä¹ˆåŒ¹é…


1. æ‰¾åˆ°æœ‰å…±åŒæ ‡ç­¾æœ€å¤šçš„ç”¨æˆ·ï¼ˆTopNï¼‰
2. å…±åŒæ ‡ç­¾è¶Šå¤šï¼Œåˆ†æ•°è¶Šé«˜ï¼Œè¶Šæ’åœ¨å‰é¢
3. å¦‚æœæ²¡æœ‰åŒ¹é…çš„ç”¨æˆ·ï¼Œéšæœºæ¨èå‡ ä¸ªï¼ˆé™çº§æ–¹æ¡ˆï¼‰



ç¼–è¾‘è·ç¦»ç®—æ³•ï¼š[https://blog.csdn.net/DBC_121/article/details/104198838](https://blog.csdn.net/DBC_121/article/details/104198838)  
æœ€å°ç¼–è¾‘è·ç¦»ï¼šå­—ç¬¦ä¸² 1 é€šè¿‡æœ€å°‘å¤šå°‘æ¬¡å¢åˆ æ”¹å­—ç¬¦çš„æ“ä½œå¯ä»¥å˜æˆå­—ç¬¦ä¸² 2  
ä½™å¼¦ç›¸ä¼¼åº¦ç®—æ³•ï¼š[https://blog.csdn.net/m0_55613022/article/details/125683937](https://blog.csdn.net/m0_55613022/article/details/125683937)ï¼ˆå¦‚æœéœ€è¦å¸¦æƒé‡è®¡ç®—ï¼Œæ¯”å¦‚å­¦ä»€ä¹ˆæ–¹å‘æœ€é‡è¦ï¼Œæ€§åˆ«ç›¸å¯¹æ¬¡è¦ï¼‰



#### 2. æ€ä¹ˆå¯¹æ‰€æœ‰ç”¨æˆ·åŒ¹é…ï¼Œå– TOP


ç›´æ¥å–å‡ºæ‰€æœ‰ç”¨æˆ·ï¼Œä¾æ¬¡å’Œå½“å‰ç”¨æˆ·è®¡ç®—åˆ†æ•°ï¼Œå– TOP Nï¼ˆ54 ç§’ï¼‰  
ä¼˜åŒ–æ–¹æ³•ï¼š



1. åˆ‡å¿Œä¸è¦åœ¨æ•°æ®é‡å¤§çš„æ—¶å€™å¾ªç¯è¾“å‡ºæ—¥å¿—ï¼ˆå–æ¶ˆæ‰æ—¥å¿—å 20 ç§’ï¼‰
2. Map å­˜äº†æ‰€æœ‰çš„åˆ†æ•°ä¿¡æ¯ï¼Œå ç”¨å†…å­˜è§£å†³ï¼šç»´æŠ¤ä¸€ä¸ªå›ºå®šé•¿åº¦çš„æœ‰åºé›†åˆï¼ˆsortedSetï¼‰ï¼Œåªä¿ç•™åˆ†æ•°æœ€é«˜çš„å‡ ä¸ªç”¨æˆ·ï¼ˆæ—¶é—´æ¢ç©ºé—´ï¼‰e.g.ã€3, 4, 5, 6, 7ã€‘å– TOP 5ï¼Œid ä¸º 1 çš„ç”¨æˆ·å°±ä¸ç”¨æ”¾è¿›å»äº†
3. ç»†èŠ‚ï¼šå‰”é™¤è‡ªå·± âˆš
4. å°½é‡åªæŸ¥éœ€è¦çš„æ•°æ®ï¼š 
   1. è¿‡æ»¤æ‰æ ‡ç­¾ä¸ºç©ºçš„ç”¨æˆ· âˆš
   2. æ ¹æ®éƒ¨åˆ†æ ‡ç­¾å–ç”¨æˆ·ï¼ˆå‰ææ˜¯èƒ½åŒºåˆ†å‡ºæ¥å“ªä¸ªæ ‡ç­¾æ¯”è¾ƒé‡è¦ï¼‰
   3. åªæŸ¥éœ€è¦çš„æ•°æ®ï¼ˆæ¯”å¦‚ id å’Œ tagsï¼‰ âˆšï¼ˆ7.0sï¼‰
5. æå‰æŸ¥ï¼Ÿï¼ˆå®šæ—¶ä»»åŠ¡ï¼‰ 
   1. æå‰æŠŠæ‰€æœ‰ç”¨æˆ·ç»™ç¼“å­˜ï¼ˆä¸é€‚ç”¨äºç»å¸¸æ›´æ–°çš„æ•°æ®ï¼‰
   2. æå‰è¿ç®—å‡ºæ¥ç»“æœï¼Œç¼“å­˜ï¼ˆé’ˆå¯¹ä¸€äº›é‡ç‚¹ç”¨æˆ·ï¼Œæå‰ç¼“å­˜ï¼‰



å¤§æ•°æ®æ¨èï¼Œæ¯”å¦‚è¯´æœ‰å‡ äº¿ä¸ªå•†å“ï¼Œéš¾é“è¦æŸ¥å‡ºæ¥æ‰€æœ‰çš„å•†å“ï¼Ÿ  
éš¾é“è¦å¯¹æ‰€æœ‰çš„æ•°æ®è®¡ç®—ä¸€éç›¸ä¼¼åº¦ï¼Ÿ  
æ£€ç´¢ => å¬å› => ç²—æ’ => ç²¾æ’ => é‡æ’åºç­‰ç­‰  
æ£€ç´¢ï¼šå°½å¯èƒ½å¤šåœ°æŸ¥ç¬¦åˆè¦æ±‚çš„æ•°æ®ï¼ˆæ¯”å¦‚æŒ‰è®°å½•æŸ¥ï¼‰  
å¬å›ï¼šæŸ¥è¯¢å¯èƒ½è¦ç”¨åˆ°çš„æ•°æ®ï¼ˆä¸åšè¿ç®—ï¼‰  
ç²—æ’ï¼šç²—ç•¥æ’åºï¼Œç®€å•åœ°è¿ç®—ï¼ˆè¿ç®—ç›¸å¯¹è½»é‡ï¼‰  
ç²¾æ’ï¼šç²¾ç»†æ’åºï¼Œç¡®å®šå›ºå®šæ’ä½



### åˆ†è¡¨å­¦ä¹ å»ºè®®


mycatã€sharding sphere æ¡†æ¶  
ä¸€è‡´æ€§ hash



### é˜Ÿä¼æ“ä½œæƒé™æ§åˆ¶


åŠ å…¥é˜Ÿä¼ï¼š ä»…éé˜Ÿä¼åˆ›å»ºäººã€ä¸”æœªåŠ å…¥é˜Ÿä¼çš„äººå¯è§  
æ›´æ–°é˜Ÿä¼ï¼šä»…åˆ›å»ºäººå¯è§  
è§£æ•£é˜Ÿä¼ï¼šä»…åˆ›å»ºäººå¯è§  
é€€å‡ºé˜Ÿä¼ï¼šåˆ›å»ºäººä¸å¯è§ï¼Œä»…å·²åŠ å…¥é˜Ÿä¼çš„äººå¯è§  
åŠ è½½éª¨æ¶å±ç‰¹æ•ˆ âœ”  
è§£å†³ï¼švan-skeleton ç»„ä»¶  
ä»…åŠ å…¥é˜Ÿä¼å’Œåˆ›å»ºé˜Ÿä¼çš„äººèƒ½çœ‹åˆ°é˜Ÿä¼æ“ä½œæŒ‰é’®ï¼ˆlistTeam æ¥å£è¦èƒ½è·å–æˆ‘åŠ å…¥çš„é˜Ÿä¼çŠ¶æ€ï¼‰ âœ”  
æ–¹æ¡ˆ 1ï¼šå‰ç«¯æŸ¥è¯¢æˆ‘åŠ å…¥äº†å“ªäº›é˜Ÿä¼åˆ—è¡¨ï¼Œç„¶ååˆ¤æ–­æ¯ä¸ªé˜Ÿä¼ id æ˜¯å¦åœ¨åˆ—è¡¨ä¸­ï¼ˆå‰ç«¯è¦å¤šå‘ä¸€æ¬¡è¯·æ±‚ï¼‰  
æ–¹æ¡ˆ 2ï¼šåœ¨åç«¯å»åšä¸Šè¿°äº‹æƒ…ï¼ˆæ¨èï¼‰  
å‰ç«¯å¯¼èˆªæ æ­»ã€æ ‡é¢˜ã€‘é—®é¢˜ âœ”  
è§£å†³ï¼šä½¿ç”¨ router.beforeEachï¼Œæ ¹æ®è¦è·³è½¬é¡µé¢çš„ url è·¯å¾„ åŒ¹é… config/routes é…ç½®çš„ title å­—æ®µã€‚



## ä¸€ã€å‰ç«¯é¡µé¢å¼€å‘


### 1.æœç´¢æ¡†


```plain
  æˆ‘ä»¬é€‰æ‹©vantç»„ä»¶åº“é‡Œçš„åŸºç¡€æœç´¢æ¡†ï¼Œå¤åˆ¶åˆ°TeamPageé¡µé¢ï¼ŒåŒæ—¶è¿˜æœ‰æŸ¥è¯¢ä¸ºç©ºæ—¶ï¼Œæ˜¾ç¤ºçš„æ— ç»“æœé¡µé¢ï¼ˆç”¨æˆ·é¡µé¢ä»¥å†™è¿‡ï¼‰
```



![1669355535742-1b917dbb-439a-4071-aae1-c8f3fb3edfe1.png](./assets/12åŒ¹é…ç”¨æˆ·&é€€å‡ºè§£æ•£é˜Ÿä¼/1669355535742-1b917dbb-439a-4071-aae1-c8f3fb3edfe1-514622.png)  
å› ä¸ºï¼Œæˆ‘ä»¬ä¸€æ¬¡æ€§æŒ‚è½½æœ¬è´¨æ€§ä¹Ÿæ˜¯æœç´¢é˜Ÿä¼ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠä»£ç æå–å‡ºæ¥



```javascript
/**
 * æœç´¢é˜Ÿä¼
 * @param val
 * @returns {Promise<void>}
 */
const listTeam = async (val = '') => {
  const res = await myAxios.get("/team/list", {
    params: {
      searchText: val,
      pageNum: 1,
    },
  });
  if (res?.code === 0) {
    teamList.value = res.data;
  } else {
    Toast.fail('åŠ è½½é˜Ÿä¼å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•');
  }
}
```



æŒ‚è½½å’Œæœç´¢æ¡†ä¿®æ”¹ä¸ºä¸‹å›¾æ‰€ç¤ºï¼šï¼ˆPSï¼šæœç´¢ç›´æ¥å›è½¦å°±å¯è¡Œï¼‰  
![1669355737979-c1e4a0d8-f9c4-4130-8f07-b1cd3d38ec85.png](./assets/12åŒ¹é…ç”¨æˆ·&é€€å‡ºè§£æ•£é˜Ÿä¼/1669355737979-c1e4a0d8-f9c4-4130-8f07-b1cd3d38ec85-277753.png)  
æµ‹è¯•  
æœç´¢ä¸€ä¸ªé˜Ÿä¼ï¼Œå’ŒæŸ¥è¯¢ä¸€ä¸ªä¸å­˜åœ¨çš„é˜Ÿä¼  

![image-20241116095910753](./assets/12åŒ¹é…ç”¨æˆ·&é€€å‡ºè§£æ•£é˜Ÿä¼/image-20241116095910753.png)

![image-20241116095954330](./assets/12åŒ¹é…ç”¨æˆ·&é€€å‡ºè§£æ•£é˜Ÿä¼/image-20241116095954330.png)



### 2.æ›´æ–°é¡µé¢


åˆ†æï¼šæˆ‘ä»¬çš„æ›´æ–°é¡µé¢å’Œæ–°å»ºé˜Ÿä¼é¡µé¢ç±»ä¼¼ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥å¤åˆ¶TeamAddPage,åˆ›å»ºTeamUpdateTeamé¡µé¢



#### (1).å®Œå–„TeamCardList

æˆ‘ä»¬é¦–å…ˆåœ¨é˜Ÿä¼é¡µé¢ï¼Œåˆ›å»ºä¸€ä¸ªæŒ‰é’®æ¥è·³è½¬åˆ°æ›´æ–°é¡µé¢ï¼Œä½†æ˜¯åªæœ‰å½“å‰ç”¨æˆ·æ˜¯é˜Ÿä¼åˆ›å»ºè€…æ‰å¯ä»¥çœ‹åˆ°æ¬¡æŒ‰é’®ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å†™åœ¨TeamCardListç»„ä»¶é‡Œ  
æŒ‰é’®æ·»åŠ   
![1669364588450-aaff7a84-5fcb-471e-9ca8-2bd8d68dc81c.png](./assets/12åŒ¹é…ç”¨æˆ·&é€€å‡ºè§£æ•£é˜Ÿä¼/1669364588450-aaff7a84-5fcb-471e-9ca8-2bd8d68dc81c-268119.png)  
ç”±äºéœ€è¦åˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦ä¸ºé˜Ÿä¼åˆ›å»ºè€…ï¼Œæˆ‘ä»¬è¦è·å–å½“å‰ç”¨æˆ·ï¼ˆè°ƒç”¨ä»¥å‰å†™çš„æ–¹æ³•ï¼‰  
![1669364531799-cff6cc68-0313-41b9-ac8f-94532aea5569.png](./assets/12åŒ¹é…ç”¨æˆ·&é€€å‡ºè§£æ•£é˜Ÿä¼/1669364531799-cff6cc68-0313-41b9-ac8f-94532aea5569-086895.png)  
å†™è·³è½¬æŒ‰é’®çš„é€»è¾‘  
![1669364702112-b655733e-dc7d-4cd9-a13f-6e46aeb767fb.png](./assets/12åŒ¹é…ç”¨æˆ·&é€€å‡ºè§£æ•£é˜Ÿä¼/1669364702112-b655733e-dc7d-4cd9-a13f-6e46aeb767fb-053934.png)  
PSï¼šåˆ«å¿˜äº†å¼•å…¥useRouter  
å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š



```vue
<template>
  <div
      id="teamCardList"
  >
    <van-card
        v-for="team in props.teamList"
        :thumb="mouse"
        :desc="team.description"
        :title="`${team.name}`"
    >
      <template #tags>
        <van-tag plain type="danger" style="margin-right: 8px; margin-top: 8px">
          {{
            teamStatusEnum[team.status]
          }}
        </van-tag>
      </template>
      <template #bottom>
        <div>
          {{ 'æœ€å¤§äººæ•°: ' + team.maxNum }}
        </div>
        <div v-if="team.expireTime">
          {{ 'è¿‡æœŸæ—¶é—´: ' + team.expireTime }}
        </div>
        <div>
          {{ 'åˆ›å»ºæ—¶é—´: ' + team.createTime }}
        </div>
      </template>
      <template #footer>
        <van-button size="small" type="primary"  plain @click="doJoinTeam(team.id)">åŠ å…¥é˜Ÿä¼</van-button>
        <van-button v-if="team.userId === currentUser?.id" size="small" plain
                    @click="doUpdateTeam(team.id)">æ›´æ–°é˜Ÿä¼
        </van-button>
      </template>
    </van-card>
  </div>

</template>

<script setup lang="ts">
import {TeamType} from "../models/team";
import {teamStatusEnum} from "../constants/team";
import mouse from '../assets/mouse.jpg';
import myAxios from "../plugins/myAxios";
import {Toast} from "vant";

import {useRouter} from "vue-router";
import {onMounted, ref} from "vue";
import {getCurrentUser} from "../services/user";

interface TeamCardListProps {
  teamList: TeamType[];
}

const props = withDefaults(defineProps<TeamCardListProps>(), {
  // @ts-ignore
  teamList: [] as TeamType[],
});

const router = useRouter();

/**
 * åŠ å…¥é˜Ÿä¼
 */
const doJoinTeam = async (id:number) => {
  const res = await myAxios.post('/team/join', {
    teamId: id,

  });
  if (res?.code === 0) {
    Toast.success('åŠ å…¥æˆåŠŸ');
  } else {
    Toast.fail('åŠ å…¥å¤±è´¥' + (res.description ? `ï¼Œ${res.description}` : ''));
  }
}

/**
 * è·³è½¬è‡³æ›´æ–°é˜Ÿä¼é¡µ
 * @param id
 */
const doUpdateTeam = (id: number) => {
  router.push({
    path: '/team/update',
    query: {
      id,
    }
  })
}

const currentUser = ref();

onMounted(async () =>{
  currentUser.value = await getCurrentUser();
})

</script>

<style scoped>
#teamCardList :deep(.van-image__img) {
  height: 128px;
  object-fit: unset;
}
</style>
```



#### (2).ä¿®æ”¹TeamUpdatePage

åˆ é™¤ä¸èƒ½ä¿®æ”¹çš„ç»„ä»¶ï¼ˆæœ€å¤§äººæ•°ï¼‰å’Œå›ºå®šæ˜¾ç¤ºçš„å‚æ•°ï¼ˆinitFormDataï¼‰ï¼Œä¿®æ”¹æäº¤é€»è¾‘ï¼ˆç”±äºæ˜¯å¤åˆ¶å¾—æ¥çš„ï¼Œåƒä¸‡åˆ«å¿˜äº†ï¼Œä¸ç„¶å°±æ˜¯å¢åŠ é˜Ÿä¼äº†ï¼‰  
å…³é”®æ˜¯è·å–ä¹‹å‰é˜Ÿä¼çš„ä¿¡æ¯ã€‚å¼•å…¥Routeï¼Œæ¥è·å–ä¸Šä¸ªé¡µé¢ä¼ æ¥çš„å‚æ•°  
å®šä¹‰å˜é‡id  
![1669365087440-9f7c11f8-68d2-48b4-a88c-13f4ba767198.png](./assets/12åŒ¹é…ç”¨æˆ·&é€€å‡ºè§£æ•£é˜Ÿä¼/1669365087440-9f7c11f8-68d2-48b4-a88c-13f4ba767198-246947.png)

æŒ‚è½½è·å–ä¹‹å‰é˜Ÿä¼çš„ä¿¡æ¯

![1669365188732-b164ca1d-f99f-4bec-a2ae-103863b70f60.png](./assets/12åŒ¹é…ç”¨æˆ·&é€€å‡ºè§£æ•£é˜Ÿä¼/1669365188732-b164ca1d-f99f-4bec-a2ae-103863b70f60-121573.png)

å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š

```vue
<template>
  <van-form @submit="onSubmit">
    <van-cell-group inset>
      <van-field
          v-model="addTeamData.name"
          name="name"
          label="é˜Ÿä¼åç§°"
          placeholder="è¾“å…¥é˜Ÿä¼åç§°"
          :rules="[{ required: true, message: 'è¯·è¾“å…¥é˜Ÿä¼åç§°' }]"
      />
      <van-field
          v-model="addTeamData.description"
          name="description"
          rows="4"
          label="é˜Ÿä¼æè¿°"
          type="textarea"
          placeholder="è¾“å…¥é˜Ÿä¼æè¿°"
      />
      <van-field
          is-link
          readonly
          name="datePicker"
          label="è¿‡æœŸæ—¶é—´"
          :placeholder="addTeamData.expireTime?addTeamData.expireTime:'ç‚¹å‡»é€‰æ‹©é˜Ÿä¼è¿‡æœŸæ—¶é—´'"
          @click="showPicker = true"
      />
      <van-popup
          v-model:show="showPicker"
          position="bottom"
      >
        <van-date-picker
            @confirm=onConfirm
            @cancel="showPicker = false"
            title="è¯·é€‰æ‹©é˜Ÿä¼è¿‡æœŸæ—¶é—´"
            type="datetime"
            :min-date="minDate"
        />
      </van-popup>

      <van-field name="maxNum" label="æœ€å¤§äººæ•°">
        <template #input>
          <van-stepper v-model="addTeamData.maxNum" min="3" max="7"/>
        </template>
      </van-field>

      <van-field name="status" label="é˜Ÿä¼çŠ¶æ€">
        <template #input>
          <van-radio-group v-model="addTeamData.status" icon-size="10px" >
            <van-radio name="0">å…¬å¼€</van-radio>
            <van-radio name="1">ç§æœ‰</van-radio>
            <van-radio name="2">åŠ å¯†</van-radio>
          </van-radio-group>
        </template>
      </van-field>

      <van-field
          v-if="Number(addTeamData.status) === 2"
          v-model="addTeamData.password"
          type="password"
          name="password"
          label="å¯†ç "
          placeholder="å¯†ç "
          :rules="[{ required: true, message: 'è¯·å¡«å†™å¯†ç ' }]"
      />
    </van-cell-group>


    <div style="margin: 16px;">
      <van-button round block type="primary" native-type="submit">
        æäº¤
      </van-button>
    </div>
  </van-form>
</template>

<script setup>
import {ref} from "vue";
import moment from "moment";
import {useRoute, useRouter} from "vue-router";
import myAxios from "../plugins/myAxios.js";
import {showFailToast, showSuccessToast} from "vant";
import {onMounted} from "vue";

// const changeTest = (val) => {
//   console.log(val);
//   console.log(val.type);
//   console.log(addTeamData);
//   console.log(addTeamData.value);
//   console.log("----------------------------------")
// }


 let initFormData = {
  "description": "",
  "expireTime": "",
  "maxNum": 5,
  "name": "",
  "password": "",
  "status": '',
};

const addTeamData = ref({...initFormData})
const route = useRoute();
const id = ref(route.query.id);
onMounted(async () => {
  if(id <= 0){
    showFailToast("åŠ è½½å¤±è´¥ï¼Œè¯·é‡æ–°å°è¯•");
  }
  const res = await myAxios.get("/team/search",{
    params:{
      id : id.value,
    }
  })
  if(res.code === 0){
    addTeamData.value = res.data;
    //å› ä¸ºè¿”å›çš„statusæ˜¯numberç±»å‹çš„ï¼Œvan-radio-groupä¸­v-modelç»‘å®šçš„å€¼å¿…é¡»æ˜¯å­—ç¬¦ä¸²ç±»å‹æ‰ç”Ÿæ•ˆã€‚
    //å› æ­¤åœ¨è¿™é‡Œå°†statusé‡æ–°èµ‹å€¼ä¸ºå­—ç¬¦ä¸²ç±»å‹ã€‚è§£å†³æ¯æ¬¡é‡æ–°æ¸²æŸ“é¡µé¢æ—¶ï¼Œradioç»„ä»¶ä¸é»˜è®¤å‹¾é€‰çš„é—®é¢˜
    addTeamData.value.status = `${res.data.status}` //ä½¿ç”¨æ¨¡æ¿å­—ç¬¦ä¸²
    console.log(addTeamData.value.status);
  }else{
    showFailToast("é˜Ÿä¼åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•")
  }
})



const showPicker = ref(false);

const onConfirm = ({selectedValues}) => {
  addTeamData.value.expireTime = selectedValues.join("-");
  showPicker.value = false;
};

const minDate = new Date();

const router = useRouter();

const onSubmit =async () => {
  const postData = {
    ...addTeamData.value,
    status: Number(addTeamData.value.status),
    expireTime: moment(addTeamData.value.expireTime).format("YYYY-MM-DD HH:mm:ss")
  }
  const res = await myAxios.post("/team/update", postData);
  console.log(res);
  if(res?.code ===0 && res.data){
    showSuccessToast("æ›´æ–°æˆåŠŸ");
    router.push({
      path:"/team",
      replace:true,
    })
  }else{
    showFailToast("æ›´æ–°å¤±è´¥");
  }
};
</script>

<style scoped>

</style>
```



> **è¸©å‘å¤„ï¼šåç«¯updateæ¥å£è¦å°†@RequestBodyåˆ å»**  
> **å¦åˆ™ä¼šæŠ¥Required request body is missingçš„é”™è¯¯ï¼ˆæˆ‘è¿™è¾¹æ˜¯è¿™æ ·çš„ï¼‰**



#### (3).æµ‹è¯•ï¼šç‚¹å‡»æ›´æ–°é˜Ÿä¼ä¿®æ”¹å‚æ•°


![1669364137041-00748a49-e68d-4cd5-88df-7338fa1e3eb9.png](./assets/12åŒ¹é…ç”¨æˆ·&é€€å‡ºè§£æ•£é˜Ÿä¼/1669364137041-00748a49-e68d-4cd5-88df-7338fa1e3eb9-850218.png)![1669364161110-f7b0d7db-5231-451e-9b71-3b850ef1cd84.png](./assets/12åŒ¹é…ç”¨æˆ·&é€€å‡ºè§£æ•£é˜Ÿä¼/1669364161110-f7b0d7db-5231-451e-9b71-3b850ef1cd84-496143.png)



### 3.æŸ¥çœ‹ä¸ªäººå·²åŠ å…¥é˜Ÿä¼


#### (1).ç¼–å†™åç«¯æ¥å£

å¤ç”¨ listTeam æ–¹æ³•ï¼Œåªæ–°å¢æŸ¥è¯¢æ¡ä»¶ï¼Œä¸åšä¿®æ”¹ï¼ˆå¼€é—­åŸåˆ™ï¼‰  
è·å–å½“å‰ç”¨æˆ·å·²åŠ å…¥çš„é˜Ÿä¼



```java
    /**
     * è·å–æˆ‘åˆ›å»ºçš„é˜Ÿä¼
     *
     * @param teamQuery
     * @param request
     * @return
     */
    @GetMapping("/list/my/create")
    public BaseResponse<List<TeamUserVO>> listMyCreateTeams(TeamQuery teamQuery, HttpServletRequest request) {
        if (teamQuery == null) {
            throw new BusinessException(ErrorCode.PARAMS_ERROR);
        }
        User loginUser = userService.getLoginUser(request);
        teamQuery.setUserId(loginUser.getId());
        List<TeamUserVO> teamList = teamService.listTeams(teamQuery, true);
        return ResultUtils.success(teamList);
    }
```



æˆ‘ä»¬æŸ¥è¯¢åŠ å…¥çš„é˜Ÿä¼éœ€è¦ç”¨åˆ°idçš„åˆ—è¡¨ï¼Œæ‰€ä»¥åœ¨Teamqueryé‡Œå¢åŠ idListå­—æ®µ  
![1669376142165-2aec0aa7-bd95-42fb-b88e-65503d021b42.png](./assets/12åŒ¹é…ç”¨æˆ·&é€€å‡ºè§£æ•£é˜Ÿä¼/1669376142165-2aec0aa7-bd95-42fb-b88e-65503d021b42-723419.png)  
è·å–æˆ‘åŠ å…¥çš„é˜Ÿä¼

```java
    /**
     * è·å–æˆ‘åŠ å…¥çš„é˜Ÿä¼
     *
     * @param teamQuery
     * @param request
     * @return
     */
    @GetMapping("/list/my/join")
    public BaseResponse<List<TeamUserVO>> listMyJoinTeams(TeamQuery teamQuery, HttpServletRequest request) {
        if (teamQuery == null) {
            throw new BusinessException(ErrorCode.PARAMS_ERROR);
        }
        User loginUser = userService.getLoginUser(request);
        QueryWrapper<UserTeam> queryWrapper = new QueryWrapper<>();
        queryWrapper.eq("userId", loginUser.getId());
        List<UserTeam> userTeamList = userTeamService.list(queryWrapper);
        // å–å‡ºä¸é‡å¤çš„é˜Ÿä¼ id
        // teamId userId
        Map<Long, List<UserTeam>> listMap = userTeamList.stream()
                .collect(Collectors.groupingBy(UserTeam::getTeamId));
        List<Long> idList = new ArrayList<>(listMap.keySet());
        teamQuery.setIdList(idList);
        List<TeamUserVO> teamList = teamService.listTeams(teamQuery, true);
        return ResultUtils.success(teamList);
    }
```



ä¿®æ”¹ä¸‹listTeamæ–¹æ³•ï¼ŒåŠ ä¸€å±‚æ ¡éªŒ  
![1669376046219-8c821950-2821-4897-afc0-b682f732401e.png](./assets/12åŒ¹é…ç”¨æˆ·&é€€å‡ºè§£æ•£é˜Ÿä¼/1669376046219-8c821950-2821-4897-afc0-b682f732401e-132199.png)



#### (2).åç«¯æµ‹è¯•

æµ‹è¯•/team/my/create

ä¸å¡«å†™å‚æ•°ç›´æ¥ç‚¹å‡»å‘é€ï¼Œåç«¯æ­£ç¡®è¿”å›è¯¥ç”¨æˆ·åˆ›å»ºçš„é˜Ÿä¼

![image-207241116170328741](./assets/12åŒ¹é…ç”¨æˆ·&é€€å‡ºè§£æ•£é˜Ÿä¼/image-20241116170328741.png)

![image-20241116170358440](./assets/12åŒ¹é…ç”¨æˆ·&é€€å‡ºè§£æ•£é˜Ÿä¼/image-20241116170358440.png)

æµ‹è¯•/team/my/join

ä¸å¡«å†™å‚æ•°ç›´æ¥ç‚¹å‡»å‘é€ï¼Œåç«¯æ­£ç¡®è¿”å›è¯¥ç”¨æˆ·åŠ å…¥çš„é˜Ÿä¼

![image-20241116170514359](./assets/12åŒ¹é…ç”¨æˆ·&é€€å‡ºè§£æ•£é˜Ÿä¼/image-20241116170514359.png)

![image-20241116170542940](./assets/12åŒ¹é…ç”¨æˆ·&é€€å‡ºè§£æ•£é˜Ÿä¼/image-20241116170542940.png)



#### (3).åˆ›å»ºå‰ç«¯é¡µé¢

æˆ‘ä»¬å¤åˆ¶ä¸€ä»½UserPageï¼Œå‘½åä¸ºUserUpdatePageï¼Œä¿®æ”¹UserPageï¼ˆæˆ‘ä»¬åªéœ€è¦å½“å‰ç”¨æˆ·ï¼Œä¿®æ”¹ä¿¡æ¯ï¼Œæˆ‘åˆ›å»ºçš„é˜Ÿä¼ï¼Œæˆ‘åŠ å…¥çš„é˜Ÿä¼ï¼‰  
ä¿®æ”¹UserPageå¦‚ä¸‹ï¼š



```vue
<template>
  <template v-if="user">
    <van-cell title="å½“å‰ç”¨æˆ·" :value="user?.username" />
    <van-cell title="ä¿®æ”¹ä¿¡æ¯" is-link to="/user/update" />
    <van-cell title="æˆ‘åˆ›å»ºçš„é˜Ÿä¼" is-link to="/user/team/create" />
    <van-cell title="æˆ‘åŠ å…¥çš„é˜Ÿä¼" is-link to="/user/team/join" />
  </template>
</template>

<script setup lang="ts">
import {useRouter} from "vue-router";
import {onMounted, ref} from "vue";
import myAxios from "../plugins/myAxios.js";
import {Toast} from "vant";
import {getCurrentUser} from "../services/user";

const user = ref();

onMounted(async ()=>{
  user.value=await getCurrentUser();
})

const router = useRouter();

const toEdit = (editKey: string, editName: string, currentValue: string) => {
  router.push({
    path: '/user/edit',
    query: {
      editKey,
      editName,
      currentValue,
    }
  })
}
</script>

<style scoped>

</style>
```



åˆ›å»ºé¡µé¢ï¼šæŸ¥è¯¢åŠ å…¥é˜Ÿä¼é¡µé¢å’ŒæŸ¥è¯¢åˆ›å»ºé˜Ÿä¼é¡µé¢ï¼ˆå¤åˆ¶TeamPageé¡µé¢ï¼Œå½¢å¼ç›¸åŒï¼‰ Â  PS:åˆ«å¿˜äº†åœ¨è·¯ç”±é‡Œé¢æ·»åŠ è¿™ä¸¤ä¸ªé¡µé¢  
å› ä¸ºæˆ‘ä»¬æŠŠåŸæ¥çš„ç”¨æˆ·é¡µé¢æ”¹ä¸ºç”¨æˆ·æ›´æ–°é¡µé¢ï¼Œè·¯ç”±é‡Œä¹Ÿè¦ä¿®æ”¹  
![1669389905879-61be93f5-6cf7-46b8-b513-cb86fc67f127.png](./assets/12åŒ¹é…ç”¨æˆ·&é€€å‡ºè§£æ•£é˜Ÿä¼/1669389905879-61be93f5-6cf7-46b8-b513-cb86fc67f127-136682.png)



æŸ¥è¯¢åŠ å…¥é˜Ÿä¼é¡µé¢

```vue
<template>
  <div id="teamPage">
    <van-search v-model="searchText" placeholder="æœç´¢é˜Ÿä¼" @search="onSearch" />
    <team-card-list :teamList="teamList" />
    <van-empty v-if="teamList?.length < 1" description="æ•°æ®ä¸ºç©º"/>
  </div>
</template>

<script setup lang="ts">

import {useRouter} from "vue-router";
import TeamCardList from "../components/TeamCardList.vue";
import {onMounted, ref} from "vue";
import myAxios from "../plugins/myAxios";
import {Toast} from "vant";

const router = useRouter();
const searchText = ref('');

const teamList = ref([]);

/**
 * æœç´¢é˜Ÿä¼
 * @param val
 * @returns {Promise<void>}
 */
const listTeam = async (val = '') => {
  const res = await myAxios.get("/team/list/my/join", {
    params: {
      searchText: val,
      pageNum: 1,
    },
  });
  if (res?.code === 0) {
    teamList.value = res.data;
  } else {
    Toast.fail('åŠ è½½é˜Ÿä¼å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•');
  }
}


// é¡µé¢åŠ è½½æ—¶åªè§¦å‘ä¸€æ¬¡
onMounted( () => {
  listTeam();
})

const onSearch = (val) => {
  listTeam(val);
};

</script>

<style scoped>
#teamPage {

}
</style>
```

æŸ¥è¯¢åˆ›å»ºé˜Ÿä¼é¡µé¢

```vue
<template>
  <div id="teamPage">
    <van-search v-model="searchText" placeholder="æœç´¢é˜Ÿä¼" @search="onSearch" />
    <van-button type="primary" @click="doJoinTeam">åˆ›å»ºé˜Ÿä¼</van-button>
    <team-card-list :teamList="teamList" />
    <van-empty v-if="teamList?.length < 1" description="æ•°æ®ä¸ºç©º"/>
  </div>
</template>

<script setup lang="ts">

import {useRouter} from "vue-router";
import TeamCardList from "../components/TeamCardList.vue";
import {onMounted, ref} from "vue";
import myAxios from "../plugins/myAxios";
import {Toast} from "vant";

const router = useRouter();
const searchText = ref('');

// è·³è½¬åˆ°åŠ å…¥é˜Ÿä¼é¡µ
const doJoinTeam = () => {
  router.push({
    path: "/team/add"
  })
}

const teamList = ref([]);

/**
 * æœç´¢é˜Ÿä¼
 * @param val
 * @returns {Promise<void>}
 */
const listTeam = async (val = '') => {
  const res = await myAxios.get("/team/list/my/create", {
    params: {
      searchText: val,
      pageNum: 1,
    },
  });
  if (res?.code === 0) {
    teamList.value = res.data;
  } else {
    Toast.fail('åŠ è½½é˜Ÿä¼å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•');
  }
}

// é¡µé¢åŠ è½½æ—¶åªè§¦å‘ä¸€æ¬¡
onMounted( () => {
  listTeam();
})

const onSearch = (val) => {
  listTeam(val);
};

</script>

<style scoped>
#teamPage {

}
</style>
```



#### (4).æµ‹è¯•


![1669390705126-b6baf9f8-4f2c-44a5-be62-710dd7bad6b0.png](./assets/12åŒ¹é…ç”¨æˆ·&é€€å‡ºè§£æ•£é˜Ÿä¼/1669390705126-b6baf9f8-4f2c-44a5-be62-710dd7bad6b0-532135.png)![1669390731624-3a471a51-96f7-4733-8627-159711bfa3bf.png](./assets/12åŒ¹é…ç”¨æˆ·&é€€å‡ºè§£æ•£é˜Ÿä¼/1669390731624-3a471a51-96f7-4733-8627-159711bfa3bf-682528.png)![1669390748547-6197fda4-072e-42d1-b5b2-b79d2923ce04.png](./assets/12åŒ¹é…ç”¨æˆ·&é€€å‡ºè§£æ•£é˜Ÿä¼/1669390748547-6197fda4-072e-42d1-b5b2-b79d2923ce04-002542.png)



> **PSï¼šè¿™é‡Œæˆ‘è§‰å¾—æ˜¯æœ‰bugçš„ï¼Œå‘é€çš„è¯·æ±‚æ˜¯ä¸å¸¦å‚æ•°çš„,å³statusçš„é»˜è®¤çŠ¶æ€æ˜¯ä¸ºnull,ä¼šè¢«å®šä¹‰æˆå…¬å…±çš„ï¼Œè¿™æ ·çš„è¯ï¼Œå¦‚æœæˆ‘ä»¬åˆ›å»ºçš„é˜Ÿä¼æ˜¯ç§äººæˆ–è€…é»˜è®¤çš„å°±ä¸ä¼šå±•ç°ï¼ˆæˆ‘è§‰å¾—åº”è¯¥æ˜¯å¤ç”¨teamListçš„ç¼˜æ•…ï¼Œåœ¨teamLIstçš„é€»è¾‘é‡Œï¼Œæˆ‘ä»¬ä¸å¸¦å‚æ•°è¯·æ±‚å°±ç›´æ¥æŸ¥è¯¢æ‰€æœ‰å…¬å¼€çš„ï¼‰ï¼Œè§£å†³åŠæ³•æ˜¯å¸¦ä¸ªstatusçš„å‚æ•°å†å‘é€è¯·æ±‚ã€‚ä½†æ˜¯æˆ‘åœ¨knife4jé‡Œæµ‹è¯•äº†ä¸€ä¸‹ï¼Œåªèƒ½ä¼ ä¸€ä¸ªçŠ¶æ€å‚æ•°ï¼Œç±»å‹ä¸ºæ•´å‹ï¼Œè¿™ä»£è¡¨äº†æˆ‘ä»¬ä¸èƒ½åŒæŸ¥è¯¢å¤šä¸ªçŠ¶æ€çš„é˜Ÿä¼ï¼Œå›åˆ°å‰ç«¯ç”±äºçŸ¥è¯†æµ…è–„æ— æ³•è§£å†³ä¼ å‚é—®é¢˜ï¼Œåªèƒ½æ˜¾ç¤ºå…¬å¼€çŠ¶æ€çš„é˜Ÿä¼ã€‚æ‹‰äº†é±¼çš®å®Œæ•´çš„ä»£ç ï¼ˆå¥½åƒä¹Ÿæ²¡è§£å†³ï¼‰ï¼Œä¸çŸ¥é“æœ‰æ— å¤§ä½¬èƒ½å¤Ÿè§£å†³è¿™ä¸ªé—®é¢˜ï¼**

### 4.é€€å‡ºå’Œè§£æ•£é˜Ÿä¼


#### 1.åœ¨TeamCardListæ·»åŠ ä¸¤ä¸ªæŒ‰é’®æ¥å®ç°è¿™ä¸¤ä¸ªåŠŸèƒ½


![1669393609942-f390e0b7-5d31-4ffd-a9fa-f1a30b286bbb.png](./assets/12åŒ¹é…ç”¨æˆ·&é€€å‡ºè§£æ•£é˜Ÿä¼/1669393609942-f390e0b7-5d31-4ffd-a9fa-f1a30b286bbb-892899.png)

#### 2.åœ¨jsé‡Œå†™å…¥æŒ‰é’®çš„æ–¹æ³•


```javascript
/**
 * é€€å‡ºé˜Ÿä¼
 * @param id
 */
const doQuitTeam = async (id: number) => {
  const res = await myAxios.post('/team/quit', {
    teamId: id
  });
  if (res?.code === 0) {
    Toast.success('æ“ä½œæˆåŠŸ');
  } else {
    Toast.fail('æ“ä½œå¤±è´¥' + (res.description ? `ï¼Œ${res.description}` : ''));
  }
}

/**
 * è§£æ•£é˜Ÿä¼
 * @param id
 */
const doDeleteTeam = async (id: number) => {
  const res = await myAxios.post('/team/delete', {
    id,
  });
  if (res?.code === 0) {
    Toast.success('æ“ä½œæˆåŠŸ');
  } else {
    Toast.fail('æ“ä½œå¤±è´¥' + (res.description ? `ï¼Œ${res.description}` : ''));
  }
}
```

(4).è¿è¡Œæµ‹è¯•  
1.é€€å‡ºé˜Ÿä¼

æˆåŠŸé€€å‡ºæ—å…‹team001

![image-20241116221310085](./assets/12åŒ¹é…ç”¨æˆ·&é€€å‡ºè§£æ•£é˜Ÿä¼/image-20241116221310085.png)



## äºŒã€éšæœºåŒ¹é…


ç¼–è¾‘è·ç¦»ç®—æ³•ï¼š[https://blog.csdn.net/DBC_121/article/details/104198838](https://blog.csdn.net/DBC_121/article/details/104198838)

> æœ€å°ç¼–è¾‘è·ç¦»ï¼šå­—ç¬¦ä¸² str1 é€šè¿‡æœ€å°‘å¤šå°‘æ¬¡å¢åˆ æ”¹å­—ç¬¦çš„æ“ä½œå¯ä»¥å˜æˆå­—ç¬¦ä¸²str2

ä½™å¼¦ç›¸ä¼¼åº¦ç®—æ³•ï¼šhttps://blog.csdn.net/m0_55613022/article/details/125683937ï¼ˆå¦‚æœéœ€è¦å¸¦æƒé‡è®¡ç®—ï¼Œæ¯”å¦‚å­¦ä»€ä¹ˆæ–¹å‘æœ€é‡è¦ï¼Œæ€§åˆ«ç›¸å¯¹æ¬¡è¦ï¼‰



### 1.åŒ¹é…ç”¨æˆ·åç«¯ç¼–å†™

è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº†ç¼–è¾‘è·ç¦»ç®—æ³•  
æŠŠè¿™ä¸ªæ–¹æ³•æ”¾åœ¨å·¥å…·ç±»ï¼ˆæ–°å»ºä¸€ä¸ªutilsåŒ…ï¼‰é‡Œé¢ï¼Œå¹¶å†™ä¸€ä¸ªæµ‹è¯•ç±»æµ‹è¯•  
æˆ‘ä»¬æ¨èæ˜¯é€šè¿‡æ ‡ç­¾ç±»ï¼ˆæ‰€ä»¥æˆ‘ä»¬ä¼ çš„å‚æ•°åº”è¯¥æ˜¯å­—ç¬¦å‹çš„åˆ—è¡¨ï¼‰ï¼Œä¿®æ”¹æ•´ç†ä¸ºï¼š

```java
/**
* ç®—æ³•å·¥å…·ç±»
*
* @author yupi
*/
public class AlgorithmUtils {

/**
* ç¼–è¾‘è·ç¦»ç®—æ³•ï¼ˆç”¨äºè®¡ç®—æœ€ç›¸ä¼¼çš„ä¸¤ç»„æ ‡ç­¾ï¼‰
*
* @param tagList1
* @param tagList2
* @return
*/
    public static int minDistance(List<String> tagList1, List<String> tagList2) {
        int n = tagList1.size();
        int m = tagList2.size();

        if (n * m == 0) {
            return n + m;
        }

        int[][] d = new int[n + 1][m + 1];
        for (int i = 0; i < n + 1; i++) {
            d[i][0] = i;
        }

        for (int j = 0; j < m + 1; j++) {
            d[0][j] = j;
        }

        for (int i = 1; i < n + 1; i++) {
            for (int j = 1; j < m + 1; j++) {
                int left = d[i - 1][j] + 1;
                int down = d[i][j - 1] + 1;
                int left_down = d[i - 1][j - 1];
                if (!Objects.equals(tagList1.get(i - 1), tagList2.get(j - 1))) {
                    left_down += 1;
                }
                d[i][j] = Math.min(left, Math.min(down, left_down));
            }
        }
        return d[n][m];
    }

/**
* ç¼–è¾‘è·ç¦»ç®—æ³•ï¼ˆç”¨äºè®¡ç®—æœ€ç›¸ä¼¼çš„ä¸¤ä¸ªå­—ç¬¦ä¸²ï¼‰
* åŸç†ï¼šhttps://blog.csdn.net/DBC_121/article/details/104198838
*
* @param word1
* @param word2
* @return
*/
    public static int minDistance(String word1, String word2) {
        int n = word1.length();
        int m = word2.length();

        if (n * m == 0) {
            return n + m;
        }

        int[][] d = new int[n + 1][m + 1];
        for (int i = 0; i < n + 1; i++) {
            d[i][0] = i;
        }

        for (int j = 0; j < m + 1; j++) {
            d[0][j] = j;
        }

        for (int i = 1; i < n + 1; i++) {
            for (int j = 1; j < m + 1; j++) {
                int left = d[i - 1][j] + 1;
                int down = d[i][j - 1] + 1;
                int left_down = d[i - 1][j - 1];
                if (word1.charAt(i - 1) != word2.charAt(j - 1)) {
                    left_down += 1;
                }
                d[i][j] = Math.min(left, Math.min(down, left_down));
            }
        }
        return d[n][m];
    }
}
```

æµ‹è¯•æ–¹æ³•

```java
/**
* ç®—æ³•å·¥å…·ç±»æµ‹è¯•
*/
public class AlgorithmUtilsTest {

    @Test
    void test() {
        String str1 = "é±¼çš®æ˜¯ç‹—";
        String str2 = "é±¼çš®ä¸æ˜¯ç‹—";
        String str3 = "é±¼çš®æ˜¯é±¼ä¸æ˜¯ç‹—";
        //        String str4 = "é±¼çš®æ˜¯çŒ«";
        // 1
        int score1 = AlgorithmUtils.minDistance(str1, str2);
        // 3
        int score2 = AlgorithmUtils.minDistance(str1, str3);
        System.out.println(score1);
        System.out.println(score2);
    }

    @Test
    void testCompareTags() {
        List<String> tagList1 = Arrays.asList("Java", "å¤§ä¸€", "ç”·");
        List<String> tagList2 = Arrays.asList("Java", "å¤§ä¸€", "å¥³");
        List<String> tagList3 = Arrays.asList("Python", "å¤§äºŒ", "å¥³");
        // 1
        int score1 = AlgorithmUtils.minDistance(tagList1, tagList2);
        // 3
        int score2 = AlgorithmUtils.minDistance(tagList1, tagList3);
        System.out.println(score1);
        System.out.println(score2);
    }
}
```

åœ¨UserControlleré‡Œå†™å…¥è·å–æœ€åŒ¹é…çš„ç”¨æˆ·çš„æ¥å£

```java
    /**
     * è·å–æœ€åŒ¹é…çš„ç”¨æˆ·
     *
     * @param num
     * @param request
     * @return
     */
    @GetMapping("/match")
    public BaseResponse<List<User>> matchUsers(long num, HttpServletRequest request) {
        if (num <= 0 || num > 20) {
            throw new BusinessException(ErrorCode.PARAMS_ERROR);
        }
        User user = userService.getLoginUser(request);
        return ResultUtils.success(userService.matchUsers(num, user));
    }
```

åœ¨USerServiceé‡Œå†™å…¥matchUsersæ–¹æ³•å¹¶å®ç°  

![1669440611584-89f28380-9c7f-437e-87a2-d96fcb55fa45.png](./assets/12åŒ¹é…ç”¨æˆ·&é€€å‡ºè§£æ•£é˜Ÿä¼/1669440611584-89f28380-9c7f-437e-87a2-d96fcb55fa45-806733.png)

å…·ä½“çš„å®ç°æ–¹æ³•æœ¬æœŸç›´æ’­å¹¶æœªå®Œç¾çš„å®Œæˆï¼ˆé—ç•™bugï¼‰ï¼Œæ‰€ä»¥ç»“åˆ13æœŸçš„å†…å®¹ï¼Œä¿®å¤äº†æ’åºçš„é—®é¢˜  
ä¸‹é¢å°±æ˜¯å…·ä½“çš„ä»£ç : Â (è¿™é‡Œç”±äºé±¼çš®è¸©å‘è¿‡å¤šï¼ŒåŒæ—¶è‡ªå·±ä¹Ÿæ²¡æœ‰å®Œå…¨ç†è§£ï¼Œè¿‡ç¨‹å°±çœç•¥)

```java
 @Override
    public List<User> matchUsers(long num, User loginUser) {
        QueryWrapper<User> queryWrapper = new QueryWrapper<>();
        queryWrapper.select("id", "tags");
        queryWrapper.isNotNull("tags");
        List<User> userList = this.list(queryWrapper);
        String tags = loginUser.getTags();
        Gson gson = new Gson();
        List<String> tagList = gson.fromJson(tags, new TypeToken<List<String>>() {
        }.getType());
        // ç”¨æˆ·åˆ—è¡¨çš„ä¸‹æ ‡ => ç›¸ä¼¼åº¦
        List<Pair<User, Long>> list = new ArrayList<>();
        // ä¾æ¬¡è®¡ç®—æ‰€æœ‰ç”¨æˆ·å’Œå½“å‰ç”¨æˆ·çš„ç›¸ä¼¼åº¦
        for (int i = 0; i < userList.size(); i++) {
            User user = userList.get(i);
            String userTags = user.getTags();
            // æ— æ ‡ç­¾æˆ–è€…ä¸ºå½“å‰ç”¨æˆ·è‡ªå·±
            if (StringUtils.isBlank(userTags) || user.getId() == loginUser.getId()) {
                continue;
            }
            List<String> userTagList = gson.fromJson(userTags, new TypeToken<List<String>>() {
            }.getType());
            // è®¡ç®—åˆ†æ•°
            long distance = AlgorithmUtils.minDistance(tagList, userTagList);
            list.add(new Pair<>(user, distance));
        }
        // æŒ‰ç¼–è¾‘è·ç¦»ç”±å°åˆ°å¤§æ’åº
        List<Pair<User, Long>> topUserPairList = list.stream()
                .sorted((a, b) -> (int) (a.getValue() - b.getValue()))
                .limit(num)
                .collect(Collectors.toList());
        // åŸæœ¬é¡ºåºçš„ userId åˆ—è¡¨
        List<Long> userIdList = topUserPairList.stream().map(pair -> pair.getKey().getId()).collect(Collectors.toList());
        QueryWrapper<User> userQueryWrapper = new QueryWrapper<>();
        userQueryWrapper.in("id", userIdList);
        // 1, 3, 2
        // User1ã€User2ã€User3
        // 1 => User1, 2 => User2, 3 => User3
        Map<Long, List<User>> userIdUserListMap = this.list(userQueryWrapper)
                .stream()
                .map(user -> getSafetyUser(user))
                .collect(Collectors.groupingBy(User::getId));
        List<User> finalUserList = new ArrayList<>();
        for (Long userId : userIdList) {
            finalUserList.add(userIdUserListMap.get(userId).get(0));
        }
        return finalUserList;
    }
```



### 2.æµ‹è¯•

åœ¨æ•°æ®åº“é‡Œæ’å…¥æ ‡ç­¾å‡æ•°æ®  
![1669447043646-ab0123fd-4687-4b47-b00d-4d01e1bf583f.png](./assets/12åŒ¹é…ç”¨æˆ·&é€€å‡ºè§£æ•£é˜Ÿä¼/1669447043646-ab0123fd-4687-4b47-b00d-4d01e1bf583f-207006.png)



æ ¹æ®æœ€å°ç¼–è¾‘è·ç¦»ç®—æ³•ï¼Œç»“æœæ’åºï¼ˆæ’é™¤è‡ªå·±)åº”è¯¥æ˜¯idï¼š32456  
å¯åŠ¨åç«¯ï¼Œåœ¨knife4jæ¥å£æ–‡æ¡£é‡Œæµ‹è¯•matchUsersï¼Œæ­£ç¡®ç”¨æˆ·æ’åºä¹Ÿæ˜¯32456



![1669448167918-20f68d1b-6b2b-442c-b22a-59709a0b223a.png](./assets/12åŒ¹é…ç”¨æˆ·&é€€å‡ºè§£æ•£é˜Ÿä¼/1669448167918-20f68d1b-6b2b-442c-b22a-59709a0b223a-977124.png)



> è¸©å‘å¤„ï¼š  
> 1.ä¸€å®šè¦æŠŠredisçš„ç¼“å­˜æ¸…é™¤**ï¼Œé‡æ–°ç™»å½•ï¼Œå†matchUsersï¼Œå¦åˆ™æ¨èçš„ç”¨æˆ·ä¸æ˜¯é€šè¿‡æœ€å°ç¼–è¾‘è·ç¦»ç®—æ³•è·å¾—çš„**  
> 2.æˆ‘è¿™é‡Œå¥½åƒåˆæœ‰bugå¦‚ä¸‹å¤„



![1669450332937-3a57ab4d-6346-494b-b046-e2ccde1c391a.png](./assets/12åŒ¹é…ç”¨æˆ·&é€€å‡ºè§£æ•£é˜Ÿä¼/1669450332937-3a57ab4d-6346-494b-b046-e2ccde1c391a-343828.png)



> è¿™é‡Œé±¼çš®ä½¿ç”¨ï¼Œæˆ‘ä½¿ç”¨ä¼šä¾æ—§æŸ¥åˆ°è‡ªå·±ï¼Œdebugå‘ç°å€¼ä¹Ÿæ˜¯ç›¸åŒçš„ï¼Œè€ƒè™‘åˆ°ä¸Šæ¬¡çš„è¸©å‘å¤„ï¼Œåº”è¯¥æ˜¯å¯¹è±¡ç±»å‹çš„é—®é¢˜ï¼Œæ¢æˆequalså¯è¡Œï¼ˆçƒå‹ä»¬å¯è‡ªè¡Œæ ¹æ®æƒ…å†µç¼–å†™ä»£ç )



## ç¬¬åä¸‰æœŸå®Œç»“ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰


> æ›´æ–°: 2023-02-10 10:07:15  
> åŸæ–‡: <https://www.yuque.com/shierkcs/catstudy/fduqxhca7lntax7f>