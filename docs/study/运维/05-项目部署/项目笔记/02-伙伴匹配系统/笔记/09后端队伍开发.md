# 09 åç«¯é˜Ÿä¼å¼€å‘

<font style="color:rgb(51, 51, 51);">åœ¨çº¿å›æ”¾ï¼š</font>[https://meeting.tencent.com/v2/cloud-record/share?...](https://meeting.tencent.com/v2/cloud-record/share?id=ce65608f-752f-448f-864a-3fd7d6e34cd2&from=3)<font style="color:rgb(51, 51, 51);">ï¼ˆè®¿é—®å¯†ç ï¼šbeMkï¼‰</font>

# é±¼çš®ç¬”è®°

### ç»„é˜ŸåŠŸèƒ½


ç†è§£ä¸ºç‹è€…è£è€€



#### ç†æƒ³çš„åº”ç”¨åœºæ™¯


> æˆ‘è¦è·Ÿåˆ«äººä¸€èµ·å‚åŠ ç«èµ›æˆ–è€…åšé¡¹ç›®ï¼Œå¯ä»¥å‘èµ·é˜Ÿä¼æˆ–è€…åŠ å…¥åˆ«äººçš„é˜Ÿä¼



#### éœ€æ±‚åˆ†æ


+ ç”¨æˆ·å¯ä»¥ **åˆ›å»º** ä¸€ä¸ªé˜Ÿä¼ï¼Œè®¾ç½®é˜Ÿä¼çš„äººæ•°ã€é˜Ÿä¼åç§°ï¼ˆæ ‡é¢˜ï¼‰ã€æè¿°ã€è¶…æ—¶æ—¶é—´ P0  
  èŠå¤©ï¼Ÿ
+ é˜Ÿé•¿ã€å‰©ä½™çš„äººæ•°
+ å…¬å¼€ æˆ– private æˆ–åŠ å¯†
+ **ç”¨æˆ·åˆ›å»ºé˜Ÿä¼æœ€å¤š 5 ä¸ª**
+ å±•ç¤ºé˜Ÿä¼åˆ—è¡¨ï¼Œæ ¹æ®åç§°æœç´¢é˜Ÿä¼ P0ï¼Œä¿¡æ¯æµä¸­ä¸å±•ç¤ºå·²è¿‡æœŸçš„é˜Ÿä¼
+ ä¿®æ”¹é˜Ÿä¼ä¿¡æ¯ P0 ~ P1
+ ç”¨æˆ·å¯ä»¥åŠ å…¥é˜Ÿä¼ï¼ˆå…¶ä»–äººã€æœªæ»¡ã€æœªè¿‡æœŸï¼‰ï¼Œå…è®¸åŠ å…¥å¤šä¸ªé˜Ÿä¼ï¼Œä½†æ˜¯è¦æœ‰ä¸ªä¸Šé™ P0
+ æ˜¯å¦éœ€è¦é˜Ÿé•¿åŒæ„ï¼Ÿç­›é€‰å®¡æ‰¹ï¼Ÿ
+ ç”¨æˆ·å¯ä»¥é€€å‡ºé˜Ÿä¼ï¼ˆå¦‚æœé˜Ÿé•¿é€€å‡ºï¼Œæƒé™è½¬ç§»ç»™ç¬¬äºŒæ—©åŠ å…¥çš„ç”¨æˆ· â€”â€” å…ˆæ¥ååˆ°ï¼‰ P1
+ é˜Ÿé•¿å¯ä»¥è§£æ•£é˜Ÿä¼ P0

---

åˆ†äº«é˜Ÿä¼ =ã€‹ é‚€è¯·å…¶ä»–ç”¨æˆ·åŠ å…¥é˜Ÿä¼ P1  
ä¸šåŠ¡æµç¨‹ï¼š



1. ç”Ÿæˆåˆ†äº«é“¾æ¥ï¼ˆåˆ†äº«äºŒç»´ç ï¼‰
2. ç”¨æˆ·è®¿é—®é“¾æ¥ï¼Œå¯ä»¥ç‚¹å‡»åŠ å…¥



é˜Ÿä¼äººæ»¡åå‘é€æ¶ˆæ¯é€šçŸ¥ P1



#### ç³»ç»Ÿï¼ˆæ¥å£ï¼‰è®¾è®¡


##### 1ã€åˆ›å»ºé˜Ÿä¼

ç”¨æˆ·å¯ä»¥ **åˆ›å»º** ä¸€ä¸ªé˜Ÿä¼ï¼Œè®¾ç½®é˜Ÿä¼çš„äººæ•°ã€é˜Ÿä¼åç§°ï¼ˆæ ‡é¢˜ï¼‰ã€æè¿°ã€è¶…æ—¶æ—¶é—´ P0  
é˜Ÿé•¿ã€å‰©ä½™çš„äººæ•°  
èŠå¤©ï¼Ÿ  
å…¬å¼€ æˆ– private æˆ–åŠ å¯†  
ä¿¡æ¯æµä¸­ä¸å±•ç¤ºå·²è¿‡æœŸçš„é˜Ÿä¼



1. è¯·æ±‚å‚æ•°æ˜¯å¦ä¸ºç©ºï¼Ÿ
2. æ˜¯å¦ç™»å½•ï¼Œæœªç™»å½•ä¸å…è®¸åˆ›å»º
3. æ ¡éªŒä¿¡æ¯ 
   1. é˜Ÿä¼äººæ•° > 1 ä¸” <= 20
   2. é˜Ÿä¼æ ‡é¢˜ <= 20
   3. æè¿° <= 512
   4. status æ˜¯å¦å…¬å¼€ï¼ˆintï¼‰ä¸ä¼ é»˜è®¤ä¸º 0ï¼ˆå…¬å¼€ï¼‰
   5. å¦‚æœ status æ˜¯åŠ å¯†çŠ¶æ€ï¼Œä¸€å®šè¦æœ‰å¯†ç ï¼Œä¸”å¯†ç  <= 32
   6. è¶…æ—¶æ—¶é—´ > å½“å‰æ—¶é—´
   7. æ ¡éªŒç”¨æˆ·æœ€å¤šåˆ›å»º 5 ä¸ªé˜Ÿä¼
4. æ’å…¥é˜Ÿä¼ä¿¡æ¯åˆ°é˜Ÿä¼è¡¨
5. æ’å…¥ç”¨æˆ· => é˜Ÿä¼å…³ç³»åˆ°å…³ç³»è¡¨



##### 2ã€æŸ¥è¯¢é˜Ÿä¼åˆ—è¡¨


åˆ†é¡µå±•ç¤ºé˜Ÿä¼åˆ—è¡¨ï¼Œæ ¹æ®åç§°ã€æœ€å¤§äººæ•°ç­‰æœç´¢é˜Ÿä¼ P0ï¼Œä¿¡æ¯æµä¸­ä¸å±•ç¤ºå·²è¿‡æœŸçš„é˜Ÿä¼



1. ä»è¯·æ±‚å‚æ•°ä¸­å–å‡ºé˜Ÿä¼åç§°ç­‰æŸ¥è¯¢æ¡ä»¶ï¼Œå¦‚æœå­˜åœ¨åˆ™ä½œä¸ºæŸ¥è¯¢æ¡ä»¶
2. ä¸å±•ç¤ºå·²è¿‡æœŸçš„é˜Ÿä¼ï¼ˆæ ¹æ®è¿‡æœŸæ—¶é—´ç­›é€‰ï¼‰
3. å¯ä»¥é€šè¿‡æŸä¸ª**å…³é”®è¯**åŒæ—¶å¯¹åç§°å’Œæè¿°æŸ¥è¯¢
4. **åªæœ‰ç®¡ç†å‘˜æ‰èƒ½æŸ¥çœ‹åŠ å¯†è¿˜æœ‰éå…¬å¼€çš„æˆ¿é—´**
5. å…³è”æŸ¥è¯¢å·²åŠ å…¥é˜Ÿä¼çš„ç”¨æˆ·ä¿¡æ¯
6. **å…³è”æŸ¥è¯¢å·²åŠ å…¥é˜Ÿä¼çš„ç”¨æˆ·ä¿¡æ¯ï¼ˆå¯èƒ½ä¼šå¾ˆè€—è´¹æ€§èƒ½ï¼Œå»ºè®®å¤§å®¶ç”¨è‡ªå·±å†™ SQL çš„æ–¹å¼å®ç°ï¼‰**



**å®ç°æ–¹å¼**  
1ï¼‰è‡ªå·±å†™ SQL



```plain
// 1. è‡ªå·±å†™ SQL
// æŸ¥è¯¢é˜Ÿä¼å’Œåˆ›å»ºäººçš„ä¿¡æ¯
// select * from team t left join user u on t.userId = u.id
// æŸ¥è¯¢é˜Ÿä¼å’Œå·²åŠ å…¥é˜Ÿä¼æˆå‘˜çš„ä¿¡æ¯
// select *
// from team t
// Â  Â  Â  Â  left join user_team ut on t.id = ut.teamId
// Â  Â  Â  Â  left join user u on ut.userId = u.id;
```



##### 3. ä¿®æ”¹é˜Ÿä¼ä¿¡æ¯


1. åˆ¤æ–­è¯·æ±‚å‚æ•°æ˜¯å¦ä¸ºç©º
2. æŸ¥è¯¢é˜Ÿä¼æ˜¯å¦å­˜åœ¨
3. åªæœ‰ç®¡ç†å‘˜æˆ–è€…é˜Ÿä¼çš„åˆ›å»ºè€…å¯ä»¥ä¿®æ”¹
4. å¦‚æœç”¨æˆ·ä¼ å…¥çš„æ–°å€¼å’Œè€å€¼ä¸€è‡´ï¼Œå°±ä¸ç”¨ update äº†ï¼ˆå¯è‡ªè¡Œå®ç°ï¼Œé™ä½æ•°æ®åº“ä½¿ç”¨æ¬¡æ•°ï¼‰
5. **å¦‚æœé˜Ÿä¼çŠ¶æ€æ”¹ä¸ºåŠ å¯†ï¼Œå¿…é¡»è¦æœ‰å¯†ç **
6. æ›´æ–°æˆåŠŸ



##### 4. ç”¨æˆ·å¯ä»¥åŠ å…¥é˜Ÿä¼


å…¶ä»–äººã€æœªæ»¡ã€æœªè¿‡æœŸï¼Œå…è®¸åŠ å…¥å¤šä¸ªé˜Ÿä¼ï¼Œä½†æ˜¯è¦æœ‰ä¸ªä¸Šé™ P0



1. ç”¨æˆ·æœ€å¤šåŠ å…¥ 5 ä¸ªé˜Ÿä¼
2. é˜Ÿä¼å¿…é¡»å­˜åœ¨ï¼Œåªèƒ½åŠ å…¥æœªæ»¡ã€æœªè¿‡æœŸçš„é˜Ÿä¼
3. ä¸èƒ½åŠ å…¥è‡ªå·±çš„é˜Ÿä¼ï¼Œä¸èƒ½é‡å¤åŠ å…¥å·²åŠ å…¥çš„é˜Ÿä¼ï¼ˆå¹‚ç­‰æ€§ï¼‰
4. ç¦æ­¢åŠ å…¥ç§æœ‰çš„é˜Ÿä¼
5. å¦‚æœåŠ å…¥çš„é˜Ÿä¼æ˜¯åŠ å¯†çš„ï¼Œå¿…é¡»å¯†ç åŒ¹é…æ‰å¯ä»¥
6. æ–°å¢é˜Ÿä¼ - ç”¨æˆ·å…³è”ä¿¡æ¯



**æ³¨æ„ï¼Œä¸€å®šè¦åŠ ä¸Šäº‹åŠ¡æ³¨è§£ï¼ï¼ï¼ï¼**



##### 5. ç”¨æˆ·å¯ä»¥é€€å‡ºé˜Ÿä¼


è¯·æ±‚å‚æ•°ï¼šé˜Ÿä¼ id



1. æ ¡éªŒè¯·æ±‚å‚æ•°
2. æ ¡éªŒé˜Ÿä¼æ˜¯å¦å­˜åœ¨
3. æ ¡éªŒæˆ‘æ˜¯å¦å·²åŠ å…¥é˜Ÿä¼
4. å¦‚æœé˜Ÿä¼ 
   1. åªå‰©ä¸€äººï¼Œé˜Ÿä¼è§£æ•£
   2. è¿˜æœ‰å…¶ä»–äºº 
      1. å¦‚æœæ˜¯é˜Ÿé•¿é€€å‡ºé˜Ÿä¼ï¼Œæƒé™è½¬ç§»ç»™ç¬¬äºŒæ—©åŠ å…¥çš„ç”¨æˆ· â€”â€” å…ˆæ¥ååˆ°åªç”¨å– id æœ€å°çš„ 2 æ¡æ•°æ®
      2. éé˜Ÿé•¿ï¼Œè‡ªå·±é€€å‡ºé˜Ÿä¼



##### 6. é˜Ÿé•¿å¯ä»¥è§£æ•£é˜Ÿä¼


è¯·æ±‚å‚æ•°ï¼šé˜Ÿä¼ id  
ä¸šåŠ¡æµç¨‹ï¼š



1. æ ¡éªŒè¯·æ±‚å‚æ•°
2. æ ¡éªŒé˜Ÿä¼æ˜¯å¦å­˜åœ¨
3. æ ¡éªŒä½ æ˜¯ä¸æ˜¯é˜Ÿä¼çš„é˜Ÿé•¿
4. ç§»é™¤æ‰€æœ‰åŠ å…¥é˜Ÿä¼çš„å…³è”ä¿¡æ¯
5. åˆ é™¤é˜Ÿä¼



##### 7. è·å–å½“å‰ç”¨æˆ·å·²åŠ å…¥çš„é˜Ÿä¼


##### 8. è·å–å½“å‰ç”¨æˆ·åˆ›å»ºçš„é˜Ÿä¼


å¤ç”¨ listTeam æ–¹æ³•ï¼Œåªæ–°å¢æŸ¥è¯¢æ¡ä»¶ï¼Œä¸åšä¿®æ”¹ï¼ˆå¼€é—­åŸåˆ™ï¼‰

---

#### äº‹åŠ¡æ³¨è§£

[@Transactional(rollbackFor ](/Transactional(rollbackFor ) = Exception.class)   
è¦ä¹ˆæ•°æ®æ“ä½œéƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½å¤±è´¥



### æ•°æ®åº“è¡¨è®¾è®¡

é˜Ÿä¼è¡¨ team  
å­—æ®µï¼š



+ id ä¸»é”® bigintï¼ˆæœ€ç®€å•ã€è¿ç»­ï¼Œæ”¾ url ä¸Šæ¯”è¾ƒç®€çŸ­ï¼Œä½†ç¼ºç‚¹æ˜¯çˆ¬è™«ï¼‰
+ name é˜Ÿä¼åç§°
+ description æè¿°
+ maxNum æœ€å¤§äººæ•°
+ expireTime è¿‡æœŸæ—¶é—´
+ userId åˆ›å»ºäºº id
+ status 0 - å…¬å¼€ï¼Œ1 - ç§æœ‰ï¼Œ2 - åŠ å¯†
+ password å¯†ç 
+ createTime åˆ›å»ºæ—¶é—´
+ updateTime æ›´æ–°æ—¶é—´
+ isDelete æ˜¯å¦åˆ é™¤



```sql
-- é˜Ÿä¼è¡¨
create table team
(
    id          bigint auto_increment comment 'id' primary key,
    name        varchar(256)                       not null comment 'é˜Ÿä¼åç§°',
    description varchar(1024)                      null comment 'é˜Ÿä¼æè¿°',
    maxNum      int      default 1                 not null comment 'æœ€å¤§äººæ•°',
    expireTime  datetime                           null comment 'è¿‡æœŸæ—¶é—´',
    userId      bigint comment 'é˜Ÿé•¿id',
    status      int      default 0                 not null comment 'é˜Ÿä¼çŠ¶æ€: 0-å…¬å¼€ 1-ç§æœ‰ 2-åŠ å¯†',
    password    varchar(512)                       null comment 'é˜Ÿä¼å¯†ç ',
    createTime  datetime default CURRENT_TIMESTAMP null comment 'åˆ›å»ºæ—¶é—´',
    updateTime  datetime default CURRENT_TIMESTAMP null on update CURRENT_TIMESTAMP comment 'ä¿®æ”¹æ—¶é—´',
    idDelete    tinyint  default 0                 not null comment 'æ˜¯å¦åˆ é™¤'
) comment 'é˜Ÿä¼';
```



ç”¨æˆ· - é˜Ÿä¼è¡¨ user_team  
å­—æ®µï¼š



+ id ä¸»é”®
+ userId ç”¨æˆ· id
+ teamId é˜Ÿä¼ id
+ joinTime åŠ å…¥æ—¶é—´
+ createTime åˆ›å»ºæ—¶é—´
+ updateTime æ›´æ–°æ—¶é—´
+ isDelete æ˜¯å¦åˆ é™¤



```sql
create table user_team
(
    id         bigint auto_increment comment 'id' primary key,
    userId     bigint comment 'ç”¨æˆ·id',
    teamId     bigint comment 'é˜Ÿä¼id',
    joinTime   datetime                           null comment 'åŠ å…¥æ—¶é—´',
    createTime datetime default CURRENT_TIMESTAMP null comment 'åˆ›å»ºæ—¶é—´',
    updateTime datetime default CURRENT_TIMESTAMP null on update CURRENT_TIMESTAMP,
    isDelete   tinyint  default 0                 not null comment 'æ˜¯å¦åˆ é™¤'
) comment 'ç”¨æˆ·é˜Ÿä¼å…³ç³»';
```



ä¸¤ä¸ªå…³ç³»ï¼š



1. ç”¨æˆ·åŠ äº†å“ªäº›é˜Ÿä¼ï¼Ÿ
2. é˜Ÿä¼æœ‰å“ªäº›ç”¨æˆ·ï¼Ÿ



æ–¹å¼ï¼š



1. å»ºç«‹ç”¨æˆ· - é˜Ÿä¼å…³ç³»è¡¨ teamId userIdï¼ˆä¾¿äºä¿®æ”¹ï¼ŒæŸ¥è¯¢æ€§èƒ½é«˜ä¸€ç‚¹ï¼Œå¯ä»¥é€‰æ‹©è¿™ä¸ªï¼Œä¸ç”¨å…¨è¡¨éå†ï¼‰
2. ç”¨æˆ·è¡¨è¡¥å……å·²åŠ å…¥çš„é˜Ÿä¼å­—æ®µï¼Œé˜Ÿä¼è¡¨è¡¥å……å·²åŠ å…¥çš„ç”¨æˆ·å­—æ®µï¼ˆä¾¿äºæŸ¥è¯¢ï¼Œä¸ç”¨å†™å¤šå¯¹å¤šçš„ä»£ç ï¼Œå¯ä»¥ç›´æ¥æ ¹æ®é˜Ÿä¼æŸ¥ç”¨æˆ·ã€æ ¹æ®ç”¨æˆ·æŸ¥é˜Ÿä¼ï¼‰



#### ä¸ºä»€ä¹ˆéœ€è¦è¯·æ±‚å‚æ•°åŒ…è£…ç±»ï¼Ÿ


1. è¯·æ±‚å‚æ•°åç§° / ç±»å‹å’Œå®ä½“ç±»ä¸ä¸€æ ·
2. æœ‰ä¸€äº›å‚æ•°ç”¨ä¸åˆ°ï¼Œå¦‚æœè¦è‡ªåŠ¨ç”Ÿæˆæ¥å£æ–‡æ¡£ï¼Œä¼šå¢åŠ ç†è§£æˆæœ¬
3. å¯¹ä¸ªå®ä½“ç±»æ˜ å°„åˆ°åŒä¸€ä¸ªå¯¹è±¡



#### ä¸ºä»€ä¹ˆéœ€è¦åŒ…è£…ç±»ï¼Ÿ


å¯èƒ½æœ‰äº›å­—æ®µéœ€è¦éšè—ï¼Œä¸èƒ½è¿”å›ç»™å‰ç«¯  
æˆ–è€…æœ‰äº›å­—æ®µæŸäº›æ–¹æ³•æ˜¯ä¸å…³å¿ƒçš„



#### å®ç°


åº“è¡¨è®¾è®¡ 5 - 10min  
å¢åˆ æ”¹æŸ¥ 5 - 10 min  
ä¸šåŠ¡é€»è¾‘å¼€å‘ï¼ˆP0ï¼‰30 min



# ä¸€ã€æ•°æ®åº“å»ºè¡¨


å¤åˆ¶ä¸‹åˆ—ddlå»ºè¡¨è¯­å¥ï¼Œåˆ°ideaé‡Œé¢å»ºè¡¨



```sql
-- é˜Ÿä¼è¡¨
create table team
(
    id          bigint auto_increment comment 'id' primary key,
    name        varchar(256)       not null comment 'é˜Ÿä¼åç§°',
    description varchar(1024) null comment 'æè¿°',
    maxNum      int      default 1 not null comment 'æœ€å¤§äººæ•°',
    expireTime  datetime null comment 'è¿‡æœŸæ—¶é—´',
    userId      bigint comment 'ç”¨æˆ·idï¼ˆé˜Ÿé•¿ idï¼‰',,
    status      int      default 0 not null comment '0 - å…¬å¼€ï¼Œ1 - ç§æœ‰ï¼Œ2 - åŠ å¯†',
    password    varchar(512) null comment 'å¯†ç ',
    createTime  datetime default CURRENT_TIMESTAMP null comment 'åˆ›å»ºæ—¶é—´',
    updateTime  datetime default CURRENT_TIMESTAMP null on update CURRENT_TIMESTAMP,
    isDelete    tinyint  default 0 not null comment 'æ˜¯å¦åˆ é™¤'
) comment 'é˜Ÿä¼';

-- ç”¨æˆ·é˜Ÿä¼å…³ç³»
create table user_team
(
    id         bigint auto_increment comment 'id'
        primary key,
    userId     bigint comment 'ç”¨æˆ·id',
    teamId     bigint comment 'é˜Ÿä¼id',
    joinTime   datetime null comment 'åŠ å…¥æ—¶é—´',
    createTime datetime default CURRENT_TIMESTAMP null comment 'åˆ›å»ºæ—¶é—´',
    updateTime datetime default CURRENT_TIMESTAMP null on update CURRENT_TIMESTAMP,
    isDelete   tinyint  default 0 not null comment 'æ˜¯å¦åˆ é™¤'
) comment 'ç”¨æˆ·é˜Ÿä¼å…³ç³»';
```



æ˜¾ç¤ºçš„è¡¨æ ¼å¦‚ä¸‹ï¼ˆtagè¡¨ä»¥å‰å»ºè¿‡ï¼Œè¿™æœŸå¥½åƒé±¼çš®å¿˜è®°äº†ï¼Œæš‚æ—¶ä¸è¦åˆ ï¼‰:  
![1669029516199-329542be-dbd0-49af-aaba-bda84287ab12.png](./assets/09åç«¯é˜Ÿä¼å¼€å‘/1669029516199-329542be-dbd0-49af-aaba-bda84287ab12-613622-1730856009659-17.png)  
ä½¿ç”¨MybatisX-Generatorç”Ÿæˆdomainï¼Œserviceå’Œmapperæ–‡ä»¶ï¼Œç„¶åæŠŠç”Ÿæˆçš„æ–‡ä»¶éƒ½ç§»åˆ°å¯¹åº”çš„ç›®å½•é‡Œé¢ï¼Œåˆ«å¿˜äº†æŠŠmapper.xmlé‡Œçš„è·¯å¾„æ”¹æˆè‡ªå·±å¯¹åº”çš„ã€‚



> å¦‚æœç›´æ¥å°†ç”Ÿæˆçš„æ–‡ä»¶æ‹‰åˆ°å¯¹åº”çš„æ–‡ä»¶ï¼Œå°±ä¼šè‡ªåŠ¨ä¿®æ”¹mapper.xmlçš„è·¯å¾„



PSï¼šåˆ«å¿˜äº†åœ¨teamå’Œuser_teamç±»ä¸­çš„is_deleteå­—æ®µæ·»åŠ @TableLogicæ³¨è§£ï¼Œå®ç°é€»è¾‘åˆ é™¤  
![1669035445564-51eba902-c44b-45c2-833d-f257b8a1c022.png](./assets/09åç«¯é˜Ÿä¼å¼€å‘/1669035445564-51eba902-c44b-45c2-833d-f257b8a1c022-614375-1730856009659-18.png)



# äºŒã€ç¼–å†™æ¥å£ï¼ˆTeamControllerï¼‰


### 1.å¤åˆ¶UserControllerå¹¶é‡å‘½åä¸ºTeamControllerä¿®æ”¹æ•´ç†ä¸ºï¼š


![1669036985257-18a4e0b7-d566-47bc-98ee-9813c6cc7cd0.png](./assets/09åç«¯é˜Ÿä¼å¼€å‘/1669036985257-18a4e0b7-d566-47bc-98ee-9813c6cc7cd0-584940-1730856009659-19.png)



### 2.ç¼–å†™å…·ä½“çš„æ¥å£


```java
    @PostMapping("/add")
    public BaseResponse<Long> addTeam(@RequestBody Team team) {
        if (team == null) {
            throw new BusinessException(ErrorCode.PARAMS_ERROR);
        }
        boolean save = teamService.save(team);
        if (!save) {
            throw new BusinessException(ErrorCode.SYSTEM_ERROR, "æ’å…¥å¤±è´¥");
        }
        return ResultUtils.success(team.getId());
    }

    @PostMapping("/delete")
    public BaseResponse<Boolean> deleteTeam(@RequestBody long id) {
        if (id <= 0) {
            throw new BusinessException(ErrorCode.PARAMS_ERROR);
        }
        boolean result = teamService.removeById(id);
        if (!result) {
            throw new BusinessException(ErrorCode.SYSTEM_ERROR, "åˆ é™¤å¤±è´¥");
        }
        return ResultUtils.success(true);
    }

    @PostMapping("/update")
    public BaseResponse<Boolean> updateTeam(@RequestBody Team team) {
        if (team == null) {
            throw new BusinessException(ErrorCode.PARAMS_ERROR);
        }
        boolean result = teamService.updateById(team);
        if (!result) {
            throw new BusinessException(ErrorCode.SYSTEM_ERROR, "æ›´æ–°å¤±è´¥");
        }
        return ResultUtils.success(true);
    }

    @GetMapping("/get")
    public BaseResponse<Team> getTeamById(@RequestBody long id) {
        if (id <= 0) {
            throw new BusinessException(ErrorCode.PARAMS_ERROR);
        }
        Team team = teamService.getById(id);
        if (team == null) {
            throw new BusinessException(ErrorCode.NULL_ERROR);
        }
        return ResultUtils.success(team);
    }
```



#### è¿™è¾¹æˆ‘ä»¬éœ€è¦æ–°å»ºè¯·æ±‚å‚æ•°åŒ…è£…ç±»å’ŒåŒ…è£…ç±»ï¼ŒåŸå› å¦‚ä¸‹ï¼š


##### ä¸ºä»€ä¹ˆéœ€è¦è¯·æ±‚å‚æ•°åŒ…è£…ç±»ï¼Ÿ


1. è¯·æ±‚å‚æ•°åç§° / ç±»å‹å’Œå®ä½“ç±»ä¸ä¸€æ ·
2. æœ‰ä¸€äº›å‚æ•°ç”¨ä¸åˆ°ï¼Œå¦‚æœè¦è‡ªåŠ¨ç”Ÿæˆæ¥å£æ–‡æ¡£ï¼Œä¼šå¢åŠ ç†è§£æˆæœ¬
3. å¯¹ä¸ªå®ä½“ç±»æ˜ å°„åˆ°åŒä¸€ä¸ªå¯¹è±¡



##### ä¸ºä»€ä¹ˆéœ€è¦åŒ…è£…ç±»ï¼Ÿ

å¯èƒ½æœ‰äº›å­—æ®µéœ€è¦éšè—ï¼Œä¸èƒ½è¿”å›ç»™å‰ç«¯  
æˆ–è€…æœ‰äº›å­—æ®µæŸäº›æ–¹æ³•æ˜¯ä¸å…³å¿ƒçš„



åœ¨modelåŒ…é‡Œæ–°å»ºä¸€ä¸ªdtoåŒ…ï¼Œå†™ä¸€ä¸ªåŒ…è£…ç±»TeamQuery



```java
@Data
public class TeamQuery {
    /**
     * id
     */
    private Long id;

    /**
     * é˜Ÿä¼åç§°
     */
    private String name;

    /**
     * æè¿°
     */
    private String description;

    /**
     * æœ€å¤§äººæ•°
     */
    private Integer maxNum;

    /**
     * ç”¨æˆ·id
     */
    private Long userId;

    /**
     * 0 - å…¬å¼€ï¼Œ1 - ç§æœ‰ï¼Œ2 - åŠ å¯†
     */
    private Integer status;
}
```



åœ¨commonåŒ…ä¸‹æ–°å»ºåˆ†é¡µè¯·æ±‚å‚æ•°åŒ…è£…ç±»



```java
@Data
public class PageRequest implements Serializable {

    private static final long serialVersionUID = -4162304142710323660L;

    /**
     * é¡µé¢å¤§å°
     */
    protected int pageSize;

    /**
     * å½“å‰æ˜¯ç¬¬å‡ é¡µ
     */
    protected int pageNum;
}
```



åŒæ—¶åœ¨TeamQueryä¸Šç»§æ‰¿è¿™ä¸ªåˆ†é¡µè¯·æ±‚ï¼Œåé¢æ¥å£ä¼šç”¨ä¸Š



![1669043616940-764ff5dc-2a09-4679-93cd-d81e8a1a6fb9.png](./assets/09åç«¯é˜Ÿä¼å¼€å‘/1669043616940-764ff5dc-2a09-4679-93cd-d81e8a1a6fb9-185684-1730856009659-20.png)



#### ç»§ç»­ç¼–å†™æ¥å£


```java
@GetMapping("/list")
    public BaseResponse<List<Team>> listTeams(TeamQuery teamQuery){
        if (teamQuery == null){
            throw new BusinessException(ErrorCode.PARAMS_ERROR);
        }
        Team team = new Team();
        BeanUtils.copyProperties(team,teamQuery);
        QueryWrapper<Team> queryWrapper = new QueryWrapper<>(team);
        List<Team> teamList = teamService.list(queryWrapper);
        return ResultUtils.success(teamList);
    }

    @GetMapping("/list/page")
    public BaseResponse<Page<Team>> listTeamsByPage(TeamQuery teamQuery){
        if (teamQuery == null){
            throw new BusinessException(ErrorCode.PARAMS_ERROR);
        }
        Team team = new Team();
        BeanUtils.copyProperties(team,teamQuery);
        Page<Team> page = new Page<>(teamQuery.getPageNum(),teamQuery.getPageSize());
        QueryWrapper<Team> queryWrapper = new QueryWrapper<>(team);
        Page<Team> resultPage = teamService.page(page, queryWrapper);
        return ResultUtils.success(resultPage);
    }
```



> è¸©å‘å¤„ï¼šæ³¨æ„Pageå¯¼å…¥çš„æ˜¯mybatisplusï¼Œè€Œä¸æ˜¯springbootè‡ªå¸¦çš„é‚£ä¸ª



#### åˆ©ç”¨knife4jæµ‹è¯•æ¥å£


é¦–å…ˆæ’å…¥10æ¡æ•°æ®  
![1669045566376-5a782cd3-b647-48bf-b3a3-4408282b4a6d.png](./assets/09åç«¯é˜Ÿä¼å¼€å‘/1669045566376-5a782cd3-b647-48bf-b3a3-4408282b4a6d-677724-1730856009659-21.png)



listå±•ç°é˜Ÿä¼ä¿¡æ¯ï¼Œç¡®å®æ˜¯æœ‰10æ¡  
![1669045650137-c13b014f-b601-4435-a06c-1cad56238458.png](./assets/09åç«¯é˜Ÿä¼å¼€å‘/1669045650137-c13b014f-b601-4435-a06c-1cad56238458-346024-1730856009660-22.png)  
åˆ†é¡µæŸ¥è¯¢ï¼šè®¾ç½®æ¯é¡µåªæ˜¾ç¤ºä¸¤æ¡  
![1669045744972-984d6497-abe7-44ba-8385-c04c8958f26b.png](./assets/09åç«¯é˜Ÿä¼å¼€å‘/1669045744972-984d6497-abe7-44ba-8385-c04c8958f26b-604852-1730856009660-23.png)  
åˆ†é¡µæŸ¥è¯¢ï¼šè®¾ç½®æ¯é¡µåªæ˜¾ç¤ºä¸¤æ¡ï¼ˆç¬¬äºŒé¡µï¼‰  
![1669045804286-b335e040-9f12-4fb4-b794-2991d2b83bdd.png](./assets/09åç«¯é˜Ÿä¼å¼€å‘/1669045804286-b335e040-9f12-4fb4-b794-2991d2b83bdd-634474-1730856009660-24.png)  
åˆ é™¤é˜Ÿä¼ä¿¡æ¯  
![1669045848605-16c09d27-8aad-430b-b7a5-8dcadee0062d.png](./assets/09åç«¯é˜Ÿä¼å¼€å‘/1669045848605-16c09d27-8aad-430b-b7a5-8dcadee0062d-370284-1730856009660-25.png)



### 3.ç»†åŒ–æ¥å£ï¼ˆæ ¹æ®å…·ä½“çš„éœ€æ±‚ï¼‰


#### 1.è¿™è¾¹æˆ‘ä»¬ä¼šè¿ç”¨åˆ°é˜Ÿä¼çš„çŠ¶æ€,å³å…¬å¼€ï¼Œç§æœ‰ç­‰ï¼Œæ‰€ä»¥æˆ‘ä»¬æå‰å†™ä¸€ä¸ªé˜Ÿä¼çŠ¶æ€æšä¸¾ç±»


```java
/**
 * é˜Ÿä¼çŠ¶æ€æšä¸¾
 */
public enum TeamStatusEnum {
    PUBLIC(0,"å…¬å¼€"),
    PRIVATE(1,"ç§æœ‰"),
    SECRET(2,"åŠ å¯†");

    private int value;
    private String text;

    public static TeamStatusEnum getEnumByValue(Integer value){
        if (value == null){
            return null;
        }
        TeamStatusEnum[] values = TeamStatusEnum.values();
        for (TeamStatusEnum teamStatusEnum: values){
            if (teamStatusEnum.getValue()==value){
                return teamStatusEnum;
            }
        }
        return null;
    }

    TeamStatusEnum(int value, String text) {
        this.value = value;
        this.text = text;
    }

    public int getValue() {
        return value;
    }

    public void setValue(int value) {
        this.value = value;
    }

    public String getText() {
        return text;
    }

    public void setText(String text) {
        this.text = text;
    }
}
```



#### 2.æ­£å¼å¼€å§‹ç»†åŒ–æ¥å£

åœ¨TeamServiceé‡Œå†™å…¥  
long addTeam(Team team, User loginUser); å¹¶åœ¨TeamServiceImplå®ç°è¿™ä¸ªæ–¹æ³•  
TeamServiceImplé‡Œä»£ç æ•´ç†å¦‚ä¸‹ï¼š



```java
@Service
public class TeamServiceImpl extends ServiceImpl<TeamMapper, Team>
        implements TeamService {

    @Resource
    private UserTeamService userTeamService;

    @Override
    @Transactional(rollbackFor = Exception.class)
    public long addTeam(Team team, User loginUser) {
        //1.è¯·æ±‚å‚æ•°æ˜¯å¦ä¸ºç©º
        if (team == null) {
            throw new BusinessException(ErrorCode.PARAMS_ERROR);
        }
        //2.æ˜¯å¦ç™»å½•ï¼Œæœªç™»å½•ä¸å…è®¸åˆ›å»º
        if (loginUser == null) {
            throw new BusinessException(ErrorCode.NO_AUTH);
        }
        final long userId = loginUser.getId();
        //3.æ£€éªŒä¿¡æ¯
        //(1).é˜Ÿä¼äººæ•°>1ä¸”<=20
        int maxNum = Optional.ofNullable(team.getMaxNum()).orElse(0);//å¦‚æœä¸ºç©ºï¼Œç›´æ¥èµ‹å€¼ä¸º0
        if (maxNum < 1 || maxNum > 20) {
            throw new BusinessException(ErrorCode.PARAMS_ERROR, "é˜Ÿä¼äººæ•°ä¸æ»¡è¶³è¦æ±‚");
        }
        //(2).é˜Ÿä¼æ ‡é¢˜ <=20
        String name = team.getName();
        if (StringUtils.isBlank(name) || name.length() > 20) {
            throw new BusinessException(ErrorCode.PARAMS_ERROR, "é˜Ÿä¼æ ‡é¢˜ä¸æ»¡è¶³è¦æ±‚");
        }
        // 3. æè¿°<= 512
        String description = team.getDescription();
        if (StringUtils.isNotBlank(description) && description.length() > 512) {
            throw new BusinessException(ErrorCode.PARAMS_ERROR, "é˜Ÿä¼æè¿°è¿‡é•¿");
        }
        //4.status æ˜¯å¦å…¬å¼€ï¼Œä¸ä¼ é»˜è®¤ä¸º0
        int status = Optional.ofNullable(team.getStatus()).orElse(0);
        TeamStatusEnum statusEnum = TeamStatusEnum.getEnumByValue(status);
        if (statusEnum == null) {
            throw new BusinessException(ErrorCode.PARAMS_ERROR, "é˜Ÿä¼çŠ¶æ€ä¸æ»¡è¶³è¦æ±‚");
        }

        //5.å¦‚æœstatusæ˜¯åŠ å¯†çŠ¶æ€ï¼Œä¸€å®šè¦å¯†ç  ä¸”å¯†ç <=32
        String password = team.getPassword();
        if (TeamStatusEnum.SECRET.equals(statusEnum)) {
            if (StringUtils.isBlank(password) || password.length() > 32) {
                throw new BusinessException(ErrorCode.PARAMS_ERROR, "å¯†ç è®¾ç½®ä¸æ­£ç¡®");
            }
        }
        //6.è¶…å‡ºæ—¶é—´ > å½“å‰æ—¶é—´
        Date expireTime = team.getExpireTime();
        if (new Date().after(expireTime)) {
            throw new BusinessException(ErrorCode.PARAMS_ERROR, "è¶…å‡ºæ—¶é—´ > å½“å‰æ—¶é—´");
        }

        //7.æ ¡éªŒç”¨æˆ·æœ€å¤šåˆ›å»º5ä¸ªé˜Ÿä¼
        //todo æœ‰bugã€‚å¯èƒ½åŒæ—¶åˆ›å»º100ä¸ªé˜Ÿä¼
        QueryWrapper<Team> queryWrapper = new QueryWrapper<>();
        queryWrapper.eq("userId", userId);
        long hasTeamNum = this.count(queryWrapper);
        if (hasTeamNum >= 5) {
            throw new BusinessException(ErrorCode.PARAMS_ERROR, "ç”¨æˆ·æœ€å¤šåˆ›å»º5ä¸ªé˜Ÿä¼");
        }
        //8.æ’å…¥é˜Ÿä¼æ¶ˆæ¯åˆ°é˜Ÿä¼è¡¨
        team.setId(null);
        team.setUserId(userId);
        boolean result = this.save(team);
        Long teamId = team.getId();
        if (!result || team == null) {	
            throw new BusinessException(ErrorCode.PARAMS_ERROR, "åˆ›å»ºé˜Ÿä¼å¤±è´¥");
        }
        //9. æ’å…¥ç”¨æˆ· ==> é˜Ÿä¼å…³ç³» åˆ°å…³ç³»è¡¨
        UserTeam userTeam = new UserTeam();
        userTeam.setTeamId(userId);
        userTeam.setTeamId(teamId);
        userTeam.setJoinTime(new Date());
        result = userTeamService.save(userTeam);
        if (!result) {
            throw new BusinessException(ErrorCode.PARAMS_ERROR, "åˆ›å»ºé˜Ÿä¼å¤±è´¥");
        }
        return teamId;
    }
```



#### 3.ä¼˜åŒ–å®Œæˆæ§åˆ¶å±‚


è¿™é‡Œæˆ‘ä»¬å› ä¸ºå®Œå–„äº†ä¸šåŠ¡å±‚ï¼Œæ‰€ä»¥åœ¨controllerå±‚å¯ä»¥ç®€ä¾¿ä¸‹ä»£ç ï¼Œæˆ‘ä»¬éœ€è¦æ–°å»ºä¸€ä¸ªé˜Ÿä¼æ·»åŠ è¯·æ±‚å°è£…ç±»ï¼ˆä¾¿äºå‰ç«¯çŸ¥é“è¯¥è¾“å…¥å“ªäº›å‚æ•°ï¼‰ Â  æ–°çš„è¯·æ±‚å°è£…ç±»ä½äºmodelåŒ…é‡Œçš„requeståŒ…



```java
@Data
public class TeamAddRequest {

    private static final long serialVersionUID = -4162304142710323660L;

    /**
     * é˜Ÿä¼åç§°
     */
    private String name;

    /**
     * æè¿°
     */
    private String description;

    /**
     * æœ€å¤§äººæ•°
     */
    private Integer maxNum;

    /**
     * è¿‡æœŸæ—¶é—´
     */
    private Date expireTime;

    /**
     * ç”¨æˆ·id
     */
    private Long userId;

    /**
     * 0 - å…¬å¼€ï¼Œ1 - ç§æœ‰ï¼Œ2 - åŠ å¯†
     */
    private Integer status;

    /**
     * å¯†ç 
     */
    private String password;
}
```



ä¿®æ”¹çš„addTeamæ¥å£å¦‚ä¸‹ï¼š



```java
    @PostMapping("/add")
    public BaseResponse<Long> addTeam(@RequestBody TeamAddRequest teamAddRequest, HttpServletRequest request) {
        if (teamAddRequest == null) {
            throw new BusinessException(ErrorCode.PARAMS_ERROR);
        }
        User loginUser = userService.getLoginUser(request);
        Team team = new Team();
        BeanUtils.copyProperties(teamAddRequest,team);
        long teamId = teamService.addTeam(team, loginUser);
        return ResultUtils.success(teamId);
    }
```



**æ³¨æ„ ï¼šBeanUtils.copyProperties(teamAddRequest,team); Â ä¸¤ä¸ªå‚æ•°çš„ä½ç½®åŸæ¥å†™é”™äº†ï¼Œç°åœ¨éœ€è¦è°ƒæ¢**  
![1669076798395-3febe007-870e-45d5-ac1a-0a52bd0762bd.png](./assets/09åç«¯é˜Ÿä¼å¼€å‘/1669076798395-3febe007-870e-45d5-ac1a-0a52bd0762bd-850589-1730856009660-26.png)



#### 4.æµ‹è¯•

å¯åŠ¨é¡¹ç›®ï¼Œå¥½åƒåˆšåˆšçš„è¯·æ±‚å‚æ•°å°è£…ç±»æ²¡èµ·ä½œç”¨ï¼ˆè¿™é‡Œè·Ÿé±¼çš®çš„ä¸€æ ·ï¼‰ï¼Œåªèƒ½è‡ªå·±åˆ é™¤å†è¾“å…¥  
![1669077516824-e103934e-48a4-4c12-9326-5c6e4c4eacaa.png](./assets/09åç«¯é˜Ÿä¼å¼€å‘/1669077516824-e103934e-48a4-4c12-9326-5c6e4c4eacaa-651216-1730856009660-27.png)  
æˆåŠŸçš„æ’å…¥  
psï¼šè¿™é‡Œè¿‡æœŸæ—¶é—´çš„è·å–å¯ä»æ§åˆ¶å°è¾“å…¥ä¸€ä¸‹ä»£ç æ¥å®ç°ï¼Œå•å•çš„è¾“å…¥å¹´æœˆæ—¥ä¼šå¯¼è‡´æ•°æ®åº“é‡Œçš„æ—¶é—´å¢åŠ 8å°æ—¶ï¼ˆåº”è¯¥æ˜¯æ—¶åŒºçš„é—®é¢˜ï¼‰  
![1669077627269-e6e0acd8-df4a-4f63-b660-c673c208a934.png](./assets/09åç«¯é˜Ÿä¼å¼€å‘/1669077627269-e6e0acd8-df4a-4f63-b660-c673c208a934-345780-1730856009660-28.png)  
å¤šæ¬¡å‘é€æ·»åŠ è¯·æ±‚ï¼Œå½“æ’å…¥5æ¬¡ä¹‹åï¼Œå†æ’å…¥ä¼šæŠ¥é”™  
![image-20241111152945551](./assets/09åç«¯é˜Ÿä¼å¼€å‘/image-20241111152945551.png)  
æµ‹è¯•äº‹åŠ¡æ˜¯å¦èµ·ä½œç”¨  
æ³¨æ„è¦åœ¨æ–¹æ³•ä¸Šæ·»åŠ å¦‚ä¸‹æ³¨è§£  
![1669079748369-f71dbe93-fab7-4ad6-bf4b-ebe313b5759f.png](./../../../../../../å­¦ä¹ æ–‡ä»¶/BaiduSyncdisk/é¡¹ç›®/é¡¹ç›®å­¦ä¹ -é±¼çš®/02-ä¼™ä¼´åŒ¹é…ç³»ç»Ÿ/ç¬”è®°-å‰¯æœ¬/img/SUvcDWc2Tz5Xpb_f/1669079748369-f71dbe93-fab7-4ad6-bf4b-ebe313b5759f-140015.png)



é¦–å…ˆæ•°æ®åº“çš„æ•°æ®åˆ è‡³4æ¡ï¼Œåˆ«å¿˜äº†æŠŠå¯¹åº”çš„ç”¨æˆ·è¡¨å…³ç³»ä¹Ÿåˆ é™¤ï¼Œä¿æŒä¸€è‡´  
ä¿®æ”¹`TeamServiceImpl`ï¼Œç›®çš„æ˜¯éª—è¿‡ç¼–è¯‘å™¨ï¼Œç›´æ¥åˆ›å»ºé˜Ÿä¼å¤±è´¥



![1669078799200-815f3b88-190d-4db8-a5ad-5cd18e61a0db.png](./../../../../../../å­¦ä¹ æ–‡ä»¶/BaiduSyncdisk/é¡¹ç›®/é¡¹ç›®å­¦ä¹ -é±¼çš®/02-ä¼™ä¼´åŒ¹é…ç³»ç»Ÿ/ç¬”è®°-å‰¯æœ¬/img/SUvcDWc2Tz5Xpb_f/1669078799200-815f3b88-190d-4db8-a5ad-5cd18e61a0db-331669.png)  
ç¨å¾®ä¿®æ”¹ä¸‹å‚æ•°ï¼Œå‘é€ï¼Œç¡®å®æŠ¥ç”¨æˆ·å…³ç³»å¤±è´¥  
![1669078696623-377c4199-2d9b-4ec5-a055-4627983dabff.png](./assets/09åç«¯é˜Ÿä¼å¼€å‘/1669078696623-377c4199-2d9b-4ec5-a055-4627983dabff-727301-1730856009660-32.png)  
æ•°æ®åº“é‡Œä¹Ÿæ²¡ç”¨å¢åŠ æ•°æ®ï¼Œè¯å®äº†äº‹åŠ¡èµ·ä½œç”¨ï¼Œæœ€ååˆ«å¿˜äº†æŠŠåˆšåˆšå¢åŠ çš„ä»£ç æ‰€åˆ é™¤ï¼ˆéª—è¿‡ç¼–è¯‘å™¨)



## ç¬¬ä¹æœŸå®Œç»“ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰


> æ›´æ–°: 2023-02-10 10:06:15  
> åŸæ–‡: <https://www.yuque.com/shierkcs/catstudy/qu9ownwhsfcfw57c>