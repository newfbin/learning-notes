# 05 ä¿®æ”¹ç”¨æˆ·æ¶ˆæ¯+ç™»å½•ç•Œé¢

ç›´æ’­å›æ”¾ï¼š<font style="color:rgba(0, 0, 0, 0.85);"> https://www.aliyundrive.com/s/XoDNanXShjN æå–ç : hv73 </font>

## é±¼çš®ç¬”è®°
1. ç”¨æˆ·ä¿®æ”¹é¡µé¢å‰ç«¯ã€åç«¯å¼€å‘å’Œè”è°ƒ



## ä¸€ã€åç«¯ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯æ¥å£

é¦–å…ˆè¿è¡Œå‰åç«¯ï¼Œçœ‹çœ‹æ˜¯å¦æ­£å¸¸



### 1.åœ¨UserControlleré‡Œé¢æ·»åŠ æ›´æ–°ç”¨æˆ·ä¿¡æ¯æ¥å£


```java
    /**
     * æ›´æ–°ç”¨æˆ·ä¿¡æ¯
     * @param user
     * @param request
     * @return
     */
    @PostMapping("/update")
    public BaseResponse<Integer> updateUser(@RequestBody User user, HttpServletRequest request) {
        // 1. æ ¡éªŒå‚æ•°æ˜¯å¦ä¸ºç©º
        if (user == null) {
            throw new BusinessException(ErrorCode.PARAMS_ERROR);
        }
        User loginUser = userService.getCurrentUser(request);
        int result = userService.updateUser(user, loginUser);
        return ResultUtils.success(result);
    }
```



ç”±äºé¡¹ç›®ä¸­å¤šæ¬¡ç”¨æˆ·é‰´æƒï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨serviceå±‚ç¼–å†™isAdminæ–¹æ³•ï¼ˆåŒ…æ‹¬å¤å†™ï¼‰  
UserService



```java

    /**
     * æ˜¯å¦ä¸ºç®¡ç†å‘˜
     * @param request
     * @return
     */
    boolean isAdmin(HttpServletRequest request);

    /**
     * æ˜¯å¦ä¸ºç®¡ç†å‘˜
     * @param loginUser
     * @return
     */
    boolean isAdmin(User loginUser);

    /**
     * è·å–å½“å‰ç”¨æˆ·
     * @param request
     * @return
     */
    User getCurrentUser(HttpServletRequest request);

    /**
     * æ›´æ–°ç”¨æˆ·ä¿¡æ¯
     * @param user
     * @param loginUser
     * @return
     */
    int updateUser(User user, User loginUser);
```



åŒæ—¶åœ¨UserServiceImplé‡Œé¢å®ç°ä¸Šè¿°æ–¹æ³•



```java
/**
     * æ›´æ–°ç”¨æˆ·ä¿¡æ¯
     * @param user
     * @param loginUser
     * @return
     */
    @Override
    public int updateUser(User user, User loginUser) {
        Long userId = user.getId();
        if (userId <= 0) {
            throw new BusinessException(ErrorCode.PARAMS_ERROR);
        }
        // 2. æ ¡éªŒæƒé™
        // 2.1 ç®¡ç†å‘˜å¯ä»¥æ›´æ–°ä»»æ„ä¿¡æ¯ã€ç”¨æˆ·åªèƒ½æ›´æ–°è‡ªå·±çš„ä¿¡æ¯
        if (!isAdmin(loginUser) && userId != loginUser.getId()) {
            throw new BusinessException(ErrorCode.NO_AUTH);
        }
        User oldUser = this.getById(user.getId());
        if (oldUser == null) {
            throw new BusinessException(ErrorCode.NULL_ERROR);
        }
        // 3. è§¦å‘æ›´æ–°
         return this.baseMapper.updateById(user);
    }

	/**
     * æ˜¯å¦ä¸ºç®¡ç†å‘˜
     * @param request
     * @return
     */
    public boolean isAdmin(HttpServletRequest request) {
        User user = (User) request.getSession().getAttribute(UserConstant.USER_LOGIN_STATE);
        if (user == null || user.getUserRole() != UserConstant.ADMIN_ROLE) {
            return false;
        }
        return true;
    }

    /**
     * æ˜¯å¦ä¸ºç®¡ç†å‘˜
     * @param loginUser
     * @return
     */
    @Override
    public boolean isAdmin(User loginUser) {
        return loginUser.getUserRole() == ADMIN_ROLE;
    }

    /**
     * è·å–å½“å‰ç”¨æˆ·
     * @param request
     * @return
     */
    @Override
    public User getCurrentUser(HttpServletRequest request) {
        if (request == null) {
            throw new BusinessException(ErrorCode.PARAMS_ERROR);
        }
        User user = (User) request.getSession().getAttribute(USER_LOGIN_STATE);
        if (user == null) {
            throw new BusinessException(ErrorCode.NOT_LOGIN);
        }
        return user;
    }
```



## äºŒã€å‰ç«¯ç”¨æˆ·ä¿¡æ¯æ¥å£


> æˆ‘è¿™é‡Œä¸èƒ½ä½¿ç”¨Toast.success() ï¼Œè¿›è¡Œæç¤ºï¼Œçœ‹æ–‡æ¡£è¯´ä½¿ç”¨showSuccessToastã€showFailToastè¿›è¡Œæç¤º
>
>  
>
> åœ¨å¼•å…¥çš„æ—¶å€™è¦æ³¨æ„è¦å†™æˆä»¥ä¸‹çš„æºæ–‡ä»¶`"vant/lib/vant.es"`ï¼Œæ‰ä¼šæˆåŠŸ
>

![882d6847-1e23-4da3-be67-92fb81410bae](./assets/05ä¿®æ”¹ç”¨æˆ·æ¶ˆæ¯+ç™»å½•ç•Œé¢/882d6847-1e23-4da3-be67-92fb81410bae.png)



## ä¸‰ã€å‰ç«¯é¡µé¢å¼€å‘


### 1.ç°åœ¨pagesåŒ…é‡Œæ–°å»ºä¸€ä¸ªç™»å½•é¡µé¢UserLoginPage.vue


```vue
<template>
  <van-form @submit="onSubmit">
    <van-cell-group inset>
      <van-field
          v-model="userAccount"
          name="userAccount"
          label="è´¦å·"
          placeholder="è¯·è¾“å…¥è´¦å·"
          :rules="[{ required: true, message: 'è¯·å¡«å†™ç”¨æˆ·å' }]"
      />
      <van-field
          v-model="userPassword"
          type="password"
          name="userPassword"
          label="å¯†ç "
          placeholder="è¯·è¾“å…¥å¯†ç "
          :rules="[{ required: true, message: 'è¯·å¡«å†™å¯†ç ' }]"
      />
    </van-cell-group>
    <div style="margin: 16px;">
      <van-button round block type="primary" native-type="submit">
        æäº¤
      </van-button>
    </div>
  </van-form>
</template>

<script setup>

import myAxios from "../plugins/myAxios.ts";
import {Toast} from "vant";
import {ref} from "vue";
import {useRouter} from "vue-router";

const router = useRouter();

const userAccount = ref('');
const userPassword = ref('');

const onSubmit = async () => {
  // console.log("ç”¨æˆ·ç™»å½•");
  const res = await myAxios.post("/user/login", {
    userAccount: userAccount.value,
    userPassword: userPassword.value
  });
  if (res.code == 0 && res.data != null) {
    Toast.success("ç™»å½•æˆåŠŸ");
    router.replace("/")
  } else {
    Toast.fail("ç™»å½•å¤±è´¥");
  }
};

</script>

<style scoped>

</style>
```

åˆ«å¿˜äº†åœ¨è·¯ç”±é‡Œé¢å¼•å…¥

```javascript
import UserLoginPage from "../pages/UserLoginPage.vue"; 

{ path: '/user/login', component: UserLoginPage },
```



### 2.ç™»å½•æˆåŠŸï¼Œç°åœ¨å°±è¦å»ç¼–å†™ç”¨æˆ·ä¿¡æ¯äº†ï¼ˆåŠ¨æ€æ˜¾ç¤ºæ•°æ®åº“é‡Œé¢çš„ä¿¡æ¯ï¼‰ï¼ŒåŸæ¥æ˜¯å†™æ­»çš„


```javascript
import myAxios from "../plugins/myAxios.ts";
import {showFailToast,showSuccessToast} from "vant/lib/vant.es";

const user = ref();

onMounted(async ()=>{
    const res = await myAxios.get('/user/current');
    if (res.code === 0){
      user.value =res.data;
      showSuccessToast('è·å–ç”¨æˆ·ä¿¡æ¯æˆåŠŸ');
    }else {
      showFailToast('è·å–ç”¨æˆ·ä¿¡æ¯æˆåŠŸ');
    }
})
```



ä½†æ˜¯ç™»å½•ä¸ä¼šç§ä¸‹cookieï¼Œæ„å‘³ç€åç«¯ä¸èƒ½è·å–ç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼Œå°±ä¸èƒ½åŠ¨æ€å±•ç¤ºç”¨æˆ·ä¿¡æ¯é¡µ

![image](./assets/05ä¿®æ”¹ç”¨æˆ·æ¶ˆæ¯+ç™»å½•ç•Œé¢/image.png)åœ¨myAxios.tsä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼šï¼ˆæ³¨æ„è¦åœ¨å®šä¹‰çš„å˜é‡ï¼Œå³myAxiosä¹‹åç²˜è´´)

```plain
myAxios.defaults.withCredentials = true; // å…è®¸æºå¸¦ cookie
```

![89b18250-1469-4b2b-8a62-47b9d4ce6fc4](./assets/05ä¿®æ”¹ç”¨æˆ·æ¶ˆæ¯+ç™»å½•ç•Œé¢/89b18250-1469-4b2b-8a62-47b9d4ce6fc4.png)

åœ¨åç«¯æ¥å£æ·»åŠ å…è®¸æºå¸¦ cookie çš„é…ç½®  
![image (1)](./assets/05ä¿®æ”¹ç”¨æˆ·æ¶ˆæ¯+ç™»å½•ç•Œé¢/image (1).png) 

æˆ–è€…åœ¨å…¨å±€è·¨åŸŸé…ç½®ä¸­æ·»åŠ å…è®¸æºå¸¦ cookie çš„é…ç½®  
![image-20241025102008421](./assets/05ä¿®æ”¹ç”¨æˆ·æ¶ˆæ¯+ç™»å½•ç•Œé¢/image-20241025102008421.png)

åŒæ—¶åç«¯è®¾ç½® cookie çš„ä½œç”¨åŸŸ  
![image (2)](./assets/05ä¿®æ”¹ç”¨æˆ·æ¶ˆæ¯+ç™»å½•ç•Œé¢/image (2).png)

ç™»å½•ï¼Œå†æ¬¡ç‚¹å‡»ä¸ªäººï¼Œå‘ç°cookieå·²ç»å¸¦æœ‰äº†![image (3)](./assets/05ä¿®æ”¹ç”¨æˆ·æ¶ˆæ¯+ç™»å½•ç•Œé¢/image (3).png)



```vue
<!--
User:Shier
CreateTime:11:01
-->

<template>
  <template v-if="user">
    <van-cell title="æ˜µç§°" is-link to="/user/edit" :value="user.username" @click="toEdit('username','æ˜µç§°',user.username)"/>
    <van-cell title="è´¦æˆ·" :value="user.userAccount" 
              @click="toEdit('userAccount','è´¦æˆ·',user.userAccount)"/>
    <van-cell title="å¤´åƒ" is-link to="/user/edit" :value="user.avatarUrl" @click="toEdit('avatarUrl','å¤´åƒ',user.avatarUrl)">
      <img style="height: 48px" :src="user.avatarUrl">
    </van-cell>
    <van-cell title="æ€§åˆ«" is-link to="/user/edit" :value="user.gender" @click="toEdit('gender','æ€§åˆ«',user.gender)" />
    <van-cell title="ç”µè¯" is-link to="/user/edit" :value="user.phone" @click="toEdit('phone','ç”µè¯',user.phone)"/>
    <van-cell title="é‚®ç®±" is-link to="/user/edit" :value="user.email" @click="toEdit('email','é‚®ç®±',user.email)"/>
    <van-cell title="æ˜Ÿçƒç¼–å·" :value="user.planetCode" />
    <van-cell title="æ³¨å†Œæ—¶é—´" :value="user.createTime"  />
  </template>
</template>
<script setup lang="ts">
  import {useRouter} from "vue-router";
  import {onMounted, ref} from "vue";
  import myAxios from "../plugins/myAxios.ts";
  import {showFailToast, showSuccessToast} from "vant/lib/vant.es";

  const user = ref();
  // const user = {
  //   id: 1,
  //   username: 'çŒ«åäºŒæ‡¿',
  //   userAccount: 'shier',
  //   avatarUrl: 'https://img1.baidu.com/it/u=467212011,1034521901&fm=253&fmt=auto&app=120&f=JPEG?w=500&h=500',
  //   gender: 'ç”·',
  //   phone: '121311313',
  //   email: '23432@qq.com',
  //   planetCode: '12322',
  //   createTime: new Date(),
  // };

  const router = useRouter()
  const toEdit = (editKey: String, editName: String, currentValue: String) => {
    router.push({
      path: 'user/edit',
      query: {
        editKey,
        editName,
        currentValue,
      }
    })
  }

  onMounted(async () => {
    const res = await myAxios.get('/user/current');
    if (res.code === 0) {
      user.value = res.data;
      showSuccessToast('è·å–ç”¨æˆ·ä¿¡æ¯æˆåŠŸ');
    } else {
      showFailToast('è·å–ç”¨æˆ·ä¿¡æ¯æˆåŠŸ');
    }
  })

</script>

<style scoped>

</style>
```

å†æ¬¡åˆ·æ–°ï¼Œé¡µé¢æˆåŠŸçš„æ˜¾ç¤º  
![1b7512ce-cd4b-436d-b06e-7095307c409d](./assets/05ä¿®æ”¹ç”¨æˆ·æ¶ˆæ¯+ç™»å½•ç•Œé¢/1b7512ce-cd4b-436d-b06e-7095307c409d.png)



### 3.å®Œå–„ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯


> å‘ç°æ¯ä¸ªé¡µé¢éƒ½è¦è·å–å½“å‰çš„ç”¨æˆ·ä¿¡æ¯ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠè¿™ä¸ªæ–¹æ³•æå–å‡ºæ¥  
åœ¨srcç›®å½•ä¸‹å»ºç«‹servicesåŒ…ï¼Œå¹¶åˆ›å»ºuser.tsç¼–å†™ä»£ç 



```typescript
import myAxios from "../plugins/myAxios";
import {getCurrentUserState, setCurrentUserState} from "../states/user";

/**
 * è·å–ç”¨æˆ·ä¿¡æ¯
 * @returns {Promise<null|any>}
 */
export const getCurrentUser = async () => {
    const user = getCurrentUserState();
    if (user) {
        return user;
    }
    //ä»è¿œç¨‹å¤„è·å–ç”¨æˆ·ä¿¡æ¯
    const res = await myAxios.get("/user/current");
    if (res.code == 0 ) {
        // setCurrentUserState(res.data);
        return res.data;
    }
    return null;
}
```



åŒæ—¶åœ¨srcç›®å½•ä¸‹å»ºç«‹statesåŒ…ï¼Œå¹¶åˆ›å»ºuser.tsç¼–å†™ä»£ç ï¼ˆå®šä¹‰ä¸¤ä¸ªæ–¹æ³•ï¼‰



```typescript
import {UserType} from "../models/user";

//ä½¿ç”¨è¿™ä¸ªå˜é‡å­˜å‚¨å·²ç»ç™»é™†çš„ç”¨æˆ·ä¿¡æ¯ã€‚
//æš‚æ—¶é¿å…äº†ä½¿ç”¨å¤æ‚çš„vueXå’Œpinia
let currentUser: UserType;

const setCurrentUserState = (user:UserType) =>{
    currentUser =user;
}

const getCurrentUserState = (): UserType =>{
    return currentUser;
}

export {
    setCurrentUserState,
    getCurrentUserState,
}
```



ç”±äºæå–äº†è·å–ç”¨æˆ·ä¿¡æ¯çš„ä»£ç ï¼Œæ‰€ä»¥ç”¨æˆ·é¡µåŸæ¥ç¼–å†™çš„ä»£ç éœ€è¦ä¿®æ”¹ä¸ºä¸‹å›¾  
![image (4)](./assets/05ä¿®æ”¹ç”¨æˆ·æ¶ˆæ¯+ç™»å½•ç•Œé¢/image (4).png)



æœ€åå°±æ˜¯è¦ç¼–å†™ç”¨æˆ·ä¿®æ”¹é¡µé¢äº†ï¼Œå‘é€ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯è¯·æ±‚ã€‚ Â  Â `UserEditPage.vue`å®Œæ•´ä»£ç å¦‚ä¸‹



```vue
<template>
  <van-form @submit="onSubmit">
      <van-field
          v-model="editUser.currentValue"
          :name="editUser.editKey"
          :label="editUser.editName"
          :placeholder="`è¯·è¾“å…¥${editUser.editName}`"
      />
    <div style="margin: 16px;">
      <van-button round block type="primary" native-type="submit">
        æäº¤
      </van-button>
    </div>
  </van-form>
</template>

<script setup lang="ts">
import {useRoute, useRouter} from "vue-router";
import {ref} from "vue";
import myAxios from "../plugins/myAxios";
  import {showSuccessToast,showFailToast} from "vant/lib/vant.es";
import {getCurrentUser} from "../services/user";

const route = useRoute();
const router =useRouter();

const editUser = ref({
  editKey: route.query.editKey,
  currentValue: route.query.currentValue,
  editName: route.query.editName,
})

// ä¸å¯ä»¥å†™åœ¨å¤–é¢ï¼Œå¦åˆ™é¡µé¢ä¸æ˜¾ç¤ºå†…å®¹ï¼Œè¿˜æ²¡æœ‰æŠ¥é”™ä¿¡æ¯ï¼ŒåŸå› æœªçŸ¥
// const currentUser = await getCurrentUser();

const onSubmit = async () => {
  // å¼‚æ­¥æ–¹æ³•å¿…é¡»æ·»åŠ  await æ‰å¯ä»¥æ‹¿åˆ°æ•°æ®, å¦åˆ™æ‹¿åˆ°çš„æ˜¯ promise å¯¹è±¡
  const currentUser = await getCurrentUser();
  console.log("-------UserEditPage", currentUser);
  const res = await myAxios.post("/user/update", {
    "id": currentUser.id,
    [editUser.value.editKey]: editUser.value.currentValue // åŠ¨æ€å–å€¼
  })
  console.log("ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯", res);
  if (res.code === 0 && res.date > 0) {
      showSuccessToast('ä¿®æ”¹æˆåŠŸ')
      router.back()
    }else {
      showFailToast('ä¿®æ”¹å¤±è´¥');
    }
};

</script>

<style scoped>

</style>
```



### 4.æµ‹è¯•å¦‚ä¸‹ï¼šå…¶ä¸­ä¼šæœ‰æŠ¥é”™ï¼Œå¥½åƒå¤§å¤šæ˜¯ç”±äºtsé€ æˆçš„ï¼Œä½†æ˜¯éƒ½ä¸ä¼šå½±å“ä»£ç çš„è¿è¡Œå®ç°

![b40fd079-2a03-4d5a-9031-9c47e25b8a86](./assets/05ä¿®æ”¹ç”¨æˆ·æ¶ˆæ¯+ç™»å½•ç•Œé¢/b40fd079-2a03-4d5a-9031-9c47e25b8a86.png)

![090e5c87-dc64-4dd1-acfc-1019f30ab393](./assets/05ä¿®æ”¹ç”¨æˆ·æ¶ˆæ¯+ç™»å½•ç•Œé¢/090e5c87-dc64-4dd1-acfc-1019f30ab393.png)



**æ³¨æ„è¸©å‘å¤„ï¼š**  
è¯­æ³•ç³–æ˜¯æ”¯æŒå†™åœ¨å¤–é¢çš„ï¼Œä½†æ˜¯è¿™é‡Œé¢è¿ç”¨å°±ä¸æ˜¾ç¤ºé¡µé¢  
![image (5)](./assets/05ä¿®æ”¹ç”¨æˆ·æ¶ˆæ¯+ç™»å½•ç•Œé¢/image (5).png)



### 5.å…³äºè°ƒç”¨ç¼“å­˜å»è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯çš„é—®é¢˜


![image (6)](./assets/05ä¿®æ”¹ç”¨æˆ·æ¶ˆæ¯+ç™»å½•ç•Œé¢/image (6).png)



è¿™è¾¹å°±å¾ˆç„å­¦ï¼Œé±¼çš®ä½¿ç”¨äº†ç¼“å­˜ï¼Œç»“æœè·å–ä¸åˆ°æœ€æ–°çš„ç”¨æˆ·ä¿¡æ¯ï¼Œè€Œæˆ‘è¿™è¾¹å¯ä»¥ã€‚ã€‚ã€‚  
**å»ºè®®ï¼šåœ¨å°ç³»ç»Ÿï¼ˆç”¨æˆ·å°‘ï¼‰ä¸­å°½é‡ä¸è¦ä½¿ç”¨ç¼“å­˜ï¼Œå¯ä»¥ä½¿ç”¨è·¯ç”±å®ˆå«ï¼Œä»è¿œç¨‹è·å–**  
**è¸©å‘å¤„**ï¼šå¦‚æœå‰ç«¯åœ¨ç”¨æˆ·é¡µçš„ä¿¡æ¯ä¸­å¹¶æœªè®¾å®šeditKeyçš„è¯ï¼Œå°±æ— æ³•ä¿®æ”¹ä¿¡æ¯ï¼ˆæ›´æ–°å†…å®¹ä¸ºç©ºï¼‰ï¼Œè¿™éœ€è¦æˆ‘ä»¬åœ¨åç«¯å»æ§åˆ¶ã€ç­›é€‰å‰ç«¯æ‰€ä¼ å…¥çš„å‚æ•° Â  Â  Â åç«¯ä¼šæœ‰ç±»ä¼¼ä»¥ä¸‹æŠ¥é”™  

![image (7)](./assets/05ä¿®æ”¹ç”¨æˆ·æ¶ˆæ¯+ç™»å½•ç•Œé¢/image (7).png)



## ç¬¬äº”æœŸå®Œç»“ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰


> æ›´æ–°: 2023-02-10 10:03:20  
> åŸæ–‡: <https://www.yuque.com/shierkcs/catstudy/zo2h5fxbgki9yogt>



# æ‹“å±•

## 1ã€å‰ç«¯å‘åç«¯å‘é€çš„è¯·æ±‚æ²¡æœ‰Cookie

![image-20241024214318441](./assets/05ä¿®æ”¹ç”¨æˆ·æ¶ˆæ¯+ç™»å½•ç•Œé¢/image-20241024214318441.png)

![image-20241024214342240](./assets/05ä¿®æ”¹ç”¨æˆ·æ¶ˆæ¯+ç™»å½•ç•Œé¢/image-20241024214342240.png)

åœ¨è‡ªå®šä¹‰çš„æ‹¦æˆªå™¨æ–‡ä»¶ä¸­ï¼Œæ·»åŠ 

```javascript
myAxios.defaults.withCredentials=true;
```

## 2ã€è®¾ç½®ç§sessionçš„èŒƒå›´

å…±äº« Cookie æ˜¯åœ¨å¤šä¸ªå­åŸŸä¹‹é—´å®ç°çŠ¶æ€æˆ–æ•°æ®å…±äº«çš„å¸¸è§éœ€æ±‚ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªå…¬å¸çš„å¤šä¸ªå­ç½‘ç«™ä¹‹é—´ï¼ˆå¦‚ `sub1.example.com` å’Œ `sub2.example.com`ï¼‰å…±äº«ç”¨æˆ·çš„ç™»å½•çŠ¶æ€ã€‚
åœ¨ HTTP åè®®ä¸­ï¼ŒCookie æ˜¯é€šè¿‡åŸŸåå’Œè·¯å¾„æ¥ç¡®å®šå…¶ä½œç”¨èŒƒå›´çš„ã€‚å½“æœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª Cookie æ—¶ï¼Œå¯ä»¥æŒ‡å®š Cookie çš„ Domain å±æ€§ã€‚æµè§ˆå™¨ä¼šæ ¹æ®è¿™ä¸ªå±æ€§æ¥å†³å®š Cookie æ˜¯å¦åœ¨ç‰¹å®šåŸŸåæˆ–å­åŸŸåä¸‹å‘é€ã€‚

ä¸ºäº†ä½¿å¤šä¸ªå­åŸŸå…±äº«ä¸€ä¸ª Cookieï¼Œå¯ä»¥å°† Cookie çš„ Domain å±æ€§è®¾ç½®ä¸ºä¸€ä¸ªæ›´é«˜å±‚çš„å…¬å…±åŸŸåï¼Œä¾‹å¦‚å°† `sub1.example.com` å’Œ `sub2.example.com` çš„ Cookie è®¾ç½®ä¸º `example.com`ã€‚è¿™æ ·åšçš„å¥½å¤„åœ¨äºï¼š

1. **å…±äº«çŠ¶æ€ï¼š** ç”¨æˆ·åœ¨ä¸€ä¸ªå­åŸŸç™»å½•åï¼Œåœ¨å…¶ä»–å­åŸŸä¹Ÿå¯ä»¥ä¿æŒç™»å½•çŠ¶æ€ï¼Œä¸éœ€è¦å†æ¬¡ç™»å½•ã€‚
2. **ç»Ÿä¸€ç®¡ç†ï¼š** å¯ä»¥é€šè¿‡ä¸€ä¸ªå…¬å…±åŸŸåæ¥ç»Ÿä¸€ç®¡ç†å’Œæ“ä½œ Cookieï¼Œç®€åŒ–äº†æ“ä½œå’Œç»´æŠ¤ã€‚

ä»¥ä¸‹æ˜¯è®¾ç½®å…±äº« Cookie çš„ç¤ºä¾‹ä»£ç ï¼š

```java
javaCookie cookie = new Cookie("username", "john");
cookie.setDomain(".example.com"); // è®¾ç½®å…¬å…±åŸŸå
cookie.setPath("/"); // è®¾ç½®è·¯å¾„èŒƒå›´ä¸ºæ•´ä¸ªç«™ç‚¹
cookie.setMaxAge(60 * 60 * 24); // è®¾ç½®æœ‰æ•ˆæœŸä¸º1å¤©
response.addCookie(cookie);
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒCookie çš„ Domain è®¾ç½®ä¸º `.example.com`ï¼ˆæ³¨æ„å‰é¢çš„ç‚¹ï¼‰ï¼Œè¿™æ ·æ‰€æœ‰ `example.com` åŠå…¶å­åŸŸï¼ˆå¦‚ `sub1.example.com` å’Œ `sub2.example.com`ï¼‰éƒ½å¯ä»¥è®¿é—®è¿™ä¸ª Cookieã€‚

### åœ¨SpringBootä¸­é…ç½®

åœ¨ Spring Boot 3 ä¸­ï¼Œå¯ä»¥ä½¿ç”¨æ›´ç®€æ´çš„æ–¹æ³•é€šè¿‡é…ç½®å±æ€§æ¥å…±äº« Cookieã€‚

é…ç½® `application.properties` æ–‡ä»¶

åœ¨ Spring Boot 3 ä¸­ï¼Œå¯ä»¥ç›´æ¥åœ¨ `application.properties` æˆ– `application.yml` æ–‡ä»¶ä¸­é…ç½® `server.servlet.session.cookie.domain` å±æ€§æ¥è®¾ç½® Cookie çš„åŸŸåã€‚

**`application.properties` ç¤ºä¾‹ï¼š**

```
propertiesserver.servlet.session.cookie.domain=.example.com
```

**`application.yml` ç¤ºä¾‹ï¼š**

```yml
yamlserver:
  servlet:
    session:
      cookie:
        domain: .example.com
```

é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯ä»¥åœ¨ Spring Boot 3 ä¸­ä½¿ç”¨æ›´ç®€æ´çš„æ–¹æ³•é…ç½®å…±äº« Cookie çš„åŸŸåï¼Œä½¿å¤šä¸ªå­åŸŸä¹‹é—´èƒ½å¤Ÿå…±äº«çŠ¶æ€ä¿¡æ¯ã€‚