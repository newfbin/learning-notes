# 11 ç”¨æˆ·é€€å‡ºé˜Ÿä¼+ å‰ç«¯é˜Ÿä¼ç•Œé¢

åœ¨çº¿å›æ”¾ï¼š[https://meeting.tencent.com/v2/cloud-record/share?...](https://meeting.tencent.com/v2/cloud-record/share?id=2f096a64-d837-4bbd-9d67-9a37019e4eec&from=3) (è®¿é—®å¯†ç ï¼šQPXd)

## é±¼çš®ç¬”è®°


### æ¥ä¸ŠæœŸçš„æ¥å£è®¾è®¡


##### 5. ç”¨æˆ·å¯ä»¥é€€å‡ºé˜Ÿä¼


è¯·æ±‚å‚æ•°ï¼šé˜Ÿä¼ id



1. æ ¡éªŒè¯·æ±‚å‚æ•°
2. æ ¡éªŒé˜Ÿä¼æ˜¯å¦å­˜åœ¨
3. æ ¡éªŒæˆ‘æ˜¯å¦å·²åŠ å…¥é˜Ÿä¼
4. å¦‚æœé˜Ÿä¼ 
   1. åªå‰©ä¸€äººï¼Œé˜Ÿä¼è§£æ•£
   2. è¿˜æœ‰å…¶ä»–äºº 
      1. å¦‚æœæ˜¯é˜Ÿé•¿é€€å‡ºé˜Ÿä¼ï¼Œæƒé™è½¬ç§»ç»™ç¬¬äºŒæ—©åŠ å…¥çš„ç”¨æˆ· â€”â€” å…ˆæ¥ååˆ°åªç”¨å– id æœ€å°çš„ 2 æ¡æ•°æ®
      2. éé˜Ÿé•¿ï¼Œè‡ªå·±é€€å‡ºé˜Ÿä¼



##### 6. é˜Ÿé•¿å¯ä»¥è§£æ•£é˜Ÿä¼


è¯·æ±‚å‚æ•°ï¼šé˜Ÿä¼ id  
ä¸šåŠ¡æµç¨‹ï¼š



1. æ ¡éªŒè¯·æ±‚å‚æ•°
2. æ ¡éªŒé˜Ÿä¼æ˜¯å¦å­˜åœ¨
3. æ ¡éªŒä½ æ˜¯ä¸æ˜¯é˜Ÿä¼çš„é˜Ÿé•¿
4. ç§»é™¤æ‰€æœ‰åŠ å…¥é˜Ÿä¼çš„å…³è”ä¿¡æ¯
5. åˆ é™¤é˜Ÿä¼



##### 7. è·å–å½“å‰ç”¨æˆ·å·²åŠ å…¥çš„é˜Ÿä¼


##### 8. è·å–å½“å‰ç”¨æˆ·åˆ›å»ºçš„é˜Ÿä¼


å¤ç”¨ listTeam æ–¹æ³•ï¼Œåªæ–°å¢æŸ¥è¯¢æ¡ä»¶ï¼Œä¸åšä¿®æ”¹ï¼ˆå¼€é—­åŸåˆ™ï¼‰

---

### äº‹åŠ¡æ³¨è§£


[@Transactional(rollbackFor ](/Transactional(rollbackFor ) = Exception.class)   
è¦ä¹ˆæ•°æ®æ“ä½œéƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½å¤±è´¥



## ä¸€ã€æ¥å£è®¾è®¡


### 1.ç”¨æˆ·å¯ä»¥é€€å‡ºé˜Ÿä¼


#### (1). æ–°å»ºé€€å‡ºè¯·æ±‚ä½“


```java
	@Data
    public class TeamQuitRequest implements Serializable {
        private static final long serialVersionUID = -2038884913144640407L;
        /**
        *  id
        */
        private Long teamId;
    }
```



#### (2).æ–°å»ºquitè¯·æ±‚æ¥å£


```java
@PostMapping("/quit")
    public BaseResponse<Boolean> quitTeam(@RequestBody TeamQuitRequest teamQuitRequest,HttpServletRequest request){
        if (teamQuitRequest == null){
        throw new BusinessException(ErrorCode.PARAMS_ERROR);
    }
    User loginUser = userService.getLoginUser(request);
    boolean result = teamService.quitTeam(teamQuitRequest, loginUser);
    return ResultUtils.success(result);
}
```



#### (3).åœ¨TeamServiceæ˜¯å†™å…¥quitTeamæ–¹æ³•


```java
/**
* é€€å‡ºé˜Ÿä¼
* @param teamQuitRequest
* @param loginUser
* @return
*/
boolean quitTeam(TeamQuitRequest teamQuitRequest, User loginUser);
```



#### (4).åœ¨TeamServiceImplé‡Œå®ç°quitTeamæ–¹æ³•


```java
	@Override
    @Transactional(rollbackFor = Exception.class)
    public boolean quitTeam(TeamQuitRequest teamQuitRequest, User loginUser) {
    if (teamQuitRequest == null) {
        throw new BusinessException(ErrorCode.PARAMS_ERROR);
    }
    Long teamId = teamQuitRequest.getTeamId();
    if (teamId == null || teamId <= 0) {
        throw new BusinessException(ErrorCode.PARAMS_ERROR);
    }
    Team team = this.getById(teamId);
    if (team == null) {
        throw new BusinessException(ErrorCode.NULL_ERROR, "é˜Ÿä¼ä¸å­˜åœ¨");
    }
    long userId = loginUser.getId();
    UserTeam queryUserTeam = new UserTeam();
    queryUserTeam.setTeamId(teamId);
    queryUserTeam.setUserId(userId);
    QueryWrapper<UserTeam> queryWrapper = new QueryWrapper<>(queryUserTeam);
    long count = userTeamService.count(queryWrapper);
    if (count == 0) {
        throw new BusinessException(ErrorCode.PARAMS_ERROR, "æœªåŠ å…¥é˜Ÿä¼");
    }
    long teamHasJoinNum = this.countTeamUserByTeamId(teamId);
    //é˜Ÿä¼åªå‰©ä¸‹ä¸€ä¸ªäººï¼Œè§£æ•£
    if (teamHasJoinNum == 1) {
        //åˆ é™¤é˜Ÿä¼
        this.removeById(teamId);
    } else {
        //é˜Ÿä¼è‡³å°‘è¿˜å‰©ä¸‹ä¸¤äºº
        //æ˜¯é˜Ÿé•¿
        if (team.getUserId() == userId) {
            //æŠŠé˜Ÿä¼è½¬ç§»ç»™æœ€æ—©åŠ å…¥çš„ç”¨æˆ·
            //1.æŸ¥è¯¢å·²åŠ å…¥é˜Ÿä¼çš„æ‰€æœ‰ç”¨æˆ·å’ŒåŠ å…¥æ—¶é—´
            QueryWrapper<UserTeam> userTeamQueryWrapper = new QueryWrapper<>();
            userTeamQueryWrapper.eq("teamId", teamId);
            userTeamQueryWrapper.last("order by id asc limit 2");
            List<UserTeam> userTeamList = userTeamService.list(userTeamQueryWrapper);
            if (CollectionUtils.isEmpty(userTeamList) || userTeamList.size() <= 1) {
                throw new BusinessException(ErrorCode.SYSTEM_ERROR);
            }
            UserTeam nextUserTeam = userTeamList.get(1);
            Long nextTeamLeaderId = nextUserTeam.getUserId();
            //æ›´æ–°å½“å‰é˜Ÿä¼çš„é˜Ÿé•¿
            Team updateTeam = new Team();
            updateTeam.setId(teamId);
            updateTeam.setUserId(nextTeamLeaderId);
            boolean result = this.updateById(updateTeam);
            if (!result) {
                throw new BusinessException(ErrorCode.SYSTEM_ERROR, "æ›´æ–°é˜Ÿä¼é˜Ÿé•¿å¤±è´¥");
            }
        }
    }
    //ç§»é™¤å…³ç³»
    return userTeamService.remove(queryWrapper);
}
```



è¿™é‡Œæˆ‘ä»¬ç”±äºå¤šæ¬¡éœ€è¦è·å¾—é˜Ÿä¼å½“å‰äººæ•°ï¼Œæ‰€ä»¥å°è£…äº†countTeamUserByTeamIdæ–¹æ³•



```java
/**
* è·å–æŸé˜Ÿä¼å½“å‰äººæ•°
*
* @param teamId
* @return
*/
private long countTeamUserByTeamId(long teamId) {
    QueryWrapper<UserTeam> userTeamQueryWrapper = new QueryWrapper<>();
    userTeamQueryWrapper.eq("teamId", teamId);
    return userTeamService.count(userTeamQueryWrapper);
}
```



åŒæ—¶åœ¨joinTeamæ–¹æ³•é‡Œä¿®æ”¹ä»£ç   
![1669210528707-a640b571-8f1f-49f2-98ed-d13440d30066.png](./assets/11ç”¨æˆ·é€€å‡ºé˜Ÿä¼+å‰ç«¯é˜Ÿä¼ç•Œé¢/1669210528707-a640b571-8f1f-49f2-98ed-d13440d30066-875002-1731571316606-41.png)



#### (5).æµ‹è¯•(è¯¦ç»†)

æˆ‘è¿™é‡Œæ˜¯é˜Ÿä¼32ï¼Œæœ‰äº†ä¸¤ä¸ªç”¨æˆ·ï¼Œå…¶ä¸­1844262784502628353æ˜¯åˆ›å»ºè€…ï¼Œ1846048964118347777æ˜¯é˜Ÿå‘˜ï¼ˆä¸ºäº†æ–¹ä¾¿å¯å¤åˆ¶å¾—åˆ°ï¼‰  
![image-20241114182605729](./assets/11ç”¨æˆ·é€€å‡ºé˜Ÿä¼+å‰ç«¯é˜Ÿä¼ç•Œé¢/image-20241114182605729.png)



ç°åœ¨1844262784502628353 ï¼ˆåˆ›å»ºè€…ï¼‰é€€å‡ºé˜Ÿä¼  
![1669209348681-b2b6089a-edbf-4444-86e8-604e932e9d5d.png](./assets/11ç”¨æˆ·é€€å‡ºé˜Ÿä¼+å‰ç«¯é˜Ÿä¼ç•Œé¢/1669209348681-b2b6089a-edbf-4444-86e8-604e932e9d5d-246188-1731571316606-43.png)



çš„ç¡®ï¼Œ1844262784502628353 å·²ç»ä¸å­˜åœ¨é˜Ÿä¼32ä¹‹ä¸­äº†  
![image-20241114184307029](./assets/11ç”¨æˆ·é€€å‡ºé˜Ÿä¼+å‰ç«¯é˜Ÿä¼ç•Œé¢/image-20241114184307029.png)

æˆ¿ä¸»çš„ç¡®é¡ºä½ç»™äº†1846048964118347777
![image-20241114184356366](./assets/11ç”¨æˆ·é€€å‡ºé˜Ÿä¼+å‰ç«¯é˜Ÿä¼ç•Œé¢/image-20241114184356366.png)

ç°åœ¨ç™»å½•1846048964118347777çš„è´¦å·ï¼Œå¹¶é€€å‡ºé˜Ÿä¼

![image-20241114184548655](./assets/11ç”¨æˆ·é€€å‡ºé˜Ÿä¼+å‰ç«¯é˜Ÿä¼ç•Œé¢/image-20241114184548655.png)

![image-20241114184715456](./assets/11ç”¨æˆ·é€€å‡ºé˜Ÿä¼+å‰ç«¯é˜Ÿä¼ç•Œé¢/image-20241114184715456.png)

å¯ä»¥çœ‹åˆ°é˜Ÿä¼32è¢«åˆ é™¤  
åˆ°æ­¤ä¸ºæ­¢é€€å‡ºåŠŸèƒ½åŸºæœ¬å®ç°



### 2.åœ¨TeamServiceé‡Œç¼–å†™åˆ é™¤é˜Ÿä¼æ–¹æ³•å¹¶åœ¨TeamServiceImplé‡Œå®ç°


#### (1).ä¿®æ”¹deleteæ¥å£


```java
@PostMapping("/delete")
    public BaseResponse<Boolean> deleteTeam(@RequestBody long id,HttpServletRequest request) {
    if (id <= 0) {
    	throw new BusinessException(ErrorCode.PARAMS_ERROR);
	}
    User loginUser = userService.getLoginUser(request);
    boolean result = teamService.deleteTeam(id,loginUser);
    if (!result) {
        throw new BusinessException(ErrorCode.SYSTEM_ERROR, "åˆ é™¤å¤±è´¥");
    }
    return ResultUtils.success(true);
}
```



#### (2).åœ¨TeamServiceé‡Œé¢å†™å…¥deleteTeamæ–¹æ³•


```java
/**
* åˆ é™¤é˜Ÿä¼
* @param id
* @param loginUser
* @return
*/
boolean deleteTeam(long id, User loginUser);
```



#### (3).åœ¨TeamServiceImplé‡Œå®ç°deleteTeamæ–¹æ³•


è·Ÿä¸Šé¢ä¸€æ ·ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®idè·å–é˜Ÿä¼ä¿¡æ¯ï¼Œè¿™ä¸ªä»£ç æˆ‘ä»¬é‡å¤çš„å†™ï¼Œæ‰€ä»¥æå–å‡ºæ¥



```java
/**
* æ ¹æ® id è·å–é˜Ÿä¼ä¿¡æ¯
*
* @param teamId
* @return
*/
private Team getTeamById(Long teamId) {
    if (teamId == null || teamId <= 0) {
    throw new BusinessException(ErrorCode.PARAMS_ERROR);
}
Team team = this.getById(teamId);
if (team == null) {
    throw new BusinessException(ErrorCode.NULL_ERROR, "é˜Ÿä¼ä¸å­˜åœ¨");
}
return team;
}
```



åœ¨Error_Codeé‡Œæ·»åŠ ä¸€ä¸ªç¦æ­¢æ“ä½œ  
![1669214171494-75c0da6c-0c58-4f0b-8aec-36c4eb445ff9.png](./assets/11ç”¨æˆ·é€€å‡ºé˜Ÿä¼+å‰ç«¯é˜Ÿä¼ç•Œé¢/1669214171494-75c0da6c-0c58-4f0b-8aec-36c4eb445ff9-422621-1731571316606-47.png)



```java
@Override
@Transactional(rollbackFor = Exception.class)
public boolean deleteTeam(long id, User loginUser) {
    // æ ¡éªŒé˜Ÿä¼æ˜¯å¦å­˜åœ¨
    Team team = getTeamById(id);
    long teamId = team.getId();
    // æ ¡éªŒä½ æ˜¯ä¸æ˜¯é˜Ÿä¼çš„é˜Ÿé•¿
    if (!team.getUserId().equals(loginUser.getId())){
        throw new BusinessException(ErrorCode.NO_AUTH,"æ— è®¿é—®æƒé™");
    }
    // ç§»é™¤æ‰€æœ‰åŠ å…¥é˜Ÿä¼çš„å…³è”ä¿¡æ¯
    QueryWrapper<UserTeam> userTeamQueryWrapper = new QueryWrapper<>();
    userTeamQueryWrapper.eq("teamId", teamId);
    boolean result = userTeamService.remove(userTeamQueryWrapper);
    if (!result){
        throw new BusinessException(ErrorCode.SYSTEM_ERROR,"åˆ é™¤é˜Ÿä¼å…³è”ä¿¡æ¯å¤±è´¥");
    }
    // åˆ é™¤é˜Ÿä¼
    return this.removeById(teamId);
}
```



æ³¨æ„åœ¨æ“ä½œå¤šä¸ªæ•°æ®åº“æ—¶ï¼Œåœ¨æ–¹æ³•ä¸Šè¦åŠ ä¸Š[@Transactional(rollbackFor ](/Transactional(rollbackFor ) = Exception.class)æ³¨è§£ï¼Œè¡¨ç¤ºè¦ä¹ˆæ•°æ®æ“ä½œéƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½å¤±è´¥ã€‚ 



> **è¸©å‘å¤„ï¼šè¿™é‡Œè¸©äº†å¤§å‘åœ¨æ ¡éªŒæ˜¯ä¸æ˜¯é˜Ÿé•¿æ—¶ï¼ŒæŒ‰ç…§é±¼çš®çš„å†™äº†ï¼Œè¿è¡Œå‘ç°æŠ¥é”™æ— æƒé™ï¼Œdebugå‘ç°ä¸¤è€…çš„idä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œæœ€ååœ¨çƒå‹çš„å¸®åŠ©ä¸‹ï¼Œå‘ç°æ˜¯ç±»å‹çš„é—®é¢˜ï¼Œæ‰“å°å‡ºä¸¤è€…çš„ç±»å‹æ˜¯Longå°è£…ç±»ï¼Œåˆ¤æ–­ä¸¤è€…éœ€è¦ä½¿ç”¨equalsï¼Œè€Œä¸æ˜¯==ï¼ˆå¥½åƒæ˜¯ä¸æ”¯æŒ==ï¼‰ï¼Œæˆ‘è¿™é‡Œä¿®æ”¹ä¸ºequalsæˆåŠŸå®ç°ï¼Œå»ºè®®å¤§å®¶å…ˆæŒ‰é±¼çš®çš„å†™ï¼Œå¦‚æœæŠ¥é”™ï¼Œå°±å¯ä»¥æ›¿æ¢ä¸‹ï¼**



#### (4).æµ‹è¯•

æˆ‘è¿™é‡Œé‡æ–°åˆ›å»ºäº†20é˜Ÿä¼ç”¨æ¥æµ‹è¯•åˆ é™¤é˜Ÿä¼ï¼Œç„¶ååœ¨knife4jé‡Œç›´æ¥åˆ é™¤é˜Ÿä¼20  
![1669257664077-35421e6f-4d4c-4003-a58c-94fc3d778c08.png](./assets/11ç”¨æˆ·é€€å‡ºé˜Ÿä¼+å‰ç«¯é˜Ÿä¼ç•Œé¢/1669257664077-35421e6f-4d4c-4003-a58c-94fc3d778c08-144618-1731571316606-49.png)  
æŸ¥çœ‹æ•°æ®åº“  
![1669257698589-8917466d-9842-4e80-88d2-15f7769f5ce6.png](./assets/11ç”¨æˆ·é€€å‡ºé˜Ÿä¼+å‰ç«¯é˜Ÿä¼ç•Œé¢/1669257698589-8917466d-9842-4e80-88d2-15f7769f5ce6-641615-1731571316606-48.png)  
![1669257717655-f2bf7036-f45e-41d2-af55-1d3506136ef3.png](./assets/11ç”¨æˆ·é€€å‡ºé˜Ÿä¼+å‰ç«¯é˜Ÿä¼ç•Œé¢/1669257717655-f2bf7036-f45e-41d2-af55-1d3506136ef3-656972-1731571316606-50.png)  
æˆåŠŸåˆ é™¤ï¼Œåˆ é™¤é˜Ÿä¼åŠŸèƒ½åŸºæœ¬å®Œæˆ



## äºŒã€å‰ç«¯è®¾è®¡


### 1.æ–°å»ºä¸€ä¸ªTeamAddPageï¼Œå¹¶åœ¨è·¯ç”±é‡Œæ·»åŠ è¿™ä¸ªé¡µé¢

![1669220241209-e8ad4753-2330-4fb9-a2d1-71b5ce8e8e37.png](./assets/11ç”¨æˆ·é€€å‡ºé˜Ÿä¼+å‰ç«¯é˜Ÿä¼ç•Œé¢/1669220241209-e8ad4753-2330-4fb9-a2d1-71b5ce8e8e37-167986.png)  
åœ¨TeamPageé‡Œå†™ä¸€ä¸ªæŒ‰é’®è·³è½¬åˆ°TeamAddPage  
![1669281628735-a09c3a61-babf-4616-910d-49fd2fd48317.png](./assets/11ç”¨æˆ·é€€å‡ºé˜Ÿä¼+å‰ç«¯é˜Ÿä¼ç•Œé¢/1669281628735-a09c3a61-babf-4616-910d-49fd2fd48317-914096-1731571316606-51.png)



### 2.ç°åœ¨æ­£å¼è®¾è®¡TeamAddPageé¡µé¢ï¼Œä¸»è¦æ˜¯åœ¨vantç»„ä»¶åº“é‡Œé€‰æ‹©åˆé€‚çš„ç»„ä»¶ç²˜è´´


#### (1).é˜Ÿä¼åå’Œæè¿°å

æˆ‘ä»¬å¯ä»¥å‘ç°é˜Ÿä¼åå’Œæè¿°åç±»ä¼¼äºç”¨æˆ·ç™»å½•é¡µé¢çš„è¡¨å•ç»„ä»¶ï¼Œæ‰€ä»¥æ‹¿æ¥å³ç”¨ï¼ˆä¿®æ”¹ä¸‹å‚æ•°ï¼‰  
è¿™ä¸ªä¸»è¦æ˜¯è¿ç”¨äº†è¡¨å•ï¼Œå•å…ƒæ ¼ï¼Œè¾“å…¥æ¡†è¿™ä¸‰ä¸ªç»„ä»¶ï¼Œå…¶ä¸­æè¿°ä½¿ç”¨äº†é«˜åº¦è‡ªé€‚åº”  
![1669282395400-ee392760-68af-41dd-8e3f-946f5d63c7cd.png](./assets/11ç”¨æˆ·é€€å‡ºé˜Ÿä¼+å‰ç«¯é˜Ÿä¼ç•Œé¢/1669282395400-ee392760-68af-41dd-8e3f-946f5d63c7cd-322556-1731571316606-52.png)



**å‚æ•°æˆ‘ä»¬å¯ä»¥ä»åå°è·å¾—ï¼ˆknife4jæ¥å£æ–‡æ¡£ï¼‰**  
![1669282458145-a6d8a363-a772-4e08-bccd-41c005a0ed03.png](./assets/11ç”¨æˆ·é€€å‡ºé˜Ÿä¼+å‰ç«¯é˜Ÿä¼ç•Œé¢/1669282458145-a6d8a363-a772-4e08-bccd-41c005a0ed03-817671-1731571316606-53.png)



#### (2).è¿‡æœŸæ—¶é—´


æˆ‘ä»¬é€‰æ‹©vanté‡Œçš„DatePicker æ—¥æœŸé€‰æ‹©å’Œfromä¸­çš„æ—¶é—´é€‰æ‹©å™¨

![edeb83fd-486a-4edd-b823-269860ddb562](./assets/11ç”¨æˆ·é€€å‡ºé˜Ÿä¼+å‰ç«¯é˜Ÿä¼ç•Œé¢/edeb83fd-486a-4edd-b823-269860ddb562.png)



è¿™é‡Œçš„min-date æˆ‘ä»¬ä¸èƒ½ç›´æ¥new Date(),å› ä¸ºè¿™ä¼šå¯¼è‡´é¡µé¢ä¸€ç›´æ¸²æŸ“ï¼Œä»è€Œé¡µé¢åŠ è½½ä¸å‡ºæ¥ï¼Œæˆ‘èƒ½å¾—åœ¨å»ºä¸€ä¸ªå¸¸é‡min-dateï¼ŒåŒæ—¶è¿™ä¸ªæ—¥æœŸé»˜è®¤ä¸æ˜¾ç¤ºï¼Œæˆ‘ä»¬è¦åœ¨JSé‡Œå±•ç¤ºæ—¥æœŸé€‰æ‹©å™¨ï¼Œç¡®å½“æŒ‰é’®å‡½æ•°

![81ad208b-e25f-4ff3-92cd-7741ccff8ab6](./assets/11ç”¨æˆ·é€€å‡ºé˜Ÿä¼+å‰ç«¯é˜Ÿä¼ç•Œé¢/81ad208b-e25f-4ff3-92cd-7741ccff8ab6.png)

> è¸©å‘ï¼š ç”±äºè¿™é‡Œå®˜æ–¹æ–‡æ¡£ä¿®æ”¹äº†ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å‰åç«¯éƒ½è¦åŠ ä¸Šä¸€ä¸ªæ—¶é—´æ ¼å¼åŒ–

å‰ç«¯æ—¶é—´æ ¼å¼åŒ–ï¼š

```plain
ä¸‹è½½ä¸€ä¸ªmomentæ ¼å¼åŒ–å·¥å…· npm i moment
```

![0ecd0796-816b-4b64-b660-ff6536e90445](./assets/11ç”¨æˆ·é€€å‡ºé˜Ÿä¼+å‰ç«¯é˜Ÿä¼ç•Œé¢/0ecd0796-816b-4b64-b660-ff6536e90445.png)

åç«¯æ—¶é—´æ ¼å¼åŒ–

![cf56c484-d232-4975-a1a7-1567785c8f58](./assets/11ç”¨æˆ·é€€å‡ºé˜Ÿä¼+å‰ç«¯é˜Ÿä¼ç•Œé¢/cf56c484-d232-4975-a1a7-1567785c8f58.png)



åœ¨expireTimeå±æ€§åŠ ä¸Šä¸€ä¸ªæ ¼å¼åŒ–æ³¨è§£ï¼Œå¹¶ç»™å®šæ ¼å¼

![6fd18ed0-dc53-4b18-9980-fdc140c7170f](./assets/11ç”¨æˆ·é€€å‡ºé˜Ÿä¼+å‰ç«¯é˜Ÿä¼ç•Œé¢/6fd18ed0-dc53-4b18-9980-fdc140c7170f.png)

#### (3).æœ€å¤§äººæ•°

è¿™é‡Œæˆ‘ä»¬é€‰æ‹©Stepperæ­¥è¿›å™¨é‡Œçš„é™åˆ¶è¾“å…¥èŒƒå›´  
![1669292724786-163fefeb-8da1-452e-84a5-9905b02d3d2f.png](./assets/11ç”¨æˆ·é€€å‡ºé˜Ÿä¼+å‰ç«¯é˜Ÿä¼ç•Œé¢/1669292724786-163fefeb-8da1-452e-84a5-9905b02d3d2f-507198-1731571316606-54.png)



#### (4).é˜Ÿä¼çŠ¶æ€ï¼ˆå½“åªæœ‰é€‰æ‹©åŠ å¯†é˜Ÿä¼æ—¶ï¼Œæ‰ä¼šè·³å‡ºå¯†ç æ¡†ï¼‰


è¿™é‡Œæˆ‘ä»¬é€‰æ‹©è¡¨å•ç±»å‹é‡Œçš„å•é€‰æ¡†ï¼Œå’Œfieldè¾“å…¥æ¡†ã€‚  
**æ³¨æ„ä¸€å®šè¦åœ¨åˆ¤æ–­çŠ¶æ€æ—¶ï¼ŒæŠŠç±»å‹è½¬ä¸ºNumberï¼Œå› ä¸ºé€šè¿‡æ‰“å°å¯å¾—ï¼ŒçŠ¶æ€æ˜¯å­—ç¬¦ä¸²ç±»å‹çš„ã€‚**  
![1669293458952-25758af6-4243-4827-9b81-700582a8132d.png](./assets/11ç”¨æˆ·é€€å‡ºé˜Ÿä¼+å‰ç«¯é˜Ÿä¼ç•Œé¢/1669293458952-25758af6-4243-4827-9b81-700582a8132d-694973-1731571316606-55.png)



#### (5).æäº¤æŒ‰é’®


![1669295146396-520c4ad1-6cc9-4b64-8243-8a5b47722915.png](./assets/11ç”¨æˆ·é€€å‡ºé˜Ÿä¼+å‰ç«¯é˜Ÿä¼ç•Œé¢/1669295146396-520c4ad1-6cc9-4b64-8243-8a5b47722915-088638-1731571316606-56.png)



native-type="submit"å±æ€§ï¼Œ ç‚¹å‡»è‡ªåŠ¨è·å–van-field nameä¸­çš„å€¼ç»„æˆçš„å¯¹è±¡ã€‚  
å…³é”®æ˜¯æäº¤æ‰€ä¼ çš„çš„çŠ¶æ€ä¹Ÿè¦è½¬æ¢æˆNumberï¼ŒåŒæ—¶åˆ›å»ºæˆåŠŸåè·³è½¬åˆ°é˜Ÿä¼é¡µé¢



![1669297230005-310758ce-d41c-42cc-868c-7de581d7a968.png](./assets/11ç”¨æˆ·é€€å‡ºé˜Ÿä¼+å‰ç«¯é˜Ÿä¼ç•Œé¢/1669297230005-310758ce-d41c-42cc-868c-7de581d7a968-810961-1731571316606-57.png)



AddTeamPageé¡µé¢å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š



```vue
<!--
User:Shier
CreateTime:19:54
-->
<template>
  <div id="teamAddPage">
    <van-form @submit="onSubmit">
      <van-cell-group inset>
        <van-field
            v-model="addTeamData.name"
            name="name"
            label="é˜Ÿä¼åç§°"
            placeholder="è¯·è¾“å…¥é˜Ÿä¼åç§°"
            :rules="[{ required: true, message: 'è¯·è¾“å…¥é˜Ÿä¼åç§°' }]"
        />
        <van-field
            v-model="addTeamData.description"
            rows="4"
            autosize
            label="é˜Ÿä¼æè¿°"
            type="textarea"
            placeholder="è¯·è¾“å…¥é˜Ÿä¼æè¿°"
        />
        <!--è¿‡æœŸæ—¶é—´-->
        <van-field
            is-link
            readonly
            name="datePicker"
            label="æ—¶é—´é€‰æ‹©"
		   :placeholder="addTeamData.expireTime?addTeamData.expireTime:'ç‚¹å‡»é€‰æ‹©é˜Ÿä¼è¿‡æœŸæ—¶é—´'"
            @click="showPicker = true"
        />
        <van-popup v-model:show="showPicker" position="bottom">
          <van-date-picker
              @confirm="onConfirm"
              @cancel="showPicker = false"
              type="datetime"
              title="è¯·é€‰æ‹©å…³é—­é˜Ÿä¼åŠ å…¥çš„æ—¶é—´"
              :min-date="minDate"/>
        </van-popup>

        <van-field name="stepper" label="æœ€å¤§äººæ•°">
          <template #input>
            <van-stepper v-model="addTeamData.maxNum" max="10" min="3"/>
          </template>
        </van-field>

        <van-field name="radio" label="é˜Ÿä¼çŠ¶æ€">
          <template #input>
            <van-radio-group v-model="addTeamData.status" direction="horizontal">
              <van-radio name="0">å…¬å¼€</van-radio>
              <van-radio name="1">ç§æœ‰</van-radio>
              <van-radio name="2">åŠ å¯†</van-radio>
            </van-radio-group>
          </template>
        </van-field>

        <van-field
            v-if="Number(addTeamData.status) === 2"
            v-model="addTeamData.password"
            type="password"
            name="password"
            label="å¯†ç "
            placeholder="è¯·è¾“å…¥é˜Ÿä¼å¯†ç "
            :rules="[{ required: true, message: 'è¯·å¡«å†™å¯†ç ' }]"
        />
      </van-cell-group>
      <div style="margin: 16px;">
        <van-button round block type="primary" native-type="submit">
          æäº¤
        </van-button>
      </div>
    </van-form>
  </div>
</template>

<script setup lang="ts">

  import {useRouter} from "vue-router";
  import {ref} from "vue";
  import myAxios from "../plugins/myAxios";
  import moment from 'moment';
  import {showFailToast, showSuccessToast} from "vant/lib/vant.es";

  const router = useRouter();


  // æ—¥æœŸå±•ç¤ºå™¨
  const showPicker = ref(false);
  // å½“å‰æ—¶é—´
  const minDate = new Date();

  const onConfirm = ({selectedValues}) => {
    addTeamData.value.expireTime = selectedValues.join('-');
    showPicker.value = false;
  };

  const initFormData = {
    "name": "",
    "description": "",
    "expireTime": null,
    "maxNum": 5,
    "password": "",
    "status": 0,
  }

  // éœ€è¦ç”¨æˆ·å¡«å†™çš„è¡¨å•æ•°æ® å¯¹è±¡æ‰©å±•
  const addTeamData = ref({...initFormData})

  // æäº¤
  const onSubmit = async () => {
    const postData = {
      ...addTeamData.value,
      status: Number(addTeamData.value.status),
      expireTime: moment(addTeamData.value.expireTime).format("YYYY-MM-DD HH:mm:ss")
    }
    const res = await myAxios.post("/team/add", postData);
    if (res?.code === 0 && res.data) {
      showSuccessToast('æ·»åŠ æˆåŠŸ');
      router.push({
        path: '/team',
        replace: true,
      });
    } else {
      showFailToast('æ·»åŠ å¤±è´¥');
    }
  }
</script>

<style scoped>
  #teamPage {

  }
</style>
```



#### (6).å¯åŠ¨å‰åç«¯é¡¹ç›®ï¼Œæµ‹è¯•

å‰ç«¯é¡µé¢æ˜¾ç¤ºå¦‚ä¸‹  
![1669301419901-d39e5ea4-f5bb-472a-97a5-4df4e22e4524.png](./assets/11ç”¨æˆ·é€€å‡ºé˜Ÿä¼+å‰ç«¯é˜Ÿä¼ç•Œé¢/1669301419901-d39e5ea4-f5bb-472a-97a5-4df4e22e4524-537124-1731571316606-58.png)  
è¾“å…¥æ•°æ®ï¼Œæäº¤ã€‚æˆ‘è¿™è¾¹å·²ç»æ·»åŠ é˜Ÿä¼äº†ï¼ˆå¿˜è®°æˆªå›¾äº†)ï¼Œå¦‚æœæ­£ç¡®çš„è¯ï¼ŒæˆåŠŸè·³è½¬  
æ•°æ®åº“æˆåŠŸåŠ å…¥æ•°æ®  
![image-20241115161846711](./assets/11ç”¨æˆ·é€€å‡ºé˜Ÿä¼+å‰ç«¯é˜Ÿä¼ç•Œé¢/image-20241115161846711.png)



### 3.è®¾è®¡é˜Ÿä¼åˆ—è¡¨


#### 1.æˆ‘ä»¬é¦–å…ˆè¦å®šä¹‰é˜Ÿä¼ç±»å‹ï¼ˆteam.d.tsï¼‰


```typescript
import {UserType} from "./user";

/**
 * é˜Ÿä¼ç±»åˆ«
 */
export type TeamType = {
    id: number;
    name: string;
    description: string;
    expireTime?: Date;//è¡¨ç¤ºå¯æœ‰å¯æ— 
    maxNum: number;
    password?: string,
    // todo å®šä¹‰æšä¸¾å€¼ç±»å‹ï¼Œæ›´è§„èŒƒ
    status: number;
    createTime: Date;
    updateTime: Date;
    createUser?: UserType;
    hasJoinNum?: number;
};
```



#### 2.åˆ›å»ºä¸€ä¸ªé˜Ÿä¼å¡ç‰‡åˆ—è¡¨ç»„ä»¶ï¼ˆç±»ä¼¼äºç”¨æˆ·å¡ç‰‡åˆ—è¡¨ï¼‰


#### (1).å¤åˆ¶ç”¨æˆ·å¡ç‰‡åˆ—è¡¨ï¼Œå°†userlistæ”¹ä¸ºteamlistï¼ŒUserCardListæ”¹ä¸ºTeamCardListï¼ŒUserTypeæ”¹ä¸ºTeamType


```vue
<template>
  <van-card
      v-for="user in props.teamList"
      :desc="user.profile"
      :title="`${user.username} (${user.planetCode})`"
      :thumb="user.avatarUrl"
  >
    <template #tags>
      <van-tag plain type="danger" v-for="tag in user.tags" style="margin-right: 8px; margin-top: 8px" >
        {{ tag }}
      </van-tag>
    </template>
    <template #footer>
      <van-button size="mini">è”ç³»æˆ‘</van-button>
    </template>
  </van-card>
</template>

<script setup lang="ts">

import {TeamType} from "../models/team";

interface TeamCardListProps{
  teamList: TeamType[];
}

const props= withDefaults(defineProps<TeamCardListProps>(),{
  //@ts-ignore
  teamList: [] as TeamType[]
});

</script>

<style scoped>

</style>
```



#### (2).ç„¶åæˆ‘ä»¬å°†æ­¤ç»„ä»¶æŒ‚è½½åœ¨TeamPageé¡µé¢


![1669335317937-6a77c439-f3ad-48e0-9e1d-a34c5c48ad19.png](./assets/11ç”¨æˆ·é€€å‡ºé˜Ÿä¼+å‰ç«¯é˜Ÿä¼ç•Œé¢/1669335317937-6a77c439-f3ad-48e0-9e1d-a34c5c48ad19-096156-1731571316606-60.png)



![1669335335131-a21e7991-817d-4e22-97dc-32234ccc6c98.png](./assets/11ç”¨æˆ·é€€å‡ºé˜Ÿä¼+å‰ç«¯é˜Ÿä¼ç•Œé¢/1669335335131-a21e7991-817d-4e22-97dc-32234ccc6c98-020179-1731571316606-61.png)



æ³¨æ„ï¼šå¼•å…¥team-card-listæ—¶ï¼Œç¼–è¯‘å™¨å¯èƒ½ä¸ä¼šå¸®ä½ æŠŠå¼•å…¥çš„ç±»å‹è‡ªåŠ¨å¸¦ä¸Šï¼Œéœ€è‡ªå·±æ·»åŠ 



![1669335416426-c0876613-7b5e-48b3-a32b-67919fd15f38.png](./assets/11ç”¨æˆ·é€€å‡ºé˜Ÿä¼+å‰ç«¯é˜Ÿä¼ç•Œé¢/1669335416426-c0876613-7b5e-48b3-a32b-67919fd15f38-128355-1731571316606-63.png)



å°†team-card-listé‡Œçš„åŸæ¥çš„ç”¨æˆ·å‚æ•°æ¢æˆé˜Ÿä¼çš„ï¼Œæµ‹è¯•ä¸€ä¸‹



![1669343687727-02a364c7-5a8d-41a3-8a24-4c1a9f7dd582.png](./assets/11ç”¨æˆ·é€€å‡ºé˜Ÿä¼+å‰ç«¯é˜Ÿä¼ç•Œé¢/1669343687727-02a364c7-5a8d-41a3-8a24-4c1a9f7dd582-244190-1731571316606-64.png)



åˆ·æ–°é¡µé¢ï¼ŒæˆåŠŸåŠ è½½å‡ºç»„ä»¶ï¼ˆå°±æ˜¯å¾ˆä¸‘ï¼Œå±•ç¤ºä¸é½å…¨ï¼‰  
![1669335581021-bd1120f9-8c3c-4296-969e-7383c517351c.png](./assets/11ç”¨æˆ·é€€å‡ºé˜Ÿä¼+å‰ç«¯é˜Ÿä¼ç•Œé¢/1669335581021-bd1120f9-8c3c-4296-969e-7383c517351c-487590-1731571316606-62.png)



#### (3).ç°åœ¨æˆ‘ä»¬è¦å®Œå–„teamcardlistç»„ä»¶

æ·»åŠ é˜Ÿä¼çŠ¶æ€ï¼Œæœ€å¤§äººæ•°ç­‰ä»¥åŠå®ç°åŠ å…¥é˜Ÿä¼åŠŸèƒ½  
æˆ‘ä»¬ä¸‹æ–¹è¦æ¶‰åŠåˆ°é˜Ÿä¼çš„çŠ¶æ€ï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºé˜Ÿä¼çŠ¶æ€å¸¸é‡ team.ts  
![1669343903878-93855297-1af2-4c56-a6a5-9b88bfc2c171.png](./assets/11ç”¨æˆ·é€€å‡ºé˜Ÿä¼+å‰ç«¯é˜Ÿä¼ç•Œé¢/1669343903878-93855297-1af2-4c56-a6a5-9b88bfc2c171-797000-1731571316606-65.png)  
å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š

```vue
<template>
  <van-card
      v-for="team in props.teamList"
      :desc="team.description"
      :title="team.name"
      :thumb="avatar"
  >
    <template #tags>
      <van-space wrap style="margin-top: 5px">
        <van-tag plain type="danger">{{ teamStatusEnum[team.status] }}</van-tag>
      </van-space>
    </template>

    <template #bottom>
      <div>{{ 'æœ€å¤§äººæ•°' + team.maxNum }}</div>
      <div v-if="team.expireTime">{{ 'è¿‡æœŸæ—¶é—´' + team.expireTime }}</div>
      <div>{{ 'åˆ›å»ºæ—¶é—´' + team.createTime }}</div>
    </template>

    <template #footer>
      <van-button size="small" type="primary" plain @click="doJoinTeam(team.id)">åŠ å…¥é˜Ÿä¼</van-button>
    </template>
  </van-card>
</template>

<script setup lang="ts">

import {defineProps} from "vue";
import {TeamType} from "../models/team";
import avatar from "../assets/avatar.jpeg"
import {teamStatusEnum} from "../constants/team";
import myAxios from "../plugins/myAxios.js";
import {showFailToast, showSuccessToast} from "vant";

interface TeamCardListProps {
  teamList: TeamType[];
}

//propsèƒ½å¤Ÿå¾—åˆ°çˆ¶ç»„ä»¶ä¼ é€’è¿‡æ¥çš„å±æ€§æ¯”å¦‚teamList
const props = defineProps<TeamCardListProps>();

const doJoinTeam = async (id : number) => {
  const res = await myAxios.post("/team/join",{
    id:id,
  })
  console.log(id);
  if(res?.code === 0){
    showSuccessToast("åŠ å…¥æˆåŠŸ");
  }else{
    showFailToast( res.message ? res.message : "");
  }
}
</script>

<style scoped>

</style>
```



æ³¨æ„ï¼š1.è¿™é‡Œthumbæˆ‘ä»¬å¼•å…¥äº†å›¾ç‰‡ï¼ˆæ˜¾ç¤ºæ›´ç¾è§‚ï¼‰ï¼Œå¯ä»¥æŠŠè‡ªå·±å¿ƒä»ªçš„å›¾ç‰‡æ”¾å…¥assetsé‡Œå¹¶å¼•å…¥  

2. åŠ å…¥é˜Ÿä¼é‡Œé¢å¤±è´¥ï¼Œå†™çš„å½¢å¼æ˜¯æ¨¡æ¿å­—ç¬¦ä¸²ï¼Œå¯è‡ªè¡Œäº†è§£  
3. å¼•å…¥æ ·å¼ï¼ŒåŸæ¥çš„å›¾ç‰‡è¿‡äºå®½ï¼Œè¦æŒ‡å®šé«˜åº¦å…³é—­è‡ªé€‚åº”ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨æ ·å¼ç©¿é€ï¼Œä¸ç„¶ä¸èµ·ä½œç”¨ï¼Œ**å¦‚æœæˆ‘ä»¬ç»™éƒ¨åˆ†ç»„ä»¶å¼•å…¥çš„æ ·å¼ä¸èµ·ä½œç”¨ï¼Œéƒ½å¯ä»¥ä½¿ç”¨æ ·å¼ç©¿é€ï¼**



#### (4).æµ‹è¯•

ä½¿ç”¨newfbin002ç™»å½•ï¼Œå†åŠ å…¥é˜Ÿä¼ï¼ŒåŠ å…¥æˆåŠŸ
![image-20241115172348127](./assets/11ç”¨æˆ·é€€å‡ºé˜Ÿä¼+å‰ç«¯é˜Ÿä¼ç•Œé¢/image-20241115172348127.png)



## ç¬¬åä¸€æœŸğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰


> æ›´æ–°: 2023-02-10 10:06:52  
> åŸæ–‡: <https://www.yuque.com/shierkcs/catstudy/uyq3aex2vvk5722u>