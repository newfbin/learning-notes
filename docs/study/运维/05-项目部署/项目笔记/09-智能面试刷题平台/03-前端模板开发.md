## æœ¬èŠ‚é‡ç‚¹

å­¦ä¹ å‰ç«¯æœåŠ¡ç«¯æ¸²æŸ“ç½‘ç«™æ¨¡æ¿çš„å¼€å‘ï¼Œå¹¶ä¸”å®Œæˆé¢è¯•åˆ·é¢˜å¹³å° Web å‰ç«¯çš„éƒ¨åˆ†åŸºç¡€é¡µé¢ï¼ŒåŒ…æ‹¬ï¼š

- éœ€æ±‚åˆ†æ
- Web å‰ç«¯æŠ€æœ¯é€‰å‹
- Next.js å‰ç«¯ä¸‡ç”¨æ¨¡æ¿å¼€å‘ï¼ˆWeb å‰ç«¯é¡¹ç›®åˆå§‹åŒ–ï¼‰

## ä¸€ã€éœ€æ±‚åˆ†æ

### éœ€æ±‚åˆ—è¡¨

#### åŸºç¡€åŠŸèƒ½ï¼ˆå‡ä¸º P0ï¼‰

- ç”¨æˆ·æ¨¡å—
- - ç”¨æˆ·æ³¨å†Œ
  - ç”¨æˆ·ç™»å½•ï¼ˆè´¦å·å¯†ç ï¼‰
  - ã€ç®¡ç†å‘˜ã€‘ç®¡ç†ç”¨æˆ· - å¢åˆ æ”¹æŸ¥
- é¢˜åº“æ¨¡å—
- - æŸ¥çœ‹é¢˜åº“åˆ—è¡¨
  - æŸ¥çœ‹é¢˜åº“è¯¦æƒ…ï¼ˆå±•ç¤ºé¢˜åº“ä¸‹çš„é¢˜ç›®ï¼‰
  - ã€ç®¡ç†å‘˜ã€‘ç®¡ç†é¢˜åº“ - å¢åˆ æ”¹æŸ¥
- é¢˜ç›®æ¨¡å—
- - é¢˜ç›®æœç´¢
  - æŸ¥çœ‹é¢˜ç›®è¯¦æƒ…ï¼ˆè¿›å…¥åˆ·é¢˜é¡µé¢ï¼‰
  - ã€ç®¡ç†å‘˜ã€‘ç®¡ç†é¢˜ç›® - å¢åˆ æ”¹æŸ¥ï¼ˆæ¯”å¦‚æŒ‰ç…§é¢˜åº“æŸ¥è¯¢é¢˜ç›®ã€ä¿®æ”¹é¢˜ç›®æ‰€å±é¢˜åº“ç­‰ï¼‰

#### é«˜çº§åŠŸèƒ½ï¼ˆå‡ä¸º P1 ~ P2ï¼‰

- é¢˜ç›®æ‰¹é‡ç®¡ç† P1
- - ã€ç®¡ç†å‘˜ã€‘æ‰¹é‡å‘é¢˜åº“æ·»åŠ é¢˜ç›®
  - ã€ç®¡ç†å‘˜ã€‘æ‰¹é‡ä»é¢˜åº“ç§»é™¤é¢˜ç›®
  - ã€ç®¡ç†å‘˜ã€‘æ‰¹é‡åˆ é™¤é¢˜ç›®
- åˆ†è¯é¢˜ç›®æœç´¢ P1
- ç”¨æˆ·åˆ·é¢˜è®°å½•æ—¥å†å›¾ P1
- è‡ªåŠ¨ç¼“å­˜çƒ­é—¨é¢˜ç›® P2
- ç½‘ç«™æµé‡æ§åˆ¶å’Œç†”æ–­ P2
- åŠ¨æ€ IP é»‘ç™½åå•è¿‡æ»¤ P2
- åŒç«¯ç™»å½•å†²çªæ£€æµ‹ P2
- åˆ†çº§é¢˜ç›®åçˆ¬è™«ç­–ç•¥ P2

### æœ¬èŠ‚é¢„æœŸå®Œæˆçš„éœ€æ±‚

ä¸æ¶‰åŠå¤æ‚çš„ä¸šåŠ¡ï¼Œä»…å¼€å‘é€šç”¨çš„ç”¨æˆ·æ³¨å†Œç™»å½•å’Œæ•°æ®ç®¡ç†èƒ½åŠ›ã€‚

- ç”¨æˆ·æ¨¡å—
- - ç”¨æˆ·æ³¨å†Œ âœ…
  - ç”¨æˆ·ç™»å½•ï¼ˆè´¦å·å¯†ç ï¼‰âœ…
  - ã€ç®¡ç†å‘˜ã€‘ç®¡ç†ç”¨æˆ· - å¢åˆ æ”¹æŸ¥ âœ…
- é¢˜åº“æ¨¡å—
- - ã€ç®¡ç†å‘˜ã€‘ç®¡ç†é¢˜åº“ - å¢åˆ æ”¹æŸ¥ âœ…
- é¢˜ç›®æ¨¡å—
- - ã€ç®¡ç†å‘˜ã€‘ç®¡ç†é¢˜ç›® - å¢åˆ æ”¹æŸ¥ âœ…

## äºŒã€Web å‰ç«¯æŠ€æœ¯é€‰å‹

### æœ¬é¡¹ç›®é€‰å‹

- React 18 æ¡†æ¶
- â­ï¸ Next.js æœåŠ¡ç«¯æ¸²æŸ“
- â­ï¸ Redux çŠ¶æ€ç®¡ç†
- Ant Design ç»„ä»¶åº“
- å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ç»„ä»¶
- â­ï¸ å‰ç«¯å·¥ç¨‹åŒ–ï¼šESLint + Prettier + TypeScript
- â­ï¸ OpenAPI å‰ç«¯ä»£ç ç”Ÿæˆ

å…¶ä¸­ï¼ŒNext.js æœåŠ¡ç«¯æ¸²æŸ“æŠ€æœ¯æ˜¯æœ¬é¡¹ç›®å­¦ä¹ çš„é‡ç‚¹ï¼Œä¹Ÿæ˜¯å‰ç«¯å¼€å‘çš„æŠ€æœ¯äº®ç‚¹ã€‚

### æœåŠ¡ç«¯æ¸²æŸ“ä»‹ç»

#### 1ã€ä»€ä¹ˆæ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ¸²æŸ“ï¼Ÿ

ç½‘ç«™æ¸²æŸ“å¯ä»¥åœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¸¤ç§ç¯å¢ƒä¸‹è¿›è¡Œã€‚

![img](./assets/03-å‰ç«¯æ¨¡æ¿å¼€å‘/F53gT3xTISQIESnq-1737276768265-79.webp)

åœ¨å®¢æˆ·ç«¯æ¸²æŸ“ï¼ˆClient-Side Renderingï¼ŒCSRï¼‰ä¸­ï¼Œå®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰ä¼šå…ˆå‘æœåŠ¡å™¨è¯·æ±‚ HTML æ–‡ä»¶ï¼ŒæœåŠ¡å™¨ä¼šè¿”å›ä¸€ä¸ªåŸºç¡€çš„ HTML æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«å¿…è¦çš„ JavaScript è„šæœ¬ã€‚è¿™äº›è„šæœ¬åœ¨æµè§ˆå™¨ç«¯è¿è¡Œï¼ŒåŠ¨æ€è¯·æ±‚åç«¯çš„æ•°æ®ã€ç”Ÿæˆç½‘é¡µå†…å®¹å¹¶æ¸²æŸ“åˆ°é¡µé¢ä¸Šã€‚

æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆServer-Side Renderingï¼ŒSSRï¼‰ æ˜¯ä¸€ç§å°†ç½‘é¡µåœ¨ **æœåŠ¡å™¨ç«¯** ç”Ÿæˆå¹¶æ¸²æŸ“ä¸º HTML å†…å®¹çš„æŠ€æœ¯ã€‚åœ¨è¿™ç§æ–¹å¼ä¸‹ï¼Œå½“ç”¨æˆ·è¯·æ±‚ä¸€ä¸ªç½‘é¡µæ—¶ï¼ŒæœåŠ¡å™¨ä¼šæå‰è°ƒç”¨åç«¯èƒ½è·å–æ•°æ®å¹¶ç”Ÿæˆå®Œæ•´çš„ HTML æ–‡æ¡£ï¼Œç„¶åå°†å…¶å‘é€åˆ°å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰ã€‚æµè§ˆå™¨æ¥æ”¶åˆ° HTML åï¼Œç›´æ¥å±•ç¤ºé¡µé¢å†…å®¹ï¼Œä¸ç”¨å†åŠ¨æ€åœ°å‘åç«¯å‘é€è¯·æ±‚æ¥è·å–æ•°æ®ã€‚

æœåŠ¡ç«¯æ¸²æŸ“çš„å·¥ä½œæµç¨‹é€šå¸¸å¦‚ä¸‹ï¼š

1. ç”¨æˆ·å‘é€è¯·æ±‚åˆ°æœåŠ¡å™¨
2. æœåŠ¡å™¨å¤„ç†è¯·æ±‚ï¼Œè°ƒç”¨åç«¯è·å–æ•°æ®ï¼Œå¹¶ç”Ÿæˆå®Œæ•´çš„ HTML é¡µé¢
3. æœåŠ¡å™¨å°†ç”Ÿæˆçš„ HTML é¡µé¢è¿”å›ç»™å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰
4. æµè§ˆå™¨æ¥æ”¶åˆ° HTML åï¼Œç›´æ¥æ¸²æŸ“é¡µé¢

#### 2ã€å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ¸²æŸ“çš„åŒºåˆ«ï¼Ÿ

å®¢æˆ·ç«¯æ¸²æŸ“å’ŒæœåŠ¡ç«¯æ¸²æŸ“çš„ä¸»è¦åŒºåˆ«åœ¨äºæ¸²æŸ“è¿‡ç¨‹å‘ç”Ÿçš„åœ°ç‚¹ã€‚

ç”±äº Ajaxã€Vueã€React ç­‰æ–°æŠ€æœ¯çš„å´›èµ·ï¼Œå¤§å¤šæ•°å­¦å‰ç«¯çš„åŒå­¦å¼€å‘çš„ç½‘ç«™éƒ½æ˜¯åŸºäºå®¢æˆ·ç«¯æ¸²æŸ“å®ç°çš„ï¼Œå®¢æˆ·ç«¯æ¸²æŸ“çš„ä¼˜ç‚¹ä¸»è¦æ˜¯ï¼š

1. å¼€å‘æ–¹ä¾¿çµæ´»ï¼šå¼€å‘è€…ä¸éœ€è¦åŒºåˆ†å“ªäº›æ•°æ®è¦åœ¨æœåŠ¡ç«¯åŠ è½½ã€å“ªäº›æ•°æ®è¦åœ¨å®¢æˆ·ç«¯åŠ è½½ï¼Œä¹Ÿä¸ç”¨æ‹…å¿ƒå“ªäº› API æ— æ³•åœ¨æœåŠ¡ç«¯ä½¿ç”¨ã€‚ä¾¿äºå®ç°æ›´åŠ å¤æ‚å’ŒåŠ¨æ€çš„ç”¨æˆ·ç•Œé¢ï¼Œé€‚åˆæ„å»ºå•é¡µåº”ç”¨ï¼ˆSPAï¼‰å’Œéœ€è¦é¢‘ç¹äº¤äº’çš„åº”ç”¨ã€‚
2. å‡å°‘æœåŠ¡å™¨å‹åŠ›ï¼šç”±äºæ¸²æŸ“å·¥ä½œç”±å®¢æˆ·ç«¯ï¼ˆç”¨æˆ·è‡ªå·±çš„ç”µè„‘ï¼‰å®Œæˆï¼Œå› æ­¤æœåŠ¡å™¨çš„è´Ÿè½½ç›¸å¯¹è¾ƒå°ï¼Œåªéœ€è¦æä¾›é™æ€èµ„æºï¼ˆæ¯”å¦‚ä½¿ç”¨ Nginx å°±èƒ½å®Œæˆéƒ¨ç½²ï¼‰ã€‚

ä»¥æˆ‘ä»¬çš„ [ç¼–ç¨‹å¯¼èˆªç½‘ç«™](https://www.code-nav.cn/) ä¸ºä¾‹ï¼Œå°±ä½¿ç”¨äº†å®¢æˆ·ç«¯æ¸²æŸ“ï¼Œå¯ä»¥çœ‹åˆ°åˆšå¼€å§‹åŠ è½½çš„ HTML æ–‡æ¡£å¹¶ä¸åŒ…å«ç½‘ç«™çš„æ•°æ®ï¼Œåªæœ‰ä¸€ä¸ªæ ‡é¢˜ã€ä»¥åŠä¸€ä¸ª JS è„šæœ¬ã€‚

![img](./assets/03-å‰ç«¯æ¨¡æ¿å¼€å‘/C90Cjo0fn7p8OaHf-1737276768265-80.webp)

æµè§ˆå™¨ä¼šæ‰§è¡Œè¯¥è„šæœ¬ï¼Œå¹¶è§¦å‘åç»­çš„æ•°æ®åŠ è½½æµç¨‹ï¼Œé€æ¸åŠ è½½æ˜¾ç¤ºæ•´ä¸ªé¡µé¢ï¼Œæ‰€ä»¥çœ‹åˆ°è¯·æ±‚çš„è¿‡ç¨‹æ˜¯æ–­æ–­ç»­ç»­çš„ã€‚

![img](./assets/03-å‰ç«¯æ¨¡æ¿å¼€å‘/FiDbOzjjbgvi45vw-1737276768265-81.webp)

è€Œæˆ‘ä»¬çš„ [é¢è¯•åˆ·é¢˜ç½‘ç«™ - é¢è¯•é¸­](https://www.mianshiya.com/) ä½¿ç”¨çš„æ˜¯æœåŠ¡ç«¯æ¸²æŸ“ï¼Œå¯ä»¥çœ‹åˆ°ï¼ŒæœåŠ¡ç«¯è¿”å›çš„ HTML æ–‡æ¡£ä¸­ï¼Œå°±å·²ç»æœ‰å®Œæ•´çš„ç½‘ç«™æ•°æ®å’Œæ ·å¼äº†ï¼š

![img](./assets/03-å‰ç«¯æ¨¡æ¿å¼€å‘/sycWFgzSOThKtcf3-1737276768266-82.webp)

æœåŠ¡ç«¯æ¸²æŸ“çš„å¥½å¤„æ˜¯ï¼š

1. å‡å°‘åˆå§‹åŠ è½½æ—¶é—´ï¼šSSR é¡µé¢å¯ä»¥åœ¨é¦–æ¬¡åŠ è½½æ—¶å±•ç¤ºå®Œæ•´å†…å®¹ï¼Œå‡å°‘ç™½å±æ—¶é—´ï¼Œè€Œ CSR é€šå¸¸éœ€è¦ç­‰å¾… JavaScript åŠ è½½å’Œæ‰§è¡Œåæ‰èƒ½å±•ç¤ºå†…å®¹ã€‚
2. SEO å‹å¥½ï¼šSSR æ›´æœ‰åˆ©äº SEOï¼Œå› ä¸ºæœç´¢å¼•æ“çˆ¬è™«èƒ½å¤Ÿç›´æ¥æŠ“å–å®Œæ•´é¡µé¢çš„å†…å®¹ï¼Œè€Œä¸ä¾èµ–äº JavaScript æ‰§è¡Œã€‚

ä½†ç›¸åº”çš„ï¼ŒSSR å°†æ¸²æŸ“ä»»åŠ¡äº¤ç»™æœåŠ¡å™¨ï¼Œå¯èƒ½ä¼šå¢åŠ æœåŠ¡å™¨çš„è´Ÿè½½å’Œå‹åŠ›ã€‚æ‰€ä»¥ SSR æ›´é€‚åˆè¿½æ±‚æ€§èƒ½å’Œ SEO çš„ä¼ä¸šçº§é¡¹ç›®ã€‚

èƒ½å¤Ÿå®ç°æœåŠ¡ç«¯æ¸²æŸ“çš„æŠ€æœ¯å¾ˆå¤šï¼Œä»¥å‰æœ‰ Java çš„ JSPã€PHP ç­‰ç­‰ï¼Œç°åœ¨æœ‰åŸºäº React çš„ Next.js å’ŒåŸºäº Vue çš„ Nuxt.js æ¡†æ¶ï¼Œå¯ä»¥è®©ä½ ç›´æ¥ç”¨å‰ç«¯çš„è¯­æ³•å¼€å‘æœåŠ¡ç«¯æ¸²æŸ“é¡¹ç›®ã€‚

#### 3ã€å…¶ä»–æ¸²æŸ“æ–¹å¼ - é™æ€ç½‘ç«™ç”Ÿæˆ

é™æ€ç½‘ç«™ç”Ÿæˆï¼ˆStatic Site Generationï¼ŒSSGï¼‰æ˜¯ä¸€ç§åœ¨æ„å»ºé˜¶æ®µç”Ÿæˆé™æ€ HTML æ–‡ä»¶çš„æŠ€æœ¯ã€‚ä¸æœåŠ¡ç«¯æ¸²æŸ“ä¸åŒï¼Œé™æ€ç½‘ç«™ç”Ÿæˆæ˜¯åœ¨æ„å»ºæ—¶ï¼ˆè€Œä¸æ˜¯ç”¨æˆ·è¯·æ±‚æ—¶ï¼‰ç”Ÿæˆé¡µé¢ï¼Œæ‰€æœ‰é¡µé¢éƒ½ä»¥é™æ€æ–‡ä»¶çš„å½¢å¼å­˜åœ¨ã€‚

è¿™ç§æ–¹å¼æœ¬è´¨ä¸Šä¹Ÿæ˜¯å®¢æˆ·ç«¯æ¸²æŸ“ï¼Œä½†æ˜¯ä¸éœ€è¦ç”±å®¢æˆ·ç«¯å†åŠ¨æ€åœ°å‘åç«¯å‘é€è¯·æ±‚æ¥è·å–æ•°æ®ï¼Œè¿™äº›é™æ€æ–‡ä»¶å¯ä»¥ç›´æ¥ç”±å†…å®¹åˆ†å‘ç½‘ç»œï¼ˆCDNï¼‰æˆ–é™æ€æœåŠ¡å™¨æä¾›ã€‚

ä¼˜ç‚¹ï¼š

1. é«˜æ€§èƒ½ï¼šç”±äºæœåŠ¡å™¨ä»…éœ€æä¾›é™æ€æ–‡ä»¶ï¼Œæ€§èƒ½æé«˜ï¼›è€Œä¸”ç”±äºæ•°æ®ä¸å˜åŒ–ï¼Œç‰¹åˆ«é€‚åˆé€šè¿‡ CDN ç¼“å­˜åŠ é€Ÿã€‚
2. SEO å‹å¥½ï¼šæœç´¢å¼•æ“æœ€å–œæ¬¢çš„å°±æ˜¯é™æ€ HTML æ–‡ä»¶ï¼Œå¯ä»¥è½»æ¾ç´¢å¼•å¹¶æå‡ SEO æ•ˆæœã€‚
3. ç®€åŒ–åŸºç¡€è®¾æ–½ï¼šæ— éœ€å¤æ‚çš„å‰åç«¯äº¤äº’é€»è¾‘ï¼Œé™æ€æ–‡ä»¶çš„éƒ¨ç½²å’Œç»´æŠ¤æˆæœ¬è¾ƒä½ã€‚

ç¼ºç‚¹ï¼š

1. åŠ¨æ€å†…å®¹æœ‰é™ï¼šSSG é€‚åˆå†…å®¹å˜åŒ–ä¸é¢‘ç¹çš„åœºæ™¯ï¼Œå¯¹äºéœ€è¦å®æ—¶æ›´æ–°å†…å®¹çš„ç½‘ç«™ï¼Œç”Ÿæˆé™æ€é¡µé¢å¯èƒ½ä¸å¤Ÿçµæ´»ã€‚
2. æ„å»ºæ—¶é—´ï¼šç”Ÿæˆå¤§é‡é™æ€é¡µé¢æ—¶ï¼Œæ„å»ºæ—¶é—´å¯èƒ½è¾ƒé•¿ï¼Œç‰¹åˆ«æ˜¯æ•°æ®é‡å¤§çš„æ—¶å€™ã€‚

åŸºäºè¿™äº›ä¼˜ç¼ºç‚¹ï¼Œé™æ€ç½‘ç«™ç”Ÿæˆé€‚åˆå†…å®¹æ•°é‡æœ‰é™çš„ã€å†…å®¹åŸºæœ¬ä¸å˜çš„ç½‘ç«™ï¼Œæ¯”å¦‚ä¸ªäººåšå®¢ã€‚åƒ VuePressã€Hugoã€Hexoã€Astro éƒ½æ˜¯ä¸»æµçš„é™æ€ç½‘ç«™ç”Ÿæˆå™¨ã€‚

[é±¼çš®çš„ç¼–ç¨‹å®å…¸](https://www.codefather.cn/) å°±æ˜¯åŸºäº VuePress å¼€å‘çš„ï¼Œæ¨¡æ¿ä¹Ÿå¼€æºåˆ°äº† GitHub ä¸Šï¼šhttps://github.com/liyupi/codefather

![img](./assets/03-å‰ç«¯æ¨¡æ¿å¼€å‘/jqPsGeyo8rE6d0Ca-1737276768266-83.webp)

éšç€é™æ€ç½‘ç«™å†…å®¹è¶Šæ¥è¶Šå¤šï¼Œæ¯æ¬¡æ„å»ºä¼šè¶Šæ¥è¶Šæ…¢ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥é‡‡ç”¨å¢é‡é™æ€ç”ŸæˆæŠ€æœ¯ã€‚

å¢é‡é™æ€ç”Ÿæˆï¼ˆIncremental Static Regenerationï¼ŒISRï¼‰å…è®¸éƒ¨åˆ†é¡µé¢åœ¨æ„å»ºä¹‹åè¿›è¡Œæ›´æ–°ï¼Œè€Œæ— éœ€é‡æ–°æ„å»ºæ•´ä¸ªç«™ç‚¹ã€‚è¿™ç§æŠ€æœ¯é€‚ç”¨äºé‚£äº›å¤§å¤šæ•°å†…å®¹ä¸å˜ã€ä½†æŸäº›éƒ¨åˆ†éœ€è¦åŠ¨æ€æ›´æ–°çš„ç½‘ç«™ã€‚

å·¥ä½œæµç¨‹ï¼š

1. åœ¨æ„å»ºé˜¶æ®µï¼Œç”Ÿæˆåˆå§‹çš„é™æ€é¡µé¢ã€‚
2. å½“é¡µé¢å†…å®¹æ›´æ–°æ—¶ï¼Œé€šè¿‡é…ç½®çš„å†ç”Ÿæˆé—´éš”ï¼Œé™æ€é¡µé¢å¯ä»¥å¢é‡æ›´æ–°ï¼Œè€Œä¸æ˜¯é‡æ–°ç”Ÿæˆæ•´ä¸ªç«™ç‚¹ï¼Œå¤§å¹…å‡å°‘æ„å»ºæ—¶é—´ã€‚
3. ç”¨æˆ·è¯·æ±‚æ—¶ï¼Œå¦‚æœé¡µé¢å†…å®¹è¿‡æœŸæˆ–æ›´æ–°ï¼Œåˆ™åå°è‡ªåŠ¨ç”Ÿæˆæ–°çš„é™æ€é¡µé¢å¹¶ç¼“å­˜ã€‚

è¿™æ ·ä¸€æ¥ï¼Œå¯ä»¥åœ¨äº«å—é™æ€ç½‘ç«™é«˜æ€§èƒ½ã€SEO å‹å¥½ç‰¹æ€§çš„åŒæ—¶ï¼ŒåŠæ—¶æ›´æ–°ç½‘ç«™çš„å†…å®¹ï¼Œå¹¶å‡å°‘æ„å»ºæ—¶é—´ã€‚

ä¸è¿‡ç¼ºç‚¹å°±æ˜¯æ¶æ„æ›´å¤æ‚ã€ç»´æŠ¤æˆæœ¬æ›´é«˜ã€‚ä½†å€¼å¾—ä¸€æçš„æ˜¯ï¼Œå¾ˆå¤šå¤§å‹ç½‘ç«™ä¸ºäº†åš SEO ä¼˜åŒ–ï¼Œä¸“é—¨æŠŠåŠ¨æ€ç½‘ç«™è½¬ä¸ºé™æ€ HTMLï¼ˆé™æ€åŒ–ï¼‰ã€‚

#### 4ã€ç»“åˆä½¿ç”¨ï¼ˆæ¨èï¼‰

å®é™…æƒ…å†µä¸‹ï¼Œå‰é¢è®²åˆ°çš„å‡ ç§æ–¹å¼å¯ä»¥ç»“åˆä½¿ç”¨ã€‚

æ¯”å¦‚ **éƒ¨åˆ†é¢„æ¸²æŸ“**ï¼ˆPartial Prerenderingï¼ŒPPRï¼‰æ˜¯ä¸€ç§å°†æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆæˆ–é™æ€ç”Ÿæˆï¼‰ä¸å®¢æˆ·ç«¯æ¸²æŸ“ç»“åˆçš„æŠ€æœ¯ã€‚

å·¥ä½œæµç¨‹ï¼š

1. åœ¨æ„å»ºé˜¶æ®µæˆ–è¯·æ±‚é˜¶æ®µï¼Œé¡µé¢çš„é™æ€éƒ¨åˆ†é¢„å…ˆæ¸²æŸ“ï¼ˆå¦‚å¯¼èˆªæ ã€é¡µè„šç­‰ï¼‰ã€‚
2. é¡µé¢åŠ è½½æ—¶ï¼Œé™æ€éƒ¨åˆ†ç›´æ¥æ˜¾ç¤ºï¼ŒåŠ¨æ€éƒ¨åˆ†ç”± JavaScript åœ¨å®¢æˆ·ç«¯åŠ è½½å¹¶æ¸²æŸ“ã€‚
3. é€šè¿‡æ°´åˆï¼ˆHydrationï¼‰è¿‡ç¨‹ï¼Œå®¢æˆ·ç«¯çš„ JavaScript æ¥ç®¡å·²ç»æ¸²æŸ“çš„é™æ€å†…å®¹ï¼Œå¹¶ç»§ç»­å¤„ç†åŠ¨æ€äº¤äº’ã€‚

è¿™æ ·ä¸€æ¥ï¼Œå…¼å…·äº† SSR çš„ SEO å‹å¥½å’Œå¿«é€Ÿåˆå§‹åŠ è½½ã€ä»¥åŠ CSR çµæ´»åŠ¨æ€äº¤äº’çš„ä¼˜ç‚¹ã€‚

![img](./assets/03-å‰ç«¯æ¨¡æ¿å¼€å‘/WgJiF07x406OlvBh-1737276768266-84.webp)

è¿˜æœ‰ä¸€ä¸ªè·Ÿéƒ¨åˆ†é¢„æ¸²æŸ“ç›¸ä¼¼çš„æ¦‚å¿µå« **åŒæ„æ¸²æŸ“** ï¼Œæ˜¯æŒ‡åŒä¸€å¥—ä»£ç å¯ä»¥åœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯è¿è¡Œï¼Œå¹¶åœ¨æœåŠ¡ç«¯æ¸²æŸ“é¡µé¢çš„åˆå§‹å†…å®¹ï¼Œç„¶ååœ¨å®¢æˆ·ç«¯æ¥ç®¡æ¸²æŸ“å’Œäº¤äº’ã€‚

å®é™…æƒ…å†µä¸‹é±¼çš®ä¹Ÿæ›´æ¨èç”¨è¿™ç§æ–¹å¼ï¼Œæœ¬é¡¹ç›®é±¼çš®ä¹Ÿä¼šå¸¦å¤§å®¶ä½¿ç”¨ä¸»æµçš„ã€æ–°ç‰ˆæœ¬çš„ Next.js æ¡†æ¶å®ç°åŒæ„æ¸²æŸ“ã€‚ä¸‹é¢å…ˆä» 0 å¼€å§‹å¸¦å¤§å®¶åšä¸€ä¸ªåŸºäº Next.js çš„å‰ç«¯ä¸‡ç”¨é¡¹ç›®æ¨¡æ¿ã€‚

## ä¸‰ã€Next.js å‰ç«¯ä¸‡ç”¨æ¨¡æ¿å¼€å‘

è‡ªä¸»æ‰“é€ ä¸€å¥—å‰ç«¯å¼€å‘é¡¹ç›®æ¨¡æ¿ï¼

### ç¡®è®¤ç¯å¢ƒï¼ï¼ï¼

æ‰“å¼€ Next.js çš„å®˜æ–¹æ–‡æ¡£ï¼šhttps://nextjs.org/docs/getting-started/installation ï¼ˆæ³¨æ„ä¸è¦çœ‹æˆå›½å†…çš„æ–‡æ¡£äº†ï¼Œä¸å¤Ÿæ–°ï¼‰

æœ¬æ¬¡æˆ‘ä»¬è¦ä½¿ç”¨çš„æ˜¯ 14 ç‰ˆæœ¬çš„ Next.jsï¼Œå¯ä»¥çœ‹åˆ° Node.js çš„ç‰ˆæœ¬è¦æ±‚å¿…é¡» >= 18.18ï¼Œä¸€å®šè¦æ³¨æ„ï¼

æ£€æµ‹å‘½ä»¤ï¼š

```shell
node -v
```

åˆ‡æ¢å’Œç®¡ç† node ç‰ˆæœ¬çš„å·¥å…·ï¼šhttps://github.com/nvm-sh/nvm

```shell
npm -v
```

Next.js æœ‰ 2 ç§å¼€å‘æ¨¡å¼ï¼Œæ³¨æ„ï¼Œæœ¬é¡¹ç›®ç”¨çš„æ˜¯æ–°çš„å¼€å‘æ¨¡å¼ App Routerï¼Œä¸è¦çœ‹é”™äº†æ–‡æ¡£ï¼š

![img](./assets/03-å‰ç«¯æ¨¡æ¿å¼€å‘/SYqJc0Wo125Bb8pN-1737276768266-85.webp)

### åˆ›å»ºé¡¹ç›®

ç›´æ¥æŒ‰ç…§å®˜æ–¹æ–‡æ¡£çš„æŒ‡å¼•ï¼Œä½¿ç”¨ Npm è‡ªå¸¦çš„ Npx è„šæ‰‹æ¶å·¥å…· `create-next-app` æ¥è‡ªåŠ¨å®‰è£… Next.js åˆå§‹åŒ–é¡¹ç›®ï¼šhttps://nextjs.org/docs/getting-started/installation#automatic-installation

æ‰§è¡Œå®‰è£…å‘½ä»¤ï¼š

```shell
npx create-next-app@latest
```

å…¶ä¸­ï¼Œlatest è¡¨ç¤ºå½“å‰è„šæ‰‹æ¶çš„æœ€æ–°ç‰ˆæœ¬ã€‚é±¼çš®ä½¿ç”¨çš„ `create-next-app` è„šæ‰‹æ¶ç‰ˆæœ¬æ˜¯ `14.2.6`ï¼Œå¯ä»¥åœ¨ [npm åŒ…ç®¡ç†å™¨ç½‘ç«™](https://www.npmjs.com/package/create-next-app?activeTab=versions) æŸ¥çœ‹ç‰ˆæœ¬æƒ…å†µã€‚å¦‚æœ latest ç‰ˆæœ¬å®‰è£…å¤±è´¥æˆ–è€…åç»­è·Ÿé±¼çš®çš„é¡¹ç›®ä¸ä¸€è‡´ï¼Œå»ºè®®æŠŠå‘½ä»¤ä¸­çš„ latest æ›¿æ¢ä¸º `14.2.6`ã€‚

![img](./assets/03-å‰ç«¯æ¨¡æ¿å¼€å‘/5AgWOuLL30gR7s7K-1737276768266-86.webp)

å¦‚æœæŠ¥äº† â€œæ‰¾ä¸åˆ°å‘½ä»¤â€ é”™è¯¯ï¼Œé‚£ä¹ˆå»ºè®®å» Node.js å®˜ç½‘é‡æ–°å®‰è£… Npmï¼Œè‡ªåŠ¨é‡æ–°å¸®ä½ é…ç½®ç¯å¢ƒå˜é‡ã€‚

è„šæ‰‹æ¶å¯ä»¥å¸®æˆ‘ä»¬è‡ªåŠ¨æ•´åˆ Reactã€Next.jsã€TypeScript è¯­æ³•ã€ESLint æ ¡éªŒç­‰åº“ï¼ŒæŒ‰ä¸‹é¢çš„æ–¹å¼é€‰æ‹©å³å¯ï¼š

![img](./assets/03-å‰ç«¯æ¨¡æ¿å¼€å‘/Uy0LWac5xw0HzaC6-1737276768266-87.webp)

è„šæ‰‹æ¶ä¼šè‡ªåŠ¨ç”Ÿæˆä»£ç å¹¶å®‰è£…ä¾èµ–ï¼Œå¦‚æœå®‰è£…ä¾èµ–å¡ä½ï¼Œå¯èƒ½éœ€è¦æ›´æ¢ Npm é•œåƒä¸ºå›½å†…æºï¼š

```shell
npm config set registry https://registry.npmmirror.com/
```

ç„¶åç”¨ WebStorm æ‰“å¼€é¡¹ç›®ï¼Œåœ¨ç»ˆç«¯æ‰§è¡Œ `npm run dev` å‘½ä»¤ï¼Œèƒ½è®¿é—®åˆ°ç½‘é¡µå°±æˆåŠŸäº†ã€‚

![img](./assets/03-å‰ç«¯æ¨¡æ¿å¼€å‘/nSn8Q6vDC9CU6VWH-1737276768266-88.webp)

è¿è¡Œæ•ˆæœå¦‚å›¾ï¼š

![img](./assets/03-å‰ç«¯æ¨¡æ¿å¼€å‘/JPyKySbsEozmRBuC-1737276768267-89.webp)

ç”Ÿæˆçš„é¡¹ç›®ä»£ç å·²ç»é»˜è®¤ä½¿ç”¨ Git ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿè¿›è¡Œæ‰˜ç®¡ï¼Œå»ºè®®å¤§å®¶åœ¨åç»­å¼€å‘æ¨¡æ¿å’Œé¡¹ç›®çš„è¿‡ç¨‹ä¸­ï¼Œå¤šåˆ†æ­¥éª¤æäº¤ï¼Œä¾¿äºå›é¡¾å¼€å‘è¿›åº¦ã€é™¤äº†é—®é¢˜ä¹Ÿèƒ½å¿«é€Ÿå›æ»šã€‚

### å‰ç«¯å·¥ç¨‹åŒ–é…ç½®

è„šæ‰‹æ¶å·²ç»å¸®æˆ‘ä»¬é…ç½®äº† ESLint è‡ªåŠ¨æ ¡éªŒã€TypeScript ç±»å‹æ ¡éªŒï¼Œä½†ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä»£ç è‡ªåŠ¨æ ¼å¼åŒ–æ’ä»¶ Prettierï¼Œéœ€è¦æ‰‹åŠ¨æ•´åˆã€‚

æ•´åˆå¤šä¸ªå·¥å…·æ—¶ï¼Œå¾ˆå®¹æ˜“å‡ºç°ç‰ˆæœ¬å†²çªçš„é—®é¢˜ï¼Œå°¤å…¶æ˜¯ ESlint å’Œ Prettier æ•´åˆæ—¶ï¼Œæ ¡éªŒè§„åˆ™å¯èƒ½ä¹Ÿä¼šå­˜åœ¨å†²çªã€‚æ‰€ä»¥æœ€å¥½æŒ‰ç…§å®˜æ–¹æ–‡æ¡£çš„æŒ‡å¼•ï¼Œæ¯”å¦‚ï¼šhttps://nextjs.org/docs/app/building-your-application/configuring/eslint#prettier

å…ˆå»å®˜ç½‘å®‰è£… prettierï¼ˆ https://prettier.io/docs/en/install ï¼‰ï¼Œæ‰§è¡Œå‘½ä»¤ï¼š

```shell
npm install --save-dev --save-exact prettier
```

ç„¶åé€šè¿‡å‘½ä»¤å®‰è£…æ•´åˆåŒ… eslint-config-prettierï¼š

![img](./assets/03-å‰ç«¯æ¨¡æ¿å¼€å‘/FLsNm9NFvm5nlNGA-1737276768267-90.webp)

ç„¶åä¿®æ”¹é¡¹ç›®æ–‡ä»¶ `.eslintrc.json` çš„é…ç½®ï¼š

![img](./assets/03-å‰ç«¯æ¨¡æ¿å¼€å‘/iqMME2JDSVRUZjyu-1737276768267-91.webp)

æœ€åéœ€è¦åœ¨ Webstorm é‡Œå¼€å¯ä»£ç ç¾åŒ–æ’ä»¶ï¼š

![img](./assets/03-å‰ç«¯æ¨¡æ¿å¼€å‘/C1o6lxgSogHvvjHf-1737276768267-92.webp)

åœ¨ä»»æ„ä¸€ä¸ª tsx æ–‡ä»¶ä¸­æ‰§è¡Œæ ¼å¼åŒ–å¿«æ·é”®ï¼ˆCtrl + Alt + Lï¼‰ï¼Œä¸æŠ¥é”™ï¼Œè¡¨ç¤ºé…ç½®å·¥ç¨‹åŒ–æˆåŠŸã€‚

ä¿®æ”¹ .eslintrc.json æ–‡ä»¶å¯ä»¥æ”¹å˜æ ¡éªŒè§„åˆ™ï¼Œä¸€èˆ¬è‡ªå·±åšé¡¹ç›®ä¸éœ€è¦ä¿®æ”¹ï¼Œå…·ä½“å¯ä»¥åˆ° ESLint å’Œ Prettier çš„å®˜æ–¹æ–‡æ¡£æŸ¥çœ‹ã€‚

å¦‚æœä¸ä½¿ç”¨è„šæ‰‹æ¶ï¼Œå°±éœ€è¦è‡ªå·±æŒ‰ç…§ä¸‹é¢è¿™äº›æ–‡æ¡£æ•´åˆè¿™äº›å·¥å…·ï¼š

- ä»£ç è§„èŒƒï¼šhttps://eslint.org/docs/latest/use/getting-started
- ä»£ç ç¾åŒ–ï¼šhttps://prettier.io/docs/en/install.html
- ç›´æ¥æ•´åˆï¼šhttps://github.com/prettier/eslint-plugin-prettier#recommended-configuration ï¼ˆåŒ…æ‹¬äº† https://github.com/prettier/eslint-config-prettier#installation ï¼‰

### å¼•å…¥ç»„ä»¶åº“

1ï¼‰Ant Design æ˜¯ React é¡¹ç›®ä¸»æµçš„ç»„ä»¶åº“ï¼ŒAnt Design Procomponents æ˜¯åœ¨æ­¤åŸºç¡€ä¸Šè¿›ä¸€æ­¥å°è£…çš„é«˜çº§ä¸šåŠ¡ç»„ä»¶åº“ï¼Œä¸€èˆ¬çš„é¡¹ç›®ä½¿ç”¨è¿™ä¸¤ä¸ªå°±è¶³å¤Ÿäº†ï¼Œæˆ‘ä»¬çš„ [é¢è¯•é¸­](https://www.mianshiya.com/) ç”¨çš„å°±æ˜¯è¿™äº›ï¼Œå®Œå…¨æ»¡è¶³éœ€æ±‚ã€‚

å‚è€ƒå®˜æ–¹æ–‡æ¡£åœ¨ Next.js é¡¹ç›®ä¸­å¼•å…¥ Ant Design 5.x ç‰ˆæœ¬çš„ç»„ä»¶åº“ï¼šhttps://ant-design.antgroup.com/docs/react/use-with-next-cn

æ‰§è¡Œå®‰è£…ï¼š

```shell
npm install antd --save
```

é’ˆå¯¹ App Router æ¨¡å¼çš„ Next.jsï¼Œéœ€è¦å¤„ç†é¡µé¢é—ªåŠ¨çš„æƒ…å†µï¼š

```shell
npm install @ant-design/nextjs-registry --save
```

ä¿®æ”¹é¡µé¢å…¨å±€å¸ƒå±€æ–‡ä»¶ `app/layout.tsx`ï¼š

```tsx
import { AntdRegistry } from "@ant-design/nextjs-registry";
import "./globals.css";

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en">
      <body>
        <AntdRegistry>{children}</AntdRegistry>
      </body>
    </html>
  );
}
```

æµ‹è¯•ä¸€ä¸‹ï¼Œéšä¾¿åœ¨ `app/page.tsx` å¼•å…¥ä¸€ä¸ªç»„ä»¶ï¼Œå¦‚æœæ˜¾ç¤ºå‡ºæ¥ï¼Œå°±è¡¨ç¤ºå¼•å…¥æˆåŠŸã€‚

![img](./assets/03-å‰ç«¯æ¨¡æ¿å¼€å‘/1ktZkI8C8VDKdOpW-1737276768271-93.webp)

æ•ˆæœå¦‚å›¾ï¼š

![img](./assets/03-å‰ç«¯æ¨¡æ¿å¼€å‘/PxDcUjdtjIG5gMsS-1737276768271-94.webp)

æ³¨æ„ï¼Œå¼•å…¥ Ant Design åï¼Œä¸ªäººä¸å»ºè®®å†å¼•å…¥ Tailwind CSS äº†ï¼Œå¯èƒ½ä¼šæœ‰æ ·å¼å†²çªé—®é¢˜ã€‚

2ï¼‰å¼•å…¥ Ant Design åï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å¼•å…¥ Ant Design Procomponentsï¼Œå‚è€ƒ [å®˜æ–¹æ–‡æ¡£](https://procomponents.ant.design/docs) æ‰§è¡Œä¸‹åˆ—å‘½ä»¤å³å¯ï¼š

```shell
npm i @ant-design/pro-components --save
```

å½“å‰ ProComponents **æ¯ä¸€ä¸ªç»„ä»¶éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„åŒ…**ï¼Œéœ€è¦åœ¨ä½ çš„é¡¹ç›®ä¸­å®‰è£…å¯¹åº”çš„ npm åŒ…å¹¶ä½¿ç”¨ã€‚æ¯”å¦‚ä½¿ç”¨ ProTable è¡¨æ ¼ç»„ä»¶ï¼Œè¿˜éœ€è¦å®‰è£… `@ant-design/pro-table`ã€‚

3ï¼‰å¼•å…¥ç»„ä»¶åº“åï¼Œå¯ä»¥æ¸…ç†æ‰ `app/globals.css` ä¸­çš„æ ·å¼ï¼Œå‡å°‘æ ·å¼å†²çªã€‚

ä¿®æ”¹ä¸ºå¦‚ä¸‹æ ·å¼ï¼Œå‡å°‘æµè§ˆå™¨é»˜è®¤æ ·å¼çš„å½±å“ï¼š

```css
* {
  box-sizing: border-box;
  padding: 0;
  margin: 0;
}

html,
body {
  max-width: 100vw;
  max-height: 100vh;;
}
```

### Next.js å¼€å‘è§„èŒƒ

å¯¹äºä¸€ä¸ªæ–°é¡¹ç›®ï¼Œå®šä¹‰ç»Ÿä¸€çš„å¼€å‘è§„èŒƒæ˜¯è‡³å…³é‡è¦çš„ã€‚ä¸€èˆ¬æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨çš„æŠ€æœ¯æ¡†æ¶çš„å®˜æ–¹æ–‡æ¡£æ‰¾åˆ°å®˜æ–¹æ¨èçš„ **æœ€ä½³å®è·µ**ã€‚æ¯”å¦‚å¯ä»¥åœ¨ Next.js å®˜æ–¹æ–‡æ¡£æœç´¢ â€œbest practicesâ€ï¼š

![img](./assets/03-å‰ç«¯æ¨¡æ¿å¼€å‘/9hYV0eAfD2Pi8yR1-1737276768272-95.webp)

è¿™ç§æ–¹å¼é€‚åˆæœ‰ä¸€å®šæ°´å¹³å’Œæ–‡æ¡£é˜…è¯»èƒ½åŠ›çš„åŒå­¦ï¼Œä¸‹é¢é±¼çš®ç»™å¤§å®¶åˆ†äº«ä¸€äº›å¼€å‘è§„èŒƒã€‚

#### 1ã€çº¦å®šå¼è·¯ç”±

Next.js ä½¿ç”¨ **çº¦å®šå¼è·¯ç”±**ï¼Œæ ¹æ®æ–‡ä»¶å¤¹çš„ç»“æ„å’Œåç§°ï¼Œè‡ªåŠ¨å°†å¯¹åº”çš„ URL åœ°å€æ˜ å°„åˆ°é¡µé¢æ–‡ä»¶ã€‚

å¸¸è§çš„å‡ ç§è·¯ç”±è§„åˆ™å¦‚ä¸‹ï¼š

1ï¼‰åŸºç¡€è§„åˆ™ï¼šä»¥ app ç›®å½•ä½œä¸ºæ ¹è·¯å¾„ï¼Œæ ¹æ®æ–‡ä»¶å¤¹çš„åç§°å’ŒåµŒå¥—å±‚çº§ï¼Œè‡ªåŠ¨æ˜ å°„ä¸º URL åœ°å€ã€‚æ³¨æ„ï¼Œåªæœ‰ç›®å½•ä¸‹ç›´æ¥åŒ…å« page æ–‡ä»¶ï¼ˆjsã€jsxã€tsã€tsx éƒ½æ”¯æŒï¼‰ï¼Œæ‰ä¼šè¢«è¯†åˆ«ä¸ºè·¯ç”±ã€‚

![img](./assets/03-å‰ç«¯æ¨¡æ¿å¼€å‘/foJ1UCfPTJopUZea-1737276768272-96.webp)

2ï¼‰è·¯ç”±ç»„ï¼šå¯ä»¥é€šè¿‡ `(xxx)` è¯­æ³•ï¼Œåˆ›å»ºä¸€ä¸ªè·¯ç”±ç»„ï¼Œä¸ä¼šè¢«è½¬åŒ–ä¸ºè·¯å¾„ï¼Œå¯ç”¨äºå¯¹è·¯ç”±è¿›è¡Œåˆ†ç»„ç®¡ç†ï¼Œæ¯”å¦‚åŒç»„è·¯ç”±ä½¿ç”¨åŒä¸€å¥—å¸ƒå±€ã€‚

![img](./assets/03-å‰ç«¯æ¨¡æ¿å¼€å‘/KzqNYA9ZY9JfFyW5-1737276768272-97.webp)

3ï¼‰åŠ¨æ€è·¯ç”±ï¼šå¯ä»¥é€šè¿‡ `[xxx]` è¯­æ³•ï¼Œè®©å¤šä¸ªä¸åŒå‚æ•°çš„ URL å¤ç”¨åŒä¸€ä¸ªé¡µé¢ï¼Œæ¯”å¦‚ `app/question/[questionId]/page.tsx` ä¸­ questionId å°±æ˜¯åŠ¨æ€è·¯ç”±å‚æ•°ï¼Œå¯ä»¥åŒ¹é… `/question/1`ã€`/question/2` ç­‰ URL åœ°å€ï¼Œåœ¨é¡µé¢ä¸­å¯ä»¥è·å–åˆ° questionId å¹¶åŠ è½½ä¸åŒçš„é¢˜ç›®ã€‚

```tsx
export default function Page({ params }: { params: { questionId: string } }) {
  return <div>æˆ‘çš„é¢˜ç›®: {params.questionId}</div>
}
```

ä»¥ä¸Šåªæ˜¯ Next.js çš„å‡ ç§å¸¸ç”¨è·¯ç”±è§„åˆ™ï¼Œè¿˜æœ‰å…¶ä»–çš„è§„åˆ™ï¼Œè¯¦æƒ…å¯ä»¥è§ Next.js çš„å®˜æ–¹æ–‡æ¡£ï¼šhttps://nextjs.org/docs/app/building-your-application/routing

#### 2ã€é™æ€èµ„æº

Next.js çº¦å®šåœ¨ `/public` ç›®å½•ä¸‹å­˜æ”¾é™æ€èµ„æºã€‚åœ¨å…¶ä¸­æ–°å»º assets ç›®å½•ï¼Œå¯ä»¥åœ¨é‡Œé¢å­˜æ”¾å›¾ç‰‡ç­‰é™æ€èµ„æºæ–‡ä»¶ï¼Œæ¯”å¦‚ç½‘ç«™çš„ Logoã€‚

å¯¹åº”å®˜æ–¹æ–‡æ¡£ï¼šhttps://nextjs.org/docs/app/building-your-application/optimizing/static-assets

![logo.png](./assets/03-å‰ç«¯æ¨¡æ¿å¼€å‘/tIzm1cZTBQg9oiwQ-1737276768321-117.jpeg)

ç„¶åå°±å¯ä»¥ç”¨ Next.js çš„ `Image` ç»„ä»¶åŠ è½½é™æ€èµ„æºï¼Œæ¯”å¦‚ï¼š

```tsx
<Image src={`/assets/logo.png`} alt={alt} width="64" height="64" />
```

Next.js ä¼šé’ˆå¯¹è¯¥ç»„ä»¶è¿›è¡Œç‰¹å®šçš„å›¾åƒä¼˜åŒ–ï¼Œæå‡æ€§èƒ½ã€‚

æ³¨æ„ï¼ŒæŸäº›ç‰¹æ®Šçš„ã€å¸¸ç”¨çš„å…ƒä¿¡æ¯æ–‡ä»¶ä¸æ˜¯æ”¾åœ¨ public ç›®å½•ä¸‹ï¼Œè€Œæ˜¯åº”è¯¥æ ¹æ®ç‰¹å®šè§„åˆ™æ”¾åœ¨ app ç›®å½•ä¸‹ï¼

å¯¹åº”å®˜æ–¹æ–‡æ¡£ï¼šhttps://nextjs.org/docs/app/api-reference/file-conventions/metadata

æ¯”å¦‚å°† favicon.ico æ”¾åˆ° app çš„æ ¹ç›®å½•ä¸‹ï¼Œå¯å±•ç¤ºç«™ç‚¹å°å›¾æ ‡ï¼š

![img](./assets/03-å‰ç«¯æ¨¡æ¿å¼€å‘/vDLWOaRzd9WQ8lmK-1737276768272-98.webp)

é˜¿é‡Œäº‘ç›˜ï¼šhttps://www.alipan.com/s/S2xSEgiAMJs æå–ç : 86ai

å°† robots.txt æ”¾åˆ° app çš„æ ¹ç›®å½•ä¸‹ï¼Œå¯ç”¨äºå‘Šè¯‰æœç´¢å¼•æ“çˆ¬è™«èƒ½å¦è®¿é—®ç‰¹å®šçš„é¡µé¢ã€ä»¥åŠç«™ç‚¹åœ°å›¾çš„åœ°å€ï¼Œæ¯”å¦‚ï¼š

```tsx
User-Agent: *
Allow: /
Disallow: /private/

Sitemap: https://mianshiya.com/sitemap.xml
```

#### 3ã€æ–‡ä»¶ç»„ç»‡å½¢å¼

é¦–å…ˆï¼Œé¡¹ç›®ä¸­çš„æ¯ä¸ªé¡µé¢å’Œç»„ä»¶éƒ½æ˜¯å•ç‹¬çš„æ–‡ä»¶å¤¹ã€‚

åŸºäº Next.js çš„çº¦å®šå¼è·¯ç”±ï¼Œæˆ‘ä»¬æ¯ä¸ªé¡µé¢ç›®å½•å†…éœ€è¦æ·»åŠ  `page.tsx` é¡µé¢æ–‡ä»¶å’Œ index.css æ ·å¼æ–‡ä»¶ï¼›æ¯ä¸ªç»„ä»¶ç›®å½•å†…æ·»åŠ  `index.tsx` é¡µé¢æ–‡ä»¶å’Œ index.css æ ·å¼æ–‡ä»¶ã€‚

å¯¹äºé¡¹ç›®ä¸­å¤šé¡µé¢å…¬ç”¨çš„ç»„ä»¶ï¼Œæ”¾åœ¨ `src/components` ç›®å½•ä¸‹ï¼›å¯¹äºæŸä¸ªé¡µé¢ç§æœ‰çš„ç»„ä»¶ï¼Œæ”¾åœ¨è¯¥é¡µé¢çš„ components ç›®å½•ä¸‹ã€‚

#### 4ã€é¡µé¢å¼€å‘è§„èŒƒ

Next.js æ”¯æŒ React çš„è¯­æ³•ï¼Œå¯ä»¥ç”¨å‡½æ•°çš„æ–¹å¼å£°æ˜é¡µé¢å’Œç»„ä»¶ã€‚æ¯ä¸ªé¡µé¢çš„æ ¹å…ƒç´ å¿…é¡»æœ‰ idã€æ¯ä¸ªç»„ä»¶æ ¹å…ƒç´ å¿…é¡»æœ‰ classNameï¼Œç”¨äºæ§åˆ¶æ ·å¼å’Œå¿«é€Ÿå®šä½ã€‚

**ä¸ºäº†åŒºåˆ†æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯æ¸²æŸ“ï¼Œæ¯ä¸ªé¡µé¢ï¼ˆæˆ–ç»„ä»¶ï¼‰éƒ½å¿…é¡»åœ¨å¼€å¤´æ˜¾ç¤ºç¼–å†™ "use client" æˆ– "use server"**

æ¯”å¦‚å®šä¹‰ä¸€ä¸ªå®¢æˆ·ç«¯æ¸²æŸ“çš„é¡µé¢ï¼Œä»£ç å¦‚ä¸‹ï¼š

```tsx
"use client";
// å¼•å…¥æ ·å¼
import "./index.css";

// ä¸»é¡µ
export default function HomePage() {
  return (
    <main id="homePage">
      <div>
        ç¨‹åºå‘˜é±¼çš®xç¼–ç¨‹å¯¼èˆªçš„é¡¹ç›®æ•™ç¨‹
      </div>
    </main>
  );
}
```

2ï¼‰å®šä¹‰ç»„ä»¶çš„æ—¶å€™ï¼Œéœ€è¦ä½¿ç”¨ TypeScript å£°æ˜ç»„ä»¶å±æ€§çš„ç±»å‹ï¼Œæ¯”å¦‚ï¼š

```tsx
"use client";
import { Viewer } from "@bytemd/react";
import "./index.css";

interface Props {
  value?: string;
}

const MdViewer = (props: Props) => {
  const { value = "" } = props;

  return (
    <div className="md-viewer">
      <Viewer value={value} plugins={plugins} />
    </div>
  );
};

export default MdViewer;
```

#### 5ã€å…¶ä»–æ³¨æ„äº‹é¡¹

1ï¼‰å¼€å‘æ—¶è¦ä¸¥æ ¼æ³¨æ„ TypeScript çš„ç±»å‹å’Œç¼–è¾‘å™¨çš„é”™è¯¯æç¤ºï¼Œå¹¶ä¸”å®šæœŸæ‰“åŒ…æ„å»ºã€‚å› ä¸º Next.js çš„æ„å»ºè¦æ±‚éå¸¸ä¸¥æ ¼ï¼Œç¨æœ‰ä¸æ…å°±ä¼šæŠ¥é”™ã€‚æ„å»ºæŠ¥é”™çš„è¯ï¼Œæ³¨æ„æŸ¥çœ‹å’Œå¤„ç†æ„å»ºä¸­çš„æŠ¥é”™ä¿¡æ¯ã€‚

2ï¼‰åœ¨é¡¹ç›®ä¸­æ…ç”¨ window ç­‰æµè§ˆå™¨ç¯å¢ƒæ‰æ”¯æŒçš„å¯¹è±¡ï¼ŒæœåŠ¡ç«¯æ— æ³•ä½¿ç”¨ã€‚æ³¨æ„ä¿è¯å®¢æˆ·ç«¯æ¸²æŸ“é¡µé¢å’ŒæœåŠ¡ç«¯æ¸²æŸ“é¡µé¢çš„ä¸€è‡´æ€§ï¼Œå¦åˆ™ä¼šå‡ºç°æ°´åˆé”™è¯¯ã€‚

### å…¨å±€é€šç”¨å¸ƒå±€

æ‰€è°“çš„å¸ƒå±€ï¼Œæ˜¯æŒ‡åœ¨å¤šä¸ªé¡µé¢é—´å¤ç”¨çš„ UI å…ƒç´ ï¼Œæ¯”å¦‚å¯¼èˆªæ ã€‚

Next.js æ”¯æŒå…¨å±€æ ¹å¸ƒå±€ï¼ˆæ¯ä¸ªé¡µé¢éƒ½ä¼šç”Ÿæ•ˆï¼‰ä»¥åŠåµŒå¥—å¸ƒå±€ï¼ˆå¯ä»¥åªå¯¹éƒ¨åˆ†é¡µé¢ç”Ÿæ•ˆï¼‰ï¼Œè¯¦æƒ…å¯ [å‚è€ƒæ–‡æ¡£](https://nextjs.org/docs/app/building-your-application/routing/layouts-and-templates#layouts)ã€‚

![img](./assets/03-å‰ç«¯æ¨¡æ¿å¼€å‘/i9DDQrhpUYduHhtv-1737276768272-99.webp)

#### åŸºç¡€å¸ƒå±€ç»“æ„

åœ¨ src ä¸‹æ–°å»º layouts ç›®å½•ï¼Œç”¨äºå­˜æ”¾é¡¹ç›®ä¸­çš„å„ç§å¸ƒå±€ã€‚åœ¨è¯¥ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªå¸ƒå±€ `BasicLayout`ï¼Œ æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼ŒåŒ…æ‹¬ index.tsx é¡µé¢å’Œ index.css æ ·å¼æ–‡ä»¶ã€‚

å¯ä»¥ç›´æ¥ä½¿ç”¨ [Ant Design Procomponents çš„å¸ƒå±€ç»„ä»¶](https://procomponents.ant.design/components/layout) å¿«é€Ÿå®ç°åŒ…å«å¯¼èˆªæ ã€å†…å®¹ã€åº•éƒ¨æ çš„å“åº”å¼å¸ƒå±€ã€‚

æ‰¾ä¸€ä¸ªå’Œè‡ªå·±é¢„æœŸæœ€ç¬¦åˆçš„ç»„ä»¶ Demoï¼Œå¹¶æŒ‰éœ€ä¿®æ”¹å³å¯ï¼Œæ¯”å¦‚ [åŸºç¡€å¸ƒå±€ç¤ºä¾‹](https://procomponents.ant.design/components/layout?tab=api#packages-layout-src-components-layout-tab-api-demo-base)ï¼š

![img](./assets/03-å‰ç«¯æ¨¡æ¿å¼€å‘/nirBHUWpZpIkMK0c-1737276768272-100.webp)

åœ¨ app ç›®å½•ä¸‹çš„ layout.tsx å…¨å±€å¸ƒå±€æ–‡ä»¶ï¼ˆå¯ä»¥ç†è§£ä¸ºé¡µé¢å…¥å£ï¼‰ä¸­å¼•å…¥ BasicLayoutï¼š

```typescript
export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="zh">
      <body>
        <AntdRegistry>
          <BasicLayout>{children}</BasicLayout>
        </AntdRegistry>
      </body>
    </html>
  );
}
```

ğŸ’¡ å¯ä»¥å°† lang="en" æ”¹ä¸º lang="zh"ï¼Œé€‚é…å›½å†…ç”¨æˆ·è®¿é—®ã€‚

ç„¶åæŒ‰éœ€ç²¾ç®€å’Œä¿®æ”¹ BasicLayout ä¸­å¤åˆ¶æ¥çš„å¸ƒå±€ä»£ç ï¼Œç›´åˆ°é¡¹ç›®å¯ä»¥æ­£å¸¸è¿è¡Œå¹¶ç¬¦åˆé¢„æœŸã€‚

æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œéœ€è¦æ³¨æ„ä¸‹é¢è¿™äº›äº‹é¡¹ï¼š

1ï¼‰é¡µé¢å¼€å¤´æ·»åŠ  "use client" å£°æ˜ï¼Œè¡¨ç¤ºå®¢æˆ·ç«¯æ¸²æŸ“

2ï¼‰ç§»é™¤ useStateã€å°†è·å– pathname æ”¹ä¸ºä½¿ç”¨ Next.js çš„ usePathname é’©å­è·å–

3ï¼‰ç§»é™¤æ— ç”¨ä»£ç ï¼Œæ¯”å¦‚ tokenã€siderMenuType

4ï¼‰å®šä¹‰å¸ƒå±€çš„ children å±æ€§ï¼š

```typescript
interface Props {
  children: React.ReactNode;
}

export default function BasicLayout({ children }: Props) {
  // ...
}
```

5ï¼‰ä¿®æ”¹èœå•æ¸²æŸ“å‡½æ•°ï¼š

```typescript
// èœå•æ¸²æŸ“
menuItemRender={(item, dom) => (
  <Link href={item.path || "/"} target={item.target}>
    {dom}
  </Link>
)}
```

6ï¼‰ç§»é™¤ window å¯¹è±¡çš„ä½¿ç”¨ï¼Œè§£å†³æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯æ°´åˆä¸ä¸€è‡´çš„é—®é¢˜

#### å…¨å±€åº•éƒ¨æ 

åœ¨ src ä¸‹æ–°å»º components ç›®å½•ï¼Œè¡¨ç¤ºå…¨å±€å…¬ç”¨ç»„ä»¶ã€‚

åˆ›å»ºå…¨å±€åº•éƒ¨æ  GlobalFooterï¼Œé€šå¸¸ç”¨äºå±•ç¤ºç‰ˆæƒä¿¡æ¯ï¼Œç®€å•ä¸€ç‚¹å°±å¥½ï¼š

```tsx
import React from "react";
import "./index.css";

/**
 * å…¨å±€åº•éƒ¨æ ç»„ä»¶
 *
 * @author yupi
 */
export default function GlobalFooter() {
  const currentYear = new Date().getFullYear();

  return (
    <div className="global-footer">
      <div>Â© {currentYear} é¢è¯•åˆ·é¢˜å¹³å°</div>
      <div>
        <a href="https://www.code-nav.cn" target="_blank">
          ä½œè€…ï¼šç¼–ç¨‹å¯¼èˆª - ç¨‹åºå‘˜é±¼çš®
        </a>
      </div>
    </div>
  );
}
```

æ ·å¼ä»£ç å¦‚ä¸‹ï¼š

```css
.global-footer {
  position: absolute;
  bottom: 0;
  width: 100%;
  background: #efefef;
  text-align: center;
  padding: 16px;
}
```

ç„¶åå¯ä»¥åœ¨ ProLayout ä¸­æ¸²æŸ“ï¼š

```tsx
footerRender={() => <GlobalFooter />}
```

éœ€è¦åœ¨ BasicLayout çš„æ ·å¼æ–‡ä»¶ä¸­è¡¥å……åº•éƒ¨å†…è¾¹è·ï¼Œå¦åˆ™æœ‰äº›å†…å®¹å¯èƒ½ä¼šè¢«åº•éƒ¨æ é®æŒ¡ä½ã€‚ç¤ºä¾‹æ ·å¼å¦‚ä¸‹ï¼š

```css
.ant-pro-layout .ant-pro-layout-content {
  padding-bottom: 96px !important;
}
```

#### å…¨å±€é¡¶éƒ¨å¯¼èˆªæ 

å¯ä»¥ç›´æ¥åˆ©ç”¨ Ant Design Procomponents çš„ ProLayout ç»„ä»¶å®ç°ï¼Œä¸ç”¨è‡ªå·±ç¼–å†™ã€‚

å°† ProLayout çš„ layout å±æ€§è®¾ç½®ä¸º topï¼Œå¯å¼€å¯é¡¶éƒ¨å¯¼èˆªæ ï¼š

```tsx
<ProLayout
  layout="top"
/>
```

ProLayout å°†é¡¶éƒ¨å¯¼èˆªæ ä»å·¦åˆ°å³åˆ†ä¸ºå‡ ä¸ªåŒºï¼šæ ‡é¢˜åŒºã€èœå•åŒºã€æ“ä½œåŒºã€å¤´åƒåŒº

![img](./assets/03-å‰ç«¯æ¨¡æ¿å¼€å‘/0SdzDSS5tGHIkIsd-1737276768272-101.webp)

1ï¼‰æ ‡é¢˜åŒºï¼šç”¨äºå±•ç¤ºç½‘ç«™å›¾æ ‡å’Œæ ‡é¢˜

å¯¹åº” ProLayout çš„ä»£ç å¦‚ä¸‹ï¼š

```tsx
// æ ‡é¢˜æ¸²æŸ“
headerTitleRender={(logo, title, _) => {
  return (
    <a href="https://www.mianshiya.com" target="_blank">
      {logo}
      {title}
    </a>
  );
}}
```

è¯¥æ¸²æŸ“å‡½æ•°æœ‰ logo å’Œ title å‚æ•°ï¼Œå¯ä»¥åœ¨ ProLayout ä¸­æ·»åŠ å¯¹åº”çš„å±æ€§ï¼Œä»¥å±•ç¤ºç½‘ç«™å›¾æ ‡å’Œæ ‡é¢˜ã€‚

```tsx
<ProLayout
  title="é¢è¯•é¸­åˆ·é¢˜å¹³å°"
  logo={
    <Image
      src="/assets/logo.png"
      alt="é¢è¯•é¸­åˆ·é¢˜ç½‘ç«™"
      width={32}
      height={32}
    />
  }
>
```

æ•ˆæœå¦‚ä¸‹ï¼š

![img](./assets/03-å‰ç«¯æ¨¡æ¿å¼€å‘/wNy19MuGIjtj0SPl-1737276768272-102.png)

2ï¼‰èœå•åŒºï¼šç”¨äºå±•ç¤ºå¯¼èˆªæ çš„èœå•ï¼Œä¾›ç”¨æˆ·åˆ‡æ¢é¡µé¢

å¯¹åº” ProLayout çš„ä»£ç å¦‚ä¸‹ï¼š

```tsx
// èœå•é¡¹æ•°æ®
menuDataRender={() => {
  return [
    {
      path: "/",
      name: "ä¸»é¡µ",
    },
    {
      path: "/banks",
      name: "é¢˜åº“",
    },
  ];
}}
// èœå•æ¸²æŸ“
menuItemRender={(item, dom) => (
  <Link href={item.path || "/"}>{dom}</Link>
)}
```

ä¸Šè¿°ä»£ç æä¾›äº†ä¸¤ä¸ªå‡½æ•°ï¼Œåˆ†åˆ«ç”¨äºæŒ‡å®šèœå•é¡¹æ•°æ®ã€èœå•çš„æ¸²æŸ“å…ƒç´ ã€‚

æ•ˆæœå¦‚ä¸‹ï¼š

![img](./assets/03-å‰ç«¯æ¨¡æ¿å¼€å‘/tdZfOkY5TDgxGY07-1737276768277-103.png)

3ï¼‰æ“ä½œåŒºï¼šå¯ç”¨äºé…ç½®å³ä¾§çš„æ“ä½œæ ï¼Œæ¯”å¦‚æœç´¢æ¡ã€å°æŒ‰é’®ç­‰ã€‚

ç§»åŠ¨ç«¯å¯ä»¥ä¸å±•ç¤ºæ“ä½œï¼Œå¯¹åº” ProLayout çš„ä»£ç å¦‚ä¸‹ï¼š

```tsx
// æ“ä½œæ¸²æŸ“
actionsRender={(props) => {
  if (props.isMobile) return [];
  return [
    <SearchInput key="search" />,
    <a
      key="github"
      href="https://github.com/liyupi/mianshiya-next"
      target="_blank"
    >
      <GithubFilled key="GithubFilled" />
    </a>,
  ];
}}
```

æ•ˆæœå¦‚ä¸‹ï¼š

![img](./assets/03-å‰ç«¯æ¨¡æ¿å¼€å‘/rH9bMXgIpQXResty-1737276768277-104.png)

4ï¼‰å¤´åƒåŒºï¼šç”¨äºå±•ç¤ºç™»å½•ç”¨æˆ·å¤´åƒã€ç”¨æˆ·æ˜µç§°ï¼Œé¼ æ ‡æ‚¬æµ®ä¸Šå»è¿˜å¯ä»¥å±•ç¤ºæ›´å¤šç”¨æˆ·æœ‰å…³çš„æ“ä½œæŒ‰é’®

å¯¹åº” ProLayout çš„ä»£ç å¦‚ä¸‹ï¼š

```tsx
avatarProps={{
  src: "/assets/logo.png",
  size: "small",
  title: "é±¼çš®é¸­",
  render: (props, dom) => {
    return (
      <Dropdown
        menu={{
          items: [
            {
              key: "logout",
              icon: <LogoutOutlined />,
              label: "é€€å‡ºç™»å½•",
            },
          ],
        }}
      >
        {dom}
      </Dropdown>
    );
  },
}}
```

æ•´ä¸ªé¡¶éƒ¨æ çš„æ•ˆæœå¦‚å›¾ï¼š

![img](./assets/03-å‰ç«¯æ¨¡æ¿å¼€å‘/1ffsHUADLHGK2tZ4-1737276768277-105.webp)

#### å¯¼èˆªèœå•é…ç½®

å¯ä»¥é€šè¿‡ç‹¬ç«‹çš„é…ç½®æ–‡ä»¶æ›´æ–¹ä¾¿åœ°ä¿®æ”¹å¯¼èˆªèœå•é¡¹ï¼Œä¸ç”¨æ¯æ¬¡éƒ½ä¿®æ”¹å¸ƒå±€ä»£ç ã€‚

å®ç°æ­¥éª¤å¦‚ä¸‹ï¼š

1ï¼‰åœ¨ `/config` ç›®å½•ä¸‹ç¼–å†™é€šç”¨é…ç½®æ–‡ä»¶ `menus.tsx`ï¼Œæ ¸å¿ƒæ˜¯èœå•é¡¹æ•°ç»„ï¼Œå¯ä»¥ç”¨ ProLayout æä¾›çš„ TypeScript ç±»å‹æ¥è§„èŒƒï¼š

```tsx
import { MenuDataItem } from "@ant-design/pro-layout";
import { CrownOutlined } from "@ant-design/icons";

// èœå•åˆ—è¡¨
const menus = [
  {
    path: "/",
    name: "ä¸»é¡µ",
  },
  {
    path: "/banks",
    name: "é¢˜åº“",
  },
  {
    path: "/questions",
    name: "é¢˜ç›®",
  },
  {
    name: "é¢è¯•é¸­",
    path: "https://mianshiya.com",
    target: "_blank",
  },
  {
    path: "/admin",
    name: "ç®¡ç†",
    icon: <CrownOutlined />,
    children: [
      {
        path: "/admin/user",
        name: "ç”¨æˆ·ç®¡ç†",
      }
    ],
  },
] as MenuDataItem[];

// å¯¼å‡º
export default menus;
```

2ï¼‰åœ¨å…¨å±€å¸ƒå±€çš„ ProLayout ä¸­å¼•å…¥èœå•æ•°æ®ï¼š

```tsx
// èœå•é¡¹æ•°æ®
menuDataRender={() => {
  return menus;
}}
```

å¯ä»¥çœ‹åˆ°å¦‚ä¸‹æ•ˆæœï¼š

![img](./assets/03-å‰ç«¯æ¨¡æ¿å¼€å‘/nvYHBRrBoDKxHS1R-1737276768277-106.webp)

3ï¼‰åŒæ­¥è·¯ç”±çš„æ›´æ–°åˆ°èœå•é¡¹é«˜äº®

åŒæ­¥é«˜äº®åŸç†ï¼šå¯ä»¥ä½¿ç”¨ `usePathname` å®¢æˆ·ç«¯é’©å­å‡½æ•°è·å–åˆ°å½“å‰é¡µé¢è·¯å¾„ï¼Œç„¶åä¼ é€’ç»™ ProLayout çš„ location å±æ€§å³å¯è‡ªåŠ¨åŒ¹é…åˆ°å¯¹åº” path çš„èœå•é¡¹ã€‚

ä»£ç å¦‚ä¸‹ï¼š

```tsx
const pathname = usePathname();

<ProLayout
  layout="top"
  title="é¢è¯•é¸­åˆ·é¢˜å¹³å°"
  location={{
    pathname,
  }}
/>
```

4ï¼‰æ‰©å±•èƒ½åŠ›ï¼šåœ¨ ProLayout çš„èœå•æ¸²æŸ“å‡½æ•°ä¸­å¯ä»¥æ ¹æ®èœå•é¡¹çš„å±æ€§æ¥è‡ªå®šä¹‰èœå•é¡¹æ¸²æŸ“é€»è¾‘ï¼Œæ¯”å¦‚æ”¯æŒé…ç½®è¶…é“¾æ¥æ˜¯å¦åœ¨æ–°é¡µé¢æ‰“å¼€ã€‚

èœå•é¡¹é…ç½®å¦‚ä¸‹ï¼Œtarget çš„å€¼ä¸º `_blank` è¡¨ç¤ºåœ¨æ–°é¡µé¢æ‰“å¼€ï¼š

```json
{
  name: "é¢è¯•é¸­",
  path: "https://mianshiya.com",
  target: "_blank",
}
```

ä¿®æ”¹èœå•æ¸²æŸ“å‡½æ•°ï¼Œæ”¯æŒæ§åˆ¶é¡µé¢æ‰“å¼€æ–¹å¼ï¼š

```tsx
// èœå•æ¸²æŸ“
menuItemRender={(item, dom) => (
  <Link href={item.path || "/"} target={item.target}>{dom}</Link>
)}
```

ğŸ’¡ è¿˜å¯ä»¥æŒ‰éœ€è¡¥å……æ›´å¤šèƒ½åŠ›ï¼Œæ¯”å¦‚æ ¹æ®é…ç½®æ§åˆ¶èœå•çš„æ˜¾éšï¼Œå»ºè®®å‚è€ƒçŸ¥åçš„èœå•ç»„ä»¶å®ç°ã€‚

### è¯·æ±‚

å‰åç«¯éœ€è¦é€šè¿‡è¯·æ±‚è¿›è¡Œäº¤äº’ï¼Œæœ¬é¡¹ç›®å¼•å…¥ä¸»æµ Axios è¯·æ±‚åº“ï¼Œå¹¶é€šè¿‡ OpenAPI å‰ç«¯ä»£ç ç”Ÿæˆï¼Œå¤§å¤§æé«˜å¼€å‘æ•ˆç‡ã€‚

æ³¨æ„ï¼Œç”±äº Next.js ä½¿ç”¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯åŒæ„æ¸²æŸ“ï¼Œéœ€è¦é€‰æ‹©ä¸€ä¸ªåŒæ—¶æ”¯æŒ Node.js å’Œæµè§ˆå™¨ç¯å¢ƒçš„è¯·æ±‚åº“ï¼Œè€Œ Axios æ˜¯æ”¯æŒçš„ã€‚

#### 1ã€è¯·æ±‚å·¥å…·åº“

Axios å®˜æ–¹æ–‡æ¡£ï¼šhttps://axios-http.com/docs/intro

å®‰è£…è¯·æ±‚å·¥å…·ç±» Axiosï¼Œä»£ç ï¼š

```shell
npm install axios
```

#### 2ã€å…¨å±€è‡ªå®šä¹‰è¯·æ±‚

éœ€è¦è‡ªå®šä¹‰å…¨å±€è¯·æ±‚åœ°å€ç­‰ï¼Œå‚è€ƒ Axios å®˜æ–¹æ–‡æ¡£ï¼Œåœ¨ `/src/libs` ç›®å½•ä¸‹ç¼–å†™è¯·æ±‚é…ç½®æ–‡ä»¶ `request.ts`ã€‚åŒ…æ‹¬å…¨å±€æ¥å£è¯·æ±‚åœ°å€ã€è¶…æ—¶æ—¶é—´ã€è‡ªå®šä¹‰è¯·æ±‚å“åº”æ‹¦æˆªå™¨ç­‰ã€‚

æ¯”å¦‚å¯ä»¥åœ¨å…¨å±€å“åº”æ‹¦æˆªå™¨ä¸­ï¼Œè¯»å–å‡ºç»“æœä¸­çš„ dataï¼Œå¹¶æ ¡éªŒ code æ˜¯å¦åˆæ³•ï¼Œå¦‚æœæ˜¯æœªç™»å½•çŠ¶æ€ï¼Œåˆ™è‡ªåŠ¨ç™»å½•ã€‚

ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼Œå…¶ä¸­ `withCredentials: true` ä¸€å®šè¦å†™ï¼Œå¦åˆ™æ— æ³•åœ¨å‘è¯·æ±‚æ—¶æºå¸¦ Cookieï¼Œå°±æ— æ³•å®Œæˆç™»å½•ã€‚

ä»£ç å¦‚ä¸‹ï¼š

```typescript
import axios from "axios";

// åˆ›å»º Axios ç¤ºä¾‹
const myAxios = axios.create({
  baseURL: "http://localhost:8101",
  timeout: 10000,
  withCredentials: true,
});

// åˆ›å»ºè¯·æ±‚æ‹¦æˆªå™¨
myAxios.interceptors.request.use(
  function (config) {
    // è¯·æ±‚æ‰§è¡Œå‰æ‰§è¡Œ
    return config;
  },
  function (error) {
    // å¤„ç†è¯·æ±‚é”™è¯¯
    return Promise.reject(error);
  },
);

// åˆ›å»ºå“åº”æ‹¦æˆªå™¨
myAxios.interceptors.response.use(
  // 2xx å“åº”è§¦å‘
  function (response) {
    // å¤„ç†å“åº”æ•°æ®
    const { data } = response;
    // æœªç™»å½•
    if (data.code === 40100) {
      // ä¸æ˜¯è·å–ç”¨æˆ·ä¿¡æ¯æ¥å£ï¼Œæˆ–è€…ä¸æ˜¯ç™»å½•é¡µé¢ï¼Œåˆ™è·³è½¬åˆ°ç™»å½•é¡µé¢
      if (
        !response.request.responseURL.includes("user/get/login") &&
        !window.location.pathname.includes("/user/login")
      ) {
        window.location.href = `/user/login?redirect=${window.location.href}`;
      }
    } else if (data.code !== 0) {
      // å…¶ä»–é”™è¯¯
      throw new Error(data.message ?? "æœåŠ¡å™¨é”™è¯¯");
    }
    return data;
  },
  // é 2xx å“åº”è§¦å‘
  function (error) {
    // å¤„ç†å“åº”é”™è¯¯
    return Promise.reject(error);
  },
);

export default myAxios;
```

#### 3ã€è‡ªåŠ¨ç”Ÿæˆè¯·æ±‚ä»£ç 

ä¼ ç»Ÿæƒ…å†µä¸‹ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½è¦å•ç‹¬ç¼–å†™ä»£ç ï¼Œå¾ˆéº»çƒ¦ã€‚

æ¨èä½¿ç”¨ OpenAPI å·¥å…·ï¼Œç›´æ¥è‡ªåŠ¨ç”Ÿæˆå³å¯ï¼šhttps://www.npmjs.com/package/@umijs/openapi

æŒ‰ç…§å®˜æ–¹æ–‡æ¡£çš„æ­¥éª¤ï¼Œå…ˆå®‰è£…ï¼š

```shell
npm i --save-dev @umijs/openapi
```

åœ¨ **é¡¹ç›®æ ¹ç›®å½•** æ–°å»º `openapi.config.ts`ï¼Œæ ¹æ®è‡ªå·±çš„éœ€è¦å®šåˆ¶ç”Ÿæˆçš„ä»£ç ï¼š

```typescript
const { generateService } = require("@umijs/openapi");

generateService({
  requestLibPath: "import request from '@/libs/request'",
  schemaPath: "http://localhost:8101/api/v2/api-docs",
  serversPath: "./src",
});
```

åœ¨ package.json çš„ script ä¸­æ·»åŠ  `"openapi": "ts-node openapi.config.ts"`

å¦‚æœ ts-node æ— æ³•è¿è¡Œï¼Œæ”¹ä¸º node

æ‰§è¡Œè¯¥å‘½ä»¤ï¼Œå¯ä»¥åœ¨ `/src/api` ç›®å½•çœ‹åˆ°ç”Ÿæˆçš„è¯·æ±‚ä»£ç ã€‚

![img](./assets/03-å‰ç«¯æ¨¡æ¿å¼€å‘/B3HeMVmdIN81xQTc-1737276768277-107.webp)

#### 4ã€æµ‹è¯•è¯·æ±‚ä»£ç 

å¯ä»¥åœ¨ `app/page.tsx` å’Œ BasicLayout ä¸­åˆ†åˆ«æµ‹è¯•è¯·æ±‚ä»£ç ï¼Œåˆ†åˆ«åœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯æ‰§è¡Œè¯·æ±‚ï¼š

```typescript
listQuestionBankVoByPageUsingPost({}).then((res) => {
    console.log(res);
});
```

æŸ¥çœ‹ç¼–è¾‘å™¨æ§åˆ¶å°ï¼Œå¯ä»¥çœ‹åˆ° page.tsx ä¸­æœåŠ¡ç«¯æ¸²æŸ“æ‰§è¡Œçš„è¯·æ±‚å“åº”ï¼š

![img](./assets/03-å‰ç«¯æ¨¡æ¿å¼€å‘/JjaW3gg7MEqKkR2U-1737276768277-108.webp)

æŸ¥çœ‹ F12 ç½‘ç»œæ§åˆ¶å°ï¼Œå¯ä»¥çœ‹åˆ° BasicLayout ä¸­å®¢æˆ·ç«¯æ¸²æŸ“æ‰§è¡Œçš„è¯·æ±‚å“åº”ï¼š

![img](./assets/03-å‰ç«¯æ¨¡æ¿å¼€å‘/UaZe1ghnUtlehRrA-1737276768277-109.webp)

### å…¨å±€åˆå§‹åŒ–é€»è¾‘

å¯ä»¥åœ¨ `app/layout.tsx` ä¸­é¢„ç•™ä¸€ä¸ªå¯ä»¥ç¼–å†™å…¨å±€åˆå§‹åŒ–é€»è¾‘çš„ä»£ç ï¼š

```tsx
/**
 * å…¨å±€åˆå§‹åŒ–å‡½æ•°ï¼Œæœ‰å…¨å±€å•æ¬¡è°ƒç”¨çš„ä»£ç ï¼Œéƒ½å¯ä»¥å†™åˆ°è¿™é‡Œ
 */
const doInit = useCallback(() => {
  console.log("hello æ¬¢è¿æ¥åˆ°æˆ‘çš„é¡¹ç›®");
}, []);

// åªæ‰§è¡Œä¸€æ¬¡
useEffect(() => {
  doInit();
}, []);
```

ğŸ’¡ æ³¨æ„ï¼Œå¼€å‘ç¯å¢ƒä¸­å¯èƒ½ä¼šçœ‹åˆ° useEffect æ‰§è¡Œäº† 2 æ¬¡ï¼Œè¿™æ˜¯æ­£å¸¸ç°è±¡ï¼Œç”Ÿäº§ç¯å¢ƒä¸ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ã€‚

å¯ä»¥å°è£…å‡ºä¸€å±‚ InitLayoutï¼Œè€Œä¸è¦æŠŠåˆå§‹åŒ–é€»è¾‘ç›´æ¥å†™åˆ° RootLayout ä¸­ï¼Œå¯ä»¥æ›´å¥½åœ°ç»´æŠ¤åˆå§‹åŒ–é€»è¾‘ï¼Œé˜²æ­¢åç»­æ‰©å±•ä»£ç æ—¶å‡ºç°æ‰§è¡Œæ—¶æœºçš„å†²çªã€‚ï¼ˆæ¯”å¦‚å¼•å…¥å…¨å±€çŠ¶æ€ç®¡ç†åï¼Œè¦å…ˆæ‰§è¡Œ RootLayout çš„ Provider ç»„ä»¶ï¼Œæ‰èƒ½è·å–åˆ° useDispatchï¼‰

```tsx
/**
 * æ‰§è¡Œåˆå§‹åŒ–é€»è¾‘çš„å¸ƒå±€ï¼ˆå¤šå°è£…ä¸€å±‚ï¼‰
 * @param children
 * @constructor
 */
const InitLayout: React.FC<
  Readonly<{
    children: React.ReactNode;
  }>
> = ({ children }) => {
  /**
   * å…¨å±€åˆå§‹åŒ–å‡½æ•°ï¼Œæœ‰å…¨å±€å•æ¬¡è°ƒç”¨çš„ä»£ç ï¼Œéƒ½å¯ä»¥å†™åˆ°è¿™é‡Œ
   */
  const doInit = useCallback(() => {
    console.log("hello æ¬¢è¿æ¥åˆ°æˆ‘çš„é¡¹ç›®");
  }, []);
  
  // åªæ‰§è¡Œä¸€æ¬¡
  useEffect(() => {
    doInit();
  }, []);

  return <>{children}</>;
};
```

### å…¨å±€çŠ¶æ€ç®¡ç†

#### 1ã€ä»€ä¹ˆæ˜¯å…¨å±€çŠ¶æ€ç®¡ç†ï¼Ÿ

æ˜¯æŒ‡å¤šä¸ªé¡µé¢éœ€è¦å…±äº«æˆ–è€…è·Ÿè¸ªå˜åŒ–çš„å˜é‡ï¼Œå¯ä»¥æ”¾åˆ°å…¨å±€æ¥ç»Ÿä¸€ç»´æŠ¤ï¼Œè€Œä¸æ˜¯æ¯ä¸ªé¡µé¢åˆ†åˆ«ç»´æŠ¤å’Œè·å–ã€‚

é€‚åˆä½œä¸ºå…¨å±€çŠ¶æ€çš„æ•°æ®ï¼šå·²ç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼ˆæ¯ä¸ªé¡µé¢å‡ ä¹éƒ½è¦ç”¨ï¼‰

åœ¨ Vue ä¸­ï¼Œä¸»æµçš„çŠ¶æ€ç®¡ç†åº“æœ‰ Vuex å’Œ Piniaï¼›åœ¨ React é¡¹ç›®ä¸­ï¼Œä¸»æµçš„çŠ¶æ€ç®¡ç†åº“æ˜¯ Reduxï¼Œæœ¬é¡¹ç›®ä¹Ÿå°†ä½¿ç”¨å®ƒã€‚

#### 2ã€Redux åŸºæœ¬æ¦‚å¿µ

React Redux å®˜æ–¹æ–‡æ¡£ï¼šhttps://react-redux.js.org/

Redux ä¸­æœ‰ä¸€äº›å¸¸ç”¨çš„æ ¸å¿ƒæ¦‚å¿µï¼Œä¸ç”¨ç†è§£ï¼Œç®€å•äº†è§£ä¸€ä¸‹å³å¯ã€‚

1ï¼‰Storeï¼šæ•´ä¸ªåº”ç”¨çŠ¶æ€ï¼ˆstateï¼‰çš„å®¹å™¨ï¼Œè´Ÿè´£å­˜å‚¨åº”ç”¨çš„çŠ¶æ€ï¼Œå¹¶æä¾›è®¿é—®çŠ¶æ€ã€æ´¾å‘ï¼ˆdispatchï¼‰åŠ¨ä½œä»¥åŠæ³¨å†Œç›‘å¬å™¨ç­‰åŠŸèƒ½ã€‚

2ï¼‰Actionï¼šä¸€ä¸ªæ™®é€šçš„ JavaScript å¯¹è±¡ï¼Œæè¿°äº†çŠ¶æ€å˜åŒ–çš„æ„å›¾ã€‚æ¯ä¸ª `action` å¿…é¡»åŒ…å«ä¸€ä¸ª `type` å­—æ®µï¼Œè¡¨ç¤ºåŠ¨ä½œç±»å‹ã€‚

ä¸€èˆ¬å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ä¼šç”¨ä¸€ä¸ªå­—ç¬¦ä¸²å¸¸é‡ï¼ˆAction Typesï¼‰æ¥æ ‡è¯†ä¸åŒçš„åŠ¨ä½œç±»å‹ã€‚æ¯”å¦‚æ”¹å˜è®¡æ•°å™¨éœ€è¦çš„ increment æˆ– decrementï¼š

```tsx
const INCREMENT = 'INCREMENT';
const DECREMENT = 'DECREMENT';
```

è¿˜ä¼šç”¨ Action Creators åŠ¨ä½œåˆ›å»ºå™¨å‡½æ•°æ¥ç”Ÿæˆ action å¯¹è±¡ï¼Œæ¯”å¦‚ï¼š

```tsx
const increment = () => ({
  type: INCREMENT,
});

const decrement = () => ({
  type: DECREMENT,
});
```

3ï¼‰Dispatchï¼šç”¨äºå‘é€ actionï¼Œè§¦å‘çŠ¶æ€æ›´æ–°ã€‚

4ï¼‰Reducerï¼šä¿—ç§°çŠ¶æ€å¤„ç†å™¨ï¼Œæ ¹æ®å½“å‰çŠ¶æ€å’Œä¼ å…¥çš„ action è¿”å›æ–°çš„çŠ¶æ€çš„å‡½æ•°ã€‚æ¯”å¦‚ï¼š

```tsx
const initialState = { count: 0 };

function counterReducer(state = initialState, action) {
  switch (action.type) {
    case INCREMENT:
      return { ...state, count: state.count + 1 };
    case DECREMENT:
      return { ...state, count: state.count - 1 };
    default:
      return state;
  }
}
```

å¯ä»¥é€šè¿‡ä¸€å¼ å›¾æ›´å¥½åœ°ç†è§£è¿™å‡ ä¸ªç»„ä»¶çš„å…³ç³»ï¼š 

![img](./assets/03-å‰ç«¯æ¨¡æ¿å¼€å‘/202408311533307-1737276768277-110.gif)

æ›´å¤šæ ¸å¿ƒæ¦‚å¿µå¯ä»¥åœ¨å®˜æ–¹æ–‡æ¡£äº†è§£ï¼šhttps://redux.js.org/tutorials/essentials/part-1-overview-concepts

#### 3ã€çŠ¶æ€ç®¡ç†å®æˆ˜

React Redux å®˜æ–¹å…¥é—¨æ–‡æ¡£ï¼šhttps://react-redux.js.org/tutorials/quick-start

ç”±äºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ TypeScriptï¼Œè¿˜è¦å‚è€ƒ TypeScript çš„å¿«é€Ÿå¯åŠ¨æ–‡æ¡£ï¼šhttps://react-redux.js.org/tutorials/typescript-quick-start ã€‚å¯¹äºæ–°æ‰‹ï¼Œä¸Šé¢ä¸¤ä¸ªæ–‡æ¡£æœ€å¥½æŒ‰é¡ºåºé˜…è¯»ã€‚

å…¶å®ä»¥å‰ Redux çš„ä½¿ç”¨æˆæœ¬è¿˜æ˜¯ç¨å¾®æœ‰ç‚¹é«˜çš„ï¼Œä½†å®˜æ–¹æä¾›äº† Redux Toolkitï¼Œå¯ä»¥ç®€åŒ–ä½¿ç”¨ Redux çš„å¼€å‘ã€‚

1ï¼‰å®‰è£…

```shell
npm install @reduxjs/toolkit react-redux
```

2ï¼‰é…ç½® Store

Store æ˜¯æ•´ä¸ªåº”ç”¨çŠ¶æ€ï¼ˆstateï¼‰çš„å®¹å™¨ï¼Œè´Ÿè´£å­˜å‚¨åº”ç”¨çš„çŠ¶æ€ï¼Œå¹¶æä¾›è®¿é—®çŠ¶æ€ã€æ´¾å‘ï¼ˆdispatchï¼‰åŠ¨ä½œä»¥åŠæ³¨å†Œç›‘å¬å™¨ç­‰åŠŸèƒ½ã€‚

åœ¨é¡¹ç›®çš„ src ç›®å½•ä¸‹æ–°å»º `stores` ç›®å½•ï¼Œç”¨äºå­˜æ”¾æ‰€æœ‰çš„çŠ¶æ€ã€‚ç„¶ååœ¨ `stores` ç›®å½•ä¸‹æ–°å»º `index.ts` æ–‡ä»¶ï¼Œåˆ›å»ºä¸€ä¸ªç©ºçš„ Redux Storeï¼š

```tsx
import { configureStore } from "@reduxjs/toolkit";

const store = configureStore({
  reducer: {
    // åœ¨è¿™é‡Œå­˜æ”¾çŠ¶æ€
  },
});

// ç”¨äºç±»å‹æ¨æ–­å’Œæç¤º
export type RootState = ReturnType<typeof store.getState>
export type AppDispatch = typeof store.dispatch

export default store;
```

3ï¼‰åœ¨é¡¹ç›®ä¸­å¼•å…¥ Redux Storeï¼Œä¿®æ”¹ `app/layout.tsx` é¡¹ç›®å…¨å±€å…¥å£æ–‡ä»¶å³å¯ï¼š

```typescript
import store from '@/stores'
import { Provider } from 'react-redux'

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {

  return (
    <html lang="en">
      <body>
        <AntdRegistry>
          <Provider store={store}>
            <BasicLayout>{children}</BasicLayout>
          </Provider>
        </AntdRegistry>
      </body>
    </html>
  );
}
```

4ï¼‰å®šä¹‰ Slice

Slice æ˜¯ Redux Toolkit ä¸­çš„æ¦‚å¿µï¼Œå®ƒå°†çŠ¶æ€å’Œç›¸å…³çš„ reducer é€»è¾‘ç»„ç»‡åœ¨ä¸€èµ·ï¼Œä¾¿äºæ¨¡å—åŒ–ç®¡ç†ã€‚æ¯ä¸ª slice é€šå¸¸ä»£è¡¨åº”ç”¨ä¸­çš„ä¸€éƒ¨åˆ†çŠ¶æ€ï¼ˆå¦‚ç”¨æˆ·ã€äº§å“ã€è´­ç‰©è½¦ç­‰ï¼‰ã€‚

ğŸ’¡ åœ¨æ²¡æœ‰ Redux Toolkit å’Œ Slice ä¹‹å‰ï¼Œä¼ ç»Ÿçš„ Redux å¼€å‘éœ€è¦å®šä¹‰ action typesã€action creators å’Œ reducer å‡½æ•°ï¼Œæ‰€æœ‰è¿™äº›é€šå¸¸éœ€è¦åœ¨ä¸åŒçš„æ–‡ä»¶ä¸­ç¼–å†™ï¼Œå¢åŠ äº†ä»£ç çš„å¤æ‚æ€§å’Œç»´æŠ¤æˆæœ¬ã€‚

åœ¨ `stores` ç›®å½•ä¸‹æ–°å»º `loginUser.ts`ï¼Œåˆ›å»ºä¸€ä¸ª slice ç”¨äºå­˜å‚¨å½“å‰ç™»å½•ç”¨æˆ·çš„ä¿¡æ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š

```tsx
import { createSlice, PayloadAction } from "@reduxjs/toolkit";
import { RootState } from "@/stores/index";

// é»˜è®¤ç”¨æˆ·
const DEFAULT_USER: API.LoginUserVO = {
  userName: "æœªç™»å½•",
  userProfile: "æš‚æ— ç®€ä»‹",
  userAvatar: "/assets/notLoginUser.png",
  userRole: "guest",
};

/**
 * ç™»å½•ç”¨æˆ·å…¨å±€çŠ¶æ€
 */
export const loginUserSlice = createSlice({
  name: "loginUser",
  initialState: DEFAULT_USER,
  reducers: {
    setLoginUser: (state, action: PayloadAction<API.LoginUserVO>) => {
      return {
        ...action.payload,
      };
    },
  },
});

// ä¿®æ”¹çŠ¶æ€
export const { setLoginUser } = loginUserSlice.actions;

export default loginUserSlice.reducer;
```

ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æä¾›ç»™æœªç™»å½•ç”¨æˆ·ä¸€ä¸ªå¤´åƒï¼Œæ”¾åˆ° `/public/assets` ç›®å½•ä¸‹ï¼Œåç§°ä¸º `notLoginUser.png`ã€‚å¦‚å›¾ï¼š

![img](./assets/03-å‰ç«¯æ¨¡æ¿å¼€å‘/iG9oN6unIlYIW5JG-1737276768278-111.png)

5ï¼‰åœ¨ Store ä¸­å¼•å…¥æ–°åˆ›å»ºçš„ Sliceï¼Œå†™åœ¨ reducer é‡Œï¼š

```tsx
import loginUser from "./loginUser";

const store = configureStore({
  reducer: {
    loginUser,
  },
});
```

6ï¼‰è·å–çŠ¶æ€

æ³¨æ„ï¼ŒçŠ¶æ€æ˜¯ç»´æŠ¤åœ¨å®¢æˆ·ç«¯çš„ï¼Œå¯ä»¥åœ¨ä»»æ„ **å®¢æˆ·ç«¯æ¸²æŸ“** é¡µé¢ï¼ˆæˆ–ç»„ä»¶ï¼‰ä¸­ä½¿ç”¨çŠ¶æ€ï¼ŒæœåŠ¡ç«¯æ¸²æŸ“æ— æ³•ä½¿ç”¨ã€‚

ä½¿ç”¨ä¸‹åˆ—è¯­æ³•è·å–çŠ¶æ€ï¼š

```tsx
const loginUser = useSelector((state: RootState) => state.loginUser);
```

æ¯”å¦‚å¯ä»¥åœ¨ BasicLayout ä¸­æ·»åŠ ä¸Šè¿°ä»£ç ï¼Œç„¶ååœ¨é¡µé¢ä¸­ç›´æ¥å±•ç¤ºï¼š

```typescript
{ JSON.stringify(loginUser) }
```

èƒ½å¤Ÿçœ‹åˆ°çŠ¶æ€çš„åˆå§‹å€¼ï¼š

![img](./assets/03-å‰ç«¯æ¨¡æ¿å¼€å‘/l5B4vR1dlDJLrfux-1737276768278-112.webp)

é¡¶éƒ¨å¯¼èˆªæ å³ä¾§å±•ç¤ºç™»å½•çŠ¶æ€ã€‚ä¿®æ”¹ BasicLayout ä¸­ ProLayout çš„ avatarProps çš„å€¼å³å¯ã€‚

```tsx
avatarProps={{
  src: loginUser.userAvatar || "/assets/logo.png",
  size: "small",
  title: loginUser.userName || "é±¼çš®é¸­",
}
```

æ•ˆæœå¦‚ä¸‹ï¼š

![img](./assets/03-å‰ç«¯æ¨¡æ¿å¼€å‘/LRtirzQWauW6yjzO-1737276768278-113.png)

7ï¼‰ä¿®æ”¹çŠ¶æ€

ä¿®æ”¹çŠ¶æ€ä¹Ÿå¾ˆæ–¹ä¾¿ï¼Œå¯ä»¥åœ¨ **é¦–æ¬¡è¿›å…¥åˆ°é¡µé¢** æ—¶ï¼Œå°è¯•è·å–ç™»å½•ç”¨æˆ·ä¿¡æ¯ã€‚ä¿®æ”¹ `app/layout.tsx` çš„å…¨å±€åˆå§‹åŒ–é€»è¾‘ï¼Œç¼–å†™è¿œç¨‹è·å–ç™»å½•ç”¨æˆ·æ•°æ®çš„ä»£ç ï¼š

```typescript
/**
 * åˆå§‹åŒ–å¸ƒå±€ï¼ˆå¤šå°è£…ä¸€å±‚ï¼Œä½¿å¾—èƒ½è°ƒç”¨ useDispatchï¼‰
 * @param children
 * @constructor
 */
const InitLayout: React.FC<
  Readonly<{
    children: React.ReactNode;
  }>
> = ({ children }) => {
  const dispatch = useDispatch<AppDispatch>();

  // åˆå§‹åŒ–å…¨å±€ç”¨æˆ·çŠ¶æ€
  const doInitLoginUser = useCallback(async () => {
    // è·å–ç”¨æˆ·ä¿¡æ¯
    const res = await getLoginUserUsingGet();
    if (res.data) {
      dispatch(setLoginUser(res.data));
    } else {
      // todo æµ‹è¯•ä»£ç ï¼Œå®é™…å¯åˆ é™¤
      setTimeout(() => {
        const testUser = { userName: "æµ‹è¯•ç™»å½•", id: 1 };
        dispatch(setLoginUser(testUser));
      }, 3000);
    }
  }, []);

  useEffect(() => {
    doInitLoginUser();
  }, []);

  return <>{children}</>;
};
```

å…¶ä¸­ï¼Œé€šè¿‡ dispatch è§¦å‘å…¨å±€çŠ¶æ€çš„æ›´æ–°ï¼š

```typescript
// å…ˆè·å– dispatch
const dispatch = useDispatch<AppDispatch>();
// è§¦å‘æ›´æ–°
dispatch(setLoginUser({...}));
```

æ•ˆæœå¦‚ä¸‹ï¼š

![img](./assets/03-å‰ç«¯æ¨¡æ¿å¼€å‘/qzsWof1Q7PHsbE8u.png)

æµ‹è¯•å®Œæˆåå¯ä»¥ç§»é™¤ç™»å½•æŒ‰é’®ã€‚

#### æ‰©å±•

æœ‰äº›é¡µé¢å¯ä»¥ä¸ç”¨è·å–å…¨å±€åˆå§‹åŒ–çŠ¶æ€ï¼Œæ¯”å¦‚ç”¨æˆ·ç™»å½•å’Œç”¨æˆ·æ³¨å†Œé¡µï¼Œå¯ä»¥æ ¹æ® pathname åˆ¤æ–­ï¼š

```typescript
// è·å–å½“å‰é¡µé¢è·¯å¾„
const pathname = usePathname();

// ç™»å½•å’Œæ³¨å†Œé¡µä¸ç”¨è·å–ç™»å½•ä¿¡æ¯
if (
  !pathname.startsWith("/user/login") &&
  !pathname.startsWith("/user/register")
) {
  ...
}
```

### å…¨å±€æƒé™ç®¡ç†

éœ€æ±‚ï¼šèƒ½å¤Ÿçµæ´»é…ç½®æ¯ä¸ªé¡µé¢æ‰€éœ€è¦çš„ç”¨æˆ·æƒé™ï¼Œç”±å…¨å±€æƒé™ç®¡ç†ç³»ç»Ÿè‡ªåŠ¨æ ¡éªŒå’Œæ‹¦æˆªï¼Œè€Œä¸éœ€è¦åœ¨æ¯ä¸ªé¡µé¢ä¸­ç¼–å†™æƒé™æ ¡éªŒä»£ç ï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚

è¿˜è¦èƒ½å¤Ÿæ ¹æ®æƒé™æ§åˆ¶å¯¼èˆªèœå•çš„æ˜¾éšï¼Œåªæœ‰å…·æœ‰æƒé™çš„èœå•ï¼Œæ‰å¯¹ç”¨æˆ·å¯è§ã€‚

#### å®ç°æ–¹æ¡ˆ

1. åœ¨è·¯ç”±é…ç½®æ–‡ä»¶ï¼Œ å®šä¹‰æŸä¸ªè·¯ç”±çš„è®¿é—®æƒé™ã€‚ç”±äº Next.js é¡¹ç›®æ˜¯çº¦å®šå¼è·¯ç”±ï¼Œåªæœ‰æˆ‘ä»¬è‡ªå®šä¹‰çš„èœå•é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥åœ¨èœå•é…ç½®æ–‡ä»¶ä¸­å®šä¹‰æƒé™ã€‚
2. æ¯æ¬¡è®¿é—®é¡µé¢æ—¶ï¼Œæ ¹æ®ç”¨æˆ·è¦è®¿é—®é¡µé¢çš„è·¯ç”±æƒé™ä¿¡æ¯ï¼Œåˆ¤æ–­ç”¨æˆ·æ˜¯å¦æœ‰å¯¹åº”çš„è®¿é—®æƒé™ï¼Œå¹¶è¿›è¡Œç›¸åº”çš„æ‹¦æˆªå¤„ç†ã€‚è¿™æ˜¯ä¸€ä¸ªå…¨å±€é€»è¾‘ï¼Œå¯ä»¥åœ¨é¡¹ç›®æ ¹å¸ƒå±€ `app/layout.tsx` ä¸­æ·»åŠ ã€‚
3. å¯¼èˆªæ å±•ç¤ºèœå•æ—¶ï¼Œå¯ä»¥è¿‡æ»¤æ‰ç™»å½•ç”¨æˆ·æ²¡æœ‰æƒé™çš„èœå•é¡¹ï¼Œä»è€Œå®ç°æ ¹æ®æƒé™æ§åˆ¶å¯¼èˆªèœå•çš„æ˜¾éšã€‚

#### å¼€å‘å®ç°

1ï¼‰åœ¨ app ç›®å½•ä¸‹æ–°å»º forbidden æ— æƒé™é¡µé¢ï¼Œå†…å®¹éšä¾¿å†™ï¼Œæ¯”å¦‚ï¼š

```tsx
import { Result, Button } from "antd";
import React from "react";

/**
 * æ— æƒé™è®¿é—®
 * @constructor
 */
const Forbidden = () => {
  return (
    <Result
      status="403"
      title="403"
      subTitle="æŠ±æ­‰ï¼Œæ‚¨æ— æƒè®¿é—®æ­¤é¡µé¢ã€‚ "
      extra={
        <Button type="primary" href="/">
          è¿”å›ä¸»é¡µ
        </Button>
      }
    />
  );
};

export default Forbidden;
```

2ï¼‰åœ¨ src ä¸‹æ–°å»º access ç›®å½•ï¼Œæ‰€æœ‰æƒé™ç®¡ç†ç›¸å…³çš„ä»£ç éƒ½æ”¾åœ¨è¯¥ç›®å½•ä¸‹ï¼Œæ¨¡å—åŒ–ã€‚åªè¦ä¸å¼•å…¥ï¼Œå°±ä¸ä¼šç”Ÿæ•ˆã€‚

å…ˆåœ¨ç›®å½•ä¸­å®šä¹‰æƒé™æšä¸¾æ–‡ä»¶ accessEnum.tsï¼š

```typescript
/**
 * æƒé™å®šä¹‰
 */
const ACCESS_ENUM = {
  NOT_LOGIN: "notLogin",
  USER: "user",
  ADMIN: "admin",
};

export default ACCESS_ENUM;
```

æœ‰äº†æšä¸¾ç±»åï¼Œå¯ä»¥å°†å…¨å±€çŠ¶æ€ä¸­çš„é»˜è®¤ç”¨æˆ·æƒé™æ”¹ä¸º â€œæœªç™»å½•â€ï¼š

```typescript
const DEFAULT_USER: API.LoginUserVO = {
  userName: "æœªç™»å½•",
  userProfile: "æš‚æ— ç®€ä»‹",
  userAvatar: "/assets/notLoginUser.png",
  userRole: AccessEnum.NOT_LOGIN,
};
```

3ï¼‰åœ¨èœå•é…ç½®æ–‡ä»¶ menus.tsx ä¸­è¡¥å……å¯¹äºæƒé™çš„é…ç½®ã€‚æ¯”å¦‚ï¼š

```typescript
{
  path: "/admin",
  name: "ç®¡ç†",
  icon: <CrownOutlined />,
  access: ACCESS_ENUM.ADMIN,
  children: [
    {
      path: "/admin/user",
      name: "ç”¨æˆ·ç®¡ç†",
      access: ACCESS_ENUM.ADMIN,
    },
  ],
},
```

4ï¼‰ç¼–å†™é€šç”¨çš„æƒé™æ ¡éªŒæ–¹æ³•ã€‚

ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºèœå•ç»„ä»¶ä¸­è¦åˆ¤æ–­æƒé™ã€æƒé™æ‹¦æˆªä¹Ÿè¦ç”¨åˆ°æƒé™åˆ¤æ–­åŠŸèƒ½ï¼Œæ‰€ä»¥æŠ½ç¦»æˆå…¬å…±æ¨¡å—ã€‚

æ–°å»º checkAccess.ts æ–‡ä»¶ï¼Œä»£ç å¦‚ä¸‹ï¼š

```typescript
import ACCESS_ENUM from "@/access/accessEnum";

/**
 * æ£€æŸ¥æƒé™ï¼ˆåˆ¤æ–­å½“å‰ç™»å½•ç”¨æˆ·æ˜¯å¦å…·æœ‰æŸä¸ªæƒé™ï¼‰
 * @param loginUser å½“å‰ç™»å½•ç”¨æˆ·
 * @param needAccess éœ€è¦æœ‰çš„æƒé™
 * @return boolean æœ‰æ— æƒé™
 */
const checkAccess = (loginUser: API.LoginUserVO, needAccess = ACCESS_ENUM.NOT_LOGIN) => {
  // è·å–å½“å‰ç™»å½•ç”¨æˆ·å…·æœ‰çš„æƒé™ï¼ˆå¦‚æœæ²¡æœ‰ loginUserï¼Œåˆ™è¡¨ç¤ºæœªç™»å½•ï¼‰
  const loginUserAccess = loginUser?.userRole ?? ACCESS_ENUM.NOT_LOGIN;
  if (needAccess === ACCESS_ENUM.NOT_LOGIN) {
    return true;
  }
  // å¦‚æœç”¨æˆ·ç™»å½•æ‰èƒ½è®¿é—®
  if (needAccess === ACCESS_ENUM.USER) {
    // å¦‚æœç”¨æˆ·æ²¡ç™»å½•ï¼Œé‚£ä¹ˆè¡¨ç¤ºæ— æƒé™
    if (loginUserAccess === ACCESS_ENUM.NOT_LOGIN) {
      return false;
    }
  }
  // å¦‚æœéœ€è¦ç®¡ç†å‘˜æƒé™
  if (needAccess === ACCESS_ENUM.ADMIN) {
    // å¦‚æœä¸ä¸ºç®¡ç†å‘˜ï¼Œè¡¨ç¤ºæ— æƒé™
    if (loginUserAccess !== ACCESS_ENUM.ADMIN) {
      return false;
    }
  }
  return true;
};

export default checkAccess;
```

å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦ï¼Œä¿®æ”¹åˆ¤æ–­æƒé™çš„é€»è¾‘ã€‚

5ï¼‰æ–°å¢æƒé™æ ¡éªŒå¸ƒå±€ AccessLayout.tsxï¼Œé€»è¾‘å¦‚ä¸‹ï¼š

1. è·å–åˆ° pathname å’Œ loginUser
2. æ ¹æ® pathname è·å–åˆ°å¯¹åº”çš„èœå•é¡¹é…ç½®ï¼Œå¹¶è·å–åˆ°æ‰€éœ€çš„æƒé™
3. è°ƒç”¨ checkAccess å‡½æ•°æ£€æµ‹æ˜¯å¦å…·æœ‰æƒé™ã€‚å¦‚æœæœ‰ï¼Œåˆ™æ­£å¸¸è¿”å›å†…å®¹ï¼›å¦‚æœæ²¡æœ‰ï¼Œè¿”å›åˆ°æ— æƒé™é¡µé¢ã€‚

å¯ä»¥å…ˆåœ¨ menus.tsx ä¸­ç¼–å†™ â€œæ ¹æ® pathname è·å–åˆ°èœå•é¡¹é…ç½®â€ çš„å‡½æ•°ï¼Œä½¿ç”¨é€’å½’å®ç°ï¼š

```tsx
// æ ¹æ®è·¯å¾„æŸ¥æ‰¾æ‰€æœ‰èœå•
export const findAllMenuItemByPath = (path: string): MenuDataItem | null => {
  return findMenuItemByPath(menus, path);
};

// æ ¹æ®è·¯å¾„æŸ¥æ‰¾èœå•
export const findMenuItemByPath = (
  menus: MenuDataItem[],
  path: string,
): MenuDataItem | null => {
  for (const menu of menus) {
    if (menu.path === path) {
      return menu;
    }
    if (menu.children) {
      const matchedMenuItem = findMenuItemByPath(menu.children, path);
      if (matchedMenuItem) {
        return matchedMenuItem;
      }
    }
  }
  return null;
};
```

ç”±äºè¯¥æ–‡ä»¶å¯¼å‡ºäº†å¤šä¸ªå‡½æ•°ï¼Œéœ€è¦å°† export default menus æ”¹ä¸º export menusï¼š

```tsx
// ä¿®æ”¹èœå•é¡¹å¯¼å‡ºæ–¹å¼ä¸º export
export const menus = [...];
```

å¹¶ä¸”åŒæ—¶ä¿®æ”¹ BasicLayout ä¸­çš„å¼•å…¥ä»£ç ï¼š

```tsx
import { menus } from "../../../config/menus";
```

ç„¶åå°±å¯ä»¥ç¼–å†™æƒé™æ ¡éªŒå¸ƒå±€ AccessLayout.tsxï¼Œä»£ç å¦‚ä¸‹ï¼š

```tsx
import { useSelector } from "react-redux";
import { RootState } from "@/stores";
import { usePathname } from "next/navigation";
import checkAccess from "@/access/checkAccess";
import Forbidden from "@/app/forbidden";
import React from "react";
import { findAllMenuItemByPath } from "../../config/menus";
import AccessEnum from "@/access/accessEnum";

/**
 * ç»Ÿä¸€æƒé™æ ¡éªŒæ‹¦æˆªå™¨
 * @param children
 * @constructor
 */
const AccessLayout: React.FC<
  Readonly<{
    children: React.ReactNode;
  }>
> = ({ children }) => {
  const pathname = usePathname();
  const loginUser = useSelector((state: RootState) => state.loginUser);
  // æƒé™æ ¡éªŒ
  const menu = findAllMenuItemByPath(pathname) || {};
  const needAccess = menu?.access ?? AccessEnum.NOT_LOGIN;
  const canAccess = checkAccess(loginUser, needAccess);
  if (!canAccess) {
    return <Forbidden />;
  }
  return <>{children}</>;
};

export default AccessLayout;
```

å¯ä»¥åœ¨ RootLayout ä¸­å¼•å…¥ï¼ŒåµŒå…¥åˆ° BasicLayout ä¸­ï¼š

```tsx
export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="zh">
      <body>
        <AntdRegistry>
          <Provider store={store}>
            <InitLayout>
              <BasicLayout>
                <AccessLayout>{children}</AccessLayout>
              </BasicLayout>
            </InitLayout>
          </Provider>
        </AntdRegistry>
      </body>
    </html>
  );
}
```

è®¿é—® /admin/user é¡µé¢ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š

![img](./assets/03-å‰ç«¯æ¨¡æ¿å¼€å‘/aJQqCD0udNiKyfUE-1737276768278-114.webp)

6ï¼‰æ ¹æ®æƒé™æ§åˆ¶èœå•æ˜¾éš

æ–°å»º menuAccess.ts æ–‡ä»¶ï¼Œæä¾›è·å–å¯è®¿é—®èœå•çš„å‡½æ•°ï¼š

```typescript
import checkAccess from "@/access/checkAccess";
import { menus } from "../../config/menus";

/**
 * è·å–æœ‰æƒé™ã€å¯è®¿é—®çš„èœå•
 * @param loginUser
 * @param menuItems
 */
const getAccessibleMenus = (loginUser: API.LoginUserVO, menuItems = menus) => {
  return menuItems.filter((item) => {
    if (!checkAccess(loginUser, item.access)) {
      return false;
    }
    if (item.children) {
      item.children = getAccessibleMenus(loginUser, item.children);
    }
    return true;
  });
};

export default getAccessibleMenus;
```

#### æ‰©å±•

è¿˜æœ‰å…¶ä»–å®ç°æƒé™æ ¡éªŒçš„æ–¹æ³•ï¼Œæ¯”å¦‚ä½¿ç”¨é«˜é˜¶ç»„ä»¶ï¼ˆHOCï¼‰åœ¨å®¢æˆ·ç«¯è¿›è¡Œæƒé™æ ¡éªŒï¼Œè¿™ç§æ–¹æ³•ä¼šæ›´çµæ´»ã€‚

åˆ›å»ºä¸€ä¸ª HOC ç»„ä»¶ï¼š

```tsx
// components/withAuth.js
import { useRouter } from 'next/router';
import { useEffect } from 'react';
import { useSelector } from 'react-redux'; // æˆ–è€…ä½¿ç”¨å…¶ä»–å…¨å±€çŠ¶æ€ç®¡ç†åº“

export default function withAuth(Component) {
  return function AuthenticatedComponent(props) {
    const router = useRouter();
    const isAuthenticated = useSelector((state) => state.auth.isAuthenticated); // è·å–ç”¨æˆ·ç™»å½•çŠ¶æ€

    useEffect(() => {
      if (!isAuthenticated) {
        // å¦‚æœæœªç™»å½•ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µé¢
        router.push('/login');
      }
    }, [isAuthenticated]);

    // å¦‚æœæœªç™»å½•ï¼Œä¸æ¸²æŸ“ç»„ä»¶
    if (!isAuthenticated) {
      return null;
    }

    // å¦‚æœå·²ç™»å½•ï¼Œæ¸²æŸ“ç»„ä»¶
    return <Component {...props} />;
  };
}
```

ä½¿ç”¨è¿™ä¸ª HOC åŒ…è£¹éœ€è¦è¿›è¡Œæƒé™æ ¡éªŒçš„é¡µé¢ï¼š

```tsx
// pages/protected.js
import withAuth from '@/components/withAuth';

function ProtectedPage() {
  return <div>This is a protected page.</div>;
}

export default withAuth(ProtectedPage);
```

### é€šç”¨ç»„ä»¶ - Markdown ç¼–è¾‘å™¨ç»„ä»¶

ä¸ºä»€ä¹ˆç”¨ Markdownï¼Ÿ

ä¸€å¥—é€šç”¨çš„æ–‡æœ¬ç¼–è¾‘è¯­æ³•ï¼Œå¯ä»¥åœ¨å„å¤§ç½‘ç«™ä¸Šç»Ÿä¸€æ ‡å‡†ã€æ¸²æŸ“å‡ºç»Ÿä¸€çš„æ ·å¼ï¼Œæ¯”è¾ƒç®€å•æ˜“å­¦ã€‚

æ¨èçš„ Md ç¼–è¾‘å™¨ï¼šhttps://github.com/bytedance/bytemd

é˜…è¯»å®˜æ–¹æ–‡æ¡£ï¼Œæ‰§è¡Œå‘½ä»¤æ¥å®‰è£…ç¼–è¾‘å™¨ä¸»ä½“ã€ä»¥åŠ gfmï¼ˆè¡¨æ ¼æ”¯æŒï¼‰æ’ä»¶ã€highlight ä»£ç é«˜äº®æ’ä»¶ï¼š

```shell
npm i @bytemd/react
npm i @bytemd/plugin-highlight @bytemd/plugin-gfm
```

åœ¨ `/src/components` ç›®å½•ä¸­æ–°å»º MdEditor ç»„ä»¶ï¼Œç¼–å†™ä»£ç ï¼š

```tsx
import { Editor } from "@bytemd/react";
import gfm from "@bytemd/plugin-gfm";
import highlight from "@bytemd/plugin-highlight";
import "bytemd/dist/index.css";
import "highlight.js/styles/vs.css";
import "./index.css";

interface Props {
  value?: string;
  onChange?: (v: string) => void;
  placeholder?: string;
}

const plugins = [gfm(), highlight()];

/**
 * Markdown ç¼–è¾‘å™¨
 * @param props
 * @constructor
 */
const MdEditor = (props: Props) => {
  const { value = "", onChange, placeholder } = props;

  return (
    <div className="md-editor">
      <Editor
        value={value}
        placeholder={placeholder}
        mode="split"
        plugins={plugins}
        onChange={onChange}
      />
    </div>
  );
};

export default MdEditor;
```

ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬è¦æŠŠ MdEditor å½“å‰è¾“å…¥çš„å€¼æš´éœ²ç»™çˆ¶ç»„ä»¶ï¼Œä¾¿äºçˆ¶ç»„ä»¶å»ä½¿ç”¨ï¼ŒåŒæ—¶ä¹Ÿæ˜¯æé«˜ç»„ä»¶çš„é€šç”¨æ€§ï¼Œæ‰€ä»¥å®šä¹‰äº†å±æ€§å’Œå±æ€§ç±»å‹ï¼ŒæŠŠ value å’Œ onChange äº‹ä»¶äº¤ç»™çˆ¶ç»„ä»¶å»ç®¡ç†ã€‚

å¯ä»¥æŒ‰ç…§å®˜æ–¹æ–‡æ¡£å¯¹ç¼–è¾‘å™¨è¿›è¡Œå¾ˆå¤šå®šåˆ¶æ“ä½œï¼Œæ¯”å¦‚åˆ‡æ¢è¯­è¨€ä¸ºä¸­æ–‡ã€åˆ‡æ¢ä¸»é¢˜æ ·å¼ã€å®‰è£…æ›´å¤šæ’ä»¶ç­‰ç­‰ã€‚å¦‚æœå‘ç°å®˜æ–¹ç»™çš„æ“ä½œæ— æ³•æ»¡è¶³å®šåˆ¶éœ€æ±‚å’Œæ ·å¼ï¼Œå¯ä»¥ä½¿ç”¨è¦†ç›– CSSã€è‡ªå·±å†™ JS çš„æ–¹å¼é­”æ”¹ã€‚

æ¯”å¦‚éšè—ç¼–è¾‘å™¨ä¸­ä¸éœ€è¦çš„æ“ä½œå›¾æ ‡ï¼ˆåƒ GitHub å›¾æ ‡ï¼‰ï¼š

```css
.bytemd-toolbar-icon.bytemd-tippy.bytemd-tippy-right:last-child {
    display: none;
}
```

æœ‰ç¼–è¾‘å™¨å°±æœ‰æµè§ˆå™¨ï¼ŒMdViewer ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

```tsx
import { Viewer } from "@bytemd/react";
import gfm from "@bytemd/plugin-gfm";
import highlight from "@bytemd/plugin-highlight";
import "bytemd/dist/index.css";
import "highlight.js/styles/vs.css";
import "./index.css";

interface Props {
  value?: string;
}

const plugins = [gfm(), highlight()];

/**
 * Markdown æµè§ˆå™¨
 * @param props
 * @constructor
 */
const MdViewer = (props: Props) => {
  const { value = "" } = props;

  return (
    <div className="md-viewer">
      <Viewer value={value} plugins={plugins} />
    </div>
  );
};

export default MdViewer;
```

å¯ä»¥åœ¨ä»»æ„å®¢æˆ·ç«¯æ¸²æŸ“é¡µé¢ï¼ˆæˆ–ç»„ä»¶ï¼‰å¼•å…¥ç»„ä»¶è¿›è¡Œæµ‹è¯•ï¼Œè¿™æ˜¯å› ä¸ºè¯¥ç»„ä»¶ç”¨åˆ°äº† useRef ä¹‹ç±»çš„ä»…å®¢æˆ·ç«¯æ‰æ”¯æŒçš„å‡½æ•°ã€‚æ¯”å¦‚åœ¨ BasicLayout ä¸­å¼•å…¥ï¼š

```tsx
const [text, setText] = useState<string>('');

<MdEditor value={text} onChange={setText} />
<MdViewer value={text} />
```

æ•ˆæœå¦‚å›¾ï¼š

![img](./assets/03-å‰ç«¯æ¨¡æ¿å¼€å‘/2dIMMmhrxUfWNLPd-1737276768278-115.webp)

### æ¸…ç†æ— ç”¨æ–‡ä»¶

æœ€åï¼Œå¯ä»¥å†æ¸…ç†ä¸€äº›æ— ç”¨æ–‡ä»¶ï¼Œæ¯”å¦‚æ²¡ç”¨åˆ°çš„ public èµ„æºã€æ¨¡æ¿è‡ªå¸¦çš„é¡µé¢ä»£ç ç­‰ã€‚

æˆ‘ä»¬çš„ä¸‡ç”¨åŸºç¡€å‰ç«¯é¡¹ç›®æ¨¡æ¿ï¼ˆå’Œä¸šåŠ¡æ— å…³ï¼‰å°±æå®šå•¦ï¼æ¥ä¸‹æ¥æ­£å¼è¿›å…¥å¼€å‘ã€‚

## å››ã€æ‰©å±•æ€è·¯

#### 1ã€å‰ç«¯æ¨¡æ¿æ”¯æŒå¤šå¥—å¸ƒå±€

éœ€æ±‚ï¼šä¸æ˜¯æ‰€æœ‰é¡µé¢éƒ½èƒ½ç»Ÿä¸€å¸ƒå±€ï¼Œæ¯”å¦‚ç”¨æˆ·ç™»å½•æ³¨å†Œé¡µå¯ä»¥ä¸éœ€è¦å¯¼èˆªæ ï¼Œå› æ­¤æ¨¡æ¿éœ€è¦å¤šå¥—å¸ƒå±€èƒ½åŠ›ã€‚

å®ç°æ€è·¯ï¼šç°åœ¨ layouts ç›®å½•ä¸­æ–°å®šä¹‰ä¸€å¥—å¸ƒå±€ã€‚ç„¶åä¿®æ”¹ `app/layout.tsx`ï¼Œå°†å†™æ­»çš„ BasicLayout å¸ƒå±€æ”¹ä¸ºä¸€ä¸ª getLayout å‡½æ•°ï¼Œå‡½æ•°å†…æ ¹æ®å½“å‰è·¯ç”±åœ°å€ï¼Œè¿”å›ä¸åŒçš„ Layout å¸ƒå±€ã€‚

#### 2ã€å‰ç«¯æ¨¡æ¿æ”¯æŒåµŒå¥—èœå•é…ç½®

å®Œå–„å‰ç«¯é¡¹ç›®æ¨¡æ¿çš„å¯¼èˆªèœå•ï¼Œæ ¹æ®åµŒå¥—è·¯ç”±ç”ŸæˆåµŒå¥—çš„å­èœå•ï¼Œå¦‚ä¸‹å›¾ï¼š

![img](./assets/03-å‰ç«¯æ¨¡æ¿å¼€å‘/GhWRU2zWfW8d5hrU-1737276768278-116.webp)

#### 3ã€å‰ç«¯å…¨å±€é”™è¯¯å¤„ç†

å‰ç«¯é¡µé¢å‡ºç°ä»»ä½•è‡´å‘½é”™è¯¯æ—¶ï¼Œä¸æ˜¯ç™½å±ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªé”™è¯¯æç¤ºé¡µé¢ã€‚

å¯ä»¥å‚è€ƒ Next.js çš„å®˜æ–¹æ–‡æ¡£å®ç°ï¼šhttps://nextjs.org/docs/app/api-reference/file-conventions/error
